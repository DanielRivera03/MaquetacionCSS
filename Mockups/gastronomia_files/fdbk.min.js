function countUp(a,b,c,d,e){for(var f=0,g=["webkit","moz","ms"],h=0;h<g.length&&!window.requestAnimationFrame;++h)window.requestAnimationFrame=window[g[h]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[g[h]+"CancelAnimationFrame"]||window[g[h]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=(new Date).getTime(),c=Math.max(0,16-(b-f)),d=window.setTimeout(function(){a(b+c)},c);return f=b+c,d}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)});var i=this;this.useEasing=!0,this.d=document.getElementById(a),i.startVal=Number(b),c=Number(c),this.countDown=b>c?!0:!1,d=Math.max(0,d||0),this.dec=Math.pow(10,d),this.duration=1e3*e||2e3,this.startTime=null,this.timestamp=null,this.remaining=null,this.frameVal=b,this.rAF=null,this.easeOutExpo=function(a,b,c,d){return 1024*c*(-Math.pow(2,-10*a/d)+1)/1023+b},this.count=function(a){null===i.startTime&&(i.startTime=a),i.timestamp=a;var e=a-i.startTime;if(i.remaining=i.duration-e,i.useEasing)if(i.countDown){var f=i.easeOutExpo(e,0,i.startVal-c,i.duration);i.frameVal=b-f}else i.frameVal=i.easeOutExpo(e,i.startVal,c-i.startVal,i.duration);else if(i.countDown){var f=(i.startVal-c)*(e/i.duration);i.frameVal=i.startVal-f}else i.frameVal=i.startVal+(c-i.startVal)*(e/i.duration);i.frameVal=Math.round(i.frameVal*i.dec)/i.dec,i.frameVal=i.countDown?i.frameVal<c?c:i.frameVal:i.frameVal>c?c:i.frameVal,i.d.innerHTML=i.addCommas(i.frameVal.toFixed(d)),e<i.duration?i.rAF=requestAnimationFrame(i.count):null!=i.callback&&i.callback()},this.start=function(a){return i.callback=a,isNaN(c)||isNaN(b)?(console.log("countUp error: startVal or endVal is not a number"),i.d.innerHTML="--"):i.rAF=requestAnimationFrame(i.count),!1},this.stop=function(){cancelAnimationFrame(i.rAF)},this.reset=function(){cancelAnimationFrame(i.rAF),i.d.innerHTML=i.addCommas(b.toFixed(d))},this.resume=function(){i.startTime=null,i.duration=i.remaining,i.startVal=i.frameVal,requestAnimationFrame(i.count)},this.addCommas=function(a){a+="";var b,c,d,e;for(b=a.split("."),c=b[0],d=b.length>1?"."+b[1]:"",e=/(\d+)(\d{3})/;e.test(c);)c=c.replace(e,"$1,$2");return c+d},i.d.innerHTML=i.addCommas(b.toFixed(d))}function DelayedQueue(){this.tasks=[],this.paused=!1}(function(a,b,c){function d(a){var b=document.documentElement.style,c;if(typeof b[a]=="string")return a;a=e(a);for(var d=0,g=f.length;d<g;d++){c=f[d]+a;if(typeof b[c]=="string")return c}}function e(a){return a.charAt(0).toUpperCase()+a.slice(1)}var f="Moz Webkit Khtml O Ms".split(" "),g=d("transform"),h={csstransforms:function(){return!!g},csstransforms3d:function(){var a=!!d("perspective");if(a){var c=" -o- -moz- -ms- -webkit- -khtml- ".split(" "),e="@media ("+c.join("transform-3d),(")+"modernizr)",f=b("<style>"+e+"{#modernizr{height:3px}}"+"</style>").appendTo("head"),g=b('<div id="modernizr" />').appendTo("html");a=g.height()===3,g.remove(),f.remove()}return a},csstransitions:function(){return!!d("transitionProperty")}};if(a.Modernizr)for(var i in h)Modernizr.hasOwnProperty(i)||Modernizr.addTest(i,h[i]);else a.Modernizr=function(){var a={_version:"1.6ish: miniModernizr for Isotope"},c=" ",d,e;for(e in h)d=h[e](),a[e]=d,c+=" "+(d?"":"no-")+e;return b("html").addClass(c),a}();if(Modernizr.csstransforms){var j=Modernizr.csstransforms3d?{translate:function(a){return"translate3d("+a[0]+"px, "+a[1]+"px, 0) "},scale:function(a){return"scale3d("+a+", "+a+", 1) "}}:{translate:function(a){return"translate("+a[0]+"px, "+a[1]+"px) "},scale:function(a){return"scale("+a+") "}},k=function(a,c,d){var e=b.data(a,"isoTransform")||{},f={},h,i={},k;f[c]=d,b.extend(e,f);for(h in e)k=e[h],i[h]=j[h](k);var l=i.translate||"",m=i.scale||"",n=l+m;b.data(a,"isoTransform",e),a.style[g]=n};b.cssNumber.scale=!0,b.cssHooks.scale={set:function(a,b){k(a,"scale",b)},get:function(a,c){var d=b.data(a,"isoTransform");return d&&d.scale?d.scale:1}},b.fx.step.scale=function(a){b.cssHooks.scale.set(a.elem,a.now+a.unit)},b.cssNumber.translate=!0,b.cssHooks.translate={set:function(a,b){k(a,"translate",b)},get:function(a,c){var d=b.data(a,"isoTransform");return d&&d.translate?d.translate:[0,0]}}}var l=b.event,m;l.special.smartresize={setup:function(){b(this).bind("resize",l.special.smartresize.handler)},teardown:function(){b(this).unbind("resize",l.special.smartresize.handler)},handler:function(a,b){var c=this,d=arguments;a.type="smartresize",m&&clearTimeout(m),m=setTimeout(function(){jQuery.event.handle.apply(c,d)},b==="execAsap"?0:100)}},b.fn.smartresize=function(a){return a?this.bind("smartresize",a):this.trigger("smartresize",["execAsap"])},b.Isotope=function(a,c){this.element=b(c),this._create(a),this._init()};var n=["overflow","position","width","height"];b.Isotope.settings={resizable:!0,layoutMode:"masonry",containerClass:"isotope",itemClass:"isotope-item",hiddenClass:"isotope-hidden",hiddenStyle:Modernizr.csstransforms&&!b.browser.opera?{opacity:0,scale:.001}:{opacity:0},visibleStyle:Modernizr.csstransforms&&!b.browser.opera?{opacity:1,scale:1}:{opacity:1},animationEngine:b.browser.opera?"jquery":"best-available",animationOptions:{queue:!1,duration:800},sortBy:"original-order",sortAscending:!0,resizesContainer:!0,transformsEnabled:!0,itemPositionDataEnabled:!1},b.Isotope.prototype={_create:function(c){this.options=b.extend({},b.Isotope.settings,c),this.styleQueue=[],this.elemCount=0;var d=this.element[0].style;this.originalStyle={};for(var e=0,f=n.length;e<f;e++){var g=n[e];this.originalStyle[g]=d[g]||""}this.element.css({overflow:"hidden",position:"relative"}),this._updateAnimationEngine(),this._updateUsingTransforms();var h={"original-order":function(a,b){return b.elemCount},random:function(){return Math.random()}};this.options.getSortData=b.extend(this.options.getSortData,h),this.reloadItems();var i=b(document.createElement("div")).prependTo(this.element);this.offset=i.position(),i.remove();var j=this;setTimeout(function(){j.element.addClass(j.options.containerClass)},0),this.options.resizable&&b(a).bind("smartresize.isotope",function(){j.resize()}),this.element.delegate("."+this.options.hiddenClass,"click",function(){return!1})},_getAtoms:function(a){var b=this.options.itemSelector,c=b?a.filter(b).add(a.find(b)):a,d={position:"absolute"};return this.usingTransforms&&(d.left=0,d.top=0),c.css(d).addClass(this.options.itemClass),this.updateSortData(c,!0),c},_init:function(a){this.$filteredAtoms=this._filter(this.$allAtoms),this._sort(),this.reLayout(a)},option:function(a){if(b.isPlainObject(a)){this.options=b.extend(!0,this.options,a);var c;for(var d in a)c="_update"+e(d),this[c]&&this[c]()}},_updateAnimationEngine:function(){var a=this.options.animationEngine.toLowerCase().replace(/[ _\-]/g,"");switch(a){case"css":case"none":this.isUsingJQueryAnimation=!1;break;case"jquery":this.isUsingJQueryAnimation=!0;break;default:this.isUsingJQueryAnimation=!Modernizr.csstransitions}this._updateUsingTransforms()},_updateTransformsEnabled:function(){this._updateUsingTransforms()},_updateUsingTransforms:function(){this.usingTransforms=this.options.transformsEnabled&&Modernizr.csstransforms&&Modernizr.csstransitions&&!this.isUsingJQueryAnimation,this.getPositionStyles=this.usingTransforms?this._translate:this._positionAbs},_filter:function(a){var b=this.options.filter===""?"*":this.options.filter;if(!b)return a;var c=this.options.hiddenClass,d="."+c,e=a.filter(d),f=e;if(b!=="*"){f=e.filter(b);var g=a.not(d).not(b).addClass(c);this.styleQueue.push({$el:g,style:this.options.hiddenStyle})}return this.styleQueue.push({$el:f,style:this.options.visibleStyle}),f.removeClass(c),a.filter(b)},updateSortData:function(a,c){var d=this,e=this.options.getSortData,f,g;a.each(function(){f=b(this),g={};for(var a in e)g[a]=e[a](f,d);b.data(this,"isotope-sort-data",g),c&&d.elemCount++})},_sort:function(){var a=this.options.sortBy,b=this._getSorter,c=this.options.sortAscending?1:-1,d=function(d,e){var f=b(d,a),g=b(e,a);return f===g&&a!=="original-order"&&(f=b(d,"original-order"),g=b(e,"original-order")),(f>g?1:f<g?-1:0)*c};this.$filteredAtoms.sort(d)},_getSorter:function(a,c){return b.data(a,"isotope-sort-data")[c]},_translate:function(a,b){return{translate:[a,b]}},_positionAbs:function(a,b){return{left:a,top:b}},_pushPosition:function(a,b,c){b+=this.offset.left,c+=this.offset.top;var d=this.getPositionStyles(b,c);this.styleQueue.push({$el:a,style:d}),this.options.itemPositionDataEnabled&&a.data("isotope-item-position",{x:b,y:c})},layout:function(a,b){var c=this.options.layoutMode;this["_"+c+"Layout"](a);if(this.options.resizesContainer){var d=this["_"+c+"GetContainerSize"]();this.styleQueue.push({$el:this.element,style:d})}this._processStyleQueue(),b&&b.call(a),this.isLaidOut=!0},_processStyleQueue:function(){var a=this.isLaidOut?this.isUsingJQueryAnimation?"animate":"css":"css",c=this.options.animationOptions,d=this._isInserting&&this.isUsingJQueryAnimation,e;b.each(this.styleQueue,function(b,f){e=d&&f.$el.hasClass("no-transition")?"css":a,f.$el[e](f.style,c)}),this.styleQueue=[]},resize:function(){this["_"+this.options.layoutMode+"ResizeChanged"]()&&this.reLayout()},reLayout:function(a){this["_"+this.options.layoutMode+"Reset"](),this.layout(this.$filteredAtoms,a)},addItems:function(a,b){var c=this._getAtoms(a);this.$allAtoms=this.$allAtoms.add(c),b&&b(c)},insert:function(a,b){this.element.append(a);var c=this;this.addItems(a,function(a){var d=c._filter(a,!0);c._addHideAppended(d),c._sort(),c.reLayout(),c._revealAppended(d,b)})},appended:function(a,b){var c=this;this.addItems(a,function(a){c._addHideAppended(a),c.layout(a),c._revealAppended(a,b)})},_addHideAppended:function(a){this.$filteredAtoms=this.$filteredAtoms.add(a),a.addClass("no-transition"),this._isInserting=!0,this.styleQueue.push({$el:a,style:this.options.hiddenStyle})},_revealAppended:function(a,b){var c=this;setTimeout(function(){a.removeClass("no-transition"),c.styleQueue.push({$el:a,style:c.options.visibleStyle}),c._processStyleQueue(),delete c._isInserting,b&&b(a)},10)},reloadItems:function(){this.$allAtoms=this._getAtoms(this.element.children())},remove:function(a){this.$allAtoms=this.$allAtoms.not(a),this.$filteredAtoms=this.$filteredAtoms.not(a),a.remove()},shuffle:function(){this.updateSortData(this.$allAtoms),this.options.sortBy="random",this._sort(),this.reLayout()},destroy:function(){var c=this.usingTransforms;this.$allAtoms.removeClass(this.options.hiddenClass+" "+this.options.itemClass).each(function(){this.style.position="",this.style.top="",this.style.left="",this.style.opacity="",c&&(this.style[g]="")});var d=this.element[0].style;for(var e=0,f=n.length;e<f;e++){var h=n[e];d[h]=this.originalStyle[h]}this.element.unbind(".isotope").undelegate("."+this.options.hiddenClass,"click").removeClass(this.options.containerClass).removeData("isotope"),b(a).unbind(".isotope")},_getSegments:function(a){var b=this.options.layoutMode,c=a?"rowHeight":"columnWidth",d=a?"height":"width",f=a?"rows":"cols",g=this.element[d](),h,i=this.options[b]&&this.options[b][c]||this.$filteredAtoms["outer"+e(d)](!0)||g;h=Math.floor(g/i),h=Math.max(h,1),this[b][f]=h,this[b][c]=i},_checkIfSegmentsChanged:function(a){var b=this.options.layoutMode,c=a?"rows":"cols",d=this[b][c];return this._getSegments(a),this[b][c]!==d},_masonryReset:function(){this.masonry={},this._getSegments();var a=this.masonry.cols;this.masonry.colYs=[];while(a--)this.masonry.colYs.push(0)},_masonryLayout:function(a){var c=this,d=c.masonry;a.each(function(){var a=b(this),e=Math.ceil(a.outerWidth(!0)/d.columnWidth);e=Math.min(e,d.cols);if(e===1)c._masonryPlaceBrick(a,d.colYs);else{var f=d.cols+1-e,g=[],h,i;for(i=0;i<f;i++)h=d.colYs.slice(i,i+e),g[i]=Math.max.apply(Math,h);c._masonryPlaceBrick(a,g)}})},_masonryPlaceBrick:function(a,b){var c=Math.min.apply(Math,b),d=0;for(var e=0,f=b.length;e<f;e++)if(b[e]===c){d=e;break}var g=this.masonry.columnWidth*d,h=c;this._pushPosition(a,g,h);var i=c+a.outerHeight(!0),j=this.masonry.cols+1-f;for(e=0;e<j;e++)this.masonry.colYs[d+e]=i},_masonryGetContainerSize:function(){var a=Math.max.apply(Math,this.masonry.colYs);return{height:a}},_masonryResizeChanged:function(){return this._checkIfSegmentsChanged()},_fitRowsReset:function(){this.fitRows={x:0,y:0,height:0}},_fitRowsLayout:function(a){var c=this,d=this.element.width(),e=this.fitRows;a.each(function(){var a=b(this),f=a.outerWidth(!0),g=a.outerHeight(!0);e.x!==0&&f+e.x>d&&(e.x=0,e.y=e.height),c._pushPosition(a,e.x,e.y),e.height=Math.max(e.y+g,e.height),e.x+=f})},_fitRowsGetContainerSize:function(){return{height:this.fitRows.height}},_fitRowsResizeChanged:function(){return!0},_cellsByRowReset:function(){this.cellsByRow={index:0},this._getSegments(),this._getSegments(!0)},_cellsByRowLayout:function(a){var c=this,d=this.cellsByRow;a.each(function(){var a=b(this),e=d.index%d.cols,f=~~(d.index/d.cols),g=(e+.5)*d.columnWidth-a.outerWidth(!0)/2,h=(f+.5)*d.rowHeight-a.outerHeight(!0)/2;c._pushPosition(a,g,h),d.index++})},_cellsByRowGetContainerSize:function(){return{height:Math.ceil(this.$filteredAtoms.length/this.cellsByRow.cols)*this.cellsByRow.rowHeight+this.offset.top}},_cellsByRowResizeChanged:function(){return this._checkIfSegmentsChanged()},_straightDownReset:function(){this.straightDown={y:0}},_straightDownLayout:function(a){var c=this;a.each(function(a){var d=b(this);c._pushPosition(d,0,c.straightDown.y),c.straightDown.y+=d.outerHeight(!0)})},_straightDownGetContainerSize:function(){return{height:this.straightDown.y}},_straightDownResizeChanged:function(){return!0},_masonryHorizontalReset:function(){this.masonryHorizontal={},this._getSegments(!0);var a=this.masonryHorizontal.rows;this.masonryHorizontal.rowXs=[];while(a--)this.masonryHorizontal.rowXs.push(0)},_masonryHorizontalLayout:function(a){var c=this,d=c.masonryHorizontal;a.each(function(){var a=b(this),e=Math.ceil(a.outerHeight(!0)/d.rowHeight);e=Math.min(e,d.rows);if(e===1)c._masonryHorizontalPlaceBrick(a,d.rowXs);else{var f=d.rows+1-e,g=[],h,i;for(i=0;i<f;i++)h=d.rowXs.slice(i,i+e),g[i]=Math.max.apply(Math,h);c._masonryHorizontalPlaceBrick(a,g)}})},_masonryHorizontalPlaceBrick:function(a,b){var c=Math.min.apply(Math,b),d=0;for(var e=0,f=b.length;e<f;e++)if(b[e]===c){d=e;break}var g=c,h=this.masonryHorizontal.rowHeight*d;this._pushPosition(a,g,h);var i=c+a.outerWidth(!0),j=this.masonryHorizontal.rows+1-f;for(e=0;e<j;e++)this.masonryHorizontal.rowXs[d+e]=i},_masonryHorizontalGetContainerSize:function(){var a=Math.max.apply(Math,this.masonryHorizontal.rowXs);return{width:a}},_masonryHorizontalResizeChanged:function(){return this._checkIfSegmentsChanged(!0)},_fitColumnsReset:function(){this.fitColumns={x:0,y:0,width:0}},_fitColumnsLayout:function(a){var c=this,d=this.element.height(),e=this.fitColumns;a.each(function(){var a=b(this),f=a.outerWidth(!0),g=a.outerHeight(!0);e.y!==0&&g+e.y>d&&(e.x=e.width,e.y=0),c._pushPosition(a,e.x,e.y),e.width=Math.max(e.x+f,e.width),e.y+=g})},_fitColumnsGetContainerSize:function(){return{width:this.fitColumns.width}},_fitColumnsResizeChanged:function(){return!0},_cellsByColumnReset:function(){this.cellsByColumn={index:0},this._getSegments(),this._getSegments(!0)},_cellsByColumnLayout:function(a){var c=this,d=this.cellsByColumn;a.each(function(){var a=b(this),e=~~(d.index/d.rows),f=d.index%d.rows,g=(e+.5)*d.columnWidth-a.outerWidth(!0)/2,h=(f+.5)*d.rowHeight-a.outerHeight(!0)/2;c._pushPosition(a,g,h),d.index++})},_cellsByColumnGetContainerSize:function(){return{width:Math.ceil(this.$filteredAtoms.length/this.cellsByColumn.rows)*this.cellsByColumn.columnWidth}},_cellsByColumnResizeChanged:function(){return this._checkIfSegmentsChanged(!0)},_straightAcrossReset:function(){this.straightAcross={x:0}},_straightAcrossLayout:function(a){var c=this;a.each(function(a){var d=b(this);c._pushPosition(d,c.straightAcross.x,0),c.straightAcross.x+=d.outerWidth(!0)})},_straightAcrossGetContainerSize:function(){return{width:this.straightAcross.x}},_straightAcrossResizeChanged:function(){return!0}},b.fn.imagesLoaded=function(a){function b(){--f<=0&&this.src!==h&&(setTimeout(d),e.unbind("load error",b))}function d(){a.call(g,e)}var e=this.find("img"),f=e.length,g=this,h="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";return f||d(),e.bind("load error",b).each(function(){if(this.complete||this.complete===c){var a=this.src;this.src=h,this.src=a}}),this};var o=function(a){this.console&&console.error(a)};b.fn.isotope=function(a){if(typeof a=="string"){var c=Array.prototype.slice.call(arguments,1);this.each(function(){var d=b.data(this,"isotope");if(!d)o("cannot call methods on isotope prior to initialization; attempted to call method '"+a+"'");else{if(!b.isFunction(d[a])||a.charAt(0)==="_"){o("no such method '"+a+"' for isotope instance");return}d[a].apply(d,c)}})}else this.each(function(){var c=b.data(this,"isotope");c?(c.option(a),c._init()):b.data(this,"isotope",new b.Isotope(a,this))});return this}})(window,jQuery),function(a){function d(b){var c=b||window.event,d=[].slice.call(arguments,1),e=0,f=!0,g=0,h=0;return b=a.event.fix(c),b.type="mousewheel",c.wheelDelta&&(e=c.wheelDelta/120),c.detail&&(e=-c.detail/3),h=e,c.axis!==undefined&&c.axis===c.HORIZONTAL_AXIS&&(h=0,g=-1*e),c.wheelDeltaY!==undefined&&(h=c.wheelDeltaY/120),c.wheelDeltaX!==undefined&&(g=-1*c.wheelDeltaX/120),d.unshift(b,e,g,h),(a.event.dispatch||a.event.handle).apply(this,d)}var b=["DOMMouseScroll","mousewheel"];if(a.event.fixHooks)for(var c=b.length;c;)a.event.fixHooks[b[--c]]=a.event.mouseHooks;a.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=b.length;a;)this.addEventListener(b[--a],d,!1);else this.onmousewheel=d},teardown:function(){if(this.removeEventListener)for(var a=b.length;a;)this.removeEventListener(b[--a],d,!1);else this.onmousewheel=null}},a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}(jQuery),function(a){a.cookie=function(b,c,d){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(c))||c===null||c===undefined)){d=a.extend({},d);if(c===null||c===undefined)d.expires=-1;if(typeof d.expires=="number"){var e=d.expires,f=d.expires=new Date;f.setDate(f.getDate()+e)}return c=String(c),document.cookie=[encodeURIComponent(b),"=",d.raw?c:encodeURIComponent(c),d.expires?"; expires="+d.expires.toUTCString():"",d.path?"; path="+d.path:"",d.domain?"; domain="+d.domain:"",d.secure?"; secure":""].join("")}d=c||{};var g=d.raw?function(a){return a}:decodeURIComponent,h=document.cookie.split("; ");for(var i=0,j;j=h[i]&&h[i].split("=");i++)if(g(j[0])===b)return g(j[1]||"");return null}}(jQuery),function(a,b){function c(a,b,c){this._d=a,this._isUTC=!!b,this._a=a._a||null,a._a=null,this._lang=c||!1}function d(a){var b=this._data={},c=a.years||a.y||0,d=a.months||a.M||0,f=a.weeks||a.w||0,g=a.days||a.d||0,h=a.hours||a.h||0,i=a.minutes||a.m||0,j=a.seconds||a.s||0,k=a.milliseconds||a.ms||0;this._milliseconds=k+j*1e3+i*6e4+h*36e5,this._days=g+f*7,this._months=d+c*12,b.milliseconds=k%1e3,j+=e(k/1e3),b.seconds=j%60,i+=e(j/60),b.minutes=i%60,h+=e(i/60),b.hours=h%24,g+=e(h/24),g+=f*7,b.days=g%30,d+=e(g/30),b.months=d%12,c+=e(d/12),b.years=c,this._lang=!1}function e(a){return a<0?Math.ceil(a):Math.floor(a)}function f(a,b){var c=a+"";while(c.length<b)c="0"+c;return c}function g(a,b,c){var d=b._milliseconds,e=b._days,f=b._months,g;d&&a._d.setTime(+a+d*c),e&&a.date(a.date()+e*c),f&&(g=a.date(),a.date(1).month(a.month()+f*c).date(Math.min(g,a.daysInMonth())))}function h(a){return Object.prototype.toString.call(a)==="[object Array]"}function i(a,b){var c=Math.min(a.length,b.length),d=Math.abs(a.length-b.length),e=0,f;for(f=0;f<c;f++)~~a[f]!==~~b[f]&&e++;return e+d}function j(b,c){var d,e;for(d=1;d<7;d++)b[d]=b[d]==null?d===2?1:0:b[d];return b[7]=c,e=new a(0),c?(e.setUTCFullYear(b[0],b[1],b[2]),e.setUTCHours(b[3],b[4],b[5],b[6])):(e.setFullYear(b[0],b[1],b[2]),e.setHours(b[3],b[4],b[5],b[6])),e._a=b,e}function k(a,b){var c,d,e=[];!b&&H&&(b=require("./lang/"+a));for(c=0;c<I.length;c++)b[I[c]]=b[I[c]]||F.en[I[c]];for(c=0;c<12;c++)d=B([2e3,c]),e[c]=new RegExp("^"+(b.months[c]||b.months(d,""))+"|^"+(b.monthsShort[c]||b.monthsShort(d,"")).replace(".",""),"i");return b.monthsParse=b.monthsParse||e,F[a]=b,b}function l(a){var b=typeof a=="string"&&a||a&&a._lang||null;return b?F[b]||k(b):B}function m(a){return ba[a]?"'+("+ba[a]+")+'":a.replace(M,"").replace(/\\?'/g,"\\'")}function n(a){return l().longDateFormat[a]||a}function o(a){var b="var a,b;return '"+a.replace(K,m)+"';",c=Function;return new c("t","v","o","p","m",b)}function p(a){return _[a]||(_[a]=o(a)),_[a]}function q(a,b){function c(c,e){return d[c].call?d[c](a,b):d[c][e]}var d=l(a);while(L.test(b))b=b.replace(L,n);return _[b]||(_[b]=o(b)),_[b](a,c,d.ordinal,f,d.meridiem)}function r(a){switch(a){case"DDDD":return Q;case"YYYY":return R;case"S":case"SS":case"SSS":case"DDD":return P;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return S;case"Z":case"ZZ":return T;case"T":return U;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return O;default:return new RegExp(a.replace("\\",""))}}function s(a,b,c,d){var e;switch(a){case"M":case"MM":c[1]=b==null?0:~~b-1;break;case"MMM":case"MMMM":for(e=0;e<12;e++)if(l().monthsParse[e].test(b)){c[1]=e;break}break;case"D":case"DD":case"DDD":case"DDDD":b!=null&&(c[2]=~~b);break;case"YY":b=~~b,c[0]=b+(b>70?1900:2e3);break;case"YYYY":c[0]=~~Math.abs(b);break;case"a":case"A":d.isPm=(b+"").toLowerCase()==="pm";break;case"H":case"HH":case"h":case"hh":c[3]=~~b;break;case"m":case"mm":c[4]=~~b;break;case"s":case"ss":c[5]=~~b;break;case"S":case"SS":case"SSS":c[6]=~~(("0."+b)*1e3);break;case"Z":case"ZZ":d.isUTC=!0,e=(b+"").match(Y),e&&e[1]&&(d.tzh=~~e[1]),e&&e[2]&&(d.tzm=~~e[2]),e&&e[0]==="+"&&(d.tzh=-d.tzh,d.tzm=-d.tzm)}}function t(a,b){var c=[0,0,1,0,0,0,0],d={tzh:0,tzm:0},e=b.match(K),f,g;for(f=0;f<e.length;f++)g=(r(e[f]).exec(a)||[])[0],a=a.replace(r(e[f]),""),s(e[f],g,c,d);return d.isPm&&c[3]<12&&(c[3]+=12),d.isPm===!1&&c[3]===12&&(c[3]=0),c[3]+=d.tzh,c[4]+=d.tzm,j(c,d.isUTC)}function u(a,b){var d,e=a.match(N)||[],f,g=99,h,j,k;for(h=0;h<b.length;h++)j=t(a,b[h]),f=q(new c(j),b[h]).match(N)||[],k=i(e,f),k<g&&(g=k,d=j);return d}function v(b){var c="YYYY-MM-DDT",d;if(V.exec(b)){for(d=0;d<4;d++)if(X[d][1].exec(b)){c+=X[d][0];break}return T.exec(b)?t(b,c+" Z"):t(b,c)}return new a(b)}function w(a,b,c,d,e){var f=e.relativeTime[a];return typeof f=="function"?f(b||1,!!c,a,d):f.replace(/%d/i,b||1)}function x(a,b,c){var d=D(Math.abs(a)/1e3),e=D(d/60),f=D(e/60),g=D(f/24),h=D(g/365),i=d<45&&["s",d]||e===1&&["m"]||e<45&&["mm",e]||f===1&&["h"]||f<22&&["hh",f]||g===1&&["d"]||g<=25&&["dd",g]||g<=45&&["M"]||g<345&&["MM",D(g/30)]||h===1&&["y"]||["yy",h];return i[2]=b,i[3]=a>0,i[4]=c,w.apply({},i)}function y(a,b){B.fn[a]=function(a){var c=this._isUTC?"UTC":"";return a!=null?(this._d["set"+c+b](a),this):this._d["get"+c+b]()}}function z(a){B.duration.fn[a]=function(){return this._data[a]}}function A(a,b){B.duration.fn["as"+a]=function(){return+this/b}}var B,C="1.7.0",D=Math.round,E,F={},G="en",H=typeof module!="undefined"&&module.exports,I="months|monthsShort|weekdays|weekdaysShort|weekdaysMin|longDateFormat|calendar|relativeTime|ordinal|meridiem".split("|"),J=/^\/?Date\((\-?\d+)/i,K=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|zz?|ZZ?)/g,L=/(LT|LL?L?L?)/g,M=/(^\[)|(\\)|\]$/g,N=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,O=/\d\d?/,P=/\d{1,3}/,Q=/\d{3}/,R=/\d{1,4}/,S=/[0-9a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+/i,T=/Z|[\+\-]\d\d:?\d\d/i,U=/T/i,V=/^\s*\d{4}-\d\d-\d\d(T(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,W="YYYY-MM-DDTHH:mm:ssZ",X=[["HH:mm:ss.S",/T\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/T\d\d:\d\d:\d\d/],["HH:mm",/T\d\d:\d\d/],["HH",/T\d\d/]],Y=/([\+\-]|\d\d)/gi,Z="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),$={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},_={},ba={M:"(a=t.month()+1)",MMM:'v("monthsShort",t.month())',MMMM:'v("months",t.month())',D:"(a=t.date())",DDD:"(a=new Date(t.year(),t.month(),t.date()),b=new Date(t.year(),0,1),a=~~(((a-b)/864e5)+1.5))",d:"(a=t.day())",dd:'v("weekdaysMin",t.day())',ddd:'v("weekdaysShort",t.day())',dddd:'v("weekdays",t.day())',w:"(a=new Date(t.year(),t.month(),t.date()-t.day()+5),b=new Date(a.getFullYear(),0,4),a=~~((a-b)/864e5/7+1.5))",YY:"p(t.year()%100,2)",YYYY:"p(t.year(),4)",a:"m(t.hours(),t.minutes(),!0)",A:"m(t.hours(),t.minutes(),!1)",H:"t.hours()",h:"t.hours()%12||12",m:"t.minutes()",s:"t.seconds()",S:"~~(t.milliseconds()/100)",SS:"p(~~(t.milliseconds()/10),2)",SSS:"p(t.milliseconds(),3)",Z:'((a=-t.zone())<0?((a=-a),"-"):"+")+p(~~(a/60),2)+":"+p(~~a%60,2)',ZZ:'((a=-t.zone())<0?((a=-a),"-"):"+")+p(~~(10*a/6),4)'},bb="DDD w M D d".split(" "),bc="M D H h m s w".split(" ");while(bb.length)E=bb.pop(),ba[E+"o"]=ba[E]+"+o(a)";while(bc.length)E=bc.pop(),ba[E+E]="p("+ba[E]+",2)";ba.DDDD="p("+ba.DDD+",3)",B=function(d,e){if(d===null||d==="")return null;var f,g;return B.isMoment(d)?new c(new a(+d._d),d._isUTC,d._lang):(e?h(e)?f=u(d,e):f=t(d,e):(g=J.exec(d),f=d===b?new a:g?new a(+g[1]):d instanceof a?d:h(d)?j(d):typeof d=="string"?v(d):new a(d)),new c(f))},B.utc=function(a,b){return h(a)?new c(j(a,!0),!0):(typeof a=="string"&&!T.exec(a)&&(a+=" +0000",b&&(b+=" Z")),B(a,b).utc())},B.unix=function(a){return B(a*1e3)},B.duration=function(a,b){var c=B.isDuration(a),e=typeof a=="number",f=c?a._data:e?{}:a,g;return e&&(b?f[b]=a:f.milliseconds=a),g=new d(f),c&&(g._lang=a._lang),g},B.humanizeDuration=function(a,b,c){return B.duration(a,b===!0?null:b).humanize(b===!0?!0:c)},B.version=C,B.defaultFormat=W,B.lang=function(a,b){var c;if(!a)return G;(b||!F[a])&&k(a,b);if(F[a]){for(c=0;c<I.length;c++)B[I[c]]=F[a][I[c]];B.monthsParse=F[a].monthsParse,G=a}},B.langData=l,B.isMoment=function(a){return a instanceof c},B.isDuration=function(a){return a instanceof d},B.lang("en",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},meridiem:function(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(a){var b=a%10;return~~(a%100/10)===1?"th":b===1?"st":b===2?"nd":b===3?"rd":"th"}}),B.fn=c.prototype={clone:function(){return B(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1e3)},toString:function(){return this._d+""},toDate:function(){return this._d},toArray:function(){var a=this;return[a.year(),a.month(),a.date(),a.hours(),a.minutes(),a.seconds(),a.milliseconds(),!!this._isUTC]},isValid:function(){return this._a?!i(this._a,(this._a[7]?B.utc(this):this).toArray()):!isNaN(this._d.getTime())},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(a){return q(this,a?a:B.defaultFormat)},add:function(a,b){var c=b?B.duration(+b,a):B.duration(a);return g(this,c,1),this},subtract:function(a,b){var c=b?B.duration(+b,a):B.duration(a);return g(this,c,-1),this},diff:function(a,b,c){var d=this._isUTC?B(a).utc():B(a).local(),e=(this.zone()-d.zone())*6e4,f=this._d-d._d-e,g=this.year()-d.year(),h=this.month()-d.month(),i=this.date()-d.date(),j;return b==="months"?j=g*12+h+i/30:b==="years"?j=g+(h+i/30)/12:j=b==="seconds"?f/1e3:b==="minutes"?f/6e4:b==="hours"?f/36e5:b==="days"?f/864e5:b==="weeks"?f/6048e5:f,c?j:D(j)},from:function(a,b){return B.duration(this.diff(a)).lang(this._lang).humanize(!b)},fromNow:function(a){return this.from(B(),a)},calendar:function(){var a=this.diff(B().sod(),"days",!0),b=this.lang().calendar,c=b.sameElse,d=a<-6?c:a<-1?b.lastWeek:a<0?b.lastDay:a<1?b.sameDay:a<2?b.nextDay:a<7?b.nextWeek:c;return this.format(typeof d=="function"?d.apply(this):d)},isLeapYear:function(){var a=this.year();return a%4===0&&a%100!==0||a%400===0},isDST:function(){return this.zone()<B([this.year()]).zone()||this.zone()<B([this.year(),5]).zone()},day:function(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return a==null?b:this.add({d:a-b})},startOf:function(a){switch(a.replace(/s$/,"")){case"year":this.month(0);case"month":this.date(1);case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return this},endOf:function(a){return this.startOf(a).add(a.replace(/s?$/,"s"),1).subtract("ms",1)},sod:function(){return this.clone().startOf("day")},eod:function(){return this.clone().endOf("day")},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return B.utc([this.year(),this.month()+1,0]).date()},lang:function(a){return a===b?l(this):(this._lang=a,this)}};for(E=0;E<Z.length;E++)y(Z[E].toLowerCase(),Z[E]);y("year","FullYear"),B.duration.fn=d.prototype={weeks:function(){return e(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*864e5+this._months*2592e6},humanize:function(a){var b=+this,c=this.lang().relativeTime,d=x(b,!a,this.lang());return a&&(d=(b<=0?c.past:c.future).replace(/%s/i,d)),d},lang:B.fn.lang};for(E in $)$.hasOwnProperty(E)&&(A(E,$[E]),z(E.toLowerCase()));A("Weeks",6048e5),H&&(module.exports=B),typeof ender=="undefined"&&(this.moment=B),typeof define=="function"&&define.amd&&define("moment",[],function(){return B})}.call(this,Date),function(){var a=function(b,c){if(!(this instanceof a))return new a(b,c);this.tokenizers=b.splice?b:[b],c&&(this.doBuild=c)};a.prototype={parse:function(a){this.src=a,this.ended=!1,this.tokens=[];do this.next();while(!this.ended);return this.tokens},build:function(a,b){a&&this.tokens.push(this.doBuild?this.doBuild(a,b,this.tkn):a)},next:function(){var a=this,b;a.findMin(),b=a.src.slice(0,a.min),a.build(b,!1),a.src=a.src.slice(a.min).replace(a.tkn,function(b){return a.build(b,!0),""}),a.src||(a.ended=!0)},findMin:function(){var a=this,b=0,c,d;a.min=-1,a.tkn="";while((c=a.tokenizers[b++])!==undefined)d=a.src[c.test?"search":"indexOf"](c),d!=-1&&(a.min==-1||d<a.min)&&(a.tkn=c,a.min=d);a.min==-1&&(a.min=a.src.length)}},window.jQuery?(jQuery.tokenizer=a,a.fn=a.prototype):window.Tokenizer=a}(),function(a){function e(a,b){if(a.originalEvent.touches.length>1)return;a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent("MouseEvents");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),a.target.dispatchEvent(d)}a.support.touch="ontouchend"in document;if(!a.support.touch)return;var b=a.ui.mouse.prototype,c=b._mouseInit,d;b._touchStart=function(a){var b=this;if(d||!b._mouseCapture(a.originalEvent.changedTouches[0]))return;d=!0,b._touchMoved=!1,e(a,"mouseover"),e(a,"mousemove"),e(a,"mousedown")},b._touchMove=function(a){if(!d)return;this._touchMoved=!0,e(a,"mousemove")},b._touchEnd=function(a){if(!d)return;e(a,"mouseup"),e(a,"mouseout"),this._touchMoved||e(a,"click"),d=!1},b._mouseInit=function(){var b=this;b.element.bind("touchstart",a.proxy(b,"_touchStart")).bind("touchmove",a.proxy(b,"_touchMove")).bind("touchend",a.proxy(b,"_touchEnd")),c.call(b)}}(jQuery),function(a){a.fn.autoGrowInput=function(b){return b=a.extend({maxWidth:500,minWidth:70,comfortZone:20},b),this.filter("input:text").each(function(){a(this).parent().find("tester").remove();var c=b.minWidth||a(this).width(),d="",e=a(this),f=a("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:e.css("fontSize"),fontFamily:e.css("fontFamily"),fontWeight:e.css("fontWeight"),letterSpacing:e.css("letterSpacing"),whiteSpace:"nowrap"}),g=function(){if(d===(d=e.val()))return;var a=d.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");f.html(a);var g=f.width(),h=g+b.comfortZone>=c?g+b.comfortZone:c,i=e.width(),j=h<i&&h>=c||h>c&&h<b.maxWidth;j&&e.width(h)};f.insertAfter(e),a(this).bind("keyup keydown blur update",function(){g()})}),this}}(jQuery),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=[].slice,u=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},v=this;a=jQuery,a.payment={},a.payment.fn={},a.fn.payment=function(){var b,c;return c=arguments[0],b=2<=arguments.length?t.call(arguments,1):[],a.payment.fn[c].apply(this,b)},e=/(\d{1,4})/g,d=[{type:"maestro",pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,format:e,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"dinersclub",pattern:/^(36|38|30[0-5])/,format:e,length:[14],cvcLength:[3],luhn:!0},{type:"laser",pattern:/^(6706|6771|6709)/,format:e,length:[16,17,18,19],cvcLength:[3],luhn:!0},{type:"jcb",pattern:/^35/,format:e,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",pattern:/^62/,format:e,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"discover",pattern:/^(6011|65|64[4-9]|622)/,format:e,length:[16],cvcLength:[3],luhn:!0},{type:"mastercard",pattern:/^5[1-5]/,format:e,length:[16],cvcLength:[3],luhn:!0},{type:"amex",pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"visa",pattern:/^4/,format:e,length:[13,14,15,16],cvcLength:[3],luhn:!0}],b=function(a){var b,c,e;a=(a+"").replace(/\D/g,"");for(c=0,e=d.length;c<e;c++){b=d[c];if(b.pattern.test(a))return b}},c=function(a){var b,c,e;for(c=0,e=d.length;c<e;c++){b=d[c];if(b.type===a)return b}},m=function(a){var b,c,d,e,f,g;d=!0,e=0,c=(a+"").split("").reverse();for(f=0,g=c.length;f<g;f++){b=c[f],b=parseInt(b,10);if(d=!d)b*=2;b>9&&(b-=9),e+=b}return e%10===0},l=function(a){var b;return a.prop("selectionStart")!=null&&a.prop("selectionStart")!==a.prop("selectionEnd")?!0:(typeof document!="undefined"&&document!==null?(b=document.selection)!=null?typeof b.createRange=="function"?b.createRange().text:void 0:void 0:void 0)?!0:!1},n=function(b){var c=this;return setTimeout(function(){var c,d;return c=a(b.currentTarget),d=c.val(),d=a.payment.formatCardNumber(d),c.val(d)})},h=function(c){var d,e,f,g,h,i,j;f=String.fromCharCode(c.which);if(!/^\d+$/.test(f))return;d=a(c.currentTarget),j=d.val(),e=b(j+f),g=(j.replace(/\D/g,"")+f).length,i=16,e&&(i=e.length[e.length.length-1]);if(g>=i)return;if(d.prop("selectionStart")!=null&&d.prop("selectionStart")!==j.length)return;e&&e.type==="amex"?h=/^(\d{4}|\d{4}\s\d{6})$/:h=/(?:^|\s)(\d{4})$/;if(h.test(j))return c.preventDefault(),d.val(j+" "+f);if(h.test(j+f))return c.preventDefault(),d.val(j+f+" ")},f=function(b){var c,d;c=a(b.currentTarget),d=c.val();if(b.meta)return;if(c.prop("selectionStart")!=null&&c.prop("selectionStart")!==d.length)return;if(b.which===8&&/\s\d?$/.test(d))return b.preventDefault(),c.val(d.replace(/\s\d?$/,""))},i=function(b){var c,d,e;d=String.fromCharCode(b.which);if(!/^\d+$/.test(d))return;c=a(b.currentTarget),e=c.val()+d;if(/^\d$/.test(e)&&e!=="0"&&e!=="1")return b.preventDefault(),c.val("0"+e+" / ");if(/^\d\d$/.test(e))return b.preventDefault(),c.val(""+e+" / ")},j=function(b){var c,d,e;d=String.fromCharCode(b.which);if(!/^\d+$/.test(d))return;c=a(b.currentTarget),e=c.val();if(/^\d\d$/.test(e))return c.val(""+e+" / ")},k=function(b){var c,d,e;d=String.fromCharCode(b.which);if(d!=="/")return;c=a(b.currentTarget),e=c.val();if(/^\d$/.test(e)&&e!=="0")return c.val("0"+e+" / ")},g=function(b){var c,d;if(b.meta)return;c=a(b.currentTarget),d=c.val();if(b.which!==8)return;if(c.prop("selectionStart")!=null&&c.prop("selectionStart")!==d.length)return;if(/\s\/\s?\d?$/.test(d))return b.preventDefault(),c.val(d.replace(/\s\/\s?\d?$/,""))},r=function(a){var b;return a.metaKey||a.ctrlKey?!0:a.which===32?!1:a.which===0?!0:a.which<33?!0:(b=String.fromCharCode(a.which),!!/[\d\s]/.test(b))},p=function(c){var d,e,f,g;d=a(c.currentTarget),f=String.fromCharCode(c.which);if(!/^\d+$/.test(f))return;if(l(d))return;return g=(d.val()+f).replace(/\D/g,""),e=b(g),e?g.length<=e.length[e.length.length-1]:g.length<=16},q=function(b){var c,d,e;c=a(b.currentTarget),d=String.fromCharCode(b.which);if(!/^\d+$/.test(d))return;if(l(c))return;e=c.val()+d,e=e.replace(/\D/g,"");if(e.length>6)return!1},o=function(b){var c,d,e;c=a(b.currentTarget),d=String.fromCharCode(b.which);if(!/^\d+$/.test(d))return;return e=c.val()+d,e.length<=4},s=function(b){var c,e,f,g,h;c=a(b.currentTarget),h=c.val(),g=a.payment.cardType(h)||"unknown";if(!c.hasClass(g))return e=function(){var a,b,c;c=[];for(a=0,b=d.length;a<b;a++)f=d[a],c.push(f.type);return c}(),c.removeClass("unknown"),c.removeClass(e.join(" ")),c.addClass(g),c.toggleClass("identified",g!=="unknown"),c.trigger("payment.cardType",g)},a.payment.fn.formatCardCVC=function(){return this.payment("restrictNumeric"),this.on("keypress",o),this},a.payment.fn.formatCardExpiry=function(){return this.payment("restrictNumeric"),this.on("keypress",q),this.on("keypress",i),this.on("keypress",k),this.on("keypress",j),this.on("keydown",g),this},a.payment.fn.formatCardNumber=function(){return this.payment("restrictNumeric"),this.on("keypress",p),this.on("keypress",h),this.on("keydown",f),this.on("keyup",s),this.on("paste",n),this},a.payment.fn.restrictNumeric=function(){return this.on("keypress",r),this},a.payment.fn.cardExpiryVal=function(){return a.payment.cardExpiryVal(a(this).val())},a.payment.cardExpiryVal=function(a){var b,c,d,e;return a=a.replace(/\s/g,""),e=a.split("/",2),b=e[0],d=e[1],(d!=null?d.length:void 0)===2&&/^\d+$/.test(d)&&(c=(new Date).getFullYear(),c=(c+"").slice(0,2),d=c+d),b=parseInt(b,10),d=parseInt(d,10),{month:b,year:d}},a.payment.validateCardNumber=function(a){var c,d;return a=(a+"").replace(/\s+|-/g,""),/^\d+$/.test(a)?(c=b(a),c?(d=a.length,u.call(c.length,d)>=0)&&(c.luhn===!1||m(a)):!1):!1},a.payment.validateCardExpiry=function(b,c){var d,e,f,g;return typeof b=="object"&&"month"in b&&(g=b,b=g.month,c=g.year),!b||!c?!1:(b=a.trim(b),c=a.trim(c),/^\d+$/.test(b)?/^\d+$/.test(c)?parseInt(b,10)<=12?(c.length===2&&(f=(new Date).getFullYear(),f=(f+"").slice(0,2),c=f+c),e=new Date(c,b),d=new Date,e.setMonth(e.getMonth()-1),e.setMonth(e.getMonth()+1,1),e>d):!1:!1:!1)},a.payment.validateCardCVC=function(b,d){var e,f;return b=a.trim(b),/^\d+$/.test(b)?d?(e=b.length,u.call((f=c(d))!=null?f.cvcLength:void 0,e)>=0):b.length>=3&&b.length<=4:!1},a.payment.cardType=function(a){var c;return a?((c=b(a))!=null?c.type:void 0)||null:null},a.payment.formatCardNumber=function(a){var c,d,e,f;return c=b(a),c?(e=c.length[c.length.length-1],a=a.replace(/\D/g,""),a=a.slice(0,+e+1||9e9),c.format.global?(f=a.match(c.format))!=null?f.join(" "):void 0:(d=c.format.exec(a),d!=null&&d.shift(),d!=null?d.join(" "):void 0)):a}}.call(this),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();var Sequoia=function(a,b){this.init(a,b)};Sequoia.prototype.init=function(a,b){this.options={nesting:!0,scrollThreshold:20,scrollIncrement:1,dragThreshold:5,dataAttribute:"id"},this.list=a;for(var c in b)this.options[c]=b[c];this._mousedown=this._mousedown.bind(this),this._mousemove=this._mousemove.bind(this),this._mouseup=this._mouseup.bind(this),this._scroll=this._scroll.bind(this),this._linePlaceholder=document.getElementById("line-placeholder"),this._ghost=document.getElementById("sortable-ghost"),this._ghost.classList.add("drag-ghost"),this.enable()},Sequoia.prototype._mousedown=function(a){var b=a.target;b=this.findItem(b),b&&(this._item=b,document.addEventListener("mousemove",this._mousemove),document.addEventListener("mouseup",this._mouseup),this._listBBox=this.list.getBoundingClientRect(),this._initPos=a)},Sequoia.prototype._mousemove=function(a){!this.dragging&&this._screenDistance(a,this._initPos)>this.options.dragThreshold&&(this.dragging=!0,this._ghost.classList.add("dragging"),this.callback("start"),this._item.classList.add("drag-source"),this.list.style.cursor="default"),this.dragging&&(this._ghost.style.top=a.clientY+"px",this._ghost.style.left=a.clientX+"px",Math.abs(a.clientY-this._listBBox.top-this._listBBox.height)<this.options.scrollThreshold?this._scrollDirection="down":Math.abs(a.clientY-this._listBBox.top)<this.options.scrollThreshold?this._scrollDirection="up":this._scrollDirection=null,window.requestAnimFrame(this._scroll),this.showPlaceholder(a),this.callback("drag"))},Sequoia.prototype._screenDistance=function(a,b){return Math.sqrt(Math.pow(a.clientX-b.clientX,2)+Math.pow(a.clientY-b.clientY,2))},Sequoia.prototype._mouseup=function(a){this.callback("done");if(this.dragging){this._item.classList.remove("drag-source"),this.removePlaceholder();var b=this._item.parentNode;b=this.findItem(b);if(this._target)switch(this._targetPosition){case"before":this._target.parentNode.insertBefore(this._item,this._target);break;case"after":this._target.parentNode.insertBefore(this._item,this._target.nextSibling);break;case"over":var c=this._target.querySelector("ul");c||(c=document.createElement("ul"),this._target.appendChild(c)),c.appendChild(this._item)}if(b){var c=b.querySelector("ul");c&&!c.children.length&&b.removeChild(c)}this.callback("stop",this._item),this._ghost.classList.remove("dragging")}document.removeEventListener("mousemove",this._mousemove),document.removeEventListener("mouseup",this._mouseup),this._item=null,this._target=null,this._scrollDirection=null,this._initPos=null,this.dragging=!1},Sequoia.prototype.callback=function(){var a=arguments[0];this.options.hasOwnProperty(a)&&typeof this.options[a]=="function"&&this.options[a].apply(this,Array.prototype.slice.call(arguments,1))},Sequoia.prototype.showPlaceholder=function(a){var b=a.clientX,c=a.clientY,d=document.elementFromPoint(b,c);d=this.findItem(d),this.removePlaceholder(),this._target=null,this._targetPosition=null;if(d){var e=d.getBoundingClientRect(),f=(c-e.top)/e.height*100,g=d.getBoundingClientRect();f<35?(this._linePlaceholder.style.top=g.top+"px",this._linePlaceholder.style.left=g.left+"px",this._linePlaceholder.style.maxWidth=g.width+"px",this._linePlaceholder.style.display="block",this._targetPosition="before",this._target=d):f>65?(this._linePlaceholder.style.top=g.top+g.height+"px",this._linePlaceholder.style.left=g.left+"px",this._linePlaceholder.style.display="block",this._targetPosition="after",this._target=d):this.options.nesting&&(this._target=d,this._targetPosition="over",this._target.classList.add("droptarget"))}},Sequoia.prototype.removePlaceholder=function(){this._linePlaceholder.style.display="none",this._target&&this._target.classList.remove("droptarget")},Sequoia.prototype.findItem=function(a){while(a&&a.tagName!=="LI")a=a.parentNode;if(a){var b=a.parentNode;while(b&&b!==this.list)b=b.parentNode;if(b)return a}return null},Sequoia.prototype.serialize=function(){var a=[],b=this.list.querySelectorAll("li");for(var c=0;c<b.length;c++){var d=this.findItem(b[c].parentNode),e=null;d&&(e=d.dataset[this.options.dataAttribute]),a.push({id:b[c].dataset[this.options.dataAttribute],parent:e})}return a},Sequoia.prototype.enable=function(){return this.enabled||(this.list.addEventListener("mousedown",this._mousedown),this.enabled=!0),this},Sequoia.prototype.disable=function(){return this.enabled&&(this.list.removeEventListener("mousedown",this._mousedown),this.enabled=!1),this},Sequoia.prototype._scroll=function(){switch(this._scrollDirection){case"up":this.list.scrollTop-=this.options.scrollIncrement,window.requestAnimFrame(this._scroll);break;case"down":this.list.scrollTop+=this.options.scrollIncrement,window.requestAnimFrame(this._scroll);break;default:}},function(){var a,b,c,d;(function(){var e={},f={};a=function(a,b,c){e[a]={deps:b,callback:c}},d=c=b=function(a){function n(b){if(b.charAt(0)!==".")return b;var c=b.split("/"),d=a.split("/").slice(0,-1);for(var e=0,f=c.length;e<f;e++){var g=c[e];if(g==="..")d.pop();else{if(g===".")continue;d.push(g)}}return d.join("/")}d._eak_seen=e;if(f[a])return f[a];f[a]={};if(!e[a])throw new Error("Could not find module "+a);var c=e[a],g=c.deps,h=c.callback,i=[],j;for(var k=0,l=g.length;k<l;k++)g[k]==="exports"?i.push(j={}):i.push(b(n(g[k])));var m=h.apply(this,i);return f[a]=j||m}})(),a("promise/all",["./utils","exports"],function(a,b){function e(a){var b=this;if(!c(a))throw new TypeError("You must pass an array to all.");return new b(function(b,c){function h(a){return function(b){i(a,b)}}function i(a,c){e[a]=c,--f===0&&b(e)}var e=[],f=a.length,g;f===0&&b([]);for(var j=0;j<a.length;j++)g=a[j],g&&d(g.then)?g.then(h(j),c):i(j,g)})}"use strict";var c=a.isArray,d=a.isFunction;b.all=e}),a("promise/asap",["exports"],function(a){function e(){return function(){process.nextTick(i)}}function f(){var a=0,b=new c(i),d=document.createTextNode("");return b.observe(d,{characterData:!0}),function(){d.data=a=++a%2}}function g(){return function(){d.setTimeout(i,1)}}function i(){for(var a=0;a<h.length;a++){var b=h[a],c=b[0],d=b[1];c(d)}h=[]}function k(a,b){var c=h.push([a,b]);c===1&&j()}"use strict";var b=typeof window!="undefined"?window:{},c=b.MutationObserver||b.WebKitMutationObserver,d=typeof global!="undefined"?global:this===undefined?window:this,h=[],j;typeof process!="undefined"&&{}.toString.call(process)==="[object process]"?j=e():c?j=f():j=g(),a.asap=k}),a("promise/config",["exports"],function(a){function c(a,c){if(arguments.length!==2)return b[a];b[a]=c}"use strict";var b={instrument:!1};a.config=b,a.configure=c}),a("promise/polyfill",["./promise","./utils","exports"],function(a,b,c){function f(){var a;typeof global!="undefined"?a=global:typeof window!="undefined"&&window.document?a=window:a=self;var b="Promise"in a&&"resolve"in a.Promise&&"reject"in a.Promise&&"all"in a.Promise&&"race"in a.Promise&&function(){var b;return new a.Promise(function(a){b=a}),e(b)}();b||(a.Promise=d)}"use strict";var d=a.Promise,e=b.isFunction;c.polyfill=f}),a("promise/promise",["./config","./utils","./all","./race","./resolve","./reject","./asap","exports"],function(a,b,c,d,e,f,g,h){function t(a){if(!l(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof t))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],u(a,this)}function u(a,b){function c(a){D(b,a)}function d(a){F(b,a)}try{a(c,d)}catch(e){d(e)}}function v(a,b,c,d){var e=l(c),f,g,h,i;if(e)try{f=c(d),h=!0}catch(j){i=!0,g=j}else f=d,h=!0;if(C(b,f))return;e&&h?D(b,f):i?F(b,g):a===y?D(b,f):a===z&&F(b,f)}function A(a,b,c,d){var e=a._subscribers,f=e.length;e[f]=b,e[f+y]=c,e[f+z]=d}function B(a,b){var c,d,e=a._subscribers,f=a._detail;for(var g=0;g<e.length;g+=3)c=e[g],d=e[g+b],v(b,c,d,f);a._subscribers=null}function C(a,b){var c=null,d;try{if(a===b)throw new TypeError("A promises callback cannot return that same promise.");if(k(b)){c=b.then;if(l(c))return c.call(b,function(c){if(d)return!0;d=!0,b!==c?D(a,c):E(a,c)},function(b){if(d)return!0;d=!0,F(a,b)}),!0}}catch(e){return d?!0:(F(a,e),!0)}return!1}function D(a,b){a===b?E(a,b):C(a,b)||E(a,b)}function E(a,b){if(a._state!==w)return;a._state=x,a._detail=b,i.async(G,a)}function F(a,b){if(a._state!==w)return;a._state=x,a._detail=b,i.async(H,a)}function G(a){B(a,a._state=y)}function H(a){B(a,a._state=z)}"use strict";var i=a.config,j=a.configure,k=b.objectOrFunction,l=b.isFunction,m=b.now,n=c.all,o=d.race,p=e.resolve,q=f.reject,r=g.asap,s=0;i.async=r;var w=void 0,x=0,y=1,z=2;t.prototype={constructor:t,_state:undefined,_detail:undefined,_subscribers:undefined,then:function(a,b){var c=this,d=new this.constructor(function(){});if(this._state){var e=arguments;i.async(function(){v(c._state,d,e[c._state-1],c._detail)})}else A(this,d,a,b);return d},"catch":function(a){return this.then(null,a)}},t.all=n,t.race=o,t.resolve=p,t.reject=q,h.Promise=t}),a("promise/race",["./utils","exports"],function(a,b){function d(a){var b=this;if(!c(a))throw new TypeError("You must pass an array to race.");return new b(function(b,c){var d=[],e;for(var f=0;f<a.length;f++)e=a[f],e&&typeof e.then=="function"?e.then(b,c):b(e)})}"use strict";var c=a.isArray;b.race=d}),a("promise/reject",["exports"],function(a){function b(a){var b=this;return new b(function(b,c){c(a)})}"use strict",a.reject=b}),a("promise/resolve",["exports"],function(a){function b(a){if(a&&typeof a=="object"&&a.constructor===this)return a;var b=this;return new b(function(b){b(a)})}"use strict",a.resolve=b}),a("promise/utils",["exports"],function(a){function b(a){return c(a)||typeof a=="object"&&a!==null}function c(a){return typeof a=="function"}function d(a){return Object.prototype.toString.call(a)==="[object Array]"}"use strict";var e=Date.now||function(){return(new Date).getTime()};a.objectOrFunction=b,a.isFunction=c,a.isArray=d,a.now=e}),b("promise/polyfill").polyfill()}(),function(){function e(e){if(e)for(var f in e)c[f]=e[f];return new a(function(a,e){var f=d.open(c.name,c.version);f.onerror=function(){e(f.error)},f.onupgradeneeded=function(){f.result.createObjectStore(c.storeName)},f.onsuccess=function(){b=f.result,a()}})}function f(d,e){var f=this;return new a(function(a,g){f.ready().then(function(){var f=b.transaction(c.storeName,"readonly").objectStore(c.storeName),h=f.get(d);h.onsuccess=function(){var b=h.result;b===undefined&&(b=null),e&&e(b),a(b)},h.onerror=function(){e&&e(null,h.error),g(h.error)}})})}function g(d,e,f){var g=this;return new a(function(a,h){g.ready().then(function(){var g=b.transaction(c.storeName,"readwrite").objectStore(c.storeName);e===undefined&&(e=null);var i=g.put(e,d);i.onsuccess=function(){f&&f(e),a(e)},i.onerror=function(){f&&f(null,i.error),h(i.error)}})})}function h(d,e){var f=this;return new a(function(a,g){f.ready().then(function(){var f=b.transaction(c.storeName,"readwrite").objectStore(c.storeName),h=f["delete"](d);h.onsuccess=function(){e&&e(),a()},h.onerror=function(){e&&e(h.error),g(h.error)},h.onabort=function(a){var b=a.target.error;b==="QuotaExceededError"&&(e&&e(b),g(b))}})})}function i(d){var e=this;return new a(function(a,f){e.ready().then(function(){var e=b.transaction(c.storeName,"readwrite").objectStore(c.storeName),g=e.clear();g.onsuccess=function(){d&&d(),a()},g.onerror=function(){d&&d(null,g.error),f(g.error)}})})}function j(d){var e=this;return new a(function(a,f){e.ready().then(function(){var e=b.transaction(c.storeName,"readonly").objectStore(c.storeName),g=e.count();g.onsuccess=function(){d&&d(g.result),a(g.result)},g.onerror=function(){d&&d(null,g.error),f(g.error)}})})}function k(d,e){var f=this;return new a(function(a,g){if(d<0){e&&e(null),a(null);return}f.ready().then(function(){var f=b.transaction(c.storeName,"readonly").objectStore(c.storeName),h=!1,i=f.openCursor();i.onsuccess=function(){var b=i.result;if(!b){e&&e(null),a(null);return}d===0?(e&&e(b.key),a(b.key)):h?(e&&e(b.key),a(b.key)):(h=!0,b.advance(d))},i.onerror=function(){e&&e(null,i.error),g(i.error)}})})}"use strict";var a=typeof module!="undefined"&&module.exports?require("promise"):this.Promise,b=null,c={},d=d||this.indexedDB||this.webkitIndexedDB||this.mozIndexedDB||this.OIndexedDB||this.msIndexedDB;if(!d)return;var l={_driver:"asyncStorage",_initStorage:e,getItem:f,setItem:g,removeItem:h,clear:i,length:j,key:k};typeof define=="function"&&define.amd?define("asyncStorage",function(){return l}):typeof module!="undefined"&&module.exports?module.exports=l:this.asyncStorage=l}.call(this),function(){function f(d){if(d)for(var e in d)b[e]=d[e];return a=b.name+"/",c.resolve()}function u(a){var b=this;return new c(function(c){b.ready().then(function(){d.clear(),a&&a(),c()})})}function v(b,e){var f=this;return new c(function(c,g){f.ready().then(function(){try{var f=d.getItem(a+b);f&&(f=z(f)),e&&e(f,null),c(f)}catch(h){e&&e(null,h),g(h)}})})}function w(b,e){var f=this;return new c(function(c){f.ready().then(function(){var f=d.key(b);f&&(f=f.substring(a.length)),e&&e(f),c(f)})})}function x(a){var b=this;return new c(function(c){b.ready().then(function(){var b=d.length;a&&a(b),c(b)})})}function y(b,e){var f=this;return new c(function(c){f.ready().then(function(){d.removeItem(a+b),e&&e(),c()})})}function z(a){if(a.substring(0,h)!==g)return JSON.parse(a);var b=a.substring(t),c=a.substring(h,t),d=new ArrayBuffer(b.length*2),e=new Uint16Array(d);for(var f=b.length-1;f>=0;f--)e[f]=b.charCodeAt(f);switch(c){case i:return d;case j:return new Blob([d]);case k:return new Int8Array(d);case l:return new Uint8Array(d);case m:return new Uint8ClampedArray(d);case n:return new Int16Array(d);case p:return new Uint16Array(d);case o:return new Int32Array(d);case q:return new Uint32Array(d);case r:return new Float32Array(d);case s:return new Float64Array(d);default:throw new Error("Unkown type: "+c)}}function A(a){var b="",c=new Uint16Array(a);try{b=String.fromCharCode.apply(null,c)}catch(d){for(var e=0;e<c.length;e++)b+=String.fromCharCode(c[e])}return b}function B(a,b){var c="";a&&(c=a+"");if(a&&(a+""==="[object ArrayBuffer]"||a.buffer&&a.buffer+""==="[object ArrayBuffer]")){var d,e=g;a instanceof ArrayBuffer?(d=a,e+=i):(d=a.buffer,c==="[object Int8Array]"?e+=k:c==="[object Uint8Array]"?e+=l:c==="[object Uint8ClampedArray]"?e+=m:c==="[object Int16Array]"?e+=n:c==="[object Uint16Array]"?e+=p:c==="[object Int32Array]"?e+=o:c==="[object Uint32Array]"?e+=q:c==="[object Float32Array]"?e+=r:c==="[object Float64Array]"?e+=s:b(new Error("Failed to get type for BinaryArray"))),b(e+A(d))}else if(c==="[object Blob]"){var f=new FileReader;f.onload=function(){var a=A(this.result);b(g+j+a)},f.readAsArrayBuffer(a)}else try{b(JSON.stringify(a))}catch(h){this.console&&this.console.error&&this.console.error("Couldn't convert value into a JSON string: ",a),b(null,h)}}function C(b,e,f){var g=this;return new c(function(c,h){g.ready().then(function(){e===undefined&&(e=null);var g=e;B(e,function(e,i){if(i)f&&f(null,i),h(i);else{try{d.setItem(a+b,e)}catch(j){if(j.name==="QuotaExceededError"||j.name==="NS_ERROR_DOM_QUOTA_REACHED")f&&f(null,j),h(j)}f&&f(g),c(g)}})})})}"use strict";var a="",b={},c=typeof module!="undefined"&&module.exports?require("promise"):this.Promise,d=null;try{d=this.localStorage}catch(e){return}var g="__lfsc__:",h=g.length,i="arbf",j="blob",k="si08",l="ui08",m="uic8",n="si16",o="si32",p="ur16",q="ui32",r="fl32",s="fl64",t=h+i.length,D={_driver:"localStorageWrapper",_initStorage:f,getItem:v,setItem:C,removeItem:y,clear:u,length:x,key:w};typeof define=="function"&&define.amd?define("localStorageWrapper",function(){return D}):typeof module!="undefined"&&module.exports?module.exports=D:this.localStorageWrapper=D}.call(this),function(){function t(a){var f=this;if(a)for(var g in a)e[g]=typeof a[g]!="string"?a[g]+"":a[g];return new b(function(a){try{d=c(e.name,e.version,e.description,e.size)}catch(b){return f.setDriver("localStorageWrapper").then(a)}d.transaction(function(b){b.executeSql("CREATE TABLE IF NOT EXISTS "+e.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){a()},null)})})}function u(a,c){var f=this;return new b(function(b,g){f.ready().then(function(){d.transaction(function(d){d.executeSql("SELECT * FROM "+e.storeName+" WHERE key = ? LIMIT 1",[a],function(a,d){var e=d.rows.length?d.rows.item(0).value:null;e&&(e=B(e)),c&&c(e),b(e)},function(a,b){c&&c(null,b),g(b)})})})})}function v(a,c,f){var g=this;return new b(function(b,h){g.ready().then(function(){c===undefined&&(c=null);var g=c;C(c,function(c,i){i?h(i):d.transaction(function(d){d.executeSql("INSERT OR REPLACE INTO "+e.storeName+" (key, value) VALUES (?, ?)",[a,c],function(){f&&f(g),b(g)},function(a,b){f&&f(null,b),h(b)})},function(a){a.code===a.QUOTA_ERR&&(f&&f(null,a),h(a))})})})})}function w(a,c){var f=this;return new b(function(b,g){f.ready().then(function(){d.transaction(function(d){d.executeSql("DELETE FROM "+e.storeName+" WHERE key = ?",[a],function(){c&&c(),b()},function(a,b){c&&c(b),g(b)})})})})}function x(a){var c=this;return new b(function(b,f){c.ready().then(function(){d.transaction(function(c){c.executeSql("DELETE FROM "+e.storeName,[],function(){a&&a(),b()},function(b,c){a&&a(c),f(c)})})})})}function y(a){var c=this;return new b(function(b,f){c.ready().then(function(){d.transaction(function(c){c.executeSql("SELECT COUNT(key) as c FROM "+e.storeName,[],function(c,d){var e=d.rows.item(0).c;a&&a(e),b(e)},function(b,c){a&&a(null,c),f(c)})})})})}function z(a,c){var f=this;return new b(function(b,g){f.ready().then(function(){d.transaction(function(d){d.executeSql("SELECT key FROM "+e.storeName+" WHERE id = ? LIMIT 1",[a+1],function(a,d){var e=d.rows.length?d.rows.item(0).key:null;c&&c(e),b(e)},function(a,b){c&&c(null,b),g(b)})})})})}function A(b){var c=new Uint8Array(b),d,e="";for(d=0;d<c.length;d+=3)e+=a[c[d]>>2],e+=a[(c[d]&3)<<4|c[d+1]>>4],e+=a[(c[d+1]&15)<<2|c[d+2]>>6],e+=a[c[d+2]&63];return c.length%3===2?e=e.substring(0,e.length-1)+"=":c.length%3===1&&(e=e.substring(0,e.length-2)+"=="),e}function B(b){if(b.substring(0,g)!==f)return JSON.parse(b);var c=b.substring(s),d=b.substring(g,s),e=c.length*.75,t=c.length,u,v=0,w,x,y,z;c[c.length-1]==="="&&(e--,c[c.length-2]==="="&&e--);var A=new ArrayBuffer(e),B=new Uint8Array(A);for(u=0;u<t;u+=4)w=a.indexOf(c[u]),x=a.indexOf(c[u+1]),y=a.indexOf(c[u+2]),z=a.indexOf(c[u+3]),B[v++]=w<<2|x>>4,B[v++]=(x&15)<<4|y>>2,B[v++]=(y&3)<<6|z&63;switch(d){case h:return A;case i:return new Blob([A]);case j:return new Int8Array(A);case k:return new Uint8Array(A);case l:return new Uint8ClampedArray(A);case m:return new Int16Array(A);case o:return new Uint16Array(A);case n:return new Int32Array(A);case p:return new Uint32Array(A);case q:return new Float32Array(A);case r:return new Float64Array(A);default:throw new Error("Unkown type: "+d)}}function C(a,b){var c="";a&&(c=a+"");if(a&&(a+""==="[object ArrayBuffer]"||a.buffer&&a.buffer+""==="[object ArrayBuffer]")){var d,e=f;a instanceof ArrayBuffer?(d=a,e+=h):(d=a.buffer,c==="[object Int8Array]"?e+=j:c==="[object Uint8Array]"?e+=k:c==="[object Uint8ClampedArray]"?e+=l:c==="[object Int16Array]"?e+=m:c==="[object Uint16Array]"?e+=o:c==="[object Int32Array]"?e+=n:c==="[object Uint32Array]"?e+=p:c==="[object Float32Array]"?e+=q:c==="[object Float64Array]"?e+=r:b(new Error("Failed to get type for BinaryArray"))),b(e+A(d))}else if(c==="[object Blob]"){var g=new FileReader;g.onload=function(){var a=A(this.result);b(f+i+a)},g.readAsArrayBuffer(a)}else try{b(JSON.stringify(a))}catch(s){this.console&&this.console.error&&this.console.error("Couldn't convert value into a JSON string: ",a),b(null,s)}}"use strict";var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b=typeof module!="undefined"&&module.exports?require("promise"):this.Promise,c=this.openDatabase,d=null,e={},f="__lfsc__:",g=f.length,h="arbf",i="blob",j="si08",k="ui08",l="uic8",m="si16",n="si32",o="ur16",p="ui32",q="fl32",r="fl64",s=g+h.length;if(!c)return;var D={_driver:"webSQLStorage",_initStorage:t,getItem:u,setItem:v,removeItem:w,clear:x,length:y,key:z};typeof define=="function"&&define.amd?define("webSQLStorage",function(){return D}):typeof module!="undefined"&&module.exports?module.exports=D:this.webSQLStorage=D}.call(this),function(){"use strict";var a=typeof module!="undefined"&&module.exports?require("promise"):this.Promise,b=1,c=2,d=3,e=d;typeof define=="function"&&define.amd?e=b:typeof module!="undefined"&&module.exports&&(e=c);var f=f||this.indexedDB||this.webkitIndexedDB||this.mozIndexedDB||this.OIndexedDB||this.msIndexedDB,g=f&&f.open("_localforage_spec_test",1).onupgradeneeded===null,h=this.openDatabase,i=this,j={INDEXEDDB:"asyncStorage",LOCALSTORAGE:"localStorageWrapper",WEBSQL:"webSQLStorage",_config:{description:"",name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},config:function(a){if(typeof a=="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var b in a)this._config[b]=a[b];return!0}return typeof a=="string"?this._config[a]:this._config},driver:function(){return this._driver||null},_ready:a.reject(new Error("setDriver() wasn't called")),setDriver:function(d,f){var k=new a(function(a,f){if(!g&&d===j.INDEXEDDB||!h&&d===j.WEBSQL){f(j);return}j._ready=null;if(e===b){require([d],function(b){j._extend(b),a(j)});return}if(e===c){var k;switch(d){case j.INDEXEDDB:k=require("./drivers/indexeddb");break;case j.LOCALSTORAGE:k=require("./drivers/localstorage");break;case j.WEBSQL:k=require("./drivers/websql")}j._extend(k)}else j._extend(i[d]);a(j)});return k.then(f,f),k},ready:function(a){return this._ready===null&&(this._ready=this._initStorage(this._config)),this._ready.then(a,a),this._ready},_extend:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])}},k;g?k=j.INDEXEDDB:h?k=j.WEBSQL:k=j.LOCALSTORAGE,this.localForageConfig&&(j.config=this.localForageConfig),j.setDriver(k),e===b?define(function(){return j}):e===c?module.exports=j:this.localforage=j}.call(this);var MODULE=function(a,b){function g(a,c,d,e){if(!c)return;var f;e=="V"?(f=a.options.customSnap.snappedV&&a.options.customSnap.snappedV.call(a.element,d,b.extend(a._uiHash(),{snapItem:c.elem.item,snapMode:c.snapMode})),c.snappedV=!0):(f=a.options.customSnap.snappedH&&a.options.customSnap.snappedH.call(a.element,d,b.extend(a._uiHash(),{snapItem:c.elem.item,snapMode:c.snapMode})),c.snappedH=!0)}function h(a,c,d,e){if(!c)return;var f;e=="V"?(f=a.options.customSnap.releasedV&&a.options.customSnap.releasedV.call(a.element,d,b.extend(a._uiHash(),{snapItem:c.item})),c.snappedV=!1):(f=a.options.customSnap.releasedH&&a.options.customSnap.releasedH.call(a.element,d,b.extend(a._uiHash(),{snapItem:c.item})),c.snappedH=!1)}var c={start:function(c,e){var f=b(this).data("draggable"),g=f.options,h=a.$htmlStage.offset();f.customSnapElements=[{item:a.$htmlStage,width:a.$htmlStage,height:a.$htmlStage,top:h.top,left:h.left}];if(a.snapoptions.gridsystem!==!1){var i=a.snapoptions.getGridSystemElements("drag");i.map(function(a){a.left+=h.left,a.top+=h.top}),f.customSnapElements=f.customSnapElements.concat(i)}b(g.customSnap.constructor!=String?g.customSnap.items||":data(draggable)":g.customSnap).each(function(){if(this.tagName=="svg"){var a=b(f.element[0]).data("svgElem")||[];for(var c=0;c<a.length;c++)if(b(this)[0]==b(a[c])[0])return;d={left:e.position.left,top:e.position.top};var g=svg(this),i=g.position();f.customSnapElements.push({item:this,width:g.measuredWidth(),height:g.measuredHeight(),top:i.y+h.top,left:i.x+h.left})}else{var j=b(this),k=j.offset();this!=f.element[0]&&f.customSnapElements.push({item:this,width:j.outerWidth(),height:j.outerHeight(),top:k.top,left:k.left})}})},drag:function(c,i){var j=b(this).data("draggable"),k=j.options,l=k.snapTolerance,m=i.offset.left,n=m+j.helperProportions.width,o=i.offset.top,p=o+j.helperProportions.height,q=0,r=0,s=k.customSnapPoint||!1;s&&(q=Math.round(j.helperProportions.width/2),r=Math.round(j.helperProportions.height/2),m+=q,o+=r,n=m,p=o);var t=a.snapoptions.gridEnabled(),u=a.currentMockup.stageHeight/2+(i.offset.top-i.position.top),v=a.currentMockup.stageWidth/2+(i.offset.left-i.position.left),w=t?a.snapoptions.gridValues[0]:0,x=t?a.snapoptions.gridValues[1]:0,y=t?w:l,z=t?x:l;a.snapoptions.snap.snapToObjects===!1&&(y=z=0);var A=y,B=z,C={val:5e3,elem:null,top:0},D={val:5e3,elem:null,left:0};for(var E=j.customSnapElements.length-1;E>=0;E--){var F=j.customSnapElements[E].left,G=F+j.customSnapElements[E].width,H=j.customSnapElements[E].top,I=H+j.customSnapElements[E].height;j.customSnapElements[E].snapTolerance?y=z=j.customSnapElements[E].snapTolerance:(y=A,z=B);var J,K,L,M,N,O;if(k.snapMode!="inner"){var P={ts:Math.abs(H-p),bs:Math.abs(I-o),ls:Math.abs(F-n),rs:Math.abs(G-m)};K=P.ts<=z,J=P.bs<=z,M=P.ls<=y,L=P.rs<=y,K&&P.ts<C.val&&(C.val=P.ts,C.elem=j.customSnapElements[E],C.snapMode=a.snapoptions.SNAP_BOTTOM,i.position.top=C.top=j._convertPositionTo("relative",{top:H-j.helperProportions.height,left:0}).top-j.margins.top+r),J&&P.bs<C.val&&(C.val=P.bs,C.snapMode=a.snapoptions.SNAP_TOP,C.elem=j.customSnapElements[E],i.position.top=C.top=j._convertPositionTo("relative",{top:I,left:0}).top-j.margins.top-r),M&&P.ls<D.val&&(D.val=P.ls,D.snapMode=a.snapoptions.SNAP_RIGHT,D.elem=j.customSnapElements[E],i.position.left=D.left=j._convertPositionTo("relative",{top:0,left:F-j.helperProportions.width}).left+j.margins.left+q),L&&P.rs<D.val&&(D.val=P.rs,D.snapMode=a.snapoptions.SNAP_LEFT,D.elem=j.customSnapElements[E],i.position.left=D.left=j._convertPositionTo("relative",{top:0,left:G}).left-j.margins.left-q)}if(k.snapMode!="outer"){var Q={ts:Math.abs(H-o),bs:Math.abs(I-p),ls:Math.abs(F-m),rs:Math.abs(G-n)};K=Q.ts<=z,J=Q.bs<=z,M=Q.ls<=y,L=Q.rs<=y,K&&Q.ts<C.val&&(C.val=Q.ts,C.snapMode=a.snapoptions.SNAP_TOP,C.elem=j.customSnapElements[E],i.position.top=C.top=j._convertPositionTo("relative",{top:H,left:0}).top-j.margins.top-r),J&&Q.bs<C.val&&(C.val=Q.bs,C.snapMode=a.snapoptions.SNAP_BOTTOM,C.elem=j.customSnapElements[E],i.position.top=C.top=j._convertPositionTo("relative",{top:I-j.helperProportions.height,left:0}).top-j.margins.top+r),M&&Q.ls<D.val&&(D.val=Q.ls,D.snapMode=a.snapoptions.SNAP_LEFT,D.elem=j.customSnapElements[E],i.position.left=D.left=j._convertPositionTo("relative",{top:0,left:F}).left-j.margins.left-q),L&&Q.rs<D.val&&(D.val=Q.rs,D.snapMode=a.snapoptions.SNAP_RIGHT,D.elem=j.customSnapElements[E],i.position.left=D.left=j._convertPositionTo("relative",{top:0,left:G-j.helperProportions.width}).left-j.margins.left+q)}if(j.customSnapElements[E].center!==!1){var R={hm:Math.abs(H+(I-H)/2-(o+(p-o)/2)),vm:Math.abs(F+(G-F)/2-(m+(n-m)/2))};O=R.hm<=z,N=R.vm<=y;if(O&&R.hm<=C.val){C.val=R.hm,C.snapMode=a.snapoptions.SNAP_MIDDLE,C.elem=j.customSnapElements[E];var S=H+Math.round((I-H-(p-o))/2);i.position.top=C.top=j._convertPositionTo("relative",{top:S,left:0}).top-j.margins.top-r}if(N&&R.vm<=D.val){D.val=R.vm,D.snapMode=a.snapoptions.SNAP_MIDDLE,D.elem=j.customSnapElements[E];var T=F+Math.round((G-F-(n-m))/2);i.position.left=D.left=j._convertPositionTo("relative",{top:0,left:T}).left-j.margins.left-q}}}i.position.top<d.top?e="n":i.position.top>d.top&&(e="s"),i.position.left<d.left?f="w":i.position.left>d.left&&(f="e"),c.axes=[f,e],d={left:i.position.left,top:i.position.top};for(E=j.customSnapElements.length-1;E>=0;E--){var U=j.customSnapElements[E];(!D.elem||b(U.item).get(0)!=b(D.elem.item).get(0))&&h(j,U,c,"V"),(!C.elem||b(U.item).get(0)!=b(C.elem.item).get(0))&&h(j,U,c,"H")}D.elem!==null?g(j,D,c,"V"):t&&(i.position.left=w*Math.round(i.position.left/w)-q),C.elem!==null?g(j,C,c,"H"):t&&(i.position.top=x*Math.round(i.position.top/x)-r),a.snapoptions.snap.snapToObjects&&(i.offset.top=i.position.top+i.helper.parent().offset().top,i.offset.left=i.position.left+i.helper.parent().offset().left)}},d={},e="",f="";return b.ui.plugin.add("draggable","snap",c),a}(MODULE||{},jQuery),MODULE=function(a,b){return function(b){function c(a,b,c){return Math.abs(a)<c?-a-.1:Math.abs(b)<c?-b-.1:0}function d(a){return a.length===0?0:a.sort(function(a,b){return a?b?Math.abs(a)-Math.abs(b):-1:1})[0]}function e(a){return parseInt(a.css("margin-left"),10)||0}function f(a){return parseInt(a.css("margin-top"),10)||0}function g(a,c,d){var e=b.ui.resizable.prototype[a];b.ui.resizable.prototype[a]=function(){d&&d.apply(this,arguments),e.apply(this,arguments),c&&c.apply(this,arguments)}}function h(a,b){var c=b.originalSize.width/b.originalSize.height;return a*c}function i(a,b){var c=b.originalSize.width/b.originalSize.height;return a/c}function j(a){return{helper:a.helper,position:a.position,originalPosition:a.originalPosition,offset:a.positionAbs}}b.extend(b.ui.resizable.prototype.options,{snapTolerance:5,snapMode:"both"}),b.ui.plugin.add("resizable","snap",{start:function(c,d){var g=b(this),h=g.data("resizable"),i=h.options.snap;h.ow=h.helper.outerWidth()-h.size.width,h.oh=h.helper.outerHeight()-h.size.height,h.lm=e(g),h.tm=f(g),h.coords=[],h.snappedPos={},h.snapped={h:!1,v:!1},h.coords=[{el:a.$htmlStage,l:0,r:a.$htmlStage.width(),t:0,b:a.$htmlStage.height(),snapping:!1}];if(a.snapoptions.gridsystem!==!1){var j=a.snapoptions.getGridSystemElements("resize");h.coords=h.coords.concat(j)}d.helper[0]!=d.originalElement[0]&&(h.lm=d.originalElement.position().left-d.helper.position().left,h.tm=d.originalElement.position().top-d.helper.position().top),b(typeof i=="string"?i:i.items||":data(resizable)").each(function(){if(this.tagName=="svg"){var a=h.originalElement.data("svgElem")||[];for(var c=0;c<a.length;c++)if(b(this)[0]==b(a[c])[0])return;var d=b(this),g=svg(this).position(),i=g.x,j=g.y;h.coords.push({l:i,t:j,r:i+svg(this).measuredWidth(),b:j+svg(this).measuredHeight(),el:d,snapping:!1})}else{if(this==h.element[0]||this==h.helper[0])return;var d=b(this),g=d.position(),i=g.left+e(d),j=g.top+f(d);h.coords.push({l:i,t:j,r:i+d.outerWidth(),b:j+d.outerHeight(),el:d,snapping:!1})}})},resize:function(e,f){var g=b(this).data("resizable");if(!g||!g.position)return;var k=g._aspectRatio,l=a.snapoptions.gridEnabled(),m=l?a.snapoptions.gridValues[0]:0,n=l?a.snapoptions.gridValues[1]:0,o=l?m:g.options.snapTolerance,p=l?n:g.options.snapTolerance;a.snapoptions.snap.snapToObjects===!1&&(o=p=.1);var q=o,r=p,s=[],t=[],u=[],v=[],w=g.axis.split(""),x=g.options.snapMode,y=g.position.left+g.lm,z=y-o,A=g.position.top+g.tm,B=A-p,C=y+g.size.width+g.ow,D=C+o,E=A+g.size.height+g.oh,F=E+p,G=!1,H=!1,I=[];b.each(g.coords,function(){var d=this,f=Math.min(D,d.r)-Math.max(z,d.l),h=Math.min(F,d.b)-Math.max(B,d.t),i=0;d.snapTolerance?o=p=d.snapTolerance:(o=q,p=r),b.each(w,function(b,e){var g;if(x=="outer")switch(e){case"w":case"e":if(f>o*2)return;break;case"n":case"s":if(h>p*2)return}else if(x=="inner")switch(e){case"w":case"e":if(f<o*2)return;break;case"n":case"s":if(h<p*2)return}switch(e){case"w":g=c(y-d.l,y-d.r,o),G=g!==0&&s.push(g)&&(d.snapModeV=a.snapoptions.SNAP_LEFT);break;case"n":g=c(A-d.t,A-d.b,p),H=g!==0&&t.push(g)&&(d.snapModeH=a.snapoptions.SNAP_TOP);break;case"e":g=c(C-d.l,C-d.r,o),G=g!==0&&u.push(g)&&(d.snapModeV=a.snapoptions.SNAP_RIGHT);break;case"s":g=c(E-d.t,E-d.b,p),H=g!==0&&v.push(g)&&(d.snapModeH=a.snapoptions.SNAP_BOTTOM)}i+=g}),i!==0?(G?I.push(function(){g.options.snap.snappedV&&g.options.snap.snappedV.call(g.element,e,b.extend(j(g),{snapItem:d.el,snapMode:d.snapModeV}))}):I.push(function(){g.options.snap.releasedV&&g.options.snap.releasedV.call(g.element,e,b.extend(j(g),{snapItem:d.el}))}),H?I.push(function(){g.options.snap.snappedH&&g.options.snap.snappedH.call(g.element,e,b.extend(j(g),{snapItem:d.el,snapMode:d.snapModeH}))}):I.push(function(){g.options.snap.releasedH&&g.options.snap.releasedH.call(g.element,e,b.extend(j(g),{snapItem:d.el}))})):(I.push(function(){g.options.snap.releasedV&&g.options.snap.releasedV.call(g.element,e,b.extend(j(g),{snapItem:d.el}))}),I.push(function(){g.options.snap.releasedH&&g.options.snap.releasedH.call(g.element,e,b.extend(j(g),{snapItem:d.el}))}))});var J,K,L,M={top:g.position.top,left:g.position.left,width:g.size.width,height:g.size.height};!v.length&&!t.length&&!u.length&&!s.length&&l?(w.indexOf("s")!=-1?(K=n*Math.round((g.position.top+g.size.height)/n)-(g.position.top+g.size.height),g.size.height+=K):w.indexOf("n")!=-1&&(K=n*Math.round(f.position.top/n)-g.position.top,g.position.top+=K,g.size.height-=K),k&&(L=h(g.size.height,g)-g.size.width,g.size.width+=L,w.indexOf("w")!=-1&&(g.position.left-=L))):(g.snapped.v=v.length>0||t.length>0,v.length&&(g.size.height+=Math.round(d(v))),t.length&&(J=Math.round(d(t)),g.position.top+=J,g.size.height-=J),k&&!s.length&&!u.length&&(L=h(g.size.height,g)-g.size.width,g.size.width+=L,w.indexOf("w")!=-1&&(g.position.left-=L))),!u.length&&!s.length&&l?(w.indexOf("e")!=-1?(K=m*Math.round((g.position.left+g.size.width)/m)-(g.position.left+g.size.width),g.size.width+=K):w.indexOf("w")!=-1&&(K=m*Math.round(f.position.left/m)-g.position.left,g.position.left+=K,g.size.width-=K),k&&(L=i(g.size.width,g)-g.size.height,g.size.height+=L,w.indexOf("n")!=-1&&(g.position.top-=L))):(g.snapped.h=u.length>0||s.length>0,u.length&&(g.size.width+=Math.round(d(u))),s.length&&(J=Math.round(d(s)),g.position.left+=J,g.size.width-=J),k&&(L=i(g.size.width,g)-g.size.height,g.size.height+=L,w.indexOf("n")!=-1&&(g.position.top-=L))),g.options.minWidth&&g.options.minHeight&&(g.size.width<g.options.minWidth&&(g.size.width=M.width,g.position.left=M.left),g.size.height<g.options.minHeight&&(g.size.height=M.height,g.position.top=M.top)),g.snappedPos={top:g.position.top,left:g.position.left,width:g.size.width,height:g.size.height};for(var N=0;N<I.length;N++)I[N]()},stop:function(c,d){var e=b(this).data("resizable"),f=a.snapoptions.gridEnabled();if(!e||!e.position)return;if(this._helper&&f){var g=e._aspectRatio,j=a.snapoptions.gridValues[0],k=a.snapoptions.gridValues[1],l=e.axis.split(""),m=0;e.snapped.v||(l.indexOf("s")!=-1?(m=k*Math.round((e.position.top+e.size.height)/k)-(e.position.top+e.size.height),e.size.height+=m):l.indexOf("n")!=-1&&(m=k*Math.round(d.position.top/k)-e.position.top,e.position.top+=m,e.size.height-=m),g&&(e.size.width=h(e.size.height,e))),e.snapped.h||(l.indexOf("e")!=-1?(m=j*Math.round((e.position.left+e.size.width)/j)-(e.position.left+e.size.width),e.size.width+=m):l.indexOf("w")!=-1&&(m=j*Math.round(d.position.left/j)-e.position.left,e.position.left+=m,e.size.width-=m),g&&(e.size.height=i(e.size.width,e)))}else this._helper||(e.position.top=e.snappedPos.top,e.position.left=e.snappedPos.left,e.size.width=e.snappedPos.width,e.size.height=e.snappedPos.height)}}),g("_mouseStop",null,function(){this._helper&&(this.position={left:(parseInt(this.helper.css("left"),10)||0)+this.lm,top:(parseInt(this.helper.css("top"),10)||0)+this.tm},this.size={width:this.helper.outerWidth(),height:this.helper.outerHeight()})}),g("_mouseStart",function(){this._helper&&(this.size={width:this.size.width-(this.helper.outerWidth()-this.helper.width()),height:this.size.height-(this.helper.outerHeight()-this.helper.height())},this.originalSize={width:this.size.width,height:this.size.height})}),g("_renderProxy",function(){this._helper&&this.helper.css({left:this.elementOffset.left,top:this.elementOffset.top,width:this.element.outerWidth(),height:this.element.outerHeight()})});var k=b.ui.resizable.prototype.plugins.resize;b.each(k,function(a,b){if(b[0]=="ghost")return k.splice(a,1),!1}),b.each(b.ui.resizable.prototype.plugins.start,function(a,c){if(c[0]=="ghost"){var d=c[1];return c[1]=function(){d.apply(this,arguments),b(this).data("resizable").ghost.css({width:"100%",height:"100%"})},!1}})}(b),a}(MODULE||{},jQuery),Markdown;typeof exports=="object"&&typeof require=="function"?Markdown=exports:Markdown={},function(){function a(a){return a}function b(a){return!1}function c(){}function d(){}c.prototype={chain:function(b,c){var d=this[b];if(!d)throw new Error("unknown hook "+b);d===a?this[b]=c:this[b]=function(a){return c(d(a))}},set:function(a,b){if(!this[a])throw new Error("unknown hook "+a);this[a]=b},addNoop:function(b){this[b]=a},addFalse:function(a){this[a]=b}},Markdown.HookCollection=c,d.prototype={set:function(a,b){this["s_"+a]=b},get:function(a){return this["s_"+a]}},Markdown.Converter=function(){function h(a){return a=a.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?(?=\s|$)[ \t]*\n?[ \t]*((\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,function(a,c,d,f,g,h){return c=c.toLowerCase(),b.set(c,D(d)),g?f:(h&&e.set(c,h.replace(/"/g,"&quot;")),"")}),a}function i(a){var b="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del",c="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math";return a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,j),a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,j),a=a.replace(/\n[ ]{0,3}((<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,j),a=a.replace(/\n\n[ ]{0,3}(<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>[ \t]*(?=\n{2,}))/g,j),a=a.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,j),a}function j(a,b){var c=b;return c=c.replace(/^\n+/,""),c=c.replace(/\n+$/g,""),c="\n\n~K"+(f.push(c)-1)+"K\n\n",c}function k(a,b){a=s(a);var c="<hr />\n";return a=a.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,c),a=a.replace(/^[ ]{0,2}([ ]?-[ ]?){3,}[ \t]*$/gm,c),a=a.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,c),a=t(a),a=w(a),a=B(a),a=i(a),a=C(a,b),a}function l(a){return a=y(a),a=m(a),a=E(a),a=p(a),a=n(a),a=F(a),a=a.replace(/~P/g,"://"),a=D(a),a=A(a),a=a.replace(/  +\n/g," <br>\n"),a}function m(a){var b=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>)/gi;return a=a.replace(b,function(a){var b=a.replace(/(.)<\/?code>(?=.)/g,"$1`");return b=L(b,a.charAt(1)=="!"?"\\`*_/":"\\`*_"),b}),a}function n(a){return a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,o),a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?((?:\([^)]*\)|[^()])*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,o),a=a.replace(/(\[([^\[\]]+)\])()()()()()/g,o),a}function o(a,c,d,f,g,h,i,j){j==undefined&&(j="");var k=c,l=d.replace(/:\/\//g,"~P"),m=f.toLowerCase(),n=g,o=j;if(n==""){m==""&&(m=l.toLowerCase().replace(/ ?\n/g," ")),n="#"+m;if(b.get(m)!=undefined)n=b.get(m),e.get(m)!=undefined&&(o=e.get(m));else{if(!(k.search(/\(\s*\)$/m)>-1))return k;n=""}}n=K(n),n=L(n,"*_");var p='<a target="_blank" href="'+n+'"';return o!=""&&(o=q(o),o=L(o,"*_"),p+=' title="'+o+'"'),p+=">"+l+"</a>",p}function p(a){return a=a.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,r),a=a.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,r),a}function q(a){return a.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}function r(a,c,d,f,g,h,i,j){var k=c,l=d,m=f.toLowerCase(),n=g,o=j;o||(o="");if(n==""){m==""&&(m=l.toLowerCase().replace(/ ?\n/g," ")),n="#"+m;if(b.get(m)==undefined)return k;n=b.get(m),e.get(m)!=undefined&&(o=e.get(m))}l=L(q(l),"*_[]()"),n=L(n,"*_");var p='<img src="'+n+'" alt="'+l+'"';return o=q(o),o=L(o,"*_"),p+=' title="'+o+'"',p+=" />",p}function s(a){return a=a.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(a,b){return"<h1>"+l(b)+"</h1>\n\n"}),a=a.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(a,b){return"<h2>"+l(b)+"</h2>\n\n"}),a=a.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(a,b,c){var d=b.length;return"<h"+d+">"+l(c)+"</h"+d+">\n\n"}),a}function t(a){a+="~0";var b=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return g?a=a.replace(b,function(a,b,c){var d=b,e=c.search(/[*+-]/g)>-1?"ul":"ol",f=v(d,e);return f=f.replace(/\s+$/,""),f="<"+e+">"+f+"</"+e+">\n",f}):(b=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,a=a.replace(b,function(a,b,c,d){var e=b,f=c,g=d.search(/[*+-]/g)>-1?"ul":"ol",h=v(f,g);return h=e+"<"+g+">\n"+h+"</"+g+">\n",h})),a=a.replace(/~0/,""),a}function v(a,b){g++,a=a.replace(/\n{2,}$/,"\n"),a+="~0";var c=u[b],d=new RegExp("(^[ \\t]*)("+c+")[ \\t]+([^\\r]+?(\\n+))(?=(~0|\\1("+c+")[ \\t]+))","gm"),e=!1;return a=a.replace(d,function(a,b,c,d){var f=d,g=b,h=/\n\n$/.test(f),i=h||f.search(/\n{2,}/)>-1;return i||e?f=k(H(f),!0):(f=t(H(f)),f=f.replace(/\n$/,""),f=l(f)),e=h,"<li>"+f+"</li>\n"}),a=a.replace(/~0/g,""),g--,a}function w(a){return a+="~0",a=a.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(a,b,c){var d=b,e=c;return d=z(H(d)),d=I(d),d=d.replace(/^\n+/g,""),d=d.replace(/\n+$/g,""),d="<pre><code>"+d+"\n</code></pre>","\n\n"+d+"\n\n"+e}),a=a.replace(/~0/,""),a}function x(a){return a=a.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(f.push(a)-1)+"K\n\n"}function y(a){return a=a.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(a,b,c,d,e){var f=d;return f=f.replace(/^([ \t]*)/g,""),f=f.replace(/[ \t]*$/g,""),f=z(f),f=f.replace(/:\/\//g,"~P"),b+"<code>"+f+"</code>"}),a}function z(a){return a=a.replace(/&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=L(a,"*_{}[]\\",!1),a}function A(a){return a=a.replace(/([\W_]|^)(\*\*|__)(?=\S)([^\r]*?\S[\*_]*)\2([\W_]|$)/g,"$1<strong>$3</strong>$4"),a=a.replace(/([\W_]|^)(\*|_)(?=\S)([^\r\*_]*?\S)\2([\W_]|$)/g,"$1<em>$3</em>$4"),a}function B(a){return a=a.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(a,b){var c=b;return c=c.replace(/^[ \t]*>[ \t]?/gm,"~0"),c=c.replace(/~0/g,""),c=c.replace(/^[ \t]+$/gm,""),c=k(c),c=c.replace(/(^|\n)/g,"$1  "),c=c.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(a,b){var c=b;return c=c.replace(/^  /mg,"~0"),c=c.replace(/~0/g,""),c}),x("<blockquote>\n"+c+"\n</blockquote>")}),a}function C(a,b){a=a.replace(/^\n+/g,""),a=a.replace(/\n+$/g,"");var c=a.split(/\n{2,}/g),d=[],e=/~K(\d+)K/,g=c.length;for(var h=0;h<g;h++){var i=c[h];e.test(i)?d.push(i):/\S/.test(i)&&(i=l(i),i=i.replace(/^([ \t]*)/g,"<p>"),i+="</p>",d.push(i))}if(!b){g=d.length;for(var h=0;h<g;h++){var j=!0;while(j)j=!1,d[h]=d[h].replace(/~K(\d+)K/g,function(a,b){return j=!0,f[b]})}}return d.join("\n\n")}function D(a){return a=a.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),a=a.replace(/<(?![a-z\/?\$!])/gi,"&lt;"),a}function E(a){return a=a.replace(/\\(\\)/g,M),a=a.replace(/\\([`*_{}\[\]()>#+-.!])/g,M),a}function F(b){b=b.replace(/(^|\s)(https?|ftp)(:\/\/[-A-Z0-9+&@#\/%?=~_|\[\]\(\)!:,\.;]*[-A-Z0-9+&@#\/%=~_|\[\]])($|\W)/gi,"$1<$2$3>$4"),b=b.replace(/&nbsp>;/gi,">");var c=function(b,c){return'<a target="_blank" href="'+c+'">'+a.plainLinkText(c)+"</a>"};return b=b.replace(/<((https?|ftp):[^'">\s]+)>/gi,c),b}function G(a){return a=a.replace(/~E(\d+)E/g,function(a,b){var c=parseInt(b);return String.fromCharCode(c)}),a}function H(a){return a=a.replace(/^(\t|[ ]{1,4})/gm,"~0"),a=a.replace(/~0/g,""),a}function I(a){if(!/\t/.test(a))return a;var b=["    ","   ","  "," "],c=0,d;return a.replace(/[\n\t]/g,function(a,e){return a==="\n"?(c=e+1,a):(d=(e-c)%4,c=e+1,b[d])})}function K(a){if(!a)return"";var b=a.length;return a.replace(J,function(c,d){if(c=="~D")return"%24";if(c==":")if(d==b-1||/[0-9\/]/.test(a.charAt(d+1)))return":";return"%"+c.charCodeAt(0).toString(16)})}function L(a,b,c){var d="(["+b.replace(/([\[\]\\])/g,"\\$1")+"])";c&&(d="\\\\"+d);var e=new RegExp(d,"g");return a=a.replace(e,M),a}function M(a,b){var c=b.charCodeAt(0);return"~E"+c+"E"}var a=this.hooks=new c;a.addNoop("plainLinkText"),a.addNoop("preConversion"),a.addNoop("postConversion");var b,e,f,g;this.makeHtml=function(c){if(b)throw new Error("Recursive call to converter.makeHtml");return b=new d,e=new d,f=[],g=0,c=a.preConversion(c),c=c.replace(/~/g,"~T"),c=c.replace(/\$/g,"~D"),c=c.replace(/\r\n/g,"\n"),c=c.replace(/\r/g,"\n"),c="\n\n"+c+"\n\n",c=I(c),c=c.replace(/^[ \t]+$/mg,""),c=i(c),c=h(c),c=k(c),c=G(c),c=c.replace(/~D/g,"$$"),c=c.replace(/~T/g,"~"),c=a.postConversion(c),f=e=b=null,c};var u={ol:"\\d+[.]",ul:"[*+-]"},J=/(?:["'*()[\]:]|~D)/g}}(),function(){function c(a){return a.replace(/<[^>]*>?/gi,g)}function g(a){return a.match(d)||a.match(e)||a.match(f)?a:""}function h(a){if(a=="")return"";var b=/<\/?\w+[^>]*(\s|$|>)/g,c=a.toLowerCase().match(b),d=(c||[]).length;if(d==0)return a;var e,f,g="<p><img><br><li><hr>",h,i=[],j=[],k=!1;for(var l=0;l<d;l++){e=c[l].replace(/<\/?(\w+).*/,"$1");if(i[l]||g.search("<"+e+">")>-1)continue;f=c[l],h=-1;if(!/^<\//.test(f))for(var m=l+1;m<d;m++)if(!i[m]&&c[m]=="</"+e+">"){h=m;break}h==-1?k=j[l]=!0:i[h]=!0}if(!k)return a;var l=0;return a=a.replace(b,function(a){var b=j[l]?"":a;return l++,b}),a}var a,b;typeof exports=="object"&&typeof require=="function"?(a=exports,b=require("./Markdown.Converter").Converter):(a=window.Markdown,b=a.Converter),a.getSanitizingConverter=function(){var a=new b;return a.hooks.chain("postConversion",c),a.hooks.chain("postConversion",h),a};var d=/^(<\/?(b|blockquote|code|del|dd|dl|dt|em|h1|h2|h3|i|kbd|li|ol|p|pre|s|sup|sub|strong|strike|ul)>|<(br|hr)\s?\/?>)$/i,e=/^(<a\starget="_blank"\shref="((https?|ftp):\/\/|\/)[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+"(\stitle="[^"<>]+")?\s?>|<\/a>)$/i,f=/^(<img\ssrc="(https?:\/\/|\/)[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+"(\swidth="\d{1,3}")?(\sheight="\d{1,3}")?(\salt="[^"<>]*")?(\stitle="[^"<>]*")?\s?\/?>)$/i}(),function(a){"use strict";var b={init:function(b){if(a(this).length===0){console.log("Share Button: No elements found.");return}return a(this).each(function(c,d){b=b||{};var e=a(this).addClass("sharer-"+c).hide(),f=e.parent(),g={};g.url=b.url||window.location.href,g.text=b.text||a("meta[name=description]").attr("content")||"";var h=function(a,c){return b[a]?b[a][c]||g[c]:g[c]};g.twitter_url=h("twitter","url"),g.twitter_text=h("twitter","text"),g.fb_url=h("facebook","url"),g.fb_title=h("facebook","title"),g.fb_caption=h("facebook","caption"),g.fb_text=h("facebook","text"),g.fb_image=h("facebook","image"),g.gplus_url=h("gplus","url"),g.selector="."+e.attr("class").split(" ").join("."),g.twitter_text=encodeURIComponent(g.twitter_text);var i={twitter:"http://twitter.com/intent/tweet?text="+g.twitter_text+"&url="+g.twitter_url,facebook:"https://www.facebook.com/sharer/sharer.php?u="+g.fb_url,gplus:"https://plus.google.com/share?url="+g.gplus_url};e.find("li").on("click",function(){var b=i[a(this).data("network")],c={width:500,height:350};return c.top=screen.height/2-c.height/2,c.left=screen.width/2-c.width/2,window.open(b,"targetWindow","toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,left="+c.left+",top="+c.top+",width="+c.width+",height="+c.height),!1}),e.find("label").on("click",function(a){return a.stopPropagation(),f.find(""+g.selector+" .social").toggleClass("active")}),a(document).on("click",function(){return f.find(".social").removeClass("active")}),setTimeout(function(){return e.show()},250)})}};a.fn.share=function(c){if(b[c])return b[c].apply(this,Array.prototype.slice.call(arguments,1));if(typeof c=="object"||!c)return b.init.apply(this,arguments);a.error("Method "+c+" does not exist on jQuery.share")}}(jQuery),function(){function ba(a){a=a.split(".");for(var b=k,c;c=a.shift();){if(null==b[c])return null;b=b[c]}return b}function ca(){}function da(a){var b=typeof a;if("object"==b){if(!a)return"null";if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function m(a){return"array"==da(a)}function ea(a){var b=da(a);return"array"==b||"object"==b&&"number"==typeof a.length}function n(a){return"string"==typeof a}function fa(a){return"function"==da(a)}function ia(a,b,c){return a.call.apply(a.bind,arguments)}function ja(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(c,d),a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function p(a,b,c){return p=Function.prototype.bind&&-1!=(Function.prototype.bind+"").indexOf("native code")?ia:ja,p.apply(null,arguments)}function s(a,b){function c(){}c.prototype=b.prototype,a.pa=b.prototype,a.prototype=new c,a.Ic=function(a,c,d){return b.prototype[c].apply(a,Array.prototype.slice.call(arguments,2))}}function ka(a,b){for(var c=a.split("%s"),d="",e=Array.prototype.slice.call(arguments,1);e.length&&1<c.length;)d+=c.shift()+e.shift();return d+c.join("%s")}function la(a){return ma.test(a)?(-1!=a.indexOf("&")&&(a=a.replace(na,"&amp;")),-1!=a.indexOf("<")&&(a=a.replace(oa,"&lt;")),-1!=a.indexOf(">")&&(a=a.replace(pa,"&gt;")),-1!=a.indexOf('"')&&(a=a.replace(qa,"&quot;")),-1!=a.indexOf("'")&&(a=a.replace(ra,"&#39;")),a):a}function sa(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^q()).toString(36)}function ta(a,b){return a<b?-1:a>b?1:0}function xa(){return k.navigator?k.navigator.userAgent:null}function Ca(){var a=k.document;return a?a.documentMode:void 0}function z(a){var b;if(!(b=Ja[a])){b=0;for(var c=String(Da).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),d=String(a).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),e=Math.max(c.length,d.length),f=0;0==b&&f<e;f++){var g=c[f]||"",h=d[f]||"",i=RegExp("(\\d*)(\\D*)","g"),j=RegExp("(\\d*)(\\D*)","g");do{var k=i.exec(g)||["","",""],l=j.exec(h)||["","",""];if(0==k[0].length&&0==l[0].length)break;b=ta(0==k[1].length?0:parseInt(k[1],10),0==l[1].length?0:parseInt(l[1],10))||ta(0==k[2].length,0==l[2].length)||ta(k[2],l[2])}while(0==b)}b=Ja[a]=0<=b}return b}function Ma(a){if(Error.captureStackTrace)Error.captureStackTrace(this,Ma);else{var b=Error().stack;b&&(this.stack=b)}a&&(this.message=String(a))}function Na(a,b){b.unshift(a),Ma.call(this,ka.apply(null,b)),b.shift()}function Oa(a,b){throw new Na("Failure"+(a?": "+a:""),Array.prototype.slice.call(arguments,1))}function Qa(a){if(Ra){Ra=!1;var b=k.location;if(b){var c=b.href;if(c&&(c=(c=Qa(c)[3]||null)&&decodeURIComponent(c))&&c!=b.hostname)throw Ra=!0,Error()}}return a.match(Pa)}function Sa(a){var b=[],c=0,d;for(d in a)b[c++]=a[d];return b}function Ta(a){var b=[],c=0,d;for(d in a)b[c++]=d;return b}function Va(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<Ua.length;f++)c=Ua[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}}function Ya(a){var b;a:{b=Za;for(var c=a.length,d=n(a)?a.split(""):a,e=0;e<c;e++)if(e in d&&b.call(void 0,d[e],e,a)){b=e;break a}b=-1}return 0>b?null:n(a)?a.charAt(b):a[b]}function $a(a){return A.concat.apply(A,arguments)}function ab(a){var b=a.length;if(0<b){for(var c=Array(b),d=0;d<b;d++)c[d]=a[d];return c}return[]}function bb(a,b){this.O={},this.j=[],this.o=0;var c=arguments.length;if(1<c){if(c%2)throw Error("Uneven number of arguments");for(var d=0;d<c;d+=2)this.set(arguments[d],arguments[d+1])}else if(a){a instanceof bb?(c=a.ba(),d=a.N()):(c=Ta(a),d=Sa(a));for(var e=0;e<c.length;e++)this.set(c[e],d[e])}}function cb(a){if(a.o!=a.j.length){for(var b=0,c=0;b<a.j.length;){var d=a.j[b];B(a.O,d)&&(a.j[c++]=d),b++}a.j.length=c}if(a.o!=a.j.length){for(var e={},c=b=0;b<a.j.length;)d=a.j[b],B(e,d)||(a.j[c++]=d,e[d]=1),b++;a.j.length=c}}function B(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function db(a){if("function"==typeof a.N)return a.N();if(n(a))return a.split("");if(ea(a)){for(var b=[],c=a.length,d=0;d<c;d++)b.push(a[d]);return b}return Sa(a)}function C(a,b,c){if("function"==typeof a.forEach)a.forEach(b,c);else if(ea(a)||n(a))Xa(a,b,c);else{var d;if("function"==typeof a.ba)d=a.ba();else if("function"!=typeof a.N)if(ea(a)||n(a)){d=[];for(var e=a.length,f=0;f<e;f++)d.push(f)}else d=Ta(a);else d=void 0;for(var e=db(a),f=e.length,g=0;g<f;g++)b.call(c,e[g],d&&d[g],a)}}function D(a,b){var c;if(a instanceof D)this.D=void 0!==b?b:a.D,eb(this,a.oa),c=a.gb,E(this),this.gb=c,fb(this,a.ia),gb(this,a.Da),hb(this,a.I),ib(this,a.R.n()),c=a.Pa,E(this),this.Pa=c;else if(a&&(c=Qa(String(a)))){this.D=!!b,eb(this,c[1]||"",!0);var d=c[2]||"";E(this),this.gb=d?decodeURIComponent(d):"",fb(this,c[3]||"",!0),gb(this,c[4]),hb(this,c[5]||"",!0),ib(this,c[6]||"",!0),c=c[7]||"",E(this),this.Pa=c?decodeURIComponent(c):""}else this.D=!!b,this.R=new jb(null,0,this.D)}function eb(a,b,c){E(a),a.oa=c?b?decodeURIComponent(b):"":b,a.oa&&(a.oa=a.oa.replace(/:$/,""))}function fb(a,b,c){E(a),a.ia=c?b?decodeURIComponent(b):"":b}function gb(a,b){E(a);if(b){b=Number(b);if(isNaN(b)||0>b)throw Error("Bad port number "+b);a.Da=b}else a.Da=null}function hb(a,b,c){E(a),a.I=c?b?decodeURIComponent(b):"":b}function ib(a,b,c){E(a),b instanceof jb?(a.R=b,a.R.xb(a.D)):(c||(b=kb(b,pb)),a.R=new jb(b,0,a.D))}function F(a,b,c){E(a),a.R.set(b,c)}function qb(a,b,c){E(a),m(c)||(c=[String(c)]),rb(a.R,b,c)}function G(a){return E(a),F(a,"zx",sa()),a}function E(a){if(a.qc)throw Error("Tried to modify a read-only Uri")}function sb(a){return a instanceof D?a.n():new D(a,void 0)}function tb(a,b,c,d){var e=new D(null,void 0);return a&&eb(e,a),b&&fb(e,b),c&&gb(e,c),d&&hb(e,d),e}function kb(a,b){return n(a)?encodeURI(a).replace(b,ub):null}function ub(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}function jb(a,b,c){this.C=a||null,this.D=!!c}function H(a){if(!a.h&&(a.h=new bb,a.o=0,a.C))for(var b=a.C.split("&"),c=0;c<b.length;c++){var d=b[c].indexOf("="),e=null,f=null;0<=d?(e=b[c].substring(0,d),f=b[c].substring(d+1)):e=b[c],e=decodeURIComponent(e.replace(/\+/g," ")),e=I(a,e),a.add(e,f?decodeURIComponent(f.replace(/\+/g," ")):"")}}function rb(a,b,c){a.remove(b),0<c.length&&(a.C=null,a.h.set(I(a,b),ab(c)),a.o+=c.length)}function I(a,b){var c=String(b);return a.D&&(c=c.toLowerCase()),c}function vb(a){a=String(a);if(/^\s*$/.test(a)?0:/^[\],:{}\s\u2028\u2029]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r\u2028\u2029\x00-\x08\x0a-\x1f]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,"")))try{return eval("("+a+")")}catch(b){}throw Error("Invalid JSON string: "+a)}function wb(a){return eval("("+a+")")}function xb(a){var b=[];return yb(new zb,a,b),b.join("")}function zb(){this.$a=void 0}function yb(a,b,c){switch(typeof b){case"string":Ab(b,c);break;case"number":c.push(isFinite(b)&&!isNaN(b)?b:"null");break;case"boolean":c.push(b);break;case"undefined":c.push("null");break;case"object":if(null==b){c.push("null");break}if(m(b)){var d=b.length;c.push("[");for(var e="",f=0;f<d;f++)c.push(e),e=b[f],yb(a,a.$a?a.$a.call(b,String(f),e):e,c),e=",";c.push("]");break}c.push("{"),d="";for(f in b)Object.prototype.hasOwnProperty.call(b,f)&&(e=b[f],"function"!=typeof e&&(c.push(d),Ab(f,c),c.push(":"),yb(a,a.$a?a.$a.call(b,f,e):e,c),d=","));c.push("}");break;case"function":break;default:throw Error("Unknown type: "+typeof b)}}function Ab(a,b){b.push('"',a.replace(Cb,function(a){if(a in Bb)return Bb[a];var b=a.charCodeAt(0),c="\\u";return 16>b?c+="000":256>b?c+="00":4096>b&&(c+="0"),Bb[a]=c+b.toString(16)}),'"')}function Db(a){return Eb(a||arguments.callee.caller,[])}function Eb(a,b){var c=[];if(0<=Wa(b,a))c.push("[...circular reference...]");else if(a&&50>b.length){c.push(Fb(a)+"(");for(var d=a.arguments,e=0;d&&e<d.length;e++){0<e&&c.push(", ");var f;f=d[e];switch(typeof f){case"object":f=f?"object":"null";break;case"string":break;case"number":f=String(f);break;case"boolean":f=f?"true":"false";break;case"function":f=(f=Fb(f))?f:"[fn]";break;default:f=typeof f}40<f.length&&(f=f.substr(0,40)+"..."),c.push(f)}b.push(a),c.push(")\n");try{c.push(Eb(a.caller,b))}catch(g){c.push("[exception trying to get caller]\n")}}else a?c.push("[...long stack...]"):c.push("[end]");return c.join("")}function Fb(a){if(Gb[a])return Gb[a];a=String(a);if(!Gb[a]){var b=/function ([^\(]+)/.exec(a);Gb[a]=b?b[1]:"[Anonymous]"}return Gb[a]}function Hb(a,b,c,d,e){this.reset(a,b,c,d,e)}function Jb(a){this.tc=a,this.Lb=this.lb=this.Ba=this.Ua=null}function J(a,b){this.name=a,this.value=b}function Pb(a){return a.Ba?a.Ba:a.Ua?Pb(a.Ua):(Oa("Root logger has no level set."),null)}function Sb(a){Rb||(Rb=new Jb(""),Qb[""]=Rb,Rb.bc(Nb));var b;if(!(b=Qb[a])){b=new Jb(a);var c=a.lastIndexOf("."),d=a.substr(c+1),c=Sb(a.substr(0,c));c.lb||(c.lb={}),c.lb[d]=b,b.Ua=c,Qb[a]=b}return b}function L(a,b){a&&a.log(Ob,b,void 0)}function M(){this.r=Sb("goog.net.BrowserChannel")}function Tb(a,b,c,d){a.info("XMLHTTP TEXT ("+b+"): "+Ub(a,c)+(d?" "+d:""))}function Vb(a,b,c){a.J((c||"Exception")+b)}function Ub(a,b){if(!b||b==Wb)return b;try{var c=wb(b);if(c)for(var d=0;d<c.length;d++)if(m(c[d])){var e=c[d];if(!(2>e.length)){var f=e[1];if(m(f)&&!(1>f.length)){var g=f[0];if("noop"!=g&&"stop"!=g)for(var h=1;h<f.length;h++)f[h]=""}}}return xb(c)}catch(i){return a.debug("Exception parsing expected JS array - probably was not JS"),b}}function Xb(a,b){this.P=b?wb:vb}function N(){0!=Yb&&(Zb[this[ga]||(this[ga]=++ha)]=this)}function ac(a){try{return!!a&&!!a[$b]}catch(b){return!1}}function cc(a,b,c,d,e){this.ea=a,this.Wa=null,this.src=b,this.type=c,this.Ka=!!d,this.Qa=e,this.key=++bc,this.na=this.Ja=!1}function dc(a){a.na=!0,a.ea=null,a.Wa=null,a.src=null,a.Qa=null}function O(a){this.src=a,this.s={},this.Ha=0}function fc(a,b){var c=b.type;if(c in a.s){var d=a.s[c],e=Wa(d,b),f;return(f=0<=e)&&A.splice.call(d,e,1),f&&(dc(b),0==a.s[c].length&&(delete a.s[c],a.Ha--)),f}return!1}function ec(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.na&&f.ea==b&&f.Ka==!!c&&f.Qa==d)return e}return-1}function P(a,b){this.type=a,this.currentTarget=this.target=b,this.defaultPrevented=this.la=!1,this.$b=!0}function ic(a){return ic[" "](a),a}function Q(a,b){P.call(this,a?a.type:""),this.relatedTarget=this.currentTarget=this.target=null,this.charCode=this.keyCode=this.button=this.screenY=this.screenX=this.clientY=this.clientX=this.offsetY=this.offsetX=0,this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.Gb=this.state=null;if(a){var c=this.type=a.type;this.target=a.target||a.srcElement,this.currentTarget=b;var d=a.relatedTarget;if(d){if(Ba){var e;a:{try{ic(d.nodeName),e=!0;break a}catch(f){}e=!1}e||(d=null)}}else"mouseover"==c?d=a.fromElement:"mouseout"==c&&(d=a.toElement);this.relatedTarget=d,this.offsetX=y||void 0!==a.offsetX?a.offsetX:a.layerX,this.offsetY=y||void 0!==a.offsetY?a.offsetY:a.layerY,this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0,this.button=a.button,this.keyCode=a.keyCode||0,this.charCode=a.charCode||("keypress"==c?a.keyCode:0),this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.state=a.state,this.Gb=a,a.defaultPrevented&&this.preventDefault()}}function lc(a,b,c,d,e){if(m(b)){for(var f=0;f<b.length;f++)lc(a,b[f],c,d,e);return null}c=mc(c);if(ac(a))a=a.Ta(b,c,d,e);else{if(!b)throw Error("Invalid event type");var f=!!d,g=nc(a);g||(a[jc]=g=new O(a)),c=g.add(b,c,!1,d,e),c.Wa||(d=oc(),c.Wa=d,d.src=a,d.ea=c,a.addEventListener?a.addEventListener(b,d,f):a.attachEvent(b in R?R[b]:R[b]="on"+b,d),kc++),a=c}return a}function oc(){var a=pc,b=gc?function(c){return a.call(b.src,b.ea,c)}:function(c){c=a.call(b.src,b.ea,c);if(!c)return c};return b}function qc(a,b,c,d,e){if(m(b))for(var f=0;f<b.length;f++)qc(a,b[f],c,d,e);else c=mc(c),ac(a)?a.yb(b,c,d,e):a&&(a=nc(a))&&(b=a.za(b,c,!!d,e))&&rc(b)}function rc(a){if("number"==typeof a||!a||a.na)return!1;var b=a.src;if(ac(b))return fc(b.V,a);var c=a.type,d=a.Wa;return b.removeEventListener?b.removeEventListener(c,d,a.Ka):b.detachEvent&&b.detachEvent(c in R?R[c]:R[c]="on"+c,d),kc--,(c=nc(b))?(fc(c,a),0==c.Ha&&(c.src=null,b[jc]=null)):dc(a),!0}function sc(a,b,c,d){var e=1;if(a=nc(a))if(b=a.s[b])for(b=ab(b),a=0;a<b.length;a++){var f=b[a];f&&f.Ka==c&&!f.na&&(e&=!1!==tc(f,d))}return Boolean(e)}function tc(a,b){var c=a.ea,d=a.Qa||a.src;return a.Ja&&rc(a),c.call(d,b)}function pc(a,b){if(a.na)return!0;if(!gc){var c=b||ba("window.event"),d=new Q(c,this),e=!0;if(!(0>c.keyCode||void 0!=c.returnValue)){a:{var f=!1;if(0==c.keyCode)try{c.keyCode=-1;break a}catch(g){f=!0}if(f||void 0==c.returnValue)c.returnValue=!0}c=[];for(f=d.currentTarget;f;f=f.parentNode)c.push(f);for(var f=a.type,h=c.length-1;!d.la&&0<=h;h--)d.currentTarget=c[h],e&=sc(c[h],f,!0,d);for(h=0;!d.la&&h<c.length;h++)d.currentTarget=c[h],e&=sc(c[h],f,!1,d)}return e}return tc(a,new Q(b,this))}function nc(a){return a=a[jc],a instanceof O?a:null}function mc(a){return fa(a)?a:a[uc]||(a[uc]=function(b){return a.handleEvent(b)})}function S(){N.call(this),this.V=new O(this),this.hc=this}function vc(a,b,c,d){b=a.V.s[String(b)];if(!b)return!0;b=ab(b);for(var e=!0,f=0;f<b.length;++f){var g=b[f];if(g&&!g.na&&g.Ka==c){var h=g.ea,i=g.Qa||g.src;g.Ja&&fc(a.V,g),e=!1!==h.call(i,d)&&e}}return e&&0!=d.$b}function wc(a,b){S.call(this),this.da=a||1,this.ra=b||k,this.kb=p(this.Hc,this),this.vb=q()}function yc(a,b,c){if(fa(a))c&&(a=p(a,c));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=p(a.handleEvent,a)}return 2147483647<b?-1:k.setTimeout(a,b||0)}function zc(){}function Ac(a){var b;return(b=a.Db)||(b={},Bc(a)&&(b[0]=!0,b[1]=!0),b=a.Db=b),b}function Dc(){}function Ec(a){return(a=Bc(a))?new ActiveXObject(a):new XMLHttpRequest}function Bc(a){if(!a.Mb&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var b=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],c=0;c<b.length;c++){var d=b[c];try{return new ActiveXObject(d),a.Mb=d}catch(e){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return a.Mb}function Fc(a){S.call(this),this.headers=new bb,this.ib=a||null,this.S=!1,this.hb=this.f=null,this.Ob=this.Sa="",this.ja=0,this.q="",this.ca=this.tb=this.Ra=this.pb=!1,this.Ga=0,this.eb=null,this.Zb=Gc,this.fb=this.fc=!1}function Lc(a){return x&&z(9)&&"number"==typeof a.timeout&&void 0!==a.ontimeout}function Za(a){return"content-type"==a.toLowerCase()}function Jc(a,b){a.S=!1,a.f&&(a.ca=!0,a.f.abort(),a.ca=!1),a.q=b,a.ja=5,Mc(a),Nc(a)}function Mc(a){a.pb||(a.pb=!0,a.dispatchEvent("complete"),a.dispatchEvent("error"))}function Oc(a){if(a.S&&"undefined"!=typeof aa)if(a.hb[1]&&4==U(a)&&2==Pc(a))L(a.r,T(a,"Local request error detected and ignored"));else if(a.Ra&&4==U(a))yc(a.Sb,0,a);else if(a.dispatchEvent("readystatechange"),4==U(a)){L(a.r,T(a,"Request complete")),a.S=!1;try{var b=Pc(a),c,d;a:switch(b){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:d=!0;break a;default:d=!1}if(!(c=d)){var e;if(e=0===b){var f=Qa(String(a.Sa))[1]||null;if(!f&&self.location)var g=self.location.protocol,f=g.substr(0,g.length-1);e=!Hc.test(f?f.toLowerCase():"")}c=e}if(c)a.dispatchEvent("complete"),a.dispatchEvent("success");else{a.ja=6;var h;try{h=2<U(a)?a.f.statusText:""}catch(i){L(a.r,"Can not get status: "+i.message),h=""}a.q=h+" ["+Pc(a)+"]",Mc(a)}}finally{Nc(a)}}}function Nc(a,b){if(a.f){Kc(a);var c=a.f,d=a.hb[0]?ca:null;a.f=null,a.hb=null,b||a.dispatchEvent("ready");try{c.onreadystatechange=d}catch(e){(c=a.r)&&c.J("Problem encountered resetting onreadystatechange: "+e.message,void 0)}}}function Kc(a){a.f&&a.fb&&(a.f.ontimeout=null),"number"==typeof a.eb&&(k.clearTimeout(a.eb),a.eb=null)}function U(a){return a.f?a.f.readyState:0}function Pc(a){try{return 2<U(a)?a.f.status:-1}catch(b){return-1}}function Qc(a){try{return a.f?a.f.responseText:""}catch(b){return L(a.r,"Can not get responseText: "+b.message),""}}function T(a,b){return b+" ["+a.Ob+" "+a.Sa+" "+Pc(a)+"]"}function Rc(){this.Yb=q()}function Sc(a){N.call(this),this.e=a,this.j={}}function Uc(a,b,c){N.call(this),this.rc=a,this.da=b,this.e=c,this.lc=p(this.xc,this)}function Vc(a){a.l=yc(a.lc,a.da),a.rc.call(a.e)}function V(a,b,c,d,e){this.b=a,this.a=b,this.Y=c,this.B=d,this.Fa=e||1,this.qa=Wc,this.qb=new Sc(this),this.Va=new wc,this.Va.setInterval(Xc)}function Yc(a,b){switch(a){case 0:return"Non-200 return code ("+b+")";case 1:return"XMLHTTP failure (no data)";case 2:return"HttpConnection timeout";default:return"Unknown error"}}function ad(){return!x||x&&10<=La}function bd(a,b,c){a.sa=1,a.T=G(b.n()),a.W=c,a.Fb=!0,cd(a,null)}function dd(a,b,c,d,e){a.sa=1,a.T=G(b.n()),a.W=null,a.Fb=c,e&&(a.ac=!1),cd(a,d)}function cd(a,b){a.Ea=q(),ed(a),a.w=a.T.n(),qb(a.w,"t",a.Fa),a.Ia=0,a.k=a.b.nb(a.b.bb()?b:null),0<a.ma&&(a.Xa=new Uc(p(a.gc,a,a.k),a.ma)),a.qb.Ta(a.k,"readystatechange",a.Dc);var c;if(a.v){c=a.v;var d={},e;for(e in c)d[e]=c[e];c=d}else c={};a.W?(a.ta="POST",c["Content-Type"]="application/x-www-form-urlencoded",a.k.send(a.w,a.ta,a.W,c)):(a.ta="GET",a.ac&&!y&&(c.Connection="close"),a.k.send(a.w,a.ta,null,c)),a.b.H(fd);if(d=a.W)for(c="",d=d.split("&"),e=0;e<d.length;e++){var f=d[e].split("=");if(1<f.length){var g=f[0],f=f[1],h=g.split("_");c=2<=h.length&&"type"==h[1]?c+(g+"="+f+"&"):c+(g+"=redacted&")}}else c=null;a.a.info("XMLHTTP REQ ("+a.B+") [attempt "+a.Fa+"]: "+a.ta+"\n"+a.w+"\n"+c)}function jd(a,b,c){for(var d=!0;!a.Z&&a.Ia<c.length;){var e=md(a,c);if(e==$c){4==b&&(a.q=4,X(),d=!1),Tb(a.a,a.B,null,"[Incomplete Response]");break}if(e==Zc){a.q=4,X(),Tb(a.a,a.B,c,"[Invalid Chunk]"),d=!1;break}Tb(a.a,a.B,e,null),kd(a,e)}4==b&&0==c.length&&(a.q=1,X(),d=!1),a.F=a.F&&d,d||(Tb(a.a,a.B,c,"[Invalid Chunked Response]"),W(a),ld(a))}function md(a,b){var c=a.Ia,d=b.indexOf("\n",c);if(-1==d)return $c;c=Number(b.substring(c,d));if(isNaN(c))return Zc;d+=1;if(d+c>b.length)return $c;var e=b.substr(d,c);return a.Ia=d+c,e}function nd(a,b){a.Ea=q(),ed(a);var c=b?window.location.hostname:"";a.w=a.T.n(),F(a.w,"DOMAIN",c),F(a.w,"t",a.Fa);try{a.K=new ActiveXObject("htmlfile")}catch(d){a.a.J("ActiveX blocked"),W(a),a.q=7,X(),ld(a);return}var e="<html><body>";b&&(e+='<script>document.domain="'+c+'"</script>'),e+="</body></html>",a.K.open(),a.K.write(e),a.K.close(),a.K.parentWindow.m=p(a.Ac,a),a.K.parentWindow.d=p(a.Wb,a,!0),a.K.parentWindow.rpcClose=p(a.Wb,a,!1),c=a.K.createElement("div"),a.K.parentWindow.document.body.appendChild(c),c.innerHTML='<iframe src="'+a.w+'"></iframe>',a.a.info("TRIDENT REQ ("+a.B+") [ attempt "+a.Fa+"]: GET\n"+a.w),a.b.H(fd)}function ed(a){a.Ab=q()+a.qa,pd(a,a.qa)}function pd(a,b){if(null!=a.ua)throw Error("WatchDog timer not null");a.ua=Y(p(a.Bc,a),b)}function id(a){a.ua&&(k.clearTimeout(a.ua),a.ua=null)}function ld(a){a.b.Nb()||a.Z||a.b.ka(a)}function W(a){id(a);var b=a.Xa;b&&"function"==typeof b.La&&b.La(),a.Xa=null,a.Va.stop(),a.qb.Za(),a.k&&(b=a.k,a.k=null,b.abort(),b.La()),a.K&&(a.K=null)}function kd(a,b){try{a.b.Tb(a,b),a.b.H(od)}catch(c){Vb(a.a,c,"Error in httprequest callback")}}function qd(a,b,c,d,e){(new M).debug("TestLoadImageWithRetries: "+e);if(0==d)c(!1);else{var f=e||0;d--,rd(a,b,function(e){e?c(!0):k.setTimeout(function(){qd(a,b,c,d,f)},f)})}}function rd(a,b,c){function d(a,b){return function(){try{e.debug("TestLoadImage: "+b),f.onload=null,f.onerror=null,f.onabort=null,f.ontimeout=null,k.clearTimeout(g),c(a)}catch(d){Vb(e,d)}}}var e=new M;e.debug("TestLoadImage: loading "+a);var f=new Image,g=null;f.onload=d(!0,"loaded"),f.onerror=d(!1,"error"),f.onabort=d(!1,"abort"),f.ontimeout=d(!1,"timeout"),g=k.setTimeout(function(){f.ontimeout&&f.ontimeout()},b),f.src=a}function sd(a,b){this.b=a,this.a=b,this.P=new Xb(0,!0)}function ud(a){var b=wd(a.b,a.va,"/mail/images/cleardot.gif");G(b),qd(b+"",5e3,p(a.mc,a),3,2e3),a.H(fd)}function vd(a){a.a.debug("TestConnection: starting stage 2");var b=a.b.Fc;if(null!=b)a.a.debug("TestConnection: skipping stage 2, precomputed result is "+b?"Buffered":"Unbuffered"),X(),b?(X(),xd(a.b,a,!1)):(X(),xd(a.b,a,!0));else if(a.A=new V(a,a.a,void 0,void 0,void 0),a.A.X(a.v),b=yd(a.b,a.L,a.I),X(),ad())qb(b,"TYPE","xmlhttp"),dd(a.A,b,!1,a.L,!1);else{qb(b,"TYPE","html");var c=a.A;a=Boolean(a.L),c.sa=3,c.T=G(b.n()),nd(c,a)}}function Ad(a,b,c){this.Eb=a||null,this.c=Bd,this.t=[],this.Q=[],this.a=new M,this.P=new Xb(0,!0),this.Jb=b||null,this.Fc=null!=c?c:null}function Cd(a,b){this.Qb=a,this.map=b}function Ed(a){P.call(this,"statevent",a)}function Fd(a,b){P.call(this,"timingevent",a),this.size=b}function Gd(a){P.call(this,"serverreachability",a)}function Jd(a){a.U&&(a.U.abort(),a.U=null),a.i&&(a.i.cancel(),a.i=null),a.M&&(k.clearTimeout(a.M),a.M=null),Md(a),a.p&&(a.p.cancel(),a.p=null),a.G&&(k.clearTimeout(a.G),a.G=null)}function Nd(a){a.p||a.G||(a.G=Y(p(a.Vb,a),0),a.aa=0)}function Pd(a,b){var c,d;b?6<a.ha?(a.t=a.Q.concat(a.t),a.Q.length=0,c=a.Ca-1,d=Od(a)):(c=b.B,d=b.W):(c=a.Ca++,d=Od(a));var e=a.Oa.n();F(e,"SID",a.Y),F(e,"RID",c),F(e,"AID",a.Aa),Kd(a,e),c=new V(a,a.a,a.Y,c,a.aa+1),c.X(a.v),c.setTimeout(Math.round(.5*a.sb)+Math.round(.5*a.sb*Math.random())),a.p=c,bd(c,e,d)}function Kd(a,b){if(a.e){var c=a.e.getAdditionalParams(a);c&&C(c,function(a,c){F(b,c,a)})}}function Od(a){var b=Math.min(a.t.length,1e3),c=["count="+b],d;6<a.ha&&0<b?(d=a.t[0].Qb,c.push("ofs="+d)):d=0;for(var e=0;e<b;e++){var f=a.t[e].Qb,g=a.t[e].map,f=6>=a.ha?e:f-d;try{C(g,function(a,b){c.push("req"+f+"_"+b+"="+encodeURIComponent(a))})}catch(h){c.push("req"+f+"_type="+encodeURIComponent("_badmap")),a.e&&a.e.badMapError(a,g)}}return a.Q=a.Q.concat(a.t.splice(0,b)),c.join("&")}function Qd(a){a.i||a.M||(a.Bb=1,a.M=Y(p(a.Ub,a),0),a.ga=0)}function Rd(a){return a.i||a.M?(a.a.J("Request already in progress"),!1):3<=a.ga?!1:(a.a.debug("Going to retry GET"),a.Bb++,a.M=Y(p(a.Ub,a),Sd(a,a.ga)),a.ga++,!0)}function Id(a){if(a.e){var b=a.e.okToMakeRequest(a);if(0!=b)return a.a.debug("Handler returned error code from okToMakeRequest"),Z(a,b),!1}return!0}function xd(a,b,c){a.a.debug("Test Connection Finished"),a.zb=a.ic&&c,a.g=b.g,a.a.debug("connectChannel_()"),a.nc(Bd,0),a.Oa=td(a,a.I),Nd(a)}function zd(a,b){a.a.debug("Test Connection Failed"),a.g=b.g,Z(a,2)}function Md(a){null!=a.$&&(k.clearTimeout(a.$),a.$=null)}function Sd(a,b){var c=a.kc+Math.floor(Math.random()*a.Ec);return a.isActive()||(a.a.debug("Inactive channel"),c*=2),c*b}function Z(a,b){a.a.info("Error code "+b);if(2==b||9==b){var c=null;a.e&&(c=a.e.getNetworkTestImageUri(a));var d=p(a.Gc,a);c||(c=new D("//www.google.com/images/cleardot.gif"),G(c)),rd(c+"",1e4,d)}else X();Td(a,b)}function Td(a,b){a.a.debug("HttpChannel: error - "+b),a.c=0,a.e&&a.e.channelError(a,b),Ld(a),Jd(a)}function Ld(a){a.c=0,a.g=-1;if(a.e)if(0==a.Q.length&&0==a.t.length)a.e.channelClosed(a);else{a.a.debug("Number of undelivered maps, pending: "+a.Q.length+", outgoing: "+a.t.length);var b=ab(a.Q),c=ab(a.t);a.Q.length=0,a.t.length=0,a.e.channelClosed(a,b,c)}}function td(a,b){var c=wd(a,null,b);return a.a.debug("GetForwardChannelUri: "+c),c}function yd(a,b,c){return b=wd(a,a.bb()?b:null,c),a.a.debug("GetBackChannelUri: "+b),b}function wd(a,b,c){var d=sb(c);if(""!=d.ia)b&&fb(d,b+"."+d.ia),gb(d,d.Da);else var e=window.location,d=tb(e.protocol,b?b+"."+e.hostname:e.hostname,e.port,c);return a.ya&&C(a.ya,function(a,b){F(d,b,a)}),F(d,"VER",a.ha),Kd(a,d),d}function Y(a,b){if(!fa(a))throw Error("Fn must not be null and must be a function");return k.setTimeout(function(){a()},b)}function X(){Dd.dispatchEvent(new Ed(Dd))}function Ud(){}var f,aa=aa||{},k=this,ga="closure_uid_"+(1e9*Math.random()>>>0),ha=0,q=Date.now||function(){return+(new Date)},na=/&/g,oa=/</g,pa=/>/g,qa=/"/g,ra=/'/g,ma=/[&<>"']/,w,ua,va,wa;wa=va=ua=w=!1;var ya;if(ya=xa()){var za=k.navigator;w=0==ya.lastIndexOf("Opera",0),ua=!w&&(-1!=ya.indexOf("MSIE")||-1!=ya.indexOf("Trident")),va=!w&&-1!=ya.indexOf("WebKit"),wa=!w&&!va&&!ua&&"Gecko"==za.product}var Aa=w,x=ua,Ba=wa,y=va,Da;a:{var Ea="",Fa;if(Aa&&k.opera)var Ga=k.opera.version,Ea="function"==typeof Ga?Ga():Ga;else if(Ba?Fa=/rv\:([^\);]+)(\)|;)/:x?Fa=/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/:y&&(Fa=/WebKit\/(\S+)/),Fa)var Ha=Fa.exec(xa()),Ea=Ha?Ha[1]:"";if(x){var Ia=Ca();if(Ia>parseFloat(Ea)){Da=String(Ia);break a}}Da=Ea}var Ja={},Ka=k.document,La=Ka&&x?Ca()||("CSS1Compat"==Ka.compatMode?parseInt(Da,10):5):void 0;s(Ma,Error),Ma.prototype.name="CustomError",s(Na,Ma),Na.prototype.name="AssertionError";var Pa=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),Ra=y,Ua="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),A=Array.prototype,Wa=A.indexOf?function(a,b,c){return A.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0>c?Math.max(0,a.length+c):c;if(n(a))return n(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},Xa=A.forEach?function(a,b,c){A.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=n(a)?a.split(""):a,f=0;f<d;f++)f in e&&b.call(c,e[f],f,a)};f=bb.prototype,f.N=function(){cb(this);for(var a=[],b=0;b<this.j.length;b++)a.push(this.O[this.j[b]]);return a},f.ba=function(){return cb(this),this.j.concat()},f.wa=function(a){return B(this.O,a)},f.remove=function(a){return B(this.O,a)?(delete this.O[a],this.o--,this.j.length>2*this.o&&cb(this),!0):!1},f.get=function(a,b){return B(this.O,a)?this.O[a]:b},f.set=function(a,b){B(this.O,a)||(this.o++,this.j.push(a)),this.O[a]=b},f.n=function(){return new bb(this)},f=D.prototype,f.oa="",f.gb="",f.ia="",f.Da=null,f.I="",f.Pa="",f.qc=!1,f.D=!1,f.toString=function(){var a=[],b=this.oa;b&&a.push(kb(b,lb),":");if(b=this.ia){a.push("//");var c=this.gb;c&&a.push(kb(c,lb),"@"),a.push(encodeURIComponent(String(b))),b=this.Da,null!=b&&a.push(":",String(b))}if(b=this.I)this.ia&&"/"!=b.charAt(0)&&a.push("/"),a.push(kb(b,"/"==b.charAt(0)?mb:nb));return(b=this.R+"")&&a.push("?",b),(b=this.Pa)&&a.push("#",kb(b,ob)),a.join("")},f.n=function(){return new D(this)},f.xb=function(a){return this.D=a,this.R&&this.R.xb(a),this};var lb=/[#\/\?@]/g,nb=/[\#\?:]/g,mb=/[\#\?]/g,pb=/[\#\?@]/g,ob=/#/g;f=jb.prototype,f.h=null,f.o=null,f.add=function(a,b){H(this),this.C=null,a=I(this,a);var c=this.h.get(a);return c||this.h.set(a,c=[]),c.push(b),this.o++,this},f.remove=function(a){return H(this),a=I(this,a),this.h.wa(a)?(this.C=null,this.o-=this.h.get(a).length,this.h.remove(a)):!1},f.wa=function(a){return H(this),a=I(this,a),this.h.wa(a)},f.ba=function(){H(this);for(var a=this.h.N(),b=this.h.ba(),c=[],d=0;d<b.length;d++)for(var e=a[d],f=0;f<e.length;f++)c.push(b[d]);return c},f.N=function(a){H(this);var b=[];if(n(a))this.wa(a)&&(b=$a(b,this.h.get(I(this,a))));else{a=this.h.N();for(var c=0;c<a.length;c++)b=$a(b,a[c])}return b},f.set=function(a,b){return H(this),this.C=null,a=I(this,a),this.wa(a)&&(this.o-=this.h.get(a).length),this.h.set(a,[b]),this.o++,this},f.get=function(a,b){var c=a?this.N(a):[];return 0<c.length?String(c[0]):b},f.toString=function(){if(this.C)return this.C;if(!this.h)return"";for(var a=[],b=this.h.ba(),c=0;c<b.length;c++)for(var d=b[c],e=encodeURIComponent(String(d)),d=this.N(d),f=0;f<d.length;f++){var g=e;""!==d[f]&&(g+="="+encodeURIComponent(String(d[f]))),a.push(g)}return this.C=a.join("&")},f.n=function(){var a=new jb;return a.C=this.C,this.h&&(a.h=this.h.n(),a.o=this.o),a},f.xb=function(a){a&&!this.D&&(H(this),this.C=null,C(this.h,function(a,b){var c=b.toLowerCase();b!=c&&(this.remove(b),rb(this,c,a))},this)),this.D=a};var Bb={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","":"\\u000b"},Cb=/\uffff/.test("")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g,Gb={};Hb.prototype.Ib=null,Hb.prototype.Hb=null;var Ib=0;Hb.prototype.reset=function(a,b,c,d,e){"number"==typeof e||Ib++,d||q(),this.Ba=a,this.sc=b,delete this.Ib,delete this.Hb},Hb.prototype.bc=function(a){this.Ba=a},J.prototype.toString=function(){return this.name};var Kb=new J("SEVERE",1e3),Lb=new J("WARNING",900),Mb=new J("INFO",800),Nb=new J("CONFIG",700),Ob=new J("FINE",500);f=Jb.prototype,f.getParent=function(){return this.Ua},f.bc=function(a){this.Ba=a},f.log=function(a,b,c){return},f.oc=function(a,b,c){var d=new Hb(a,String(b),this.tc);if(c){d.Ib=c;var e,f=arguments.callee.caller;try{var g,h=ba("window.location.href");if(n(c))g={message:c,name:"Unknown error",lineNumber:"Not available",fileName:h,stack:"Not available"};else{var i,j,l=!1;try{i=c.lineNumber||c.Jc||"Not available"}catch(m){i="Not available",l=!0}try{j=c.fileName||c.filename||c.sourceURL||k.$googDebugFname||h}catch(o){j="Not available",l=!0}g=!l&&c.lineNumber&&c.fileName&&c.stack&&c.message&&c.name?c:{message:c.message||"Not available",name:c.name||"UnknownError",lineNumber:i,fileName:j,stack:c.stack||"Not available"}}e="Message: "+la(g.message)+'\nUrl: <a href="view-source:'+g.fileName+'" target="_new">'+g.fileName+"</a>\nLine: "+g.lineNumber+"\n\nBrowser stack:\n"+la(g.stack+"-> ")+"[end]\n\nJS stack traversal:\n"+la(Db(f)+"-> ")}catch(p){e="Exception trying to expose exception! You win, we lose. "+p}d.Hb=e}return d},f.J=function(a,b){this.log(Kb,a,b)},f.fa=function(a,b){this.log(Lb,a,b)},f.info=function(a,b){this.log(Mb,a,b)};var Qb={},Rb=null;M.prototype.debug=function(a){this.info(a)},M.prototype.info=function(a){var b=this.r;b&&b.info(a,void 0)},M.prototype.fa=function(a){var b=this.r;b&&b.fa(a,void 0)},M.prototype.J=function(a){var b=this.r;b&&b.J(a,void 0)},Xb.prototype.parse=function(a){return this.P(a)};var Yb=0,Zb={};N.prototype.ob=!1,N.prototype.La=function(){if(!this.ob&&(this.ob=!0,this.u(),0!=Yb)){var a=this[ga]||(this[ga]=++ha);delete Zb[a]}},N.prototype.u=function(){if(this.Rb)for(;this.Rb.length;)this.Rb.shift()()};var $b="closure_listenable_"+(1e6*Math.random()|0),bc=0;O.prototype.add=function(a,b,c,d,e){var f=this.s[a];f||(f=this.s[a]=[],this.Ha++);var g=ec(f,b,d,e);return-1<g?(a=f[g],c||(a.Ja=!1)):(a=new cc(b,this.src,a,!!d,e),a.Ja=c,f.push(a)),a},O.prototype.remove=function(a,b,c,d){if(a in this.s){var e=this.s[a];return b=ec(e,b,c,d),-1<b?(dc(e[b]),A.splice.call(e,b,1),0==e.length&&(delete this.s[a],this.Ha--),!0):!1}return!1},O.prototype.Za=function(a){var b=0,c;for(c in this.s)if(!a||c==a){for(var d=this.s[c],e=0;e<d.length;e++)++b,dc(d[e]);delete this.s[c],this.Ha--}return b},O.prototype.za=function(a,b,c,d){a=this.s[a];var e=-1;return a&&(e=ec(a,b,c,d)),-1<e?a[e]:null};var gc=!x||x&&9<=La,hc=x&&!z("9");!y||z("528"),Ba&&z("1.9b")||x&&z("8")||Aa&&z("9.5")||y&&z("528"),Ba&&!z("8")||x&&z("9"),P.prototype.u=function(){},P.prototype.La=function(){},P.prototype.preventDefault=function(){this.defaultPrevented=!0,this.$b=!1},ic[" "]=ca,s(Q,P),Q.prototype.preventDefault=function(){Q.pa.preventDefault.call(this);var a=this.Gb;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,hc)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}},Q.prototype.u=function(){};var jc="closure_lm_"+(1e6*Math.random()|0),R={},kc=0,uc="__closure_events_fn_"+(1e9*Math.random()>>>0);s(S,N),S.prototype[$b]=!0,f=S.prototype,f.wb=null,f.addEventListener=function(a,b,c,d){lc(this,a,b,c,d)},f.removeEventListener=function(a,b,c,d){qc(this,a,b,c,d)},f.dispatchEvent=function(a){var b,c=this.wb;if(c)for(b=[];c;c=c.wb)b.push(c);var c=this.hc,d=a.type||a;if(n(a))a=new P(a,c);else if(a instanceof P)a.target=a.target||c;else{var e=a;a=new P(d,c),Va(a,e)}var e=!0,f;if(b)for(var g=b.length-1;!a.la&&0<=g;g--)f=a.currentTarget=b[g],e=vc(f,d,!0,a)&&e;a.la||(f=a.currentTarget=c,e=vc(f,d,!0,a)&&e,a.la||(e=vc(f,d,!1,a)&&e));if(b)for(g=0;!a.la&&g<b.length;g++)f=a.currentTarget=b[g],e=vc(f,d,!1,a)&&e;return e},f.u=function(){S.pa.u.call(this),this.V&&this.V.Za(void 0),this.wb=null},f.Ta=function(a,b,c,d){return this.V.add(String(a),b,!1,c,d)},f.yb=function(a,b,c,d){return this.V.remove(String(a),b,c,d)},f.za=function(a,b,c,d){return this.V.za(String(a),b,c,d)},s(wc,S),f=wc.prototype,f.xa=!1,f.l=null,f.setInterval=function(a){this.da=a,this.l&&this.xa?(this.stop(),this.start()):this.l&&this.stop()},f.Hc=function(){if(this.xa){var a=q()-this.vb;0<a&&a<.8*this.da?this.l=this.ra.setTimeout(this.kb,this.da-a):(this.l&&(this.ra.clearTimeout(this.l),this.l=null),this.dispatchEvent(xc),this.xa&&(this.l=this.ra.setTimeout(this.kb,this.da),this.vb=q()))}},f.start=function(){this.xa=!0,this.l||(this.l=this.ra.setTimeout(this.kb,this.da),this.vb=q())},f.stop=function(){this.xa=!1,this.l&&(this.ra.clearTimeout(this.l),this.l=null)},f.u=function(){wc.pa.u.call(this),this.stop(),delete this.ra};var xc="tick";zc.prototype.Db=null;var Cc;s(Dc,zc),Cc=new Dc,s(Fc,S);var Gc="";Fc.prototype.r=Sb("goog.net.XhrIo");var Hc=/^https?$/i,Ic=["POST","PUT"];f=Fc.prototype,f.send=function(a,b,c,d){if(this.f)throw Error("[goog.net.XhrIo] Object is active with another request="+this.Sa+"; newUri="+a);b=b?b.toUpperCase():"GET",this.Sa=a,this.q="",this.ja=0,this.Ob=b,this.pb=!1,this.S=!0,this.f=this.ib?Ec(this.ib):Ec(Cc),this.hb=this.ib?Ac(this.ib):Ac(Cc),this.f.onreadystatechange=p(this.Sb,this);try{L(this.r,T(this,"Opening Xhr")),this.tb=!0,this.f.open(b,String(a),!0),this.tb=!1}catch(e){L(this.r,T(this,"Error opening Xhr: "+e.message)),Jc(this,e);return}a=c||"";var f=this.headers.n();d&&C(d,function(a,b){f.set(b,a)}),d=Ya(f.ba()),c=k.FormData&&a instanceof k.FormData,!(0<=Wa(Ic,b))||d||c||f.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),C(f,function(a,b){this.f.setRequestHeader(b,a)},this),this.Zb&&(this.f.responseType=this.Zb),"withCredentials"in this.f&&(this.f.withCredentials=this.fc);try{Kc(this),0<this.Ga&&(this.fb=Lc(this.f),L(this.r,T(this,"Will abort after "+this.Ga+"ms if incomplete, xhr2 "+this.fb)),this.fb?(this.f.timeout=this.Ga,this.f.ontimeout=p(this.qa,this)):this.eb=yc(this.qa,this.Ga,this)),L(this.r,T(this,"Sending request")),this.Ra=!0,this.f.send(a),this.Ra=!1}catch(g){L(this.r,T(this,"Send error: "+g.message)),Jc(this,g)}},f.qa=function(){"undefined"!=typeof aa&&this.f&&(this.q="Timed out after "+this.Ga+"ms, aborting",this.ja=8,L(this.r,T(this,this.q)),this.dispatchEvent("timeout"),this.abort(8))},f.abort=function(a){this.f&&this.S&&(L(this.r,T(this,"Aborting")),this.S=!1,this.ca=!0,this.f.abort(),this.ca=!1,this.ja=a||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Nc(this))},f.u=function(){this.f&&(this.S&&(this.S=!1,this.ca=!0,this.f.abort(),this.ca=!1),Nc(this,!0)),Fc.pa.u.call(this)},f.Sb=function(){this.ob||(this.tb||this.Ra||this.ca?Oc(this):this.wc())},f.wc=function(){Oc(this)},f.isActive=function(){return!!this.f},f.Kb=function(){return n(this.q)?this.q:String(this.q)},new Rc,Rc.prototype.set=function(a){this.Yb=a},Rc.prototype.reset=function(){this.set(q())},Rc.prototype.get=function(){return this.Yb},s(Sc,N);var Tc=[];f=Sc.prototype,f.Ta=function(a,b,c,d){m(b)||(Tc[0]=b,b=Tc);for(var e=0;e<b.length;e++){var f=lc(a,b[e],c||this.handleEvent,d||!1,this.e||this);if(!f)break;this.j[f.key]=f}return this},f.yb=function(a,b,c,d,e){if(m(b))for(var f=0;f<b.length;f++)this.yb(a,b[f],c,d,e);else c=c||this.handleEvent,e=e||this.e||this,c=mc(c),d=!!d,b=ac(a)?a.za(b,c,d,e):a?(a=nc(a))?a.za(b,c,d,e):null:null,b&&(rc(b),delete this.j[b.key]);return this},f.Za=function(){var a=this.j,b=rc,c;for(c in a)b.call(void 0,a[c],c,a);this.j={}},f.u=function(){Sc.pa.u.call(this),this.Za()},f.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},s(Uc,N),f=Uc.prototype,f.ab=!1,f.Xb=0,f.l=null,f.stop=function(){this.l&&(k.clearTimeout(this.l),this.l=null,this.ab=!1)},f.u=function(){Uc.pa.u.call(this),this.stop()},f.xc=function(){this.l=null,this.ab&&!this.Xb&&(this.ab=!1,Vc(this))},f=V.prototype,f.v=null,f.F=!1,f.ua=null,f.Ab=null,f.Ea=null,f.sa=null,f.T=null,f.w=null,f.W=null,f.k=null,f.Ia=0,f.K=null,f.ta=null,f.q=null,f.g=-1,f.ac=!0,f.Z=!1,f.ma=0,f.Xa=null;var Wc=45e3,Xc=250,Zc={},$c={};f=V.prototype,f.X=function(a){this.v=a},f.setTimeout=function(a){this.qa=a},f.dc=function(a){this.ma=a},f.Dc=function(a){a=a.target;var b=this.Xa;b&&3==U(a)?(this.a.debug("Throttling readystatechange."),b.l||b.Xb?b.ab=!0:Vc(b)):this.gc(a)},f.gc=function(a){try{if(a==this.k)a:{var b=U(this.k),c=this.k.ja,d=Pc(this.k);if(!ad()||y&&!z("420+")){if(4>b)break a}else if(3>b||3==b&&!Aa&&!Qc(this.k))break a;this.Z||4!=b||7==c||(8==c||0>=d?this.b.H(gd):this.b.H(hd)),id(this);var e=Pc(this.k);this.g=e;var f=Qc(this.k);f||this.a.debug("No response text for uri "+this.w+" status "+e),this.F=200==e,this.a.info("XMLHTTP RESP ("+this.B+") [ attempt "+this.Fa+"]: "+this.ta+"\n"+this.w+"\n"+b+" "+e),this.F?(4==b&&W(this),this.Fb?(jd(this,b,f),Aa&&this.F&&3==b&&(this.qb.Ta(this.Va,xc,this.Cc),this.Va.start())):(Tb(this.a,this.B,f,null),kd(this,f)),this.F&&!this.Z&&(4==b?this.b.ka(this):(this.F=!1,ed(this)))):(400==e&&0<f.indexOf("Unknown SID")?(this.q=3,X(),this.a.fa("XMLHTTP Unknown SID ("+this.B+")")):(this.q=0,X(),this.a.fa("XMLHTTP Bad status "+e+" ("+this.B+")")),W(this),ld(this))}else this.a.fa("Called back with an unexpected xmlhttp")}catch(g){this.a.debug("Failed call to OnXmlHttpReadyStateChanged_"),this.k&&Qc(this.k)?Vb(this.a,g,"ResponseText: "+Qc(this.k)):Vb(this.a,g,"No response text")}finally{}},f.Cc=function(){var a=U(this.k),b=Qc(this.k);this.Ia<b.length&&(id(this),jd(this,a,b),this.F&&4!=a&&ed(this))},f.Ac=function(a){Y(p(this.zc,this,a),0)},f.zc=function(a){if(!this.Z){var b=this.a;b.info("TRIDENT TEXT ("+this.B+"): "+Ub(b,a)),id(this),kd(this,a),ed(this)}},f.Wb=function(a){Y(p(this.yc,this,a),0)},f.yc=function(a){this.Z||(this.a.info("TRIDENT TEXT ("+this.B+"): "+a?"success":"failure"),W(this),this.F=a,this.b.ka(this),this.b.H(od))},f.pc=function(){id(this),this.b.ka(this)},f.cancel=function(){this.Z=!0,W(this)},f.Bc=function(){this.ua=null;var a=q();0<=a-this.Ab?(this.F&&this.a.J("Received watchdog timeout even though request loaded successfully"),this.a.info("TIMEOUT: "+this.w),2!=this.sa&&this.b.H(gd),W(this),this.q=2,X(),ld(this)):(this.a.fa("WatchDog timer called too early"),pd(this,this.Ab-a))},f.Kb=function(){return this.q},f=sd.prototype,f.v=null,f.A=null,f.Ya=!1,f.ec=null,f.Na=null,f.ub=null,f.I=null,f.c=null,f.g=-1,f.L=null,f.va=null,f.X=function(a){this.v=a},f.cc=function(a){this.P=a},f.mb=function(a){this.I=a,a=td(this.b,this.I),X(),this.ec=q();var b=this.b.Jb;null!=b?(this.L=this.b.correctHostPrefix(b[0]),(this.va=b[1])?(this.c=1,ud(this)):(this.c=2,vd(this))):(qb(a,"MODE","init"),this.A=new V(this,this.a,void 0,void 0,void 0),this.A.X(this.v),dd(this.A,a,!1,null,!0),this.c=0)},f.mc=function(a){if(a)this.c=2,vd(this);else{X();var b=this.b;b.a.debug("Test Connection Blocked"),b.g=b.U.g,Z(b,9)}a&&this.H(hd)},f.nb=function(a){return this.b.nb(a)},f.abort=function(){this.A&&(this.A.cancel(),this.A=null),this.g=-1},f.Nb=function(){return!1},f.Tb=function(a,b){this.g=a.g;if(0==this.c)if(this.a.debug("TestConnection: Got data for stage 1"),b){try{var c=this.P.parse(b)}catch(d){Vb(this.a,d),zd(this.b,this);return}this.L=this.b.correctHostPrefix(c[0]),this.va=c[1]}else this.a.debug("TestConnection: Null responseText"),zd(this.b,this);else if(2==this.c)if(this.Ya)X(),this.ub=q();else if("11111"==b){if(X(),this.Ya=!0,this.Na=q(),c=this.Na-this.ec,ad()||500>c)this.g=200,this.A.cancel(),this.a.debug("Test connection succeeded; using streaming connection"),X(),xd(this.b,this,!0)}else X(),this.Na=this.ub=q(),this.Ya=!1},f.ka=function(){this.g=this.A.g;if(!this.A.F)this.a.debug("TestConnection: request failed, in state "+this.c),0==this.c?X():2==this.c&&X(),zd(this.b,this);else if(0==this.c)this.a.debug("TestConnection: request complete for initial check"),this.va?(this.c=1,ud(this)):(this.c=2,vd(this));else if(2==this.c){this.a.debug("TestConnection: request complete for stage 2");var a=!1;(a=ad()?this.Ya:200>this.ub-this.Na?!1:!0)?(this.a.debug("Test connection succeeded; using streaming connection"),X(),xd(this.b,this,!0)):(this.a.debug("Test connection failed; not using streaming"),X(),xd(this.b,this,!1))}},f.bb=function(){return this.b.bb()},f.isActive=function(){return this.b.isActive()},f.H=function(a){this.b.H(a)},f=Ad.prototype,f.v=null,f.ya=null,f.p=null,f.i=null,f.I=null,f.Oa=null,f.Cb=null,f.L=null,f.jc=!0,f.Ca=0,f.uc=0,f.Ma=!1,f.e=null,f.G=null,f.M=null,f.$=null,f.U=null,f.zb=null,f.ic=!0,f.Aa=-1,f.Pb=-1,f.g=-1,f.aa=0,f.ga=0,f.kc=5e3,f.Ec=1e4,f.rb=2,f.sb=2e4,f.ma=0,f.cb=!1,f.ha=8;var Bd=1,Dd=new S;s(Ed,P),s(Fd,P);var fd=1,hd=2,gd=3,od=4;s(Gd,P);var Wb="y2f%";f=Ad.prototype,f.mb=function(a,b,c,d,e){this.a.debug("connect()"),X(),this.I=b,this.ya=c||{},d&&void 0!==e&&(this.ya.OSID=d,this.ya.OAID=e),this.a.debug("connectTest_()"),Id(this)&&(this.U=new sd(this,this.a),this.U.X(this.v),this.U.cc(this.P),this.U.mb(a))},f.disconnect=function(){this.a.debug("disconnect()"),Jd(this);if(3==this.c){var a=this.Ca++,b=this.Oa.n();F(b,"SID",this.Y),F(b,"RID",a),F(b,"TYPE","terminate"),Kd(this,b),a=new V(this,this.a,this.Y,a,void 0),a.sa=2,a.T=G(b.n()),b=new Image,b.src=a.T,b.onload=b.onerror=p(a.pc,a),a.Ea=q(),ed(a)}Ld(this)},f.X=function(a){this.v=a},f.dc=function(a){this.ma=a},f.Nb=function(){return 0==this.c},f.cc=function(a){this.P=a},f.Vb=function(a){this.G=null,this.a.debug("startForwardChannel_");if(Id(this))if(this.c==Bd)if(a)this.a.J("Not supposed to retry the open");else{this.a.debug("open_()"),this.Ca=Math.floor(1e5*Math.random()),a=this.Ca++;var b=new V(this,this.a,"",a,void 0);b.X(this.v);var c=Od(this),d=this.Oa.n();F(d,"RID",a),this.Eb&&F(d,"CVER",this.Eb),Kd(this,d),bd(b,d,c),this.p=b,this.c=2}else 3==this.c&&(a?Pd(this,a):0==this.t.length?this.a.debug("startForwardChannel_ returned: nothing to send"):this.p?this.a.J("startForwardChannel_ returned: connection already in progress"):(Pd(this),this.a.debug("startForwardChannel_ finished, sent request")))},f.Ub=function(){this.M=null;if(Id(this)){this.a.debug("Creating new HttpRequest"),this.i=new V(this,this.a,this.Y,"rpc",this.Bb),this.i.X(this.v),this.i.dc(this.ma);var a=this.Cb.n();F(a,"RID","rpc"),F(a,"SID",this.Y),F(a,"CI",this.zb?"0":"1"),F(a,"AID",this.Aa),Kd(this,a);if(ad())F(a,"TYPE","xmlhttp"),dd(this.i,a,!0,this.L,!1);else{F(a,"TYPE","html");var b=this.i,c=Boolean(this.L);b.sa=3,b.T=G(a.n()),nd(b,c)}this.a.debug("New Request created")}},f.Tb=function(a,b){if(0!=this.c&&(this.i==a||this.p==a))if(this.g=a.g,this.p==a&&3==this.c)if(7<this.ha){var c;try{c=this.P.parse(b)}catch(d){c=null}if(m(c)&&3==c.length){var e=c;if(0==e[0])a:if(this.a.debug("Server claims our backchannel is missing."),this.M)this.a.debug("But we are currently starting the request.");else{if(this.i){if(!(this.i.Ea+3e3<this.p.Ea))break a;Md(this),this.i.cancel(),this.i=null}else this.a.fa("We do not have a BackChannel established");Rd(this),X()}else this.Pb=e[1],c=this.Pb-this.Aa,0<c&&(e=e[2],this.a.debug(e+" bytes (in "+c+" arrays) are outstanding on the BackChannel"),37500>e&&this.zb&&0==this.ga&&!this.$&&(this.$=Y(p(this.vc,this),6e3)))}else this.a.debug("Bad POST response data returned"),Z(this,11)}else b!=Wb&&(this.a.debug("Bad data returned - missing/invald magic cookie"),Z(this,11));else if(this.i==a&&Md(this),!/^[\s\xa0]*$/.test(b)){c=this.P.parse(b);for(var e=this.e&&this.e.channelHandleMultipleArrays?[]:null,f=0;f<c.length;f++){var g=c[f];this.Aa=g[0],g=g[1],2==this.c?"c"==g[0]?(this.Y=g[1],this.L=this.correctHostPrefix(g[2]),g=g[3],this.ha=null!=g?g:6,this.c=3,this.e&&this.e.channelOpened(this),this.Cb=yd(this,this.L,this.I),Qd(this)):"stop"==g[0]&&Z(this,7):3==this.c&&("stop"==g[0]?(e&&0!=e.length&&(this.e.channelHandleMultipleArrays(this,e),e.length=0),Z(this,7)):"noop"!=g[0]&&(e?e.push(g):this.e&&this.e.channelHandleArray(this,g)),this.ga=0)}e&&0!=e.length&&this.e.channelHandleMultipleArrays(this,e)}},f.correctHostPrefix=function(a){return this.jc?this.e?this.e.correctHostPrefix(a):a:null},f.vc=function(){null!=this.$&&(this.$=null,this.i.cancel(),this.i=null,Rd(this),X())},f.ka=function(a){this.a.debug("Request complete");var b;if(this.i==a)Md(this),this.i=null,b=2;else{if(this.p!=a)return;this.p=null,b=1}this.g=a.g;if(0!=this.c)if(a.F)1==b?(q(),Dd.dispatchEvent(new Fd(Dd,a.W?a.W.length:0)),Nd(this),this.Q.length=0):Qd(this);else{var c=a.Kb();if(3==c||7==c||0==c&&0<this.g)this.a.debug("Not retrying due to error type");else{this.a.debug("Maybe retrying, last error: "+Yc(c,this.g));var d;if(d=1==b)this.p||this.G?(this.a.J("Request already in progress"),d=!1):this.c==Bd||this.aa>=(this.Ma?0:this.rb)?d=!1:(this.a.debug("Going to retry POST"),this.G=Y(p(this.Vb,this,a),Sd(this,this.aa)),this.aa++,d=!0);if(d||2==b&&Rd(this))return;this.a.debug("Exceeded max number of retries")}this.a.debug("Error: HTTP request failed");switch(c){case 1:Z(this,5);break;case 4:Z(this,10);break;case 3:Z(this,6);break;case 7:Z(this,12);break;default:Z(this,2)}}},f.nc=function(a){if(!(0<=Wa(arguments,this.c)))throw Error("Unexpected channel state: "+this.c)},f.Gc=function(a){a?(this.a.info("Successfully pinged google.com"),X()):(this.a.info("Failed to ping google.com"),X(),Td(this,8))},f.nb=function(a){if(a&&!this.cb)throw Error("Can't create secondary domain capable XhrIo object.");return a=new Fc,a.fc=this.cb,a},f.isActive=function(){return!!this.e&&this.e.isActive(this)},f.H=function(){Dd.dispatchEvent(new Gd(Dd))},f.bb=function(){return this.cb||!ad()},f=Ud.prototype,f.channelHandleMultipleArrays=null,f.okToMakeRequest=function(){return 0},f.channelOpened=function(){},f.channelHandleArray=function(){},f.channelError=function(){},f.channelClosed=function(){},f.getAdditionalParams=function(){return{}},f.getNetworkTestImageUri=function(){return null},f.isActive=function(){return!0},f.badMapError=function(){},f.correctHostPrefix=function(a){return a};var $,Vd,Wd=[].slice;Vd={0:"Ok",4:"User is logging out",6:"Unknown session ID",7:"Stopped by server",8:"General network error",2:"Request failed",9:"Blocked by a network administrator",5:"No data from server",10:"Got bad data from the server",11:"Got a bad response from the server"},$=function(a,b){var c,d,e,f,g,h,i,j,l,n,o;return j=this,a||(a="channel"),a.match(/:\/\//)&&a.replace(/^ws/,"http"),b||(b={}),m(b||"string"==typeof b)&&(b={}),h=b.reconnectTime||3e3,null!==b.affinity&&(b.extraParams||(b.extraParams={}),b.affinityParam||(b.affinityParam="a"),this.affinity=b.affinity||sa(),b.extraParams[b.affinityParam]=this.affinity),o=function(a){j.readyState=j.readyState=a},o(this.CLOSED),n=null,f=b.Kc,c=function(){var a,b;b=arguments[0],a=2<=arguments.length?Wd.call(arguments,1):[];try{return"function"==typeof j[b]?j[b].apply(j,a):void 0}catch(c){throw a=c,"undefined"!=typeof console&&null!==console&&console.error(a.stack),a}},d=new Ud,d.channelOpened=function(){return f=n,o($.OPEN),c("onopen")},e=null,d.channelError=function(a,b){var d;d=Vd[b],e=b,j.readyState!==$.CLOSED&&o($.jb);try{return c("onerror",d,b)}catch(f){}},i=null,d.channelClosed=function(a,d,f){var k;if(j.readyState!==$.CLOSED){n=null,a=e?Vd[e]:"Closed",o($.CLOSED),b.reconnect&&7!==e&&0!==e&&(k=6===e?0:h,clearTimeout(i),i=setTimeout(g,k));try{c("onclose",a,d,f)}catch(l){}return e=null}},d.channelHandleArray=function(a,b){return c("onmessage",b)},g=function(){if(n)throw Error("Reconnect() called from invalid state");o($.CONNECTING),c("onconnecting"),clearTimeout(i),n=new Ad(b.appVersion,null!=f?f.Jb:void 0),b.crossDomainXhr&&(n.cb=!0),n.e=d,e=null;if(b.failFast){var g=n;g.Ma=!0,g.a.info("setFailFast: true"),(g.p||g.G)&&g.aa>(g.Ma?0:g.rb)&&(g.a.info("Retry count "+g.aa+" > new maxRetries "+(g.Ma?0:g.rb)+". Fail immediately!"),g.p?(g.p.cancel(),g.ka(g.p)):(k.clearTimeout(g.G),g.G=null,Z(g,2)))}return b.forwardChannelRequestTimeout&&(n.sb=b.forwardChannelRequestTimeout),n.mb(""+a+"/test",""+a+"/bind",b.extraParams,null!=f?f.Y:void 0,null!=f?f.Aa:void 0)},this.open=function(){if(j.readyState!==j.CLOSED)throw Error("Already open");return g()},this.close=function(){clearTimeout(i),e=0;if(j.readyState!==$.CLOSED)return o($.jb),n.disconnect()},this.sendMap=l=function(a){var b;if((b=j.readyState)===$.jb||b===$.CLOSED)throw Error("Cannot send to a closed connection");b=n;if(0==b.c)throw Error("Invalid operation: sending map when state is closed");1e3==b.t.length&&b.a.J("Already have 1000 queued maps upon queueing "+xb(a)),b.t.push(new Cd(b.uc++,a)),2!=b.c&&3!=b.c||Nd(b)},this.send=function(a){return"string"==typeof a?l({_S:a}):l({JSON:xb(a)})},g(),this},$.prototype.CONNECTING=$.CONNECTING=$.CONNECTING=0,$.prototype.OPEN=$.OPEN=$.OPEN=1,$.prototype.CLOSING=$.CLOSING=$.jb=2,$.prototype.CLOSED=$.CLOSED=$.CLOSED=3,("undefined"!=typeof exports&&null!==exports?exports:window).BCSocket=$}(),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=[].slice,x=function(a,b){return function(){return a.apply(b,arguments)}},y=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};window.sharejs=l={version:"0.6.2"},typeof WEB=="undefined"&&(window.WEB=!0),p=typeof WEB!="undefined"&&WEB!==null?function(a){return setTimeout(a,0)}:process.nextTick,d=function(){function a(){}return a.prototype.on=function(a,b){var c;return this._events||(this._events={}),(c=this._events)[a]||(c[a]=[]),this._events[a].push(b),this},a.prototype.removeListener=function(a,b){var c,d,e,f=this;this._events||(this._events={}),d=(e=this._events)[a]||(e[a]=[]),c=0;while(c<d.length)d[c]===b&&(d[c]=void 0),c++;return p(function(){var b;return f._events[a]=function(){var c,d,e,f;e=this._events[a],f=[];for(c=0,d=e.length;c<d;c++)b=e[c],b&&f.push(b);return f}.call(f)}),this},a.prototype.emit=function(){var a,b,c,d,e,f,g;b=arguments[0],a=2<=arguments.length?w.call(arguments,1):[];if((f=this._events)!=null?!f[b]:!void 0)return this;g=this._events[b];for(d=0,e=g.length;d<e;d++)c=g[d],c&&c.apply(this,a);return this},a.prototype.once=function(a,b){var c,d=this;return this.on(a,c=function(){var e;return e=1<=arguments.length?w.call(arguments,0):[],d.removeListener(a,c),b.apply(d,e)})},a}(),d.mixin=function(a){var b;return b=a.prototype||a,b.on=d.prototype.on,b.removeListener=d.prototype.removeListener,b.emit=d.prototype.emit,b.once=d.prototype.once,a};if(typeof WEB=="undefined"||WEB===null)module.exports=d;l._bt=i=function(a,b,c,d){var e,f;return e=function(a,c,d,e){return b(d,a,c,"left"),b(e,c,a,"right")},a.transformX=a.transformX=f=function(a,b){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;c(a),c(b),k=[];for(p=0,t=b.length;p<t;p++){o=b[p],j=[],g=0;while(g<a.length){l=[],e(a[g],o,j,l),g++;if(l.length!==1){if(l.length===0){x=a.slice(g);for(q=0,u=x.length;q<u;q++)h=x[q],d(j,h);o=null;break}y=f(a.slice(g),l),i=y[0],n=y[1];for(r=0,v=i.length;r<v;r++)h=i[r],d(j,h);for(s=0,w=n.length;s<w;s++)m=n[s],d(k,m);o=null;break}o=l[0]}o!=null&&d(k,o),a=j}return[a,k]},a.transform=a.transform=function(a,c,d){var e,g,h,i,j;if(d!=="left"&&d!=="right")throw new Error("type must be 'left' or 'right'");return c.length===0?a:a.length===1&&c.length===1?b([],a[0],c[0],d):d==="left"?(i=f(a,c),e=i[0],h=i[1],e):(j=f(c,a),h=j[0],g=j[1],g)}},typeof WEB=="undefined"&&(l.bootstrapTransform=i),s={},s.name="text",s.create=function(){return""},r=function(a,b,c){return a.slice(0,b)+c+a.slice(b)},j=function(a){var b,c;if(typeof a.p!="number")throw new Error("component missing position field");c=typeof a.i,b=typeof a.d;if(!(c==="string"^b==="string"))throw new Error("component needs an i or d field");if(!(a.p>=0))throw new Error("position cannot be negative")},k=function(a){var b,c,d;for(c=0,d=a.length;c<d;c++)b=a[c],j(b);return!0},s.apply=function(a,b){var c,d,e,f;k(b);for(e=0,f=b.length;e<f;e++){c=b[e];if(c.i!=null)a=r(a,c.p,c.i);else{d=a.slice(c.p,c.p+c.d.length);if(c.d!==d)throw new Error("Delete component '"+c.d+"' does not match deleted text '"+d+"'");a=a.slice(0,c.p)+a.slice(c.p+c.d.length)}}return a},s._append=h=function(a,b){var c,d,e;if(b.i===""||b.d==="")return;return a.length===0?a.push(b):(c=a[a.length-1],c.i!=null&&b.i!=null&&c.p<=(d=b.p)&&d<=c.p+c.i.length?a[a.length-1]={i:r(c.i,b.p-c.p,b.i),p:c.p}:c.d!=null&&b.d!=null&&b.p<=(e=c.p)&&e<=b.p+b.d.length?a[a.length-1]={d:r(b.d,c.p-b.p,c.d),p:b.p}:a.push(b))},s.compose=function(a,b){var c,d,e,f;k(a),k(b),d=a.slice();for(e=0,f=b.length;e<f;e++)c=b[e],h(d,c);return d},s.compress=function(a){return s.compose([],a)},s.normalize=function(a){var b,c,d,e;c=[];if(a.i!=null||a.p!=null)a=[a];for(d=0,e=a.length;d<e;d++)b=a[d],b.p==null&&(b.p=0),h(c,b);return c},u=function(a,b,c){return b.i!=null?b.p<a||b.p===a&&c?a+b.i.length:a:a<=b.p?a:a<=b.p+b.d.length?b.p:a-b.d.length},s.transformCursor=function(a,b,c){var d,e,f,g;e=c==="right";for(f=0,g=b.length;f<g;f++)d=b[f],a=u(a,d,e);return a},s._tc=t=function(a,b,c,d){var e,f,g,i,j,l;k([b]),k([c]);if(b.i!=null)h(a,{i:b.i,p:u(b.p,c,d==="right")});else if(c.i!=null)l=b.d,b.p<c.p&&(h(a,{d:l.slice(0,c.p-b.p),p:b.p}),l=l.slice(c.p-b.p)),l!==""&&h(a,{d:l,p:b.p+c.i.length});else if(b.p>=c.p+c.d.length)h(a,{d:b.d,p:b.p-c.d.length});else if(b.p+b.d.length<=c.p)h(a,b);else{i={d:"",p:b.p},b.p<c.p&&(i.d=b.d.slice(0,c.p-b.p)),b.p+b.d.length>c.p+c.d.length&&(i.d+=b.d.slice(c.p+c.d.length-b.p)),g=Math.max(b.p,c.p),f=Math.min(b.p+b.d.length,c.p+c.d.length),e=b.d.slice(g-b.p,f-b.p),j=c.d.slice(g-c.p,f-c.p);if(e!==j)throw new Error("Delete ops delete different text in the same region of the document");i.d!==""&&(i.p=u(i.p,c),h(a,i))}return a},o=function(a){return a.i!=null?{d:a.i,p:a.p}:{i:a.d,p:a.p}},s.invert=function(a){var b,c,d,e,f;e=a.slice().reverse(),f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(o(b));return f},typeof WEB!="undefined"&&WEB!==null?(l.types||(l.types={}),i(s,t,k,h),l.types.text=s):(module.exports=s,require("./helpers").bootstrapTransform(s,t,k,h)),typeof WEB=="undefined"&&(s=require("./text")),s.api={provides:{text:!0},getLength:function(){return this.snapshot.length},getText:function(){return this.snapshot},insert:function(a,b,c){var d;return d=[{p:a,i:b}],this.submitOp(d,c),d},del:function(a,b,c){var d;return d=[{p:a,d:this.snapshot.slice(a,a+b)}],this.submitOp(d,c),d},_register:function(){return this.on("remoteop",function(a){var b,c,d,e;e=[];for(c=0,d=a.length;c<d;c++)b=a[c],b.i!==void 0?e.push(this.emit("insert",b.p,b.i)):e.push(this.emit("delete",b.p,b.d));return e})}};if(typeof WEB=="undefined"||WEB===null)v=require("../types");typeof WEB!="undefined"&&WEB!==null&&(l.extendDoc=function(a,b){return c.prototype[a]=b}),c=function(){function a(a,b,c){this.connection=a,this.name=b,this.shout=x(this.shout,this),this.flush=x(this.flush,this),c||(c={}),this.version=c.v,this.snapshot=c.snapshot,c.type&&this._setType(c.type),this.state="closed",this.autoOpen=!1,this._create=c.create,this.inflightOp=null,this.inflightCallbacks=[],this.inflightSubmittedIds=[],this.pendingOp=null,this.pendingCallbacks=[],this.serverOps={}}return a.prototype._xf=function(a,b){var c,d;return this.type.transformX?this.type.transformX(a,b):(c=this.type.transform(a,b,"left"),d=this.type.transform(b,a,"right"),[c,d])},a.prototype._otApply=function(a,b){var c;c=this.snapshot,this.snapshot=this.type.apply(this.snapshot,a),this.emit("change",a,c);if(b)return this.emit("remoteop",a,c)},a.prototype._connectionStateChanged=function(a,b){switch(a){case"disconnected":this.state="closed",this.inflightOp&&this.inflightSubmittedIds.indexOf(this.connection.prevId)==-1&&this.inflightSubmittedIds.push(this.connection.prevId),this.emit("closed");break;case"ok":this.connection.prevId=this.connection.id,this.autoOpen&&this.open();break;case"stopped":typeof this._openCallback=="function"&&this._openCallback(b)}return this.emit(a,b)},a.prototype._setType=function(a){var b,c,d;if(this.type)return;typeof a=="string"&&(a=v[a]);if(!a||!a.compose)throw new Error("Support for types without compose() is not implemented");this.type=a;if(a.api){d=a.api;for(b in d)c=d[b],this[b]=c;return typeof this._register=="function"?this._register():void 0}return this.provides={}},a.prototype._onMessage=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;switch(!1){case a.open!==!0:return this.state="open",this._create=!1,this.created==null&&(this.created=!!a.create),a.type&&this._setType(a.type),a.create?(this.created=!0,this.snapshot=this.type.create()):(this.created!==!0&&(this.created=!1),a.snapshot!==void 0&&(this.snapshot=a.snapshot)),a.meta&&(this.meta=a.meta),a.v!=null&&(this.version=a.v),this.inflightOp?(h={doc:this.name,op:this.inflightOp,v:this.version},this.inflightSubmittedIds.length&&(h.dupIfSource=this.inflightSubmittedIds),this.connection.send(h)):this.flush(),this.emit("open"),typeof this._openCallback=="function"?this._openCallback(null):void 0;case a.open!==!1:return a.error&&(typeof console!="undefined"&&console!==null&&console.error("Could not open document: "+a.error),this.emit("error",a.error),typeof this._openCallback=="function"&&this._openCallback(a.error)),this.state="closed",this.emit("closed"),typeof this._closeCallback=="function"&&this._closeCallback(),this._closeCallback=null;case a.op!==undefined||a.error!=="Op already submitted":break;case!(a.op===void 0&&a.v!==void 0||a.op&&(o=a.meta.source,y.call(this.inflightSubmittedIds,o)>=0)):e=this.inflightOp,this.inflightOp=null,this.inflightSubmittedIds.length=0,d=a.error;if(d){this.type.invert?(i=this.type.invert(e),this.pendingOp&&(p=this._xf(this.pendingOp,i),this.pendingOp=p[0],i=p[1]),this._otApply(i,!0)):this.emit("error","Op apply failed ("+d+") and the op could not be reverted"),q=this.inflightCallbacks;for(k=0,m=q.length;k<m;k++)b=q[k],b(d)}else{if(a.v!==this.version)throw new Error("Invalid version from server");this.serverOps[this.version]=e,this.version++,this.emit("acknowledge",e),r=this.inflightCallbacks;for(l=0,n=r.length;l<n;l++)b=r[l],b(null,e)}return this.flush();case!a.op:if(a.v<this.version)return;if(a.doc!==this.name)return this.emit("error","Expected docName '"+this.name+"' but got "+a.doc);if(a.v!==this.version)return this.emit("error","Expected version "+this.version+" but got "+a.v);return f=a.op,this.serverOps[this.version]=f,c=f,this.inflightOp!==null&&(s=this._xf(this.inflightOp,c),this.inflightOp=s[0],c=s[1]),this.pendingOp!==null&&(t=this._xf(this.pendingOp,c),this.pendingOp=t[0],c=t[1]),this.version++,this._otApply(c,!0);case!a.meta:u=a.meta,g=u.path,j=u.value;switch(g!=null?g[0]:void 0){case"shout":return this.emit("shout",j);default:return typeof console!="undefined"&&console!==null?console.warn("Unhandled meta op:",a):void 0}break;default:return typeof console!="undefined"&&console!==null?console.warn("Unhandled document message:",a):void 0}},a.prototype.flush=function(){if(this.connection.state!=="ok"||this.inflightOp!==null||this.pendingOp===null)return;return this.inflightOp=this.pendingOp,this.inflightCallbacks=this.pendingCallbacks,this.pendingOp=null,this.pendingCallbacks=[],this.connection.send({doc:this.name,op:this.inflightOp,v:this.version})},a.prototype.submitOp=function(a,b){return this.type.normalize!=null&&(a=this.type.normalize(a)),this.snapshot=this.type.apply(this.snapshot,a),this.pendingOp!==null?this.pendingOp=this.type.compose(this.pendingOp,a):this.pendingOp=a,b&&this.pendingCallbacks.push(b),this.emit("change",a),setTimeout(this.flush,0)},a.prototype.shout=function(a){return this.connection.state!=="ok"?!1:this.connection.send({doc:this.name,meta:{path:["shout"],value:a}})},a.prototype.open=function(a){var b,c=this;this.autoOpen=!0;if(this.state!=="closed")return;return b={doc:this.name,open:!0},this.snapshot===void 0&&(b.snapshot=null),this.type&&(b.type=this.type.name),this.version!=null&&(b.v=this.version),this._create&&(b.create=!0),this.connection.send(b),this.state="opening",this._openCallback=function(b){return c._openCallback=null,typeof a=="function"?a(b):void 0}},a.prototype.close=function(a){return this.autoOpen=!1,this.state==="closed"?typeof a=="function"?a():void 0:(this.connection.send({doc:this.name,open:!1}),this.state="closed",this.emit("closing"),this._closeCallback=a)},a}();if(typeof WEB=="undefined"||WEB===null)d=require("./microevent");d.mixin(c),l.Doc=c,e=function(){function a(a,b,c){var d,e,f=this;b!=null&&typeof b=="function"?(c=b,b=void 0):typeof c!="function"&&(c=g),this.debug=this.debugAll,this.reconnectInterval=1e3,this.timeoutInterval=2e3,this.forcedClose=!1,this.url=a,this.protocols=b,this.readyState=c.CONNECTING,this.URL=a,e=!1,d=function(a){var b;return f.ws=new c(f.url,null,{debug:!0,protocols_whitelist:["xhr-polling","jsonp-polling"],rtt:3e4}),f.debug&&console.debug("ReconnectingWebSocket","attempt-connect",f.url),b=setTimeout(function(){return f.debug&&console.debug("ReconnectingWebSocket","connection-timeout",f.url),e=!0,f.ws.close(),e=!1},f.timeoutInterval),f.ws.onopen=function(d){return clearTimeout(b),f.debug&&console.debug("ReconnectingWebSocket","onopen",f.url),f.readyState=c.OPEN,a=!1,f.onopen(d)},f.ws.onclose=function(g){return clearTimeout(b),f.ws=null,f.forcedClose?(f.readyState=c.CLOSED,f.onclose(g)):(f.readyState=c.CONNECTING,f.onconnecting(g),!a&&!e&&(f.debug&&console.debug("ReconnectingWebSocket","onclose",f.url),f.onclose(g)),setTimeout(function(){return d(!0)},f.reconnectInterval))},f.ws.onmessage=function(a){return f.debug&&console.debug("ReconnectingWebSocket","onmessage",f.url,a.data),f.onmessage(a)},f.ws.onerror=function(a){return f.debug&&console.debug("ReconnectingWebSocket","onerror",f.url,a),f.onerror(a)}},d(this.url)}return a.prototype.onopen=function(a){},a.prototype.onclose=function(a){},a.prototype.onconnecting=function(a){},a.prototype.onmessage=function(a){},a.prototype.onerror=function(a){},a.prototype.send=function(a){if(this.ws)return this.debug&&console.debug("ReconnectingWebSocket","send",this.url,a),this.ws.send(a);throw"INVALID_STATE_ERR : Pausing to reconnect websocket"},a.prototype.close=function(){if(this.ws)return this.forcedClose=!0,this.ws.close()},a.prototype.debugAll=!1,a.prototype.refresh=function(){if(this.ws)return this.ws.close()},a}(),typeof WEB!="undefined"&&WEB!==null?(v=l.types,a=window.BCSocket,f=window.SockJS,g=window.WebSocket,a?q="channel":f?q="sockjs":q="websocket"):(v=require("../types"),a=require("browserchannel").BCSocket,c=require("./doc").Doc,g=require("ws"),q=null),b=function(){function b(b,c,d){var g=this;this.docs={},this.state="connecting",q==null&&b.match(/^ws:/)&&(q="websocket"),this.socket=d?d:function(){switch(q){case"channel":return new a(b,{reconnect:!0});case"sockjs":return new e(b,f);case"websocket":return new e(b);default:return new a(b,{reconnect:!0})}}(),this.socket.onmessage=function(a){var b;if(q==="sockjs"||q==="websocket")a=JSON.parse(a.data);if(a.auth===null)return g.lastError=a.error,g.disconnect(),g.emit("connect failed",a.error);if(a.auth){g.id=a.auth,g.setState("ok");return}return b=a.doc,b!==void 0?g.lastReceivedDoc=b:a.doc=b=g.lastReceivedDoc,g.docs[b]?g.docs[b]._onMessage(a):typeof console!="undefined"&&console!==null?console.error("Unhandled message",a):void 0},this.connected=!1,this.socket.onclose=function(a){g.setState("disconnected",a);if(a==="Closed"||a==="Stopped by server")return g.setState("stopped",g.lastError||a)},this.socket.onerror=function(a){return g.emit("error",a)},this.socket.onopen=function(){return g.send({auth:c?c:null}),g.lastError=g.lastReceivedDoc=null,g.setState("handshaking")},this.socket.onconnecting=function(){return g.setState("connecting")}}return b.prototype.setState=function(a,b){var c,d,e,f;if(this.state===a)return;this.state=a,a==="disconnected"&&delete this.id,this.emit(a,b),e=this.docs,f=[];for(d in e)c=e[d],f.push(c._connectionStateChanged(a,b));return f},b.prototype.send=function(a){if(q==="sockjs"||q==="websocket")a=JSON.stringify(a);return this.socket.send(a)},b.prototype.disconnect=function(){return this.socket.close()},b.prototype.makeDoc=function(a,b,d){var e,f=this;if(this.docs[a])throw new Error("Doc "+a+" already open");return e=new c(this,a,b),this.docs[a]=e,e.open(function(b){return b&&delete f.docs[a],b||e.on("closed",function(){if(!e.autoOpen)return delete f.docs[a]}),d(b,b?void 0:e)})},b.prototype.openExisting=function(a,b){var c;return this.state==="stopped"?b("connection closed"):this.docs[a]?this._ensureOpenState(this.docs[a],b):c=this.makeDoc(a,{},b)},b.prototype.open=function(a,b,c){var d;if(this.state==="stopped")return c("connection closed");if(this.state==="connecting"){this.on("handshaking",function(){return this.open(a,b,c),c=null});return}typeof b=="function"&&(c=b,b="text"),c||(c=function(){}),typeof b=="string"&&(b=v[b]);if(!b)throw new Error("OT code for document type missing");if(a==null)throw new Error("Server-generated random doc names are not currently supported");if(this.docs[a]){d=this.docs[a],d.type===b?this._ensureOpenState(d,c):c("Type mismatch",d);return}return this.makeDoc(a,{create:!0,type:b.name},c)},b.prototype._ensureOpenState=function(a,b){switch(a.state){case"open":b(null,a);break;case"opening":this.on("open",function(){return b(null,a)});break;case"closed":a.open(function(c){return b(c,c?void 0:a)})}},b}();if(typeof WEB=="undefined"||WEB===null)d=require("./microevent");d.mixin(b),l.Connection=b,typeof WEB!="undefined"&&WEB!==null?(m=window.BCSocket!==void 0,n=window.SockJS!==void 0,m?q="channel":n?q="sockjs":q="websocket"):b=require("./connection").Connection,l.open=function(){var a,c,d;return a={},c=function(c,d,e){var f,g,h,i;return typeof WEB!="undefined"&&WEB!==null&&c==null&&(h=window.location,i=q==="websocket"?"ws:":h.protocol,c=""+i+"//"+h.host+"/"+q),a[c]||(f=new b(c,d,e),g=function(){return delete a[c]},f.on("disconnected",g),f.on("connect failed",g),a[c]=f),a[c]},d=function(a){var b,c,d,e;d=0,e=a.docs;for(c in e)b=e[c],(b.state!=="closed"||b.autoOpen)&&d++;if(d===0)return a.disconnect()},function(a,b,e,f){var g,h,i,j;return typeof e=="function"&&(f=e,e={}),typeof e=="string"&&(e={origin:e}),i=e.origin,g=e.authentication,j=e.socket,h=c(i,g,j),h.open(a,b,function(a,b){return a?(f(a),d(h)):(b.on("closed",function(){return d(h)}),f(null,b))}),h.on("connect failed"),h}}();if(typeof WEB=="undefined"||WEB===null)l.Doc=require("./doc").Doc,l.Connection=require("./connection").Connection}.call(this),function(){var a=!0,b,c,d,e,f,g,h,i,j,k,l,m=[].slice;e=window.sharejs,typeof a!="undefined"&&a!==null?k=e.types.text:k=require("./text"),h={},h.name="json",h.create=function(){return null},h.invertComponent=function(a){var b;return b={p:a.p},a.si!==void 0&&(b.sd=a.si),a.sd!==void 0&&(b.si=a.sd),a.oi!==void 0&&(b.od=a.oi),a.od!==void 0&&(b.oi=a.od),a.li!==void 0&&(b.ld=a.li),a.ld!==void 0&&(b.li=a.ld),a.na!==void 0&&(b.na=-a.na),a.lm!==void 0&&(b.lm=a.p[a.p.length-1],b.p=a.p.slice(0,a.p.length-1).concat([a.lm])),b},h.invert=function(a){var b,c,d,e,f;e=a.slice().reverse(),f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(h.invertComponent(b));return f},h.checkValidOp=function(a){},g=function(a){return Object.prototype.toString.call(a)==="[object Array]"},h.checkList=function(a){if(!g(a))throw new Error("Referenced element not a list")},h.checkObj=function(a){if(a.constructor!==Object)throw new Error("Referenced element not an object (it was "+JSON.stringify(a)+")")},h.apply=function(a,b){var d,e,f,g,i,j,k,l,m,n,o,p,q,r;h.checkValidOp(b),b=c(b),e={data:a};try{for(i=n=0,p=b.length;n<p;i=++n){d=b[i],l=null,m=null,g=e,j="data",r=d.p;for(o=0,q=r.length;o<q;o++){k=r[o],l=g,m=j,g=g[j],j=k;if(l==null)throw new Error("Path invalid")}if(d.na!==void 0){if(typeof g[j]!="number")throw new Error("Referenced element not a number");g[j]+=d.na}else if(d.si!==void 0){if(typeof g!="string")throw new Error("Referenced element not a string (it was "+JSON.stringify(g)+")");l[m]=g.slice(0,j)+d.si+g.slice(j)}else if(d.sd!==void 0){if(typeof g!="string")throw new Error("Referenced element not a string");if(g.slice(j,j+d.sd.length)!==d.sd)throw new Error("Deleted string does not match");l[m]=g.slice(0,j)+g.slice(j+d.sd.length)}else if(d.li!==void 0&&d.ld!==void 0)h.checkList(g),g[j]=d.li;else if(d.li!==void 0)h.checkList(g),g.splice(j,0,d.li);else if(d.ld!==void 0)h.checkList(g),g.splice(j,1);else if(d.lm!==void 0)h.checkList(g),d.lm!==j&&(f=g[j],g.splice(j,1),g.splice(d.lm,0,f));else if(d.oi!==void 0)h.checkObj(g),g[j]=d.oi;else{if(d.od===void 0)throw new Error("invalid / missing instruction in op");h.checkObj(g),delete g[j]}}}catch(s){throw s}return e.data},h.pathMatches=function(a,b,c){var d,e,f,g;if(a.length!==b.length)return!1;for(d=f=0,g=a.length;f<g;d=++f){e=a[d];if(e!==b[d]&&(!c||d!==a.length-1))return!1}return!0},h.append=function(a,b){var d;return b=c(b),a.length!==0&&h.pathMatches(b.p,(d=a[a.length-1]).p)?d.na!==void 0&&b.na!==void 0?a[a.length-1]={p:d.p,na:d.na+b.na}:d.li!==void 0&&b.li===void 0&&b.ld===d.li?d.ld!==void 0?delete d.li:a.pop():d.od!==void 0&&d.oi===void 0&&b.oi!==void 0&&b.od===void 0?d.oi=b.oi:b.lm!==void 0&&b.p[b.p.length-1]===b.lm?null:a.push(b):a.push(b)},h.compose=function(a,b){var d,e,f,g;h.checkValidOp(a),h.checkValidOp(b),e=c(a);for(f=0,g=b.length;f<g;f++)d=b[f],h.append(e,d);return e},h.normalize=function(a){var b,c,d,e,f;c=[],g(a)||(a=[a]);for(d=0,e=a.length;d<e;d++)b=a[d],(f=b.p)==null&&(b.p=[]),h.append(c,b);return c},c=function(b){return typeof a!="undefined"&&a!==null?JSON.parse(JSON.stringify(b)):j(b)},j=function(a){var b,c,d;if(typeof a!="object"||a===null)return a;b=a instanceof Array?[]:{};for(c in a)d=a[c],a.hasOwnProperty(c)&&(b[c]=j(a[c]));return b},h.canOpAffectOp=function(a,b){var c,d,e,f;if(a.length===0)return!0;if(b.length===0)return!1;b=b.slice(0,b.length-1),a=a.slice(0,a.length-1);for(c=e=0,f=a.length;e<f;c=++e){d=a[c];if(c>=b.length)return!1;if(d!==b[c])return!1}return!0},h.transformComponent=function(a,b,d,e){var f,g,i,j,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;b=c(b),b.na!==void 0&&b.p.push(0),d.na!==void 0&&d.p.push(0),h.canOpAffectOp(d.p,b.p)&&(f=d.p.length-1),h.canOpAffectOp(b.p,d.p)&&(g=b.p.length-1),l=b.p.length,p=d.p.length,b.na!==void 0&&b.p.pop(),d.na!==void 0&&d.p.pop();if(d.na)return g!=null&&p>=l&&d.p[g]===b.p[g]&&(b.ld!==void 0?(o=c(d),o.p=o.p.slice(l),b.ld=h.apply(c(b.ld),[o])):b.od!==void 0&&(o=c(d),o.p=o.p.slice(l),b.od=h.apply(c(b.od),[o]))),h.append(a,b),a;g!=null&&p>l&&b.p[g]===d.p[g]&&(b.ld!==void 0?(o=c(d),o.p=o.p.slice(l),b.ld=h.apply(c(b.ld),[o])):b.od!==void 0&&(o=c(d),o.p=o.p.slice(l),b.od=h.apply(c(b.od),[o])));if(f!=null){i=l===p;if(d.na===void 0)if(d.si!==void 0||d.sd!==void 0){if(b.si!==void 0||b.sd!==void 0){if(!i)throw new Error("must be a string?");j=function(a){var b;return b={p:a.p[a.p.length-1]},a.si!=null?b.i=a.si:b.d=a.sd,b},v=j(b),w=j(d),t=[],k._tc(t,v,w,e);for(y=0,z=t.length;y<z;y++)u=t[y],n={p:b.p.slice(0,f)},n.p.push(u.p),u.i!=null&&(n.si=u.i),u.d!=null&&(n.sd=u.d),h.append(a,n);return a}}else if(d.li!==void 0&&d.ld!==void 0){if(d.p[f]===b.p[f]){if(!i)return a;if(b.ld!==void 0){if(b.li===void 0||e!=="left")return a;b.ld=c(d.li)}}}else if(d.li!==void 0)b.li!==void 0&&b.ld===void 0&&i&&b.p[f]===d.p[f]?e==="right"&&b.p[f]++:d.p[f]<=b.p[f]&&b.p[f]++,b.lm!==void 0&&i&&d.p[f]<=b.lm&&b.lm++;else if(d.ld!==void 0){if(b.lm!==void 0&&i){if(d.p[f]===b.p[f])return a;s=d.p[f],m=b.p[f],x=b.lm,(s<x||s===x&&m<x)&&b.lm--}if(d.p[f]<b.p[f])b.p[f]--;else if(d.p[f]===b.p[f]){if(p<l)return a;if(b.ld!==void 0){if(b.li===void 0)return a;delete b.ld}}}else if(d.lm!==void 0)if(b.lm!==void 0&&l===p){m=b.p[f],x=b.lm,q=d.p[f],r=d.lm;if(q!==r)if(m===q){if(e!=="left")return a;b.p[f]=r,m===x&&(b.lm=r)}else m>q&&b.p[f]--,m>r?b.p[f]++:m===r&&q>r&&(b.p[f]++,m===x&&b.lm++),x>q?b.lm--:x===q&&x>m&&b.lm--,x>r?b.lm++:x===r&&(r>q&&x>m||r<q&&x<m?e==="right"&&b.lm++:x>m?b.lm++:x===q&&b.lm--)}else b.li!==void 0&&b.ld===void 0&&i?(m=d.p[f],x=d.lm,s=b.p[f],s>m&&b.p[f]--,s>x&&b.p[f]++):(m=d.p[f],x=d.lm,s=b.p[f],s===m?b.p[f]=x:(s>m&&b.p[f]--,s>x?b.p[f]++:s===x&&m>x&&b.p[f]++));else if(d.oi!==void 0&&d.od!==void 0){if(b.p[f]===d.p[f]){if(b.oi===void 0||!i)return a;if(e==="right")return a;b.od=d.oi}}else if(d.oi!==void 0){if(b.oi!==void 0&&b.p[f]===d.p[f]){if(e!=="left")return a;h.append(a,{p:b.p,od:d.oi})}}else if(d.od!==void 0&&b.p[f]===d.p[f]){if(!i)return a;if(b.oi===void 0)return a;delete b.od}}return h.append(a,b),a},typeof a!="undefined"&&a!==null?(e.types||(e.types={}),e._bt(h,h.transformComponent,h.checkValidOp,h.append),e.types.json=h):(module.exports=h,require("./helpers").bootstrapTransform(h,h.transformComponent,h.checkValidOp,h.append)),typeof a=="undefined"&&(h=require("./json")),typeof a!="undefined"&&a!==null&&(f=e.extendDoc,e.extendDoc=function(a,c){return b.prototype[a]=c,f(a,c)}),d=function(a){return a.length===1&&a[0].constructor===Array?a[0]:a},b=function(){function a(a,b){this.doc=a,this.path=b}return a.prototype.at=function(){var a;return a=1<=arguments.length?m.call(arguments,0):[],this.doc.at(this.path.concat(d(a)))},a.prototype.parent=function(){return this.path.length?this.doc.at(this.path.slice(0,this.path.length-1)):void 0},a.prototype.get=function(){return this.doc.getAt(this.path)},a.prototype.set=function(a,b){return this.doc.setAt(this.path,a,b)},a.prototype.insert=function(a,b,c){return this.doc.insertAt(this.path,a,b,c)},a.prototype.del=function(a,b,c){return this.doc.deleteTextAt(this.path,b,a,c)},a.prototype.remove=function(a){return this.doc.removeAt(this.path,a)},a.prototype.push=function(a,b){return this.insert(this.get().length,a,b)},a.prototype.move=function(a,b,c){return this.doc.moveAt(this.path,a,b,c)},a.prototype.add=function(a,b){return this.doc.addAt(this.path,a,b)},a.prototype.on=function(a,b){return this.doc.addListener(this.path,a,b)},a.prototype.removeListener=function(a){return this.doc.removeListener(a)},a.prototype.getLength=function(){return this.get().length},a.prototype.getText=function(){return this.get()},a}(),l=function(a,b){var c,d,e,f,g,h;c={data:a},e="data",d=c;for(g=0,h=b.length;g<h;g++){f=b[g],d=d[e],e=f;if(typeof d=="undefined")throw new Error("bad path")}return{elem:d,key:e}},i=function(a,b){var c,d,e,f;if(a.length!==b.length)return!1;for(d=e=0,f=a.length;e<f;d=++e){c=a[d];if(c!==b[d])return!1}return!0},h.api={provides:{json:!0},at:function(){var a;return a=1<=arguments.length?m.call(arguments,0):[],new b(this,d(a))},get:function(){return this.snapshot},set:function(a,b){return this.setAt([],a,b)},getAt:function(a){var b,c,d;return d=l(this.snapshot,a),b=d.elem,c=d.key,b[c]},setAt:function(a,b,c){var d,e,f,g;g=l(this.snapshot,a),d=g.elem,e=g.key,f={p:a};if(d.constructor===Array)f.li=b,typeof d[e]!="undefined"&&(f.ld=d[e]);else{if(typeof d!="object")throw new Error("bad path");f.oi=b,typeof d[e]!="undefined"&&(f.od=d[e])}return this.submitOp([f],c)},removeAt:function(a,b){var c,d,e,f;f=l(this.snapshot,a),c=f.elem,d=f.key;if(typeof c[d]=="undefined")throw new Error("no element at that path");e={p:a};if(c.constructor===Array)e.ld=c[d];else{if(typeof c!="object")throw new Error("bad path");e.od=c[d]}return this.submitOp([e],b)},insertAt:function(a,b,c,d){var e,f,g,h;return h=l(this.snapshot,a),e=h.elem,f=h.key,g={p:a.concat(b)},e[f].constructor===Array?g.li=c:typeof e[f]=="string"&&(g.si=c),this.submitOp([g],d)},moveAt:function(a,b,c,d){var e;return e=[{p:a.concat(b),lm:c}],this.submitOp(e,d)},addAt:function(a,b,c){var d;return d=[{p:a,na:b}],this.submitOp(d,c)},deleteTextAt:function(a,b,c,d){var e,f,g,h;return h=l(this.snapshot,a),e=h.elem,f=h.key,g=[{p:a.concat(c),sd:e[f].slice(c,c+b)}],this.submitOp(g,d)},addListener:function(a,b,c){var d;return d={path:a,event:b,cb:c},this._listeners.push(d),d},removeListener:function(a){var b;return b=this._listeners.indexOf(a),b<0?!1:(this._listeners.splice(b,1),!0)},_register:function(){return this._listeners=[],this.on("change",function(a){var b,c,d,e,f,g,h,i,j,k,l,m;m=[];for(h=0,j=a.length;h<j;h++){b=a[h];if(b.na!==void 0||b.si!==void 0||b.sd!==void 0)continue;f=[],l=this._listeners;for(d=i=0,k=l.length;i<k;d=++i){e=l[d],c={p:e.path,na:0},g=this.type.transformComponent([],c,b,"left");if(g.length===0)f.push(d);else{if(g.length!==1)throw new Error("Bad assumption in json-api: xforming an 'si' op will always result in 0 or 1 components.");e.path=g[0].p}}f.sort(function(a,b){return b-a}),m.push(function(){var a,b,c;c=[];for(a=0,b=f.length;a<b;a++)d=f[a],c.push(this._listeners.splice(d,1));return c}.call(this))}return m}),this.on("remoteop",function(a){var b,c,d,e,f,g,h,j,k;k=[];for(h=0,j=a.length;h<j;h++)b=a[h],f=b.na===void 0?b.p.slice(0,b.p.length-1):b.p,k.push(function(){var a,h,j,k,l;j=this._listeners,l=[];for(a=0,h=j.length;a<h;a++){k=j[a],g=k.path,e=k.event,c=k.cb;if(i(g,f))switch(e){case"insert":b.li!==void 0&&b.ld===void 0?l.push(c(b.p[b.p.length-1],b.li)):b.oi!==void 0&&b.od===void 0?l.push(c(b.p[b.p.length-1],b.oi)):b.si!==void 0?l.push(c(b.p[b.p.length-1],b.si)):l.push(void 0);break;case"delete":b.li===void 0&&b.ld!==void 0?l.push(c(b.p[b.p.length-1],b.ld)):b.oi===void 0&&b.od!==void 0?l.push(c(b.p[b.p.length-1],b.od)):b.sd!==void 0?l.push(c(b.p[b.p.length-1],b.sd)):l.push(void 0);break;case"replace":b.li!==void 0&&b.ld!==void 0?l.push(c(b.p[b.p.length-1],b.ld,b.li)):b.oi!==void 0&&b.od!==void 0?l.push(c(b.p[b.p.length-1],b.od,b.oi)):l.push(void 0);break;case"move":b.lm!==void 0?l.push(c(b.p[b.p.length-1],b.lm)):l.push(void 0);break;case"add":b.na!==void 0?l.push(c(b.na)):l.push(void 0);break;default:l.push(void 0)}else this.type.canOpAffectOp(g,f)?e==="child op"?(d=b.p.slice(g.length),l.push(c(d,b))):l.push(void 0):l.push(void 0)}return l}.call(this));return k})}}}.call(this),FDBK.Mockup=function(a,b){a=a||{},this.id=a.id||utils.guid("a"),this.name=a.name,this.isMaster=a.isMaster||!1,this.master=a.master||null,this.parent=a.parent,this.stageWidth=a.stageWidth,this.stageHeight=a.stageHeight,this.stencils=a.stencils||[],this.selection=[],this.stencilDict={},this.groupedStencils={},typeof FDBK.UndoManager!="undefined"&&(this.undo=new FDBK.UndoManager({undoChange:FDBK.action("updateUndoButton"),redoChange:FDBK.action("updateRedoButton"),max_undo:300})),this.hasLayout=!1,this.countStencils=function(){return Object.keys(this.stencilDict).filter(function(a){return this.stencilDict[a].type!=="group"},this).length},this.guidForStencil=function(){return utils.guid(this.id+"-")},this.localIdForStencil=function(a){var b=a.split("-");return b[b.length-1]},a.duplicateFrom&&function(a,b){var c=function(c){return c.replace(a,b)};((function(a){for(var b=0;b<a.length;b++){var d=a[b],e=d.id;d.id=c(d.id),d.type==="group"&&d.stencils&&arguments.callee.call(this,d.stencils)}})).call(this,this.stencils)}.call(this,a.duplicateFrom,this.id),this.cleanUpLinks=function(a){var b=this,c=function(d){for(var e=0;e<d.length;e++){var f=d[e];f.link&&f.link.ref===a&&(f.link=null,FDBK.pub("collab-link-stencil",b.id,f.id,null)),f.type==="group"&&f.stencils&&c(f.stencils)}};c(this.stencils)},function(a,b){for(var c=0;c<a.length;c++)this.stencilDict[a[c].id]=a[c],b&&(this.groupedStencils[a[c].id]=b),a[c].type=="group"&&a[c].stencils&&a[c].stencils.length>0&&arguments.callee.call(this,a[c].stencils,a[c].id)}.call(this,this.stencils),this.stencil=function(a){return this.stencilDict[a]},this.stencilPath=function(a){var b=[],c;while(c=this.stencil(a))b.push(c),a=this.groupedStencils[a];return b},this.substencils=function(a){var b=[];return function(a){if(a){b.push(a);if(a.type==="group"&&a.stencils)for(var c=0;c<a.stencils.length;c++)arguments.callee.call(this,a.stencils[c])}}(this.stencil(a)),b},this.stencilList=function(){return this.stencils||[]},this.indexOfStencil=function(a){for(var b=0;b<this.stencils.length;b++)if(this.stencils[b]&&this.stencils[b].id===a)return b;return-1},this.addStencil=function(a,b){a=a||{};var c=a.id||this.guidForStencil();a.id=c;if(b){var d=this.stencil(b);d.type!="group"&&console.log("Trying to add sub stencils to non group parents"),d.stencils=d.stencils?[a].concat(d.stencils):[a]}else this.stencils=[a].concat(this.stencils);return this.stencilDict[c]=a,b&&(this.groupedStencils[c]=b),c},this.copyStencil=function(a){return this.addStencil($.extend(!0,{},this.stencil(a)))},this.removeStencil=function(a){function c(a){var c=b.stencil(a);delete b.stencilDict[a],b.groupedStencils[a]&&delete b.groupedStencils[a];if(c&&c.type=="group"&&c.stencils&&c.stencils.length>0)for(var d=0;d<c.stencils.length;d++)arguments.callee(c.stencils[d].id)}var b=this;c(a);var d=this.indexOfStencil(a);d!==-1&&this.stencils.splice(d,1)},this.updateStencil=function(a,b){var c=this.stencil(a);if(c)for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d])},this.changeStencilIndex=function(a,b){var c=this.indexOfStencil(a);c>=0&&this.stencils.splice(b,0,this.stencils.splice(c,1)[0])},this.stackStencil=function(a,b,c){var d=this.indexOfStencil(a),e=this.indexOfStencil(c),f=this.stencils[d],g=this.stencils[e];this.stencils.splice(d,1),e=this.indexOfStencil(c);var h=this.stencils.slice(0,e),i=this.stencils.slice(e+1,this.stencils.length);b=="before"?this.stencils=h.concat([f,g],i):this.stencils=h.concat([g,f],i)},this.stencilList=function(){return this.stencils},this.toString=function(){var a="#"+this.id+":";for(var b=0;b<this.stencils.length;b++){var c=this._stencilStore[this.stencils[b]];a+=this.stencils[b]+", "}return a},this.isEmpty=function(){return this.stencils.length===0};var c=function(a){var b={};for(var c=0;c<a.length;c++)typeof this[a[c]]!="undefined"&&(b[a[c]]=this[a[c]]);return b};return this.propertiesToExport=function(){var a=["id","name","stageWidth","stageHeight","stencils","master","isMaster","parent"];return c.call(this,a)},this.propertiesToDuplicate=function(){var a=["stageWidth","stageHeight","stencils","master","isMaster","parent"];return c.call(this,a)},this.toJSON=function(){return this.propertiesToExport()},this.usage=function(a){return utils.unique(Object.keys(this.stencilDict).map(function(b){return utils.objectPath(this[b],a)},this.stencilDict))},this.filterStencils=function(a){var b=this.stencilDict;return Object.keys(b).map(function(a){return b[a]}).filter(a)},this},FDBK.Project=function(a,b){b&&($.extend(!0,a,a.jsonData),delete a.jsonData),a=a||{},this.id=a.id||null,this.uniqueId=a.uniqueId||null,this.tempId=a.tempId||utils.guid("unsaved-"),this.alias=a.alias||null,this.name=a.name||FDBK.loc("_Untitled Project"),this.description=a.description||FDBK.loc("_No Description"),this.isArchived=a.isArchived||!1,this.ownerUserName=a.ownerUserName||FDBK.USER_DATA.userName,this.isDeleted=a.isDeleted||!1,this.isPublic=a.privacy?a.privacy==="public_":!0,this.privacy=a.privacy,this.permission=a.permission||"unknown",this.font=a.font||FDBK.config("projectManagement.font.legacy"),this.readOnly=a.readOnly||!1,this.notifications=a.notifications||!1,this.lastUpdateDate=a.lastupdateDate||null,this.googleFileId=a.googleFileId||null,this.version=a.version||"1.0",this.ownerIsPremium=a.ownerIsPremium||!1,this.isClean=function(){return JSON.stringify(this)===FDBK.CACHED_PROJECT},this.links=a.links||{},this.stageWidth=Math.abs(parseInt(a.stageWidth,10))||960,this.stageHeight=Math.abs(parseInt(a.stageHeight,10))||1200,this.mockups=a.mockups||[],this.privacy=a.privacy,this.fallbackImages=a.fallbackImages||[],this.mockups=this.mockups.map(function(a){return new FDBK.Mockup(a,b)}),this.updateAttributes=function(a){this.id=a.id||null,this.uniqueId=a.uniqueId||null,this.alias=a.alias||null,this.isArchived=a.isArchived||!1,this.ownerUserName=a.ownerUserName,this.isDeleted=a.isDeleted||!1,this.isPublic=a.privacy==="public_",this.permission=a.permission||"unknown",this.notifications=a.notifications||!1},this.mockupFromStencilId=function(a){var b=a.split("-");switch(b.length){case 1:return null;case 2:return this.mockup(b[0]);case 3:return this.mockup(b[0]+"-"+b[1])}return null},this.mockup=function(a){a+="";for(var b=0;b<this.mockups.length;b++)if(this.mockups[b].id===a)return this.mockups[b];return null},this.indexOfMockup=function(a){return this._indexOf(a,this.mockupList())},this._indexOf=function(a,b){for(var c=0;c<b.length;c++)if(b[c].id===a)return c;return-1},this.indexOfNormalPage=function(a){return this._indexOf(a,this.normalPages())},this.indexOfMasterPage=function(a){return this._indexOf(a,this.masterPages())},this.mockupAtIndex=function(a,b){return b&&(a=(a+this.mockups.length)%this.mockups.length),this.mockups[a]},this.normalPageAtIndex=function(a,b){var c=this.normalPages();return b&&(a=(a+c.length)%c.length),c[a]},this.mockupList=function(){return this.mockups},this.countStencils=function(){var a=0;return this.mockupList().forEach(function(b){a+=b.countStencils()}),a};var c={};this.normalPages=function(){function f(a){d[a]+=1;var b=e[a];while(b)d[b]+=1,b=e[b]}var a=this.mockupList().filter(function(a){return!a.isMaster}),b=[],c,d={},e={},g;for(var h=0;h<a.length;h++)g=a[h],g.parent&&(c=b.indexOf(this.mockup(g.parent)))>-1?(e[g.id]=g.parent,d[g.parent]||(d[g.parent]=0),c+=d[g.parent],b.splice(c+1,0,g),f(g.parent)):b.push(g);return b},this.masterPages=function(){return this.mockupList().filter(function(a){return a.isMaster})},this.pagesForMaster=function(a){return this.mockupList().filter(function(b){return!b.isMaster&&b.master===a})},this.childPages=function(a){return this.mockupList().filter(function(b){return!b.isMaster&&b.parent==a})},this.hasChildren=function(a){return this.childPages(a).length},this.isAncestor=function(a,b){var c=this.mockup(b);if(c){var d=c.parent;while(d){if(d===a)return!0;d=this.mockup(d).parent}}return!1},this.addMockup=function(a){a=a||{},a.stageWidth=a.stageWidth||this.stageWidth,a.stageHeight=a.stageHeight||this.stageHeight;var b=new FDBK.Mockup(a);return this.mockups.push(b),b.id},this.removeMockup=function(a){var b=this.indexOfMockup(a);b!==-1&&(this.cleanUpLinks(a),this.mockups.splice(b,1))},this.updateMockup=function(a,b){var c=this.mockup(a);if(c)for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d])},this.sortMockups=function(a){this.mockups.sort(function(b,c){return a.indexOf(b.id)-a.indexOf(c.id)})},this.cleanUpLinks=function(a){this.mockupList().forEach(function(b){b.cleanUpLinks(a)})},this.size=function(){return this.mockups.length},this.isNew=function(){return!this.uniqueId};var d=function(a){var b={};for(var c=0;c<a.length;c++)b[a[c]]=this[a[c]];return b};return this.propertiesToExport=function(){var a=["id","uniqueId","name","description","stageWidth","stageHeight","mockups","font"];return d.call(this,a)},this.toJSON=function(){return this.propertiesToExport()},this.toServerJSON=function(){var a=this.toJSON(),b={name:a.name,uniqueId:a.uniqueId,description:a.description,mockups:a.mockups,stageWidth:a.stageWidth,stageHeight:a.stageHeight,font:a.font};return b},this.getMetadataJSON=function(){var a=this.toJSON(),b={name:a.name,uniqueId:a.uniqueId,description:a.description};return b},this.getContentJSON=function(){var a=this.toJSON(),b={mockups:a.mockups,stageWidth:a.stageWidth,stageHeight:a.stageHeight,font:a.font};return b},this.getAttributes=function(){return{id:this.id,uniqueId:this.uniqueId,alias:this.alias,isArchived:this.isArchived,ownerUserName:this.ownerUserName,isDeleted:this.isDeleted,privacy:this.privacy,permission:this.permission,notifications:this.notifications}},this.canViewProject=function(){return this.permission!="unknown"&&this.permission!="forbidden"},this.canEditProject=function(){return this.permission=="owner"||this.permission=="collab_edit"},this.canCommentProject=function(){return this.permission=="owner"||this.permission=="collab_edit"||this.permission=="collab_view"||this.isPublic},this.canDeleteComments=function(){return this.permission=="owner"},this.canChangeCollaborators=function(){return this.permission=="owner"},this.isPremiumProject=function(){return FDBK.VIEWER_MODE?this.ownerIsPremium:this.permission=="collab_edit"||this.permission=="owner"&&(FDBK.hasPremiumPlan()||this.ownerIsPremium)},this.usage=function(a){return utils.unique(Array.prototype.concat.apply([],this.mockupList().map(function(b){return b.usage(a)})))},this.pageDepth=function(a){var b=0;while(a&&a.parent)a=this.mockup(a.parent),b++;return b},this},FDBK.UndoManager=function(a){this.action_index={},this.next_id=1,this.undo_queue=[],this.redo_queue=[],this.current_action=null,this.group=null,this.group_queue=[],this.group_id=0,this.working="",this.undo_available=0,this.undo_names=[],this.redo_available=0,this.redo_names=[];var b={max_undo:20,undoChange:function(){},redoChange:function(){}};this.settings=$.extend(b,a)},FDBK.UndoManager.prototype.groupRunner=function(a){var b;while(b=a.pop()){var c=this.action_index[b];delete this.action_index[b],c[1].apply(c[3],c[2])}},FDBK.UndoManager.prototype.undoable=function(a,b,c,d,e,f){if(this.group!==null)return e=e||this.next_id++,this.action_index[e]=[a,b,c,d],this.group[2][0].push(e),this;var g=this.undo_queue;return this.working=="UNDO"&&(g=this.redo_queue),e=e||this.next_id++,this.action_index[e]=[a,b,c,d],f||(g.push(e),g.length>this.settings.max_undo&&(g.shift(),this.working=="UNDO"?(this.redo_available--,this.redo_names.shift()):(this.undo_available--,this.undo_names.shift())),this.working=="UNDO"?(this.redo_available++,this.redo_names.push(this.current_action[0]),this.settings.redoChange()):(this.undo_available++,this.working=="REDO"?this.undo_names.push(this.current_action[0]):(this.clearRedoQueue(),this.undo_names.push(a)),this.settings.undoChange())),this},FDBK.UndoManager.prototype.undo=function(){if(this.undo_queue.length>0){var a=this.undo_queue.pop();this.undo_available--,this.undo_names.pop();var b=this.action_index[a];delete this.action_index[a],this.working="UNDO",this.current_action=b,this.startGroup(b[0]),b[1].apply(b[3],b[2]),this.endGroup(),delete this.current_action,this.working="",this.settings.undoChange()}return this},FDBK.UndoManager.prototype.undoQueueActionNames=function(a){var b=0,c,d=[];for(var e=this.undo_queue.length-1;e>=0;e--){c=this.action_index[this.undo_queue[e]][0];if(this.action_index[this.undo_queue[e]][1]!=this.groupRunner)c+=" "+this.action_index[this.undo_queue[e]][2].join(",");else{var f=this.action_index[this.undo_queue[e]][2];f.length>0&&(f=f[0]);var g=[];for(var h=0;h<f.length;h++)g.push(this.action_index[f[h]][2].join(","));c+=" "+g.join("").replace(",[object Object]","")}d.push(c),b++;if(b==a)break}return d},FDBK.UndoManager.prototype.clearUndoQueue=function(){for(var a=this.undo_queue.length-1;a>=0;a--)delete this.action_index[this.undo_queue[a]];return this.undo_queue=[],this.undo_available=0,this.redo_names=[],this.settings.undoChange(),this},FDBK.UndoManager.prototype.clearQueues=function(){return this.action_index={},this.undo_queue=[],this.undo_available=0,this.undo_names=[],this.redo_queue=[],this.redo_available=0,this.redo_names=[],this.settings.undoChange(),this.settings.redoChange(),this},FDBK.UndoManager.prototype.redo=function(){if(this.redo_queue.length>0){var a=this.redo_queue.pop();this.redo_available--,this.redo_names.pop();var b=this.action_index[a];delete this.action_index[a],this.working="REDO",this.current_action=b,this.startGroup(b[0]),b[1].apply(b[3],b[2]),this.endGroup(),delete this.current_action,this.working="",this.settings.redoChange()}return this},FDBK.UndoManager.prototype.clearRedoQueue=function(){for(var a=this.redo_queue.length-1;a>=0;a--)delete this.action_index[this.redo_queue[a]];return this.redo_queue=[],this.redo_available=0,this.redo_names=[],this.settings.redoChange(),this},FDBK.UndoManager.prototype.startGroup=function(a){return this.group!==null&&this.group_queue.push(this.group),this.group_id=this.next_id++,this.group=[a,this.groupRunner,[[]],this,this.group_id],this.group_id},FDBK.UndoManager.prototype.endGroup=function(){var a=this.group;return this.group_queue.length>0?this.group=this.group_queue.pop():this.group=null,this.undoable.apply(this,a),this},FDBK.UndoManager.prototype.exitGroup=function(a){if(a!==!1){var b=this.group;this.startGroup("rolling back"),b[1].apply(b[3],b[2]),this.exitGroup(!1)}return this.group_queue.length>0?this.group=this.group_queue.pop():this.group=null,this},FDBK.UndoManager.prototype.resumeGroup=function(a){return this.group!==null&&this.group_queue.push(this.group),this.group=this.action_index[a],this.group[5]=!0,this.group_id=a,this},DelayedQueue.prototype.add=function(a){this.paused?this.tasks.push(a):a.call()},DelayedQueue.prototype.addOnce=function(a){this.paused?this.tasks.indexOf(a)==-1&&this.tasks.push(a):a.call()},DelayedQueue.prototype.pause=function(){this.paused=!0},DelayedQueue.prototype.resume=function(){for(var a=0;a<this.tasks.length;a++)this.tasks[a].call();this.tasks=[],this.paused=!1},FDBK.mixinModule("errorTracking",{errorTracking:{extraData:{},setContext:function(a){this.extraData=a,a.email&&Raven.setUser({email:a.email})},trackException:function(a){if(!FDBK.isProductionEnv&&!BrowserDetect.unsupportedBrowser)throw a;Raven.captureException(a,{extra:this.extraData})},trackMessage:function(a){if(!FDBK.isProductionEnv)return;Raven.captureMessage(a,{extra:this.extraData})}},initModule:function(){Raven.config("https://e9ce532467a048aab25ac4c29202133b@app.getsentry.com/16326",{whitelistUrls:[/moqups\.com/,/d27nuzh0d4iswj\.cloudfront\.net/],ignoreErrors:["top.GLOBALS","originalCreateNotification","canvas.contentDocument","MyApp_RemoveAllHighlights","http://tt.epicplay.com","Can't find variable: ZiteReader","jigsaw is not defined","ComboSearch is not defined","http://loading.retry.widdit.com/","atomicFindClose","fb_xd_fragment","bmi_SafeAddOnload","EBCallBackMessageReceived","conduitPage"],ignoreUrls:[/graph\.facebook\.com/i,/connect\.facebook\.net\/en_US\/all\.js/i,/eatdifferent\.com\.woopra-ns\.com/i,/static\.woopra\.com\/js\/woopra\.js/i,/extensions\//i,/^chrome:\/\//i,/127\.0\.0\.1:4001\/isrunning/i,/webappstoolbarba\.texthelp\.com\//i,/metrics\.itunes\.apple\.com\.edgesuite\.net\//i]}).install()}}),FDBK.StreamingClient=function(a){this._doc=null,this._logEnabled=!1,this.shownOfflineMessage=!1,this.connectedUsers=[],this.saveActionOnAcknowledge=!1,this.$offlineStatus=$("#project-offline-status"),this.$saveInProgress=$("#project-save-in-progress"),this.$connectingStatus=$("#project-connecting-status"),this._suppressCheck=!1,this._opQueue=new DelayedQueue,this.docSize=0,this.MAX_DOC_SIZE=155e5,FDBK.sub("project-saved-locally",function(a){this._doc&&this._doc.snapshot&&(this.docSize=utils.JSONSize(this._doc.snapshot))},this),FDBK.sub("selection-transform",function(a,b,c){switch(b){case"timer-start":this._suppressCheck=!0;break;case"timer-stop":this._suppressCheck=!1}},this);var b=this;this.$offlineStatus.click(function(){var a=FDBK.library.serviceClient._doc;a&&b.refreshConnection()}),this._log=function(){this._logEnabled&&console.log.apply(console,arguments)},this._EXCEPTION_LOG_LENGTH=20,this._exceptionLog=[],this._logException=function(a,b,c){c&&typeof c=="object"&&(c=JSON.stringify(c)),a?FDBK.errorTracking.trackException(a):b&&FDBK.errorTracking.trackMessage(b);var d={t:(new Date).toISOString()};a&&(d.title=a.name+" "+a.message),b&&(d.label=b),c&&(d.extra=c);if(a||b||c)this._exceptionLog.push(d),this._exceptionLog.length>this._EXCEPTION_LOG_LENGTH&&this._exceptionLog.shift()},this.createProject=function(a,b){var c=this,d=a.constructor==FDBK.Project?a:new FDBK.Project(a);this.$saveInProgress.show(),FDBK.API.xhr(FDBK.API.CALL_CREATE_PROJECT,{data:JSON.stringify(d.getMetadataJSON()),success:function(a){a.success&&a.object?(d.updateAttributes(a.object),FDBK.library.closeCurrentProject(),FDBK.library.openProject(d,!0),FDBK.CACHED_PROJECT="",c.getProjectJSON(a.object.uniqueId,function(a,c){a&&(FDBK.library.closeCurrentProject(),FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error creating your project. Please contact us if the problem persists."),buttons:[{text:FDBK.loc("_OK"),classes:"primary-action close-modal"}]})),b&&b()})):FDBK.library.checkSession()},error:function(a){a.status===403&&FDBK.showActiveProjectsAlert(!0)}})},this.getProjectJSON=function(a,b){this._log("opening document ",a);var c=this;this.connectedUsers=[],FDBK.pub("presence-update-users",[]),c._doc&&FDBK.library.closeCurrentProject();var d,e=function(a){c._log("Failed opening document:",a),d&&(d.removeListener("connecting",D),d.disconnect()),d=null,b(a)},f={authentication:FDBK._authToken(),origin:FDBK.WEB_SOCKET_URL+"channel?p="+a,socket:new BCSocket(FDBK.WEB_SOCKET_URL+"channel",{reconnect:!0,extraParams:{p:a},affinity:null,forwardChannelRequestTimeout:18e4})};d=sharejs.open(a,"json",f,function(f,g){c.shownOfflineMessage=!1;if(f){c._log("error opening document ",a,f),c._doc=null,b(f,null);return}c._log("document open",a),c.setConnectionState("online"),d.removeListener("disconnected",e),c._doc=g,FDBK.errorTracking.setContext({email:FDBK.USER_DATA.email,username:FDBK.USER_DATA.userName,context:FDBK.USER_DATA.context.userName,project:a}),c.addDocListeners(),c.addOperationListeners(),c.addMetaEventsListeners();var h=!1;if(!g.snapshot){var i;if(!FDBK.library.currentProject){var j=FDBK.defaultProjects.emptyProject;j.uniqueId=a,i=(new FDBK.Project(j)).toServerJSON()}i=i||FDBK.library.currentProject.toServerJSON(),g.submitOp([{p:[],oi:i}]),h=!0}c.docSize=utils.JSONSize(g.snapshot),c.checkDocSize(),b(null,$.extend(!0,{},c._doc.snapshot)),h&&FDBK.pub("empty-project-fetched")}),d&&(d.on("connecting",D),d.on("disconnected",e))},this.checkDocSize=function(){return this.docSize>this.MAX_DOC_SIZE?(this.showDocSizeWarning(),!0):!1},this.showDocSizeWarning=function(){FDBK.openConfirmDialog({heading:"Project size warning",message:"We don't want to ruin your fun but the current project is getting pretty large. This version of Moqups has a 16MB limit on the size of each project; it's a technical aspect that doesn't leave us much elbow room. The good news is that in the upcoming version we've fixed this limitation. In the meantime, <a href='https://moqups.com/help/large-projects' target='_blank'>here's what you can do</a>.",buttons:[{text:FDBK.loc("_OK"),classes:"primary-action close-modal right"}]})},this.closeProject=function(){var a=this;this._doc&&(this.docSize=0,this.removeDocListeners(),this.removeOperationListeners(),this.removeMetaEventsListeners(),this.connectedUsers=[],this._doc.close(function(){a._log("document closed succesfully")}),a._doc=null)},this.getOpForFixingSync=function(a,b){if(!a.mockups||!b.mockups||a.mockups.length!=b.mockups.length)return{p:[],oi:a,od:b};var c=[];for(var d=0;d<a.mockups.length;d++)if(JSON.stringify(a.mockups[d])!=JSON.stringify(b.mockups[d])){c.push(d);if(c.length>1)break}return c.length==1?{p:["mockups",c[0]],ld:b.mockups[c[0]],li:a.mockups[c[0]],s:"sync_update"}:c.length==0&&a.stageWidth!=b.stageWidth||a.stageHeight!=b.stageHeight?[{p:["stageWidth"],oi:a.stageWidth,od:b.stageWidth},{p:["stageHeight"],oi:a.stageHeight,od:b.stageHeight}]:JSON.stringify(a)!=JSON.stringify(b)?{p:[],oi:a,od:b}:[]},this.lastFixVersion=null,this.fixProjectData=function(){if(this._doc.version==this.lastFixVersion)return;var a=JSON.stringify(this._doc.snapshot),b=JSON.stringify(FDBK.library.currentProject.toServerJSON()),c=this.getOpForFixingSync(JSON.parse(b),JSON.parse(a));c.length!=undefined||c.p&&c.p.length>0?this.sendOp(c):(FDBK.API.xhr(FDBK.API.CALL_SAVE_PROJECT_SYNC_ERROR,{BASE_URL:FDBK.WEB_SOCKET_URL,data:{v:this._doc.version,collaborating:this.distinctUsers().length>1,ownerUsername:FDBK.library.currentProject.ownerUserName,exceptions:this._exceptionLog},contentType:"application/x-www-form-urlencoded",urlParams:[FDBK.library.currentProject.uniqueId,"syncerror"]}),this.distinctUsers().length<=1?this.sendOp(c):FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error synchronizing changes for your project. To avoid any issues please reload your project."),buttons:[{text:FDBK.loc("_Reload Project"),classes:"right primary-action",onClick:function(){var a=FDBK.library.currentProject.uniqueId;FDBK.library.closeCurrentProject(),FDBK.library.fetchProject(a)}}]})),this.lastFixVersion=this._doc.version},this.checkProjectData=function(){var a=JSON.stringify(this._doc.snapshot),b=JSON.stringify(FDBK.library.currentProject.toServerJSON());this.docSize=utils.JSONSize(this._doc.snapshot),a===b||this._suppressCheck?(this.$saveInProgress.hide(),FDBK.pub("project-sanity-check-passed")):this.fixProjectData()},this.setConnectionState=function(a){var c=this;a==="online"?(b.$offlineStatus.removeClass("shown"),b.$connectingStatus.removeClass("shown"),FDBK.STREAMING_OFFLINE=!1):a==="offline"?(b.$connectingStatus.removeClass("shown"),b.$offlineStatus.addClass("shown"),FDBK.STREAMING_OFFLINE=!0,window.setTimeout(function(){FDBK.STREAMING_OFFLINE&&!c.shownOfflineMessage&&(c.showOfflineMessage(),c.shownOfflineMessage=!0)},5e3)):a==="connecting"&&(b.$offlineStatus.removeClass("shown"),b.$connectingStatus.addClass("shown"),FDBK.STREAMING_OFFLINE=!0),FDBK.pub("streaming-offline-status-changed")},this.refreshConnection=function(){if(!this._doc||!this._doc.connection||!this._doc.connection.state)return;try{this._doc.connection.socket.close(),this._doc.connection.socket.open()}catch(a){b._logException(a,"refreshConnection")}},this.showOfflineMessage=function(){FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_You are now working offline. Your changes will be synchronized once the connection is established."),buttons:[{text:FDBK.loc("_OK"),classes:"right primary-action close-modal"}]})},this.saveAction=function(a){if(!this._doc)return!0;this.docSize=utils.JSONSize(this._doc.snapshot);if(this.checkDocSize())return!0;if(this._doc.state!="open"){this.refreshConnection(),a&&this.showOfflineMessage();return}this._doc.pendingOp||this._doc.inflightOp?(a&&this.$saveInProgress.show(),this.saveActionOnAcknowledge=!0):(this.$saveInProgress.hide(),this.checkProjectData())},this.replaceProjectData=function(a,c,d){if(!b._doc)return;try{b._doc.submitOp({p:[],oi:a,s:c},function(){d&&d()})}catch(e){b._logException(e,"replaceProjectData"),b._log("Error replacing project data",e)}},this.pathForStencil=function(a,b){function d(a){var c=b.groupedStencils[a];return c?d(c).concat(["stencils",b.stencil(c).stencils.indexOf(b.stencil(a))]):["stencils",b.indexOfStencil(a)]}var c=this;return this.pathForMockup(b).concat(d(a))},this.pathForMockup=function(a){return["mockups",FDBK.library.currentProject.mockupList().indexOf(a)]};var b=this,c=function(){b.closeProject()},d=function(a,c,d){var e=FDBK.library.currentProject.mockup(a)||FDBK.library.currentMockup,f=e.stencil(c),g=b.pathForStencil(c,e),h=[];d=d||{top:f.top,left:f.left,width:f.width,height:f.height};for(var i in d){var j;try{j=b._doc.getAt(g.concat(i))}catch(k){b._logException(k,"onMoveResizeStencil",{p:g,s:c}),b._log("error getting path",k),b._suppressCheck=!1,b.checkProjectData();return}j!==undefined&&j!=d[i]&&h.push({p:g.concat(i),od:j,oi:d[i],s:c})}h.length>0&&b.sendOp(h)},e=function(a,c){var d=FDBK.library.currentProject.mockup(a)||FDBK.library.currentMockup,e=d.stencil(c),f=b.pathForStencil(c,d),g={p:f,ld:e};b.sendOp(g)},f=function(a,c,d){var e,f,g,h=FDBK.library.currentProject.mockup(a)||FDBK.library.currentMockup;if(d){var i=h.stencil(d);for(var j=0;j<i.stencils.length;j++)if(i.stencils[j].id==c){e=i.stencils[j];break}i.stencils.length==1?(f=b.pathForStencil(d,h).concat(["stencils"]),g={p:f,oi:[e]}):(f=b.pathForStencil(d,h).concat(["stencils",j]),g={p:f,li:e})}else e=h.stencil(c),f=b.pathForStencil(c,h),g={p:f,li:e};b.sendOp(g)},g=function(a,c,d){var e=FDBK.library.currentProject.mockup(a)||FDBK.library.currentMockup,f=e.stencil(c),g=b.pathForStencil(c,e),h={p:g.concat("locked"),oi:d,od:!d,s:c};b.sendOp(h)},h=function(a,c,d){var e=FDBK.library.currentProject.mockup(a)||FDBK.library.currentMockup,f=e.stencil(c),g=b.pathForStencil(c,e),h=b._doc.getAt(g.concat("link")),i={p:g.concat("link"),oi:d,od:h};b.sendOp(i)},i=function(a,c,d){var e=FDBK.library.currentProject.mockup(a)||FDBK.library.currentMockup,f=e.stencil(c),g=b.pathForMockup(e).concat(["stencils",d]),h=e.indexOfStencil(c),i={p:g,lm:h,s:c};b.sendOp(i)},j=function(a){var c=FDBK.library.currentProject.mockup(a),d=b.pathForMockup(c),e={p:d,li:c};b.sendOp(e)},k=function(a){var c=FDBK.library.currentProject.mockup(a),d=b.pathForMockup(c),e={p:d,ld:c};b.sendOp(e)},l=function(a){var c=FDBK.library.currentProject.mockup(a),d=b.pathForMockup(c),e={p:d.concat("name"),oi:c.name,od:b._doc.getAt(d.concat("name"))};b.sendOp(e)},m=function(a,c){var d=FDBK.library.currentProject.mockup(a),e=b.pathForMockup(d);op={p:e,lm:c},b.sendOp(op)},n=function(a){var c=FDBK.library.currentProject.mockup(a),d=b.pathForMockup(c),e=[];e.push({p:d.concat("stageWidth"),oi:c.stageWidth,od:b._doc.getAt(d.concat("stageWidth"))}),e.push({p:d.concat("stageHeight"),oi:c.stageHeight,od:b._doc.getAt(d.concat("stageHeight"))}),e.push({p:["stageWidth"],oi:FDBK.library.currentProject.stageWidth,od:b._doc.getAt(["stageWidth"])}),e.push({p:["stageHeight"],oi:FDBK.library.currentProject.stageHeight,od:b._doc.getAt(["stageHeight"])}),b.sendOp(e)},o=function(){b.sendOp([{p:["name"],oi:FDBK.library.currentProject.name,od:b._doc.getAt(["name"])}])},p=function(a){var c=FDBK.library.currentProject.mockup(a),d=b.pathForMockup(c);b.sendOp([{p:d.concat("isMaster"),oi:!1,od:!0}])},q=function(a){var c=FDBK.library.currentProject.mockup(a),d=b.pathForMockup(c);b.sendOp([{p:d.concat("isMaster"),oi:!0,od:!1}])},r=function(a,c){var d=FDBK.library.currentProject.mockup(a),e=b.pathForMockup(d);b.sendOp([{p:e.concat("master"),oi:c,od:b._doc.getAt(e.concat("master"))}])},s=function(a,c){var d=FDBK.library.currentProject.mockup(a),e=b.pathForMockup(d);b.sendOp([{p:e.concat("parent"),oi:c,od:b._doc.getAt(e.concat("parent"))}])},t=function(a,c,d,e){var f=FDBK.library.currentProject.mockup(a),g=b.pathForMockup(f),h=[],i=[];stencilPath=g.concat(["stencils",e]);for(var j in c){if(!d.hasOwnProperty(j))h.push({p:stencilPath.concat(j),oi:c[j],s:c.id});else{var k=!1;typeof c[j]=="object"?k=JSON.stringify({val:c[j]})!=JSON.stringify({val:d[j]}):k=c[j]!=d[j],k&&h.push({p:stencilPath.concat(j),oi:c[j],od:d[j],s:c.id})}i.push(j)}for(j in d)i.indexOf(j)==-1&&h.push({p:stencilPath.concat(j),od:d[j],s:c.id});b.sendOp(h)};this.sendOp=function(a){var b=this,c=[].concat(a),d;if(this.docSize>=this.MAX_DOC_SIZE){var e=utils.JSONSize(FDBK.library.currentProject.toServerJSON());if(e>this.docSize){this.showDocSizeWarning(),setTimeout(function(){H(window.sharejs.types.json.invert(c))},1);return}this.docSize=e}for(var f=0;f<c.length;f++){d=c[f];if(d.p.length>1&&d.p[1]==-1){this._logException(null,"validateMockupOpPath",d.p),this._suppressCheck=!1,this.checkProjectData();return}if(d.p.length>2&&d.p[2]=="stencils"&&d.p[3]==-1){this._logException(null,"validateOpStencilPath",d.p),this._suppressCheck=!1,this.checkProjectData();return}}try{this._doc.submitOp(a,function(a){a&&console.error("error",a),a&&FDBK.errorTracking.trackMessage("submitOp error: "+a);if(a=="Internal error"){if(!FDBK.library.currentProject)return;var c=FDBK.library.currentProject.uniqueId,d=FDBK.library.currentProject.getAttributes();FDBK.library.closeCurrentProject(),FDBK.library.serviceClient.getProjectJSON(c,function(a,b){a||(FDBK.library.openProject(b,!0),FDBK.library.currentProject.updateAttributes(d))})}else a&&a!="Op already submitted"&&(b._logException(null,"sendOp :"+a,{v:b._doc.version}),b.fixProjectData())})}catch(g){this._logException(g,"sendOp"),this._log("Error sending op ",a,g.message)}},this.processWhenReady=function(a){var b=this._opQueue;return function(){var c=arguments;b.add(function(){a.apply(null,c)})}},this.addOperationListeners=function(){this.removeOperationListeners(),FDBK.sub("collab-move-resize-stencil",this.processWhenReady(d)),FDBK.sub("collab-remove-stencil",this.processWhenReady(e)),FDBK.sub("collab-add-stencil",this.processWhenReady(f)),FDBK.sub("collab-lock-stencil",this.processWhenReady(g)),FDBK.sub("collab-link-stencil",this.processWhenReady(h)),FDBK.sub("collab-order-stencil",this.processWhenReady(i)),FDBK.sub("collab-add-mockup",this.processWhenReady(j)),FDBK.sub("collab-remove-mockup",this.processWhenReady(k)),FDBK.sub("collab-rename-mockup",this.processWhenReady(l)),FDBK.sub("collab-sort-mockup",this.processWhenReady(m)),FDBK.sub("collab-update-stagesize",this.processWhenReady(n)),FDBK.sub("collab-rename-project",this.processWhenReady(o)),FDBK.sub("collab-mockup-convert-normal",this.processWhenReady(p)),FDBK.sub("collab-mockup-convert-master",this.processWhenReady(q)),FDBK.sub("collab-mockup-set-master",this.processWhenReady(r)),FDBK.sub("collab-mockup-set-parent",this.processWhenReady(s)),FDBK.sub("collab-replace-stencil",this.processWhenReady(t))},this.removeOperationListeners=function(){FDBK.unsub("collab-move-resize-stencil"),FDBK.unsub("collab-remove-stencil"),FDBK.unsub("collab-add-stencil"),FDBK.unsub("collab-lock-stencil"),FDBK.unsub("collab-link-stencil"),FDBK.unsub("collab-order-stencil"),FDBK.unsub("collab-add-mockup"),FDBK.unsub("collab-remove-mockup"),FDBK.unsub("collab-rename-mockup"),FDBK.unsub("collab-sort-mockup"),FDBK.unsub("collab-update-stagesize"),FDBK.unsub("collab-rename-project"),FDBK.unsub("collab-mockup-convert-normal"),FDBK.unsub("collab-mockup-convert-master"),FDBK.unsub("collab-mockup-set-master"),FDBK.unsub("collab-mockup-set-parent"),FDBK.unsub("collab-replace-stencil")},this.distinctUsers=function(){var a={};return this.connectedUsers.filter(function(b){return a[b.username]?!1:(a[b.username]=!0,!0)})};var u=function(a){if(b.distinctUsers().length<=1)return;try{b._doc.shout(JSON.stringify({action:"updateComments",args:a}))}catch(c){b._logException(c,"shoutComment"),b._log("Error on shout : ",c)}},v="",w=function(a){if(b.distinctUsers().length<=1)return;var c=a.map(function(a){return a.id}),d=JSON.stringify({selection:c});if(d===v)return;v=d;try{b._doc.shout(JSON.stringify({action:"selectionChanged",args:[FDBK.library.currentMockup.id,FDBK.USER_DATA.userName,c]}))}catch(e){b._logException(e,"shoutSelection"),b._log("Error on shout : ",e)}},x=function(){try{b._doc.shout(JSON.stringify({action:"updatePermissions",args:[FDBK.library.currentProject.uniqueId]}))}catch(a){b._logException(a,"shoutPermission"),b._log("Error on shout : ",a)}},y=function(a){try{b._doc.shout(JSON.stringify({action:"teamMembersChanged",args:[a]}))}catch(c){b._logException(c,"teamMembersChanged"),b._log("Error on shout : ",c)}},z=function(){try{b._doc.shout(JSON.stringify({action:"projectNotAvailable",args:[FDBK.library.currentProject.uniqueId]}))}catch(a){b._logException(a,"shoutProjectNotAvailable"),b._log("Error on shout : ",a)}},A=function(){try{b._doc.shout(JSON.stringify({action:"updateProjectPrivacy",args:FDBK.library.currentProject.isPublic}))}catch(a){b._logException(a,"shoutUpdateProjectPrivacy"),b._log("Error on shout : ",a)}};this.addMetaEventsListeners=function(){FDBK.sub("comment-posted",u),FDBK.sub("selection-changed",w),FDBK.sub("changed-collaborators",x),FDBK.sub("project-not-available",z),FDBK.sub("project-privacy-changed",A),FDBK.sub("team-updated-members",y)},this.removeMetaEventsListeners=function(){FDBK.unsub("comment-posted",u),FDBK.unsub("selection-changed",w),FDBK.unsub("changed-collaborators",x),FDBK.unsub("project-not-available",z),FDBK.unsub("project-privacy-changed",A),FDBK.unsub("team-updated-members",y)},this.kick=function(a,b){this._doc.connection.id==a&&(FDBK.library.closeCurrentProject(),FDBK.library.openProjects(),b&&FDBK.library.projectsView.showError(b))},this.selectionChanged=function(a,b,c){FDBK.pub("presence-user-selection",a,b,c)},this.updatePresence=function(a){this.connectedUsers=a,FDBK.pub("presence-update-users",a)},this.updateComments=function(a){FDBK.pub("refresh-comments",a)},this.updateProjectPrivacy=function(a){FDBK.library.currentProject.isPublic=a,FDBK.library.updatePresencePrivacy()},this.updateContextSettings=function(a){if(this._doc.connection.id!=a)return;var b=FDBK.USER_DATA.context.uniqueId;FDBK.API.xhr(FDBK.API.CALL_GET_CURRENT_USER,{success:function(a){if(a.success){FDBK.USER_DATA=$.extend(FDBK.USER_DATA,a.object.user),FDBK.library.contextController.init(FDBK.USER_DATA);var c=FDBK.library.contextController.contexts.filter(function(a){return a.uniqueId==b?!0:!1});if(c.length===0){var d=FDBK.library.contextController.contexts[0].uniqueId;FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_You are no longer part of this team."),buttons:[{text:FDBK.loc("_Change Team"),classes:"right primary-action",onClick:function(){FDBK.library.contextController.switchContext(d)}}]})}else FDBK.library.setAccountMenu()}}})},this.updatePaymentStatus=function(a,b){if(this._doc.connection.id!=a)return;FDBK.pub("payment-notification-update",b)};var B=function(a){b._log("doc closed",b._doc.connection.state),b.setConnectionState("offline")},C=function(){b._log("doc open",b._doc.connection.state),b.setConnectionState("online")},D=function(){b.setConnectionState("connecting")},E=function(a){b._log("server acknowledged op",a);if(b.saveActionOnAcknowledge||b.$saveInProgress.is(":visible"))b.saveAction(),b.saveActionOnAcknowledge=!1;FDBK.pub("project-saved"),FDBK.pub("project-sync-ack")},F=function(a){b._log("received shout : ",a);var c=JSON.parse(a);b.hasOwnProperty(c.action)&&b[c.action].apply(b,[].concat(c.args))},G=function(a){b._log("document error ",a),FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:"The following error occured : <br/><strong>"+a+"</strong><br/>To avoid any issues please reload your project.",buttons:[{text:FDBK.loc("_Reload Project"),classes:"right primary-action",onClick:function(){var a=FDBK.library.currentProject.uniqueId;FDBK.library.closeCurrentProject(),setTimeout(function(){FDBK.library.fetchProject(a)},100)}}]})},H=function(a){b._log("received remote op",a);var c=[].concat(a);b._opQueue.pause();try{for(var d=0;d<c.length;d++)a=c[d],b.processOperation(a)}catch(e){b._logException(e,"remoteOp")}b._opQueue.resume(),FDBK.pub("project-saved")};this.addDocListeners=function(){this._doc.on("open",C),this._doc.on("closed",B),this._doc.on("error",G),this._doc.on("acknowledge",E),this._doc.on("shout",F),this._doc.on("remoteop",H),FDBK.sub("close-project",c)},this.removeDocListeners=function(){this._doc.connection.removeListener("connecting",D),sharejs.Doc.prototype.removeListener.apply(this._doc,["open",C]),sharejs.Doc.prototype.removeListener.apply(this._doc,["closed",B]),sharejs.Doc.prototype.removeListener.apply(this._doc,["error",B]),sharejs.Doc.prototype.removeListener.apply(this._doc,["acknowledge",E]),sharejs.Doc.prototype.removeListener.apply(this._doc,["shout",F]),sharejs.Doc.prototype.removeListener.apply(this._doc,["remoteop",H]),FDBK.unsub("close-project",c)},this.processOperation=function(a){this._log("processing op ",a);if(a.length===0){this._log("invalid operation");return}var b,c,d=a.p;if(d.length===0){var e=FDBK.library.currentProject.getAttributes();FDBK.library.clearWorkspace(),FDBK.library.openProject($.extend(!0,{},a.oi,e),!0);return}if(d[0]=="mockups")if(d.length>2){b=FDBK.library.currentProject.mockupList()[d[1]];switch(d[2]){case"stageWidth":T(b,{stageWidth:a.oi});break;case"stageHeight":T(b,{stageHeight:a.oi});break;case"master":FDBK.library.setMasterForMockup(b.id,{master:a.oi},{forward:!1,undoable:!1});break;case"parent":FDBK.library.setMockupParent(b.id,{parentId:a.oi,updateStructure:!1},{forward:!1,undoable:!1}),this._opQueue.addOnce(FDBK.library.refreshProjectStructure);break;case"isMaster":a.oi===!0?FDBK.library.convertNormalToMasterPage(b.id,{forward:!1}):FDBK.library.convertMasterToNormalPage(b.id,{forward:!1});break;case"name":R(b,a.oi);break;case"stencils":var f=(d.length-1)%2===0?d[d.length-1]:null;opStencilModel=b;for(var g=2;g<d.length;g+=2){if(d[g]!="stencils")break;opStencilModel=opStencilModel.stencils[d[g+1]]}if(f)switch(f){case"left":case"top":I(b,opStencilModel,f,a.oi);break;case"width":case"height":J(b,opStencilModel,f,a.oi);break;case"locked":M(b,opStencilModel,a.oi);break;case"link":N(b,opStencilModel,a.oi);break;default:var h=$.extend(!0,{},opStencilModel);a.oi!=undefined&&a.od!=undefined?h[f]=a.oi:a.od!=undefined?delete h[f]:a.oi!=undefined&&(h[f]=a.oi),L(b,opStencilModel),K(h,b),O(b,h,d[3])}else a.li?a.ld?L(b,opStencilModel):(K(a.li,b),d[3]!==0&&O(b,a.li,d[3]),opStencilModel=b.stencilList()[d[3]]):a.ld?L(b,opStencilModel):a.lm!==undefined&&O(b,opStencilModel,a.lm);b&&FDBK.library.currentMockup.master&&FDBK.library.currentMockup.master==b.id&&FDBK.pub("master-edited",b.id),opStencilModel&&FDBK.pub("remote-stencil-update",opStencilModel.id);break;default:this._log("unprocessed op : ",a)}}else if(a.li&&a.ld){b=FDBK.library.currentProject.mockupList()[d[1]];var i=!1;b.id==FDBK.library.currentMockup.id&&(i=!0),Q(b),P(a.li,d[1]),i&&FDBK.library.changeActiveMockup(a.li.id)}else a.li?P(a.li,d[1]):a.ld?(b=FDBK.library.currentProject.mockupList()[d[1]],Q(b)):a.lm!==undefined&&(b=FDBK.library.currentProject.mockupList()[d[1]],S(b,a.lm),this._opQueue.addOnce(FDBK.library.refreshProjectStructure));else if(d[0]=="stageWidth"||d[0]=="stageHeight"){var j={};j[d[0]]=a.oi,U(j)}else d[0]=="name"?V(a.oi):this._log("Unprocessed op",a)};var I=function(a,b,c,d){if(!b)return;if(a!=FDBK.library.currentMockup){var e={};e[c]=d,a.updateStencil(b.id,e),FDBK.library.setMockupRendered(a.id,!1);return}c=="left"?FDBK.library.moveStencil(b.id,{left:d,top:b.top},{undoable:!1,forward:!1}):c=="top"&&FDBK.library.moveStencil(b.id,{left:b.left,top:d},{undoable:!1,forward:!1})},J=function(a,b,c,d){if(!b)return;if(a!=FDBK.library.currentMockup){var e={};e[c]=d,a.updateStencil(b.id,e),FDBK.library.setMockupRendered(a.id,!1);return}c=="width"?FDBK.library.resizeStencil(b.id,{width:d,height:b.height,top:b.top,left:b.left},{forward:!1,undoable:!1}):c=="height"&&FDBK.library.resizeStencil(b.id,{width:b.width,height:d,top:b.top,left:b.left},{forward:!1,undoable:!1})},K=function(a,b){if(!a)return;if(b!=FDBK.library.currentMockup){b.addStencil(a),FDBK.library.setMockupRendered(b.id,!1);return}FDBK.library.addStencilFinal({type:a.type,templateName:a.name,data:a,checkSize:!0},{forward:!1,undoable:!1})},L=function(a,b){if(!b)return;if(a!=FDBK.library.currentMockup){a.removeStencil(b.id),FDBK.library.setMockupRendered(a.id,!1);return}FDBK.library.removeStencil(b.id,{},{forward:!1,undoable:!1})},M=function(a,b,c){if(!b)return;if(a!=FDBK.library.currentMockup){a.updateStencil(b.id,{locked:c}),FDBK.library.setMockupRendered(a.id,!1);return}FDBK.library.lockStencil(b.id,{lock:c},{forward:!1,undoable:!1})},N=function(a,b,c){if(!b)return;if(a!=FDBK.library.currentMockup){a.updateStencil(b.id,{link:c}),FDBK.library.setMockupRendered(a.id,!1);return}FDBK.library.linkStencil(b.id,{link:c},{forward:!1,undoable:!1})},O=function(a,b,c){if(!b)return;if(a!=FDBK.library.currentMockup){a.changeStencilIndex(b.id,c),FDBK.library.setMockupRendered(a.id,!1);return}FDBK.library.updateStencilIndex(b,c,{forward:!1,undoable:!1,updateModel:!1})},P=function(a,b){FDBK.library.addMockup({props:a,switchToMockup:!1,index:b},{forward:!1}),FDBK.library.changeMockupOrder(a.id,{index:b,skipRefresh:!1},{forward:!1})},Q=function(a){FDBK.library.removeMockup(a.id,{remote:!0},{forward:!1})},R=function(a,b){FDBK.library.updateMockupName(a.id,{value:b},{forward:!1})},S=function(a,b){FDBK.library.changeMockupOrder(a.id,{index:b,skipRefresh:!0},{forward:!1})},T=function(a,b){b.stageWidth?a.stageWidth=b.stageWidth:b.stageHeight&&(a.stageHeight=b.stageHeight),a.id==FDBK.library.currentMockup.id&&FDBK.library.setStageSize()},U=function(a){a.stageWidth?FDBK.library.currentProject.stageWidth=a.stageWidth:a.stageHeight&&(FDBK.library.currentProject.stageHeight=a.stageHeight)},V=function(a){FDBK.library.updateProjectName({value:a},{forward:!1})};return this};var MODULE=function(a,b){function j(c){var d=b(c).prop("tagName").toLowerCase(),e={};if(d=="div"){c=b(c);var f=a.$svgObject.offset(),g=c.offset();e.st=g.top-f.top,e.sb=e.st+c.height(),e.sl=g.left-f.left,e.sr=e.sl+c.width()}else{var h=svg(b(c)[0]),i=h.position();e.st=i.y,e.sb=e.st+h.measuredHeight(),e.sl=i.x,e.sr=e.sl+h.measuredWidth()}return e}function k(a){var b=a.data("draggable");if(!b||!b.options)return!1;var c=b.options.customSnapPoint||!1;return c}function l(a){var b=a.data("resizable");if(!b||!b.resizing)return null;var c={l:b.position.left+b.lm,t:b.position.top+b.tm,r:b.position.left+b.lm+b.size.width,b:b.position.top+b.tm+b.size.height};return c}function m(a){var b=a.data("resizable");return!b||!b.resizing?!1:!0}var c=document.getElementById("hLine"),d=document.getElementById("vLine");a.snapoptions={snap:{snapToObjects:!0,snapTolerance:5,snapGrid:!1,showGuides:!0,items:".active-mockup .stencil",snappedH:function(d,f){var g=f.helper.parents("[id^=ghost]").length>0?!0:!1,j=f.position.top-(g?0:h-b("#project-wrapper").scrollTop()),m=j+f.helper.height(),n=f.position.left-(g?0:i),o=n+f.helper.width();k(f.helper)&&(j+=Math.round(b(this).height()/2),n+=Math.round(b(this).width()/2),m=j,o=n),e=f.snapItem;var p=0,q=l(b(this));q&&(o=q.r,n=q.l,j=q.t,m=q.b);switch(f.snapMode){case a.snapoptions.SNAP_TOP:p=j;break;case a.snapoptions.SNAP_BOTTOM:p=m;break;case a.snapoptions.SNAP_MIDDLE:p=j+Math.round((m-j)/2)}a.snapoptions.snap.showGuides&&(c.style.top=Math.min(p,a.currentMockup.stageHeight-1)+"px",c.style.display="block")},snappedV:function(c,e){var g=e.helper.parents("[id^=ghost]").length>0?!0:!1,j=e.position.top-(g?0:h),m=j+e.helper.height(),n=e.position.left-(g?0:i),o=n+e.helper.width();f=e.snapItem;var p=0;k(e.helper)&&(j+=Math.round(b(this).height()/2),n+=Math.round(b(this).width()/2),m=j,o=n);var q=l(b(this));q&&(o=q.r,n=q.l,j=q.t,m=q.b);switch(e.snapMode){case a.snapoptions.SNAP_LEFT:p=n;break;case a.snapoptions.SNAP_RIGHT:p=o;break;case a.snapoptions.SNAP_MIDDLE:p=n+Math.round((o-n)/2)}a.snapoptions.snap.showGuides&&(d.style.left=Math.min(p,a.currentMockup.stageWidth-1)+"px",d.style.display="block")},releasedH:function(a,d){if(e&&typeof f!="string"&&b(d.snapItem).get(0)==b(e).get(0)||typeof e=="string"&&e===d.snapItem)c.style.display="none",e=null},releasedV:function(a,c){if(f&&typeof f!="string"&&b(c.snapItem).get(0)==b(f).get(0)||typeof f=="string"&&f===c.snapItem)d.style.display="none",f=null}},stop:function(a,b){f=null,e=null,c.style.display="none",d.style.display="none"},update:function(a,b){}};var e=null,f=null,g=[20,20],h=b("#htmlStage").offset().top,i=b("#htmlStage").offset().left;a.snapoptions.gridValues=g,a.snapoptions.gridEnabled=function(b){if(b===undefined)return a.snapoptions.snapGrid;a.snapoptions.snapGrid=b},a.snapoptions.setGrid=function(b,c){a.snapoptions.gridValues=[b,c]},a.snapoptions._gridsystem=!1,a.snapoptions.gridsystemSnapping=!1;var n={};return a.snapoptions.gridsystem=function(c){if(c===undefined)return a.snapoptions._gridsystem;a.snapoptions._gridsystem=c;var d,e,f,g;switch(a.snapoptions._gridsystem){case a.snapoptions.GS_960_12:d=10,e=60,f=20,g=12;break;case a.snapoptions.GS_960_16:d=10,e=40,f=20,g=16;break;case a.snapoptions.GS_960_24:d=5,e=30,f=10,g=24;break;case a.snapoptions.GS_960_24_BP:d=0,e=30,f=10,g=24}n={padding:d,colWidth:e,colSpacing:f,colCount:g},b("#gridsystem").remove(),c!==!1&&b("#tmplsvg-gridsystem").loc_tmpl({colCount:Array(g),colPadding:d,colWidth:e,colSpacing:f}).insertBefore("#grid")},a.snapoptions.getGridSystemElements=function(c){var d=[];if(!a.snapoptions.gridsystemSnapping)return d;c=c||"drag";for(var e=0;e<n.colCount;e++){var f=n.padding+e*(n.colWidth+n.colSpacing),g=n.colWidth,h;c=="resize"?h={el:"snap_gs"+e,l:f,r:f+g,t:0,b:b("#htmlStage").height(),snapping:!1,snapTolerance:5}:h={item:"snap_gs"+e,width:g,height:b("#htmlStage").height(),top:0,left:f,center:!1,snapTolerance:5},d.push(h)}return d},a.snapoptions.SNAP_TOP="snapTop",a.snapoptions.SNAP_BOTTOM="snapBottom",a.snapoptions.SNAP_LEFT="snapLeft",a.snapoptions.SNAP_RIGHT="snapRight",a.snapoptions.SNAP_MIDDLE="snapMiddle",a.snapoptions.GS_960_12="GS_960_12",a.snapoptions.GS_960_16="GS_960_16",a.snapoptions.GS_960_24="GS_960_24",a.snapoptions.GS_960_24_BP="GS_960_24_BP",a}(MODULE||{},jQuery),utils=window.utils={};utils.svgns="http://www.w3.org/2000/svg",utils.xlinkns="http://www.w3.org/1999/xlink",utils.xmlns="http://www.w3.org/XML/1998/namespace",utils.userAgent=navigator.userAgent,utils.isOpera=!!window.opera,utils.isWebkit=utils.userAgent.indexOf("AppleWebKit")>=0,utils.isGecko=utils.userAgent.indexOf("Gecko/")>=0,utils.isIE=utils.userAgent.indexOf("MSIE")>=0,utils._guidCount=0,utils.guid=function(a){var b=function(){return((1+Math.random())*65536|0).toString(16).substring(1)},c=b()+b();return a?a+c:c},utils.getPercentage=function(a){return typeof a=="string"&&a.substr(-1)=="%"&&!isNaN(parseInt(a))?parseInt(a):!1},utils.nl2br=function(a){return(a+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")},utils.rgb2hex=function(a){function b(a){return("0"+parseInt(a).toString(16)).slice(-2)}return a=a.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/),"#"+b(a[1])+b(a[2])+b(a[3])},utils.rgb2hex=function(a){function b(a){return("0"+parseInt(a).toString(16)).slice(-2)}return a=a.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/),"#"+b(a[1])+b(a[2])+b(a[3])},utils.rgbaObjectFromColorString=function(a){a==="transparent"&&(a="rgba(0, 0, 0, 0)");var b=a.match(/^rgba\(([^,]+),([^,]+),([^,]+),([^,]+)\)$/);if(b)return{r:b[1].trim(),g:b[2].trim(),b:b[3].trim(),a:b[4].trim()};var c=a.match(/^rgb\(([^,]+),([^,]+),([^,]+)\)$/);if(c)return{r:c[1].trim(),g:c[2].trim(),b:c[3].trim(),a:"1"};var d=a.match(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i);return d?{r:parseInt(d[1],16),g:parseInt(d[2],16),b:parseInt(d[3],16),a:"1"}:"rgba(0, 0, 0, 1)"},utils.rgbaObjectToString=function(a){return"rgba("+a.r+", "+a.g+", "+a.b+", "+a.a+")"},utils.rgbaObjectToHex=function(a){function b(a){return("0"+parseInt(a).toString(16)).slice(-2)}return"#"+b(a.r)+b(a.g)+b(a.b)},utils.uniqueName=function(a,b){a=a.replace(/\s\([0-9]+\)$/,"");var c=a,d=1;while(b.indexOf(c)!==-1)c=a+" ("+d++ +")";return c},utils.stencil=function(a){var b=a;return typeof b=="string"&&(b=$("#"+a).get(0)),b},utils.stencilId=function(a){return a instanceof jQuery?a.get(0).attr("id"):a!==undefined&&a.id!==undefined?a.id:null},utils.sameArrayContent=function(a,b){return a.length===b.length&&!a.filter(function(a){return b.indexOf(a)===-1}).length},utils.getAlphabeticIndex=function(a){var b=26,c=a%(b-1)>0?Math.floor(a/b):0,d=c>0?String.fromCharCode(64+c):"";return d+String.fromCharCode(a%b+65)},utils.sanitize=function(a){return((a||"")+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},utils.optimalPopoverPosition=function(a,b){var c=FDBK.library.$projectWrapper.height(),d=FDBK.library.$projectWrapper.width(),e=FDBK.library.$projectWrapper.scrollTop(),f=FDBK.library.$projectWrapper.scrollLeft(),g={left:$(a).offset().left-FDBK.library.$projectWrapper.offset().left,top:$(a).offset().top-FDBK.library.$projectWrapper.offset().top};targetOffset=$(a).offset();var h=$(a).outerWidth(),i=$(a).outerHeight(),j=$(b).width(),k=$(b).height(),l=$("body").height()-(targetOffset.top+i),m=targetOffset.top,n=targetOffset.left,o=$("body").width()-(targetOffset.left+h),p,q,r,s,t;return l>=k+30?(p=targetOffset.left+h/2-j/2,q=targetOffset.top+i+5,r="bottom",s="",t=""):m>=k+30?(p=targetOffset.left+h/2-j/2,q=targetOffset.top-k-15,r="top",s="bottom",t="popoverTailDown"):o>=j+30?(p=targetOffset.left+h+15,q=targetOffset.top+i/2-k/2,r="right",s="right",t="popoverTailLeft"):n>=j+30?(p=targetOffset.left-j-15,q=targetOffset.top+i/2-k/2,r="left",s="left",t="popoverTailRight"):(p=targetOffset.left+(h-j)/2,q=targetOffset.top+(i-k)/2,s="",t="popoverTailNone"),p+j>$("body").width()&&(p-=p+j-$("body").width()+10,t="popoverTailNone"),q+k>$("body").height()&&(q-=q+k-$("body").height()+10,t="popoverTailNone"),q<0&&(q=10,t="popoverTailNone"),{left:p,top:q,pos:r,tooltipWrapperClass:s,popoverTailClass:t}},utils.usernameEmailArrayFromString=function(a){var b=/[,;]+/,c=a.replace(/\n\r?/g,",").split(b),d=/^.+@.+$/i,e=/^[a-z0-9._-]+$/i,f=/\<([^\>]+)\>/g,g;while(g=f.exec(a))c.push(g[1]);return c.map(function(a){return $.trim(a)}).filter(function(a){return a.length>0&&!/\s/g.test(a)&&(d.test(a)||e.test(a))})},!function(a){function b(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function c(a,b){return a<<b|a>>>32-b}function d(a,d,e,f,g,h){return b(c(b(b(d,a),b(f,h)),g),e)}function e(a,b,c,e,f,g,h){return d(b&c|~b&e,a,b,f,g,h)}function f(a,b,c,e,f,g,h){return d(b&e|c&~e,a,b,f,g,h)}function g(a,b,c,e,f,g,h){return d(b^c^e,a,b,f,g,h)}function h(a,b,c,e,f,g,h){return d(c^(b|~e),a,b,f,g,h)}function i(a,c){a[c>>5]|=128<<c%32,a[(c+64>>>9<<4)+14]=c;var d,i,j,k,l,m=1732584193,n=-271733879,o=-1732584194,p=271733878;for(d=0;d<a.length;d+=16)i=m,j=n,k=o,l=p,m=e(m,n,o,p,a[d],7,-680876936),p=e(p,m,n,o,a[d+1],12,-389564586),o=e(o,p,m,n,a[d+2],17,606105819),n=e(n,o,p,m,a[d+3],22,-1044525330),m=e(m,n,o,p,a[d+4],7,-176418897),p=e(p,m,n,o,a[d+5],12,1200080426),o=e(o,p,m,n,a[d+6],17,-1473231341),n=e(n,o,p,m,a[d+7],22,-45705983),m=e(m,n,o,p,a[d+8],7,1770035416),p=e(p,m,n,o,a[d+9],12,-1958414417),o=e(o,p,m,n,a[d+10],17,-42063),n=e(n,o,p,m,a[d+11],22,-1990404162),m=e(m,n,o,p,a[d+12],7,1804603682),p=e(p,m,n,o,a[d+13],12,-40341101),o=e(o,p,m,n,a[d+14],17,-1502002290),n=e(n,o,p,m,a[d+15],22,1236535329),m=f(m,n,o,p,a[d+1],5,-165796510),p=f(p,m,n,o,a[d+6],9,-1069501632),o=f(o,p,m,n,a[d+11],14,643717713),n=f(n,o,p,m,a[d],20,-373897302),m=f(m,n,o,p,a[d+5],5,-701558691),p=f(p,m,n,o,a[d+10],9,38016083),o=f(o,p,m,n,a[d+15],14,-660478335),n=f(n,o,p,m,a[d+4],20,-405537848),m=f(m,n,o,p,a[d+9],5,568446438),p=f(p,m,n,o,a[d+14],9,-1019803690),o=f(o,p,m,n,a[d+3],14,-187363961),n=f(n,o,p,m,a[d+8],20,1163531501),m=f(m,n,o,p,a[d+13],5,-1444681467),p=f(p,m,n,o,a[d+2],9,-51403784),o=f(o,p,m,n,a[d+7],14,1735328473),n=f(n,o,p,m,a[d+12],20,-1926607734),m=g(m,n,o,p,a[d+5],4,-378558),p=g(p,m,n,o,a[d+8],11,-2022574463),o=g(o,p,m,n,a[d+11],16,1839030562),n=g(n,o,p,m,a[d+14],23,-35309556),m=g(m,n,o,p,a[d+1],4,-1530992060),p=g(p,m,n,o,a[d+4],11,1272893353),o=g(o,p,m,n,a[d+7],16,-155497632),n=g(n,o,p,m,a[d+10],23,-1094730640),m=g(m,n,o,p,a[d+13],4,681279174),p=g(p,m,n,o,a[d],11,-358537222),o=g(o,p,m,n,a[d+3],16,-722521979),n=g(n,o,p,m,a[d+6],23,76029189),m=g(m,n,o,p,a[d+9],4,-640364487),p=g(p,m,n,o,a[d+12],11,-421815835),o=g(o,p,m,n,a[d+15],16,530742520),n=g(n,o,p,m,a[d+2],23,-995338651),m=h(m,n,o,p,a[d],6,-198630844),p=h(p,m,n,o,a[d+7],10,1126891415),o=h(o,p,m,n,a[d+14],15,-1416354905),n=h(n,o,p,m,a[d+5],21,-57434055),m=h(m,n,o,p,a[d+12],6,1700485571),p=h(p,m,n,o,a[d+3],10,-1894986606),o=h(o,p,m,n,a[d+10],15,-1051523),n=h(n,o,p,m,a[d+1],21,-2054922799),m=h(m,n,o,p,a[d+8],6,1873313359),p=h(p,m,n,o,a[d+15],10,-30611744),o=h(o,p,m,n,a[d+6],15,-1560198380),n=h(n,o,p,m,a[d+13],21,1309151649),m=h(m,n,o,p,a[d+4],6,-145523070),p=h(p,m,n,o,a[d+11],10,-1120210379),o=h(o,p,m,n,a[d+2],15,718787259),n=h(n,o,p,m,a[d+9],21,-343485551),m=b(m,i),n=b(n,j),o=b(o,k),p=b(p,l);return[m,n,o,p]}function j(a){var b,c="";for(b=0;b<32*a.length;b+=8)c+=String.fromCharCode(255&a[b>>5]>>>b%32);return c}function k(a){var b,c=[];for(c[(a.length>>2)-1]=void 0,b=0;b<c.length;b+=1)c[b]=0;for(b=0;b<8*a.length;b+=8)c[b>>5]|=(255&a.charCodeAt(b/8))<<b%32;return c}function l(a){return j(i(k(a),8*a.length))}function m(a,b){var c,d,e=k(a),f=[],g=[];for(f[15]=g[15]=void 0,e.length>16&&(e=i(e,8*a.length)),c=0;16>c;c+=1)f[c]=909522486^e[c],g[c]=1549556828^e[c];return d=i(f.concat(k(b)),512+8*b.length),j(i(g.concat(d),640))}function n(a){var b,c,d="0123456789abcdef",e="";for(c=0;c<a.length;c+=1)b=a.charCodeAt(c),e+=d.charAt(15&b>>>4)+d.charAt(15&b);return e}function o(a){return unescape(encodeURIComponent(a))}function p(a){return l(o(a))}function q(a){return n(p(a))}function r(a,b){return m(o(a),o(b))}function s(a,b){return n(r(a,b))}function t(a,b,c){return b?c?r(b,a):s(b,a):c?p(a):q(a)}"use strict","function"==typeof define&&define.amd?define(function(){return t}):a.md5=t}(this),utils.md5=window.md5,utils.getAvatarImageURL=function(a){var b="";return a=a||{},a.email=a.email||"",a.email==FDBK.USER_DATA.email&&!a.forceGravatar&&(a=FDBK.USER_DATA),a.avatar&&a.avatar.ref&&a.avatar.type=="system"&&utils.isSystemAvatar(a.avatar.ref)?(b+="https://moqups.com/home/avatars/"+a.avatar.ref+".jpg",a.email&&(b+="?uid="+utils.md5(a.email))):a.avatar&&a.avatar.ref&&a.avatar.type=="custom"?b+=FDBK.ASSET_IMAGE_BASE_URL+a.avatar.ref:(b+="https://secure.gravatar.com/avatar/"+utils.md5(a.email)+"?s=240",b+="&d=mm"),b},utils.isSystemAvatar=function(a){var b=!1;return $.each(FDBK.config("systemAvatars"),function(c,d){d.ref==a&&(b=!0)}),b},utils.markdown=function(a){return this._markdownConverter||(this._markdownConverter=new Markdown.getSanitizingConverter,this._markdownConverter.hooks.chain("preConversion",function(a){return a=a.replace(/\n/g,"&nbsp;  \n"),a})),this._markdownConverter.makeHtml(a)},utils.setDocumentTitle=function(a){document.title=a+"  Moqups"},utils.insertText=function(a,b){if(a.selectionStart||a.selectionStart=="0"){var c=a.selectionStart,d=a.selectionEnd;a.value=a.value.substring(0,c)+b+a.value.substring(d,a.value.length),a.selectionStart=c+b.length,a.selectionEnd=c+b.length}else a.value+=b},utils.b64toBlob=function(a,b,c){function d(a){return a.charCodeAt(0)}b=b||"",c=c||1024;var e=atob(a),f=[];for(var g=0;g<e.length;g+=c){var h=e.slice(g,g+c),i=Array.prototype.map.call(h,d),j=new Uint8Array(i);f.push(j)}var k=new Blob(f,{type:b});return k},utils.tab=function(a){utils.insertText(a,"\t")},utils.untab=function(a){utils.insertText(a,"\t")},utils.debounce=function(a,b,c){var d,e;return function(){var f=this,g=arguments,h=function(){d=null,c||(e=a.apply(f,g))},i=c&&!d;return clearTimeout(d),d=setTimeout(h,b),i&&(e=a.apply(f,g)),e}},utils.objectPath=function(a,b){return b.split(".").reduce(function(a,b){return a!==undefined?a[b]:undefined},a)},utils.unique=function(a){return a.filter(function(a,b,c){return c.indexOf(a)===b})},utils.categorize=function(a,b){var c=0;for(var d=0;d<a.length;d++)c+=a.charCodeAt(d);return c%b},utils.mixin=function(a,b){for(var c in b)a[c]=b[c]},utils.copyOf=function(a){return a+" "+FDBK.loc("_Copy")},utils.indexOf=function(a,b){for(var c=0;c<a.length;c++)if(a[c].id===b)return c;return-1},utils.intersectionOfObjects=function(a,b){var c={};for(var d in a)b[d]!==undefined&&(c[d]=a[d]===b[d]?a[d]:null);return c},utils.intersectionOfArrays=function(a,b){var c=[];for(var d=0;d<a.length;d++)b.indexOf(a[d])!=-1&&c.push(a[d]);return c},utils.pad=function(a,b,c){for(var d=0;d<c;d++)a=b+a;return a},utils.getHumanSize=function(a){if(!a||a<=0)return"0 bytes";var b=["bytes","KB","MB","GB","TB","PB"],c=Math.floor(Math.log(a)/Math.log(1024));return(a/Math.pow(1024,c)).toFixed(2)+" "+b[c]},utils.JSONSize=function(a){return JSON.stringify(a).length},FDBK.mixinModule("stencil-templates",{_stencilTemplates:{},_sidebarStencilTemplates:[],_SVGDefs:[],_SVGDefsProps:[],STENCIL_TEMPLATES_URL:"compiled/stencils-compiled.tmpl.",STENCIL_TEMPLATE_INDIVIDUAL_URL:"stencil-tmpl/{name}.tmpl.",STENCIL_ICON_SPRITE_URL:"stencils/compiled-stencil-icons.png",STENCIL_ICON_SPRITE_URL_2X:"stencils/compiled-stencil-icons@2x.png",STENCIL_ICON_INDIVIDUAL_URL:"stencils/{name}.png",DEF_INDIVIDUAL_URL:"stencil-tmpl/{name}.def.",STENCIL_SIDEBAR_ITEM_TMPL:'<li class="stencil-item">\t\t\t<a class="stencil-icon" data-id="{{= templateName}}">\t\t\t\t<img src="{{= iconStyle}}" alt=""/><span>{{= title}}</span>\t\t\t</a>\t\t</li>',STENCIL_SIDEBAR_ITEM_SPRITE_TMPL:'<li class="stencil-item">\t\t\t<a class="stencil-icon" data-id="{{= templateName}}">\t\t\t\t<img class="stencil-icon-sprite" src="data:image/gif;base64,R0lGODlhAQABAJH/AP///wAAAMDAwAAAACH5BAEAAAIALAAAAAABAAEAAAICVAEAOw==" style="{{= iconStyle}}" />\t\t\t\t<span>{{= title}}</span>\t\t\t</a>\t\t</li>',STENCIL_ICON_SPRITE_UNIT_SIZE_X:80,STENCIL_ICON_SPRITE_UNIT_SIZE_Y:50,_stencilsDefsReady:!1,_stencilTemplatesLoaded:!1,_stencilTemplatesToLoadCount:0,_stencilTemplatesLoadedCount:0,_SVGDefsLoaded:!1,_SVGDefsToLoadCount:0,_SVGDefsLoadedCount:0,_SVGPanelProperties:{"tmplsvg-state-panel":["disabled"],"tmplsvg-color-panel":["background_color","foreground_color","secondary_color"],"tmplsvg-text-generic-panel":["font_size","color","color_selected","line_height","text_align"],"tmplsvg-stroke-panel":["stroke_width","stroke_stlyle","stroke_color","corner_radius","border"],"tmplsvg-icon-generic-panel":["icon","icon_secondary","icon_size"],"tmplsvg-size-panel":["size"],"tmplsvg-effects-panel":["blokk"],"tmplsvg-marker-panel":["line_marker_start","line_marker_end"],"tmplsvg-direction-panel":["mode"]},tmplHelperMethods:{pathForRoundedRect:function(a,b,c,d,e,f,g,h){function i(a,b){return a+" "+b+" "}var j="M"+i(a+e,b);return j+="L"+i(a+c-f,b)+"Q"+i(a+c,b)+i(a+c,b+f),j+="L"+i(a+c,b+d-g)+"Q"+i(a+c,b+d)+i(a+c-g,b+d),j+="L"+i(a+h,b+d)+"Q"+i(a,b+d)+i(a,b+d-h),j+="L"+i(a,b+e)+"Q"+i(a,b)+i(a+e,b),j+="Z",j},isTrue:function(a){return a==="true"||a===!0||a===1}},initModule:function(){},parseCompiledStencilTemplates:function(a){FDBK.config("stencilTemplates.useJSONPStencils")&&(a=a.data);var b=0,c,d;while((b=a.indexOf("<<<",b))!==-1){c=b,b=a.indexOf(">>>",b);if(b===-1){console.info("stencil templates are corrupted.");break}var e=a.substring(c+3,b).split(/\n|\r\n/),f="tmplsvg-"+e[0].match(/\/([a-zA-Z0-9\-\_]+)\.tmpl\.svg/)[1],g=e.slice(1).join(" ");$.template(f,g)}},normalizedTemplateInspectables:function(a,b){b=b||{};var c={},d=a.migrateInspectables,e=a.legacyInspectables||{},f;for(var g in b)if(d&&d[g]){f=[].concat(d[g]);for(var h=0;h<f.length;h++)c[f[h]]=b[g]}else a.metadata.inspectables&&a.metadata.inspectables.hasOwnProperty(g)&&(c[g]=b[g]);return $.extend(!0,{},e,c)},getStencilDOM:function(a,b){var c=this.stencilTemplate(a),d=this.normalizedTemplateInspectables(c,b.inspectables),e=$.extend(!0,{},b,{tpl:typeof b.text!="undefined"?FDBK.tokenize(a,b.text,b):null,guid:utils.guid(),insp:d,guid:"c"+utils.guid(),constants:{BASE_URL:FDBK.BASE_URL,IMAGE_BASE_URL:FDBK.ASSET_IMAGE_BASE_URL},stencil:b},this.tmplHelperMethods),f=$.loc_tmpl(a,e).get(0);return f.templateName=a,b.locked&&(f.locked="true"),f},cloneStencilDOM:function(a){var b=$(a).clone()[0],c=FDBK.config("stencilTemplates.domProperties")||[];return c.forEach(function(c){b[c]=a[c]}),b},getStencilTemplateDefaultData:function(a){var b=this._stencilTemplates[a];return b?b.metadata||{}:{}},panelNameForStencil:function(a){return""+a+"-panel"},getPanelDOM:function(a,b,c){var d={tpl:a};c&&(d=$.extend(d,c));var e=document.createDocumentFragment();if(b){var f=$("#"+b);if(f.length>0){var g=f.loc_tmpl($.extend({},d,this.tmplHelperMethods));for(var h=0;h<g.length;h++)e.appendChild(g[h])}}var i=[],j,k=Object.keys(a);for(var b in this._SVGPanelProperties){j=this._SVGPanelProperties[b];if(utils.intersectionOfArrays(j,k).length>0){var l=$("#"+b).tmpl($.extend({},d,this.tmplHelperMethods));for(var h=0;h<l.length;h++)e.appendChild(l[h])}}return e},getAllStencilIconsDOM:function(){return FDBK.config("stencilTemplates.useSpriteStencilIcons")?$.template("stencil-sidebar-item-tmpl",FDBK.STENCIL_SIDEBAR_ITEM_SPRITE_TMPL):$.template("stencil-sidebar-item-tmpl",FDBK.STENCIL_SIDEBAR_ITEM_TMPL),this._sidebarStencilTemplates.map(function(a){var b=FDBK.stencilTemplate(a);return $.loc_tmpl("stencil-sidebar-item-tmpl",b).outerHTML()}).join("")},addSVGDef:function(a){this._SVGDefsToLoadCount+=1,this._SVGDefsProps.push(a)},loadSVGDefs:function(){var a;for(var b=0;b<this._SVGDefsProps.length;b++){a=this._SVGDefsProps[b];var c=this;$.ajax({url:FDBK.STENCIL_BASE_URL+FDBK.DEF_INDIVIDUAL_URL.replace("{name}",a.name)+this.getExtension(),dataType:FDBK.config("stencilTemplates.useJSONPStencils")?"jsonp":"text",async:!1,jsonp:!1,cache:!0,jsonpCallback:"dataready",success:function(a){FDBK.config("stencilTemplates.useJSONPStencils")&&(a=a.data),FDBK._SVGDefs.push(a),c._SVGDefsLoadedCount+=1,c.checkStencilsAndDefsLoaded()},error:function(){c._SVGDefsLoadedCount+=1,c.checkStencilsAndDefsLoaded()}})}},getSVGDefs:function(){return this._SVGDefs.join("")},addStencilTemplate:function(a){var b="tmplsvg-"+a.name;if(!a.excludeFromSidebar){if(FDBK.config("stencilTemplates.useSpriteStencilIcons")){var c=a.iconPosition||[0,0],d=-(c[1]-1)*FDBK.STENCIL_ICON_SPRITE_UNIT_SIZE_X,e=-(c[0]-1)*FDBK.STENCIL_ICON_SPRITE_UNIT_SIZE_Y;a.iconStyle="background: url('"+FDBK.IMAGE_BASE_URL+(window.devicePixelRatio&&window.devicePixelRatio>1?FDBK.STENCIL_ICON_SPRITE_URL_2X:FDBK.STENCIL_ICON_SPRITE_URL)+"') "+d+"px "+e+"px; background-size: 961px auto"}else a.iconStyle=FDBK.IMAGE_BASE_URL+FDBK.STENCIL_ICON_INDIVIDUAL_URL.replace("{name}",a.name);this._sidebarStencilTemplates.push(b)}a.templateName=b,this._stencilTemplates[b]=a,FDBK.config("stencilTemplates.useCompiledStencils")||(this._stencilTemplatesToLoadCount+=1)},loadStencilTemplates:function(){if(!FDBK.config("stencilTemplates.useCompiledStencils")){var a=this,b;for(var c in this._stencilTemplates)b=this._stencilTemplates[c],$.ajax({url:FDBK.STENCIL_BASE_URL+FDBK.STENCIL_TEMPLATE_INDIVIDUAL_URL.replace("{name}",b.name)+this.getExtension(),dataType:FDBK.config("stencilTemplates.useJSONPStencils")?"jsonp":"text",async:!1,jsonp:!1,jsonpCallback:"dataready",success:function(b){FDBK.config("stencilTemplates.useJSONPStencils")&&(b=b.data),$.template(c,b),a._stencilTemplatesLoadedCount+=1,a.checkStencilsAndDefsLoaded()},error:function(){a._stencilTemplatesLoadedCount+=1,a.checkStencilsAndDefsLoaded()}})}else{this._stencilTemplatesToLoadCount=1;var a=this;$.ajax({url:FDBK.STENCIL_BASE_URL+FDBK.STENCIL_TEMPLATES_URL+this.getExtension(),dataType:FDBK.config("stencilTemplates.useJSONPStencils")?"jsonp":"text",async:!1,data:{},jsonp:!1,cache:!0,jsonpCallback:"dataready",success:function(b){a.parseCompiledStencilTemplates(b),a._stencilTemplatesLoadedCount=1,a.checkStencilsAndDefsLoaded()},error:function(){a._stencilTemplatesLoadedCount=1,a.checkStencilsAndDefsLoaded()}})}},stencilTemplate:function(a){return this._stencilTemplates[a]},getExtension:function(){return FDBK.config("stencilTemplates.useJSONPStencils")?"json":"svg"},checkStencilsAndDefsLoaded:function(){!this._stencilTemplatesLoaded&&this._stencilTemplatesToLoadCount>0&&this._stencilTemplatesToLoadCount==this._stencilTemplatesLoadedCount&&(this._stencilTemplatesLoaded=!0,FDBK.pub("stencils-loaded"),FDBK.loadSVGDefs()),!this._SVGDefsLoaded&&this._SVGDefsToLoadCount>0&&this._SVGDefsToLoadCount==this._SVGDefsLoadedCount&&(this._SVGDefsLoaded=!0,$("#svgObject").append(FDBK.getSVGDefs()),FDBK.pub("svg-defs-loaded")),!this._stencilsDefsReady&&this._stencilTemplatesLoadedCount&&this._SVGDefsLoaded&&(this._stencilsDefsReady=!0,FDBK.pub("stencils-and-defs-loaded"))},executeLayoutHelper:function(a,b){if(!a)return;var c=this.stencilTemplate(a).layoutHelper||this.F_HELPER_NULL;c(b)},F_HELPER_NULL:function(a){},F_TOKENIZER_MARKDOWN:function(a){return this._tokenizerConverter||(this._tokenizerConverter=new Markdown.getSanitizingConverter,this._tokenizerConverter.hooks.chain("preConversion",function(a){var b;while(b=/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm.exec(a))a=a.replace(b[0],b[0].replace(/\*/g,"\0"));return a=a.replace(/\n/g,"&nbsp;  \n"),a}),this._tokenizerConverter.hooks.chain("postConversion",function(a){return a.replace(/\0/g,"*")})),this._tokenizerConverter.makeHtml(a)},F_TOKENIZER_PARAGRAPH:function(a,b){return b.inspectables&&b.inspectables.blokk==="true"?a.replace(/[^\s\t\r\n]/g,"&#9600;").replace(/\s/g,"&#32;"):this.F_TOKENIZER_MARKDOWN(a)},F_TOKENIZER_PERCENTAGE:function(a){var b=a.match(/(\d+)%?/);return b?Math.min(parseInt(b,10),100):a},F_TOKENIZER_RATINGS:function(a){var b=a.match(/(\d+)\/(\d+)/);if(!b)return"";for(var c=0,d=[],e=Math.min(parseInt(b[2],10),100);c<e;c++)d.push(" ");return b[2]=d,b},F_TOKENIZER_NEWLINE:function(a){var b=a.split(/\n|\r\n/);return b.map(utils.sanitize)},F_TOKENIZER_NULL:function(a){return utils.sanitize(a)},F_TOKENIZER_VERTICAL_MENU:function(a){var b=a.split(/\n|\r\n/),c=[];for(var d in b){var e=b[d].match(/^(\*|_)?\s?(.*)?$/),f={};f.icon=e[1];var g=(e[2]||"").match(/^.*,\s?(>)$/);g&&(f.type=g[1]);var h=(e[2]||"").replace(/\s?,\s?(\s?>|)$/,"").split(/,([^,]+)$/);f.title=utils.sanitize(h[0]),c.push(f)}return c},F_TOKENIZER_HORIZONTAL_MENU:function(a){var b=a.replace(/\n|\r\n/g," ").split(/,\s*/igm),c=[];for(var d in b){var e=b[d].match(/^(\*|_)?\s?(.*)?$/),f={};f.icon=e[1];var g=(e[2]||"").match(/^.*,\s?(>)$/);g&&(f.type=g[1]);var h=(e[2]||"").replace(/\s?,\s?(\s?>|)$/,"").split(/,([^,]+)$/);f.title=utils.sanitize(h[0]),c.push(f)}return c},F_TOKENIZER_TREE:function(a){var b=a.split(/\n|\r\n/),c=[];for(var d in b){var e={};e.title=b[d].replace(/^\s*/,""),e.indent=Math.max(0,b[d].length-e.title.length);var f=e.title.match(/^(f|F|v|>|\[\+\]|\[\-\]|\[x\]|\[\s\]|\-)?\s?(.*)?$/);e.icon=f[1],e.icon||e.indent--,e.title=utils.sanitize((f[2]||"").replace(/\s?,\s?(\s?>|)$/,"")),c.push(e)}return c},F_TOKENIZER_CALENDAR:function(a){var b=moment("04/22/2012","MM/DD/YYYY");moment(a)&&moment(a).isValid&&(b=moment(a,"MM/DD/YYYY"));var c={title:b.format("MMMM DD, YYYY"),days:[]},d=b.clone().date(1),e=d.day();c.index=b.date()+e-1;for(var f=0;f<e;f++)c.days.push("");var g=(new Date(b.toDate().getFullYear(),b.toDate().getMonth()+1,0)).getDate();for(var f=0;f<g;f++)c.days.push(f+1+"");var h=7-c.days.length%7;for(var f=0;f<h;f++)c.days.push("");return c},tokenize:function(a,b,c){var d=this._stencilTemplates[a];return(d&&d.tokenizer?d.tokenizer:this.F_TOKENIZER_NULL).call(this,b,c)}}),FDBK.addSVGDef({name:"webalys"}),FDBK.addStencilTemplate({name:"note",title:"Note",tags:"sticky note paper book",iconPosition:[6,6],metadata:{text:"When **you** do things **right**, people won't be sure you've done anything at all.\n\n_~~Futurama_",inspectables:{note_style:"yellow",font_size:14,text_align:"left"}},legacyInspectables:{font_size:14,text_align:"left"},tokenizer:FDBK.F_TOKENIZER_PARAGRAPH,layoutHelper:function(a){var b=$(a).find("path")[0],c=svg(a).explicitHeight(),d=svg(a).explicitWidth(),e=10,f=d/e,g="M0,0",h=0;for(var i=0;i<f;i++)h+e<=d&&(g+="l5,5 5,-5"),h+=e;g+="l0,-"+(c-e/2)+"-"+d+",0 0,"+(c-e/2),h+e>d&&(g+="l 0,5"),g+="z",b.setAttribute("d",g)},multiline:!0}),FDBK.addStencilTemplate({name:"rect",title:"Rectangle / Box",tags:"square rectangle container box",iconPosition:[5,2],metadata:{inspectables:{background_color:"#ffffff",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",corner_radius:0,brd:1}},migrateInspectables:{border:"brd",bg:"background_color",stroke:"stroke_color",checked:"corner_radius"},multiline:!0}),FDBK.addStencilTemplate({name:"hotspot",title:"Hotspot",tags:"link hotspot target",iconPosition:[6,5],excludeFromPrint:!0,excludeFromSidebar:!0,metadata:{inspectables:{type:"rect"}}}),FDBK.addStencilTemplate({name:"heading-one",title:"Heading",tags:"heading h1 big title text",iconPosition:[1,12],metadata:{text:"Heading",inspectables:{color:"#000000",font_size:26}},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"label",title:"Label",tags:"label text input",iconPosition:[2,6],metadata:{text:"Label:",inspectables:{color:"#000000",font_size:14}},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"text",title:"Paragraph",tags:"label char paragraph string text",iconPosition:[5,1],metadata:{text:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla quam velit, vulputate eu pharetra nec, mattis ac neque. Duis vulputate commodo lectus, ac blandit elit tincidunt id. Sed rhoncus, tortor sed eleifend tristique, tortor mauris molestie elit, et lacinia ipsum quam nec dui. Quisque nec mauris sit amet elit iaculis pretium sit amet quis magna. Aenean velit odio, elementum in tempus ut, vehicula eu diam. Pellentesque rhoncus aliquam mattis. Ut vulputate eros sed felis sodales nec vulputate justo hendrerit. Vivamus varius pretium ligula, a aliquam odio euismod sit amet. Quisque laoreet sem sit amet orci ullamcorper at ultricies metus viverra. Pellentesque arcu mauris, malesuada quis ornare accumsan, blandit sed diam.",inspectables:{color:"#000000",font_size:14,text_align:"left",line_height:1.3,blokk:"false"}},legacyInspectables:{line_height:1.3},tokenizer:FDBK.F_TOKENIZER_PARAGRAPH,multiline:!0,justifyAlignSupport:!0}),FDBK.addStencilTemplate({name:"link",title:"Link",tags:"link text hyper",iconPosition:[6,1],metadata:{text:"Hyperlink",inspectables:{color:"#1464f6",font_size:14}},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"link-bar-menu",title:"Link Bar",tags:"horizontal",iconPosition:[6,2],metadata:{text:"Link 1, *Link2, Link 3",inspectables:{foreground_color:"#000000",color:"#1464f6",color_selected:"#000000",font_size:14,text_align:"center"}},legacyInspectables:{foreground_color:"#000000",color_selected:"#000000"},tokenizer:FDBK.F_TOKENIZER_HORIZONTAL_MENU}),FDBK.addStencilTemplate({name:"checkbox",tags:"form",title:"Checkbox",iconPosition:[1,3],metadata:{text:"Check me out",inspectables:{checked:"checked",disabled:"checked",font_size:14,color:"#000000",stroke_color:"#000000",stroke_width:2,stroke_style:"solid"}},legacyInspectables:{color:"#000000",stroke_color:"#000000",stroke_width:2,stroke_style:"solid"},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"radio",title:"Radio buttons",tags:"form",iconPosition:[1,4],metadata:{text:"Pizza",inspectables:{checked:"checked",disabled:"checked",font_size:14,color:"#000000",stroke_color:"#000000",stroke_width:2,stroke_style:"solid"}},legacyInspectables:{color:"#000000",font_size:14,stroke_color:"#000000",stroke_width:2,stroke_style:"solid"},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"button",tags:"pill button control target action",title:"Button",iconPosition:[1,2],metadata:{text:"Button",inspectables:{radius:4,color:"#000000",font_size:16,text_align:"center",background_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",icon:"",icon_size:16,icon_secondary:"",dropdown:""}},legacyInspectables:{stroke_color:"#000000",stroke_width:2,stroke_style:"solid",text_align:"center",icon_secondary:""},migrateInspectables:{fill_color:"background_color",size:["font_size","icon_size"]},layoutHelper:function(a){var b=$(a).find("rect")[0];if(parseFloat(b.getAttribute("rx"))>4){var c=parseInt(svg(a).explicitHeight())/2;b.setAttribute("rx",c)}},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"combo-box",title:"Combo box",tags:"form input combobox dropdown select options menu",iconPosition:[1,5],metadata:{text:"Options",inspectables:{color:"#000000",background_color:"#ffffff",foreground_color:"#E6E6E6",text_align:"left",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:14,corner_radius:5}},legacyInspectables:{color:"#000000",background_color:"#ffffff",foreground_color:"#E6E6E6",text_align:"left",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:14,corner_radius:5},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"input-text",title:"Text input",tags:"input text field",iconPosition:[2,4],metadata:{text:"Email Address",inspectables:{color:"#C0C0C0",font_size:14,text_align:"left",background_color:"#ffffff",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",corner_radius:0,icon:"",icon_size:14}},legacyInspectables:{color:"#000000",font_size:14,text_align:"left",background_color:"#ffffff",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",corner_radius:0,icon:"",icon_size:14},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"textarea",title:"Text area",tags:"input text field textarea area multiline",iconPosition:[2,5],metadata:{text:"Multi\n\nline\n\ntextarea",inspectables:{color:"#000000",font_size:14,text_align:"left",line_height:1,background_color:"#ffffff",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",corner_radius:0}},legacyInspectables:{color:"#000000",font_size:14,text_align:"left",line_height:1,background_color:"#ffffff",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",corner_radius:0},tokenizer:FDBK.F_TOKENIZER_MARKDOWN,multiline:!0}),FDBK.addStencilTemplate({name:"stepper",title:"Stepper input",tags:"form input number",iconPosition:[3,12],metadata:{text:"12px",inspectables:{color:"#000000",text_align:"center",background_color:"#ffffff",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:14,corner_radius:5}},legacyInspectables:{color:"#000000",text_align:"center",background_color:"#ffffff",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:14,corner_radius:5},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"slider",title:"Slider",tags:"form input percentage slider",iconPosition:[3,7],metadata:{text:"50%",inspectables:{background_color:"#ffffff",foreground_color:"#AAAAAA",secondary_color:"#E1E1E1",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",corner_radius:5}},legacyInspectables:{background_color:"#ffffff",foreground_color:"#AAAAAA",secondary_color:"#E1E1E1",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",corner_radius:5},tokenizer:FDBK.F_TOKENIZER_PERCENTAGE}),FDBK.addStencilTemplate({name:"avatar",tags:"user picture",title:"Avatar",iconPosition:[1,1],metadata:{inspectables:{type:"dude",foreground_color:"#606060",background_color:"#ffffff",stroke_color:"#606060",stroke_width:2,stroke_style:"solid",corner_radius:0,size:128,border:!0}},legacyInspectables:{type:"dude",foreground_color:"#606060",background_color:"#ffffff",stroke_color:"#606060",stroke_width:2,stroke_style:"solid",corner_radius:0,size:128},migrateInspectables:{fill_color:["foreground_color","stroke_color"]}}),FDBK.addStencilTemplate({name:"icon",title:"Icon",tags:"symbol",iconPosition:[5,4],metadata:{inspectables:{foreground_color:"#000000",icon:"icon-emoticon-happy",size:24}},migrateInspectables:{fill_color:"foreground_color"}}),FDBK.addStencilTemplate({name:"grid",title:"Grid",tags:"data table tabular",iconPosition:[4,2],metadata:{text:"Cell 1, cell 2, cell 3\nCell 4, cell 5, cell 6\nCell 7, cell 8, cell 9\n cell 10"},tokenizer:function(a){var b,c;b=a.split(/\n|\r\n/);var d=0,c=b.map(function(a){var b=a.split(/,\s*/igm);return d=Math.max(d,b.length),b});return c.map(function(a){a.length=d}),c},multiline:!0,excludeFromSidebar:!0}),FDBK.addStencilTemplate({name:"grid-2",title:"Grid",tags:"data table tabular",iconPosition:[4,2],metadata:{text:"Head 1, Head 2, Head 3\n Cell 1, Cell 2, Cell 3, []\nCell 4, Cell 5, Cell 6, [x]\nCell 7, Cell 8, Cell 9, ()\nCell 10, Cell 11, Cell 12, (o)",inspectables:{header:!0,zebra:!0,sortable:!0,border:!0,vertical_lines:!0,horizontal_lines:!0,color:"#000000",font_size:14,text_align:"left",background_color:"#FFFFFF",foreground_color:"#ECECEC",secondary_color:"#CCCCCC",stroke_color:"#000000",stroke_width:1,stroke_style:"solid"}},legacyInspectables:{color:"#000000",font_size:14,text_align:"left",background_color:"#FFFFFF",foreground_color:"#ECECEC",secondary_color:"#CCCCCC",stroke_color:"#000000",stroke_width:1,stroke_style:"solid"},tokenizer:function(a){var b,c;b=a.split(/\n|\r\n/);var d=0,c=b.map(function(a){var b=a.split(/,\s*/igm);return d=Math.max(d,b.length),b});for(var e in c)for(var f in c[e])c[e][f]!="(o)"&&c[e][f]!="()"&&c[e][f]!="[x]"&&c[e][f]!="[]"&&(c[e][f]=FDBK.F_TOKENIZER_MARKDOWN(c[e][f]));return[c,d]},multiline:!0}),FDBK.addStencilTemplate({name:"horizontal-progress-bar",title:"Horizontal progress bar",tags:"percentage progress",iconPosition:[2,8],metadata:{text:"50%",inspectables:{background_color:"#FFFFFF",foreground_color:"#AAAAAA",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",corner_radius:4}},legacyInspectables:{background_color:"#FFFFFF",foreground_color:"#AAAAAA",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",corner_radius:4},tokenizer:FDBK.F_TOKENIZER_PERCENTAGE}),FDBK.addStencilTemplate({name:"line",title:"Diagonal Line",tags:"ruler line horizontal diagonal connector arc orthogonal arrow",iconPosition:[6,5],metadata:{inspectables:{stroke_color:"#000000",stroke_width:2,stroke_style:"solid",line_type:"diagonal",line_mode:"major",line_marker_start:!0,line_marker_end:!0,resize_mode:"nwse"}},migrateInspectables:{stroke:"stroke_color"}}),FDBK.addStencilTemplate({name:"horizontal-line",title:"Horizontal Line",tags:"ruler line horizontal",iconPosition:[3,9],metadata:{inspectables:{stroke_color:"#000000",stroke_width:2,stroke_style:"solid",line_marker_start:!1,line_marker_end:!1}},migrateInspectables:{stroke:"stroke_color"}}),FDBK.addStencilTemplate({name:"vertical-line",title:"Vertical Line",tags:"ruler line vertical",iconPosition:[3,10],metadata:{inspectables:{stroke_color:"#000000",stroke_width:2,stroke_style:"solid",line_marker_start:!1,line_marker_end:!1}},migrateInspectables:{stroke:"stroke_color"}}),FDBK.addStencilTemplate({name:"iphone",title:"iPhone",tags:"ios device mobile",iconPosition:[4,12],metadata:{inspectables:{bg_color:"#FFFFFF",status_size:5,status_color:"#000000",top_color:"#D6D6D6",top_size:15,bottom_size:15,bottom_color:"#929292",orientation:"portrait"}},excludeFromSidebar:!0}),FDBK.addStencilTemplate({name:"iphone-2",title:"iPhone",tags:"ios device mobile",iconPosition:[4,12],metadata:{inspectables:{bg_color:"#FFFFFF",status_size:4,status_color:"#000000",top_color:"#D6D6D6",top_size:15,bottom_size:15,bottom_color:"#929292",orientation:"portrait"}}}),FDBK.addStencilTemplate({name:"ipad",title:"iPad",tags:"ios device mobile tablet",iconPosition:[6,4],metadata:{inspectables:{bg_color:"#FFFFFF",status_size:4,status_color:"#000000",top_color:"#D6D6D6",top_size:15,bottom_size:15,bottom_color:"#929292",orientation:"portrait"}}}),FDBK.addStencilTemplate({name:"ios-alert",title:"iOS Alert",tags:"alert confirm dialog",iconPosition:[5,10],metadata:{text:"Are you sure?\nSome helpful info here\nNo, Yes",inspectables:{color:"#000000",font_size:16,background_color:"#E6E6E6",foreground_color:"#FFFFFF",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",corner_radius:4}},legacyInspectables:{color:"#000000",font_size:16,background_color:"#E6E6E6",foreground_color:"#FFFFFF",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",corner_radius:4},tokenizer:function(a){var b=a.split(/\n|\r\n/),c=[];return c.push(b[0]),c.push(b[1]),b[2]&&c.push(b[2].split(/\s*\,\s*/)),c},multiline:!0}),FDBK.addStencilTemplate({name:"ios-picker",title:"iOS Picker",tags:"picker",iconPosition:[5,8],metadata:{text:"April, 20, 2011\nMay, 21, 2012\nJune, 22, 2013",inspectables:{color:"#000000",color_selected:"#000000",font_size:16,background_color:"#FFFFFF",foreground_color:"#E6E6E6",secondary_color:"#000000"}},legacyInspectables:{color:"#000000",color_selected:"#000000",font_size:16,background_color:"#FFFFFF",foreground_color:"#E6E6E6",secondary_color:"#000000"},tokenizer:function(a){var b;b=a.split(/\n|\r\n/);var c=0,d=[],e=[];for(var f=0;f<b.length;f++){var g=b[f].split(/,\s*/igm);d.push(g),c=Math.max(c,g.length)}for(var h=0;h<c;h++)for(var i=0;i<b.length;i++){e[h]||(e[h]=[]);var g=d[i][h];g==undefined&&(g=""),e[h].push(g)}return e},multiline:!0}),FDBK.addStencilTemplate({name:"ios-menu",title:"iOS Menu",tags:"menu settings",iconPosition:[5,6],metadata:{text:"+ Add\n- Delete\nv Check\nAnother check, (v)\nCurrent value, value\nSub menu, >\nReorder, =\n* Bullet\n_ Icon\n__ Big Icon, Summary description\nx Thumbnail\nX Big Thumbnail, Summary description\nToggle, ON",inspectables:{background:!0,color:"#000000",color_selected:"#929292",font_size:14,background_color:"#FFFFFF",stroke_color:"#000000",stroke_width:1,stroke_style:"solid"}},legacyInspectables:{color:"#000000",color_selected:"#929292",font_size:14,background_color:"#FFFFFF",stroke_color:"#000000",stroke_width:1,stroke_style:"solid"},tokenizer:function(a){var b=a.split(/\n|\r\n/),c=[];for(var d in b){var e=b[d].match(/^(\+|v|__|_|X|x|-|\*)?\s?(.*)?$/),f={};f.icon=e[1];var g=(e[2]||"").match(/^.*,\s?(OFF|ON|=|>|\(>\)|\(v\))$/);g&&(f.type=g[1]);var h=(e[2]||"").replace(/\s?,\s?(\s?(OFF)|(ON)|=|>|\(>\)|\(v\))$/,"").split(/,([^,]+)$/);f.title=h[0],f.subtitle=h[1],c.push(f)}return c},multiline:!0}),FDBK.addStencilTemplate({name:"ios-button",title:"iOS Button",tags:"mobile ios back",iconPosition:[3,5],metadata:{text:"Back",inspectables:{color:"#000000",background_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:16,text_align:"center",icon:"",icon_size:16,orientation:"back"}},legacyInspectables:{font_size:14,icon_size:16,text_align:"center",stroke_width:2,stroke_style:"solid"},migrateInspectables:{fill_color:"background_color"},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"ios-segmented-control",title:"iOS Segments",tags:"tab menu segment horizontal",iconPosition:[5,7],metadata:{text:"Item 1, *Item 2, Item 3",inspectables:{color:"#000000",color_selected:"#000000",font_size:14,text_align:"center",background_color:"#ffffff",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid"}},legacyInspectables:{color:"#000000",color_selected:"#000000",font_size:14,text_align:"center",background_color:"#ffffff",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid"},tokenizer:FDBK.F_TOKENIZER_HORIZONTAL_MENU}),FDBK.addStencilTemplate({name:"ios-keyboard",title:"iOS Keyboard",tags:"input",iconPosition:[5,9],metadata:{inspectables:{keyboard_type:"normal"}},migrateInspectables:{mode:"keyboard_type"}}),FDBK.addStencilTemplate({name:"ios-switch",title:"iOS Switch",tags:"form on off",iconPosition:[2,1],metadata:{inspectables:{checked:"checked"}}}),FDBK.addStencilTemplate({name:"map",title:"Map",tags:"google maps location position",iconPosition:[3,2],metadata:{inspectables:{background_color:"#FFFFFF",foreground_color:"#E6E6E6",secondary_color:"#B3B3B3"}},legacyInspectables:{background_color:"#FFFFFF",foreground_color:"#E6E6E6",secondary_color:"#B3B3B3"}}),FDBK.addStencilTemplate({name:"image-placeholder",title:"Placeholder image",tags:"placeholder picture photo",iconPosition:[3,11],excludeFromSidebar:!0,metadata:{}}),FDBK.addStencilTemplate({name:"image-placeholder-2",title:"Placeholder image",tags:"placeholder picture photo",iconPosition:[3,11],metadata:{inspectables:{background_color:"#E6E6E6",foreground_color:"#B3B3B3"}},legacyInspectables:{background_color:"#E6E6E6",foreground_color:"#B3B3B3"}}),FDBK.addStencilTemplate({name:"image",title:"Image",tags:"picture photo",iconPosition:[0,0],metadata:{},excludeFromSidebar:!0}),FDBK.addStencilTemplate({name:"group-stencil",title:"Group",tags:"",iconPosition:[0,0],excludeFromSidebar:!0}),FDBK.addStencilTemplate({name:"pie-chart",title:"Pie chart",tags:"charts data",iconPosition:[4,11],metadata:{inspectables:{background_color:"#FFFFFF",foreground_color:"#DFDFDF",secondary_color:"#808080",stroke_color:"#000000",stroke_width:2,stroke_style:"solid"}},legacyInspectables:{background_color:"#FFFFFF",foreground_color:"#DFDFDF",secondary_color:"#808080",stroke_color:"#000000",stroke_width:2,stroke_style:"solid"}}),FDBK.addStencilTemplate({name:"bar-chart",title:"Bar chart",tags:"charts data",iconPosition:[4,10],metadata:{inspectables:{background_color:"#FFFFFF",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid"}},legacyInspectables:{background_color:"#FFFFFF",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid"}}),FDBK.addStencilTemplate({name:"column-chart",title:"Column Chart",tags:"charts data",iconPosition:[4,9],metadata:{inspectables:{background_color:"#FFFFFF",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid"}},legacyInspectables:{background_color:"#FFFFFF",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid"}}),FDBK.addStencilTemplate({name:"line-chart",title:"Line Chart",tags:"charts data",iconPosition:[4,8],metadata:{inspectables:{foreground_color:"#808080",stroke_color:"#000000",stroke_width:2,stroke_style:"solid"}},legacyInspectables:{foreground_color:"#808080",stroke_color:"#000000",stroke_width:2,stroke_style:"solid"}}),FDBK.addStencilTemplate({name:"banner",title:"Banner",tags:"banner advertisement",iconPosition:[3,3],metadata:{text:"468*60",inspectables:{color:"#000000",background_color:"#ffffff",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:14,corner_radius:0}},legacyInspectables:{stroke_width:2,stroke_style:"solid",font_size:14,corner_radius:0},migrateInspectables:{fill_color:"background_color"},layoutHelper:function(a){$(a).find("div").html(utils.sanitize(svg(a).explicitWidth())+" &times; "+utils.sanitize(svg(a).explicitHeight()))}}),FDBK.addStencilTemplate({name:"search-input",title:"Search input",tags:"form search filter",iconPosition:[3,1],metadata:{text:"Search",inspectables:{color:"#000000",font_size:14,text_align:"left",background_color:"#FFFFFF",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",icon_size:13,icon:"icon-find",icon_secondary:"icon-close_2_"}},legacyInspectables:{color:"#000000",font_size:14,text_align:"left",background_color:"#FFFFFF",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",icon_size:13,icon:"icon-find",icon_secondary:"icon-close_2_"}}),FDBK.addStencilTemplate({name:"stars",title:"Star ratings",tags:"ratings feedback vote",iconPosition:[1,10],metadata:{text:"3/5",inspectables:{background_color:"#CCCCCC",foreground_color:"#000000"}},legacyInspectables:{background_color:"#CCCCCC",foreground_color:"#000000"},tokenizer:FDBK.F_TOKENIZER_RATINGS}),FDBK.addStencilTemplate({name:"hearts",title:"Heart ratings",tags:"ratings feedback",iconPosition:[1,9],metadata:{text:"3/5",inspectables:{background_color:"#CCCCCC",foreground_color:"#000000"}},legacyInspectables:{background_color:"#CCCCCC",foreground_color:"#000000"},tokenizer:FDBK.F_TOKENIZER_RATINGS}),FDBK.addStencilTemplate({name:"tab-bar",title:"Tabs",tags:"navigation",iconPosition:[4,1],metadata:{text:"Home, *Products, About, Contact",inspectables:{mode:"up"}},tokenizer:function(a){return a.split(/,\s*/igm)},excludeFromSidebar:!0}),FDBK.addStencilTemplate({name:"tab-bar-2",title:"Tabs",tags:"navigation",iconPosition:[4,1],metadata:{text:"Home, *Products, About, Contact",inspectables:{mode:"up",color:"#000000",font_size:14,text_align:"center",color_selected:"#000000",background_color:"#FFFFFF",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid"}},legacyInspectables:{mode:"up",color:"#000000",font_size:14,text_align:"center",color_selected:"#000000",background_color:"#FFFFFF",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid"},tokenizer:function(a){return a.split(/,\s*/igm)}}),FDBK.addStencilTemplate({name:"throbber",title:"Throbber",tags:"spinner loading",iconPosition:[3,4],metadata:{inspectables:{foreground_color:"#000000"}},legacyInspectables:{foreground_color:"#000000"}}),FDBK.addStencilTemplate({name:"thumbnails",title:"Thumbnails",tags:"grid placeholder image",iconPosition:[4,3],metadata:{text:"2*2",inspectables:{background_color:"#ffffff",stroke_color:"#000000",stroke_width:2,stroke_style:"solid"}},legacyInspectables:{background_color:"#ffffff",stroke_color:"#000000",stroke_width:2,stroke_style:"solid"},tokenizer:function(a){var b=a.match(/\s*(\d+)\s*\*?\s*(\d+)?\s*/);if(!b)return"";var c,d,e,f;for(c=0,d=[],f=Math.min(parseInt(b[1]||1),100);c<f;c++)d.push(" ");for(c=0,e=[],f=Math.min(parseInt(b[2]||1),100);c<f;c++)e.push(" ");return[d,e]}}),FDBK.addStencilTemplate({name:"tooltip",title:"Tooltip",tags:"note annotation tooltip speech popover arrow",iconPosition:[3,6],metadata:{text:"I'm a tooltip! \n\nOr am I a *speech bubble?*",inspectables:{direction:"bottom-left",color:"#000000",font_size:14,background_color:"#ffffff",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",text_align:"left",icon:"",icon_size:16,line_height:1}},legacyInspectables:{font_size:14,stroke_width:2,stroke_style:"solid",text_align:"left",icon:"",icon_size:16,line_height:1},migrateInspectables:{bg:"background_color",stroke:"stroke_color"},justifyAlignSupport:!0,tokenizer:FDBK.F_TOKENIZER_MARKDOWN,multiline:!0}),FDBK.addStencilTemplate({name:"window",title:"Window",tags:"window chrome mac windows",iconPosition:[2,12],metadata:{text:"Untitled Window",inspectables:{type:"mac",background_color:"#FFFFFF",foreground_color:"#E6E6E6",stroke_color:"#231F20",stroke_width:2,stroke_style:"solid",font_size:14,color:"#000000"}},legacyInspectables:{type:"mac",background_color:"#FFFFFF",foreground_color:"#E6E6E6",stroke_color:"#231F20",stroke_width:2,stroke_style:"solid",font_size:14,color:"#000000"}}),FDBK.addStencilTemplate({name:"browser",title:"Browser",tags:"browser window popup firefox chrome windows mac",iconPosition:[2,11],metadata:{text:"Moqzilla \n http://moqups.com",inspectables:{background_color:"#FFFFFF",foreground_color:"#E6E6E6",secondary_color:"#999999",stroke_color:"#231F20",stroke_width:2,stroke_style:"solid",font_size:12,color:"#000000"}},legacyInspectables:{type:"mac",background_color:"#FFFFFF",foreground_color:"#E6E6E6",secondary_color:"#999999",stroke_color:"#231F20",stroke_width:2,stroke_style:"solid",font_size:12,color:"#000000"},tokenizer:FDBK.F_TOKENIZER_NEWLINE,multiline:!0}),FDBK.addStencilTemplate({name:"vertical-scrollbar",title:"Vertical scrollbar",tags:"scrollbar vertical",metadata:{inspectables:{background_color:"#FFFFFF",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",corner_radius:0}},legacyInspectables:{background_color:"#FFFFFF",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",corner_radius:0},iconPosition:[1,6]}),FDBK.addStencilTemplate({name:"horizontal-scrollbar",title:"Horizontal scrollbar",tags:"scrollbar horizontal",iconPosition:[1,7],metadata:{inspectables:{background_color:"#FFFFFF",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",corner_radius:0}},legacyInspectables:{background_color:"#FFFFFF",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",corner_radius:0}}),FDBK.addStencilTemplate({name:"context-menu",title:"Context menu",tags:"menu right click context vertical",iconPosition:[1,8],metadata:{text:"File\nOpen...\n*Open Recent,>\nExport as, >\n\nPrint\nPage Setup\n\nExit",inspectables:{color:"#000000",color_selected:"#000000",background_color:"#ffffff",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:14,corner_radius:4,text_align:"left"}},legacyInspectables:{color:"#000000",color_selected:"#000000",background_color:"#ffffff",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:14,corner_radius:4,text_align:"left"},tokenizer:FDBK.F_TOKENIZER_VERTICAL_MENU,multiline:!0}),FDBK.addStencilTemplate({name:"vertical-menu",title:"Vertical List menu",tags:"menu right click context vertical list",iconPosition:[5,5],metadata:{text:"Apps\nGames\n* Movies,>\nBooks\nNewspapers",inspectables:{color:"#000000",color_selected:"#000000",background_color:"#ffffff",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:14,text_align:"left",corner_radius:0}},legacyInspectables:{color:"#000000",color_selected:"#000000",background_color:"#ffffff",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:14,text_align:"left",corner_radius:0},tokenizer:FDBK.F_TOKENIZER_VERTICAL_MENU,multiline:!0}),FDBK.addStencilTemplate({name:"vertical-arrow-menu",title:"Vertical arrow menu",tags:"menu",iconPosition:[4,6],metadata:{text:"Apps\nGames\n* Movies,>\nBooks\nNewspapers",inspectables:{hide_arrow:"false",color:"#000000",color_selected:"#000000",background_color:"#FFFFFF",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:14,text_align:"left"}},legacyInspectables:{hide_arrow:"false",color:"#000000",color_selected:"#000000",background_color:"#ffffff",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:14,text_align:"left"},tokenizer:FDBK.F_TOKENIZER_VERTICAL_MENU,multiline:!0}),FDBK.addStencilTemplate({name:"horizontal-menu",title:"Horizontal menu",tags:"menu right click context vertical list",iconPosition:[4,4],metadata:{text:"Apps, Games, * Movies, Books, Newspapers",inspectables:{color:"#000000",color_selected:"#000000",background_color:"#ffffff",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:14,text_align:"center",corner_radius:0}},legacyInspectables:{color:"#000000",color_selected:"#000000",background_color:"#ffffff",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:14,text_align:"center",corner_radius:0},tokenizer:FDBK.F_TOKENIZER_HORIZONTAL_MENU}),FDBK.addStencilTemplate({name:"horizontal-arrow-menu",title:"Horizontal Arrow Menu",tags:"menu right click context vertical list",iconPosition:[4,5],metadata:{text:"Apps, Games, * Movies, Books, Newspapers",inspectables:{hide_arrow:"false",color:"#000000",color_selected:"#000000",background_color:"#FFFFFF",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:14,text_align:"center"}},legacyInspectables:{hide_arrow:"false",color:"#000000",color_selected:"#000000",background_color:"#ffffff",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:14,text_align:"center"},tokenizer:FDBK.F_TOKENIZER_HORIZONTAL_MENU}),FDBK.addStencilTemplate({name:"steps",title:"Steps",tags:"steps",iconPosition:[2,7],metadata:{text:"*Sign up, Pricing plan, Payment, Complete!",inspectables:{color:"#000000",color_selected:"#000000",background_color:"#ffffff",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:14}},legacyInspectables:{color:"#000000",color_selected:"#000000",background_color:"#ffffff",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:14},tokenizer:FDBK.F_TOKENIZER_HORIZONTAL_MENU}),FDBK.addStencilTemplate({name:"bread-crumb-menu",title:"Breadcrumb menu",tags:"bread crumb menu",iconPosition:[4,7],metadata:{text:"Home, Level 1, Level 2, Level 3, *Last",inspectables:{color:"#000000",color_selected:"#000000",background_color:"#FFFFFF",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:14,text_align:"center"}},legacyInspectables:{color:"#000000",color_selected:"#000000",background_color:"#FFFFFF",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:14,text_align:"center"},tokenizer:FDBK.F_TOKENIZER_HORIZONTAL_MENU}),FDBK.addStencilTemplate({name:"tree-menu",title:"Tree menu",tags:"tree",iconPosition:[6,3],metadata:{text:"F Pictures\n - Purple Lotus 1.jpg\n - Blue Orchid.png\n f Other Flowers\n\n[-] Tree\n [+] Branch\n [+] Another Branch\n A Leaf\n\nv Level 1 \n > Level 2\n v Level 3\n  > Level 3.1\n\n[ ] Check all the things!\n [x] Check me once\n [x] Check me twice",inspectables:{color:"#000000",foreground_color:"#000000",font_size:14}},legacyInspectables:{color:"#000000",foreground_color:"#000000",font_size:14},tokenizer:FDBK.F_TOKENIZER_TREE,multiline:!0}),FDBK.addStencilTemplate({name:"ribbon",title:"Ribbon",tags:"header ribbon section",iconPosition:[1,11],metadata:{text:"Page Section",inspectables:{type:"both",color:"#000000",background_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:14,text_align:"left"}},legacyInspectables:{type:"both",color:"#000000",background_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:14,text_align:"left"},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"calendar",title:"Calendar",tags:"date calendar picker",iconPosition:[2,2],metadata:{},excludeFromSidebar:!0}),FDBK.addStencilTemplate({name:"calendar-2",title:"Calendar",tags:"date calendar picker",iconPosition:[2,2],metadata:{text:"4/22/2012",inspectables:{color:"#000000",color_selected:"#000000",background_color:"#FFFFFF",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:12,corner_radius:0}},legacyInspectables:{color:"#000000",color_selected:"#000000",background_color:"#FFFFFF",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:12,corner_radius:0},tokenizer:FDBK.F_TOKENIZER_CALENDAR}),FDBK.addStencilTemplate({name:"date-picker",title:"Date picker",tags:"input date picker",iconPosition:[2,3],metadata:{text:"4/22/2012",inspectables:{color:"#000000",background_color:"#FFFFFF",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:14,text_align:"left",icon:"icon-calendar",icon_size:16,corner_radius:0}},legacyInspectables:{color:"#000000",background_color:"#FFFFFF",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",font_size:14,text_align:"left",icon:"icon-calendar",icon_size:16,corner_radius:0},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"video-player",tags:"video player",title:"Video player",iconPosition:[2,9],metadata:{inspectables:{background_color:"#FFFFFF",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",secondary_color:"#AAAAAA"}},legacyInspectables:{background_color:"#FFFFFF",foreground_color:"#E1E1E1",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",secondary_color:"#AAAAAA"}}),FDBK.addStencilTemplate({name:"audio-player",tags:"audio player",title:"Audio player",iconPosition:[2,10],metadata:{inspectables:{background_color:"#FFFFFF",foreground_color:"#E6E6E6",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",secondary_color:"#AAAAAA"}},legacyInspectables:{background_color:"#FFFFFF",foreground_color:"#E1E1E1",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",secondary_color:"#AAAAAA"}}),FDBK.addStencilTemplate({name:"basic-shapes",tags:"circle rectangle hexagon pentagon rombus parallelogram star",title:"Simple Shapes",iconPosition:[5,3],metadata:{text:"",inspectables:{color:"#000000",font_size:14,type:"star",stroke_color:"#000000",stroke_width:2,stroke_style:"solid",background_color:"#E1E1E1",brd:1}},migrateInspectables:{border:"brd",bg:"background_color",stroke:"stroke_color"},legacyInspectables:{font_size:14},tokenizer:FDBK.F_TOKENIZER_MARKDOWN,multiline:!0}),FDBK.loadStencilTemplates();var svg=window.svg=function(a){return a==svg.element?svg:(typeof a=="string"&&(a=$(a)[0]),svg.init(a))};svg.TEXT_ALIGN_LEFT="left",svg.TEXT_ALIGN_RIGHT="right",svg.TEXT_ALIGN_MIDDLE="middle",svg.TEXT_ALIGN_JUSTIFY="justify",svg.RESIZE_VERTICAL="vertical",svg.RESIZE_HORIZONTAL="horizontal",svg.RESIZE_ASPECT="aspect",svg.RESIZE_ALL="all",svg.RESIZE_NWSE="nwse",svg.RESIZE_NESW="nesw",svg.RESIZE_NONE="none",svg.RESIZE_LINE="line",svg.init=function(a){return svg.element=a,svg.$element=$(a),svg.root=a.ownerSVGElement,svg},svg.width=function(a){if(svg.isContainer())return a!=undefined&&(svg.element.setAttribute("width",a),svg.measuredWidth(a),svg.element.boundingRect=null),svg.getBoundingRect().width;if(svg.isGroup())return svg.getBoundingRect().width;if(a!=undefined){var b=(parseInt(a)-svg.strokeWidth())/svg.element.getBBox().width;b!=1&&svg.transform(b,1)}return svg.element.getBBox&&svg.isUIElement()?Math.round(svg.element.getBBox().width)+svg.strokeWidth():0},svg.height=function(a){if(svg.isContainer())return a!=undefined&&(svg.element.setAttribute("height",a),svg.measuredHeight(a),svg.element.boundingRect=null),svg.getBoundingRect().height;if(svg.isGroup())return svg.getBoundingRect().height;if(a!=undefined){var b=(parseInt(a)-svg.strokeWidth())/svg.element.getBBox().height;b!=1&&svg.transform(1,b)}return svg.element.getBBox&&svg.isUIElement()?Math.round(svg.element.getBBox().height)+svg.strokeWidth():0},svg.explicitWidth=function(){var a=svg.element.getAttributeNode("explicit-width")||svg.element.getAttributeNode("width");if(a)return a.value},svg.explicitHeight=function(){var a=svg.element.getAttributeNode("explicit-height")||svg.element.getAttributeNode("height");if(a)return a.value},svg.totalWidth=function(a){if(a==undefined)return svg.element.getAttribute("total-width");svg.element.setAttribute("total-width",a)},svg.totalHeight=function(a){if(a==undefined)return svg.element.getAttribute("total-height");svg.element.setAttribute("total-height",a)},svg.measuredWidth=function(a){return a==undefined?parseInt(svg.element.getAttribute("measured-width")):(svg.element.setAttribute("measured-width",a),a)},svg.measuredHeight=function(a){return a==undefined?parseInt(svg.element.getAttribute("measured-height")):(svg.element.setAttribute("measured-height",a),a)},svg.strokeWidthCompensation=function(){return svg.strokeWidth()/2},svg.strokeWidth=function(){return parseInt(svg.element.getAttribute("stroke-width"))||0},svg.size=function(a,b){if(a==undefined&&b==undefined){if(svg.isContainer())return svg.getBoundingRect();return}var c,d;if(svg.isContainer()||svg.isRect()||svg.isImage())a!=undefined&&(a=Math.max(0,a-svg.strokeWidth()),svg.element.setAttribute("width",a),svg.measuredWidth(a),svg.element.boundingRect=null),b!=undefined&&(b=Math.max(0,b-svg.strokeWidth()),svg.element.setAttribute("height",b),svg.measuredHeight(b),svg.element.boundingRect=null);else if(svg.isGroup()){var e=svg.getRealBBox();a!=undefined?c=parseInt(a)/(e.width||1):c=1,b!=undefined?d=parseInt(b)/(e.height||1):d=1,(c!=1||d!=1)&&svg.transform(c,d)}else{var e=svg.element.getBBox();a!=undefined?c=(parseInt(a)-svg.strokeWidth())/(e.width||1):c=1,b!=undefined?d=(parseInt(b)-svg.strokeWidth())/(e.height||1):d=1,(c!=1||d!=1)&&svg.transform(c,d)}},svg.position=function(a,b){if(a!=undefined&&b!=undefined){svg.transform(null,null,a,b);return}if(svg.isRect()||svg.isImage()||svg.isContainer()){var c=svg.element.x.baseVal.value-svg.strokeWidthCompensation(),d=svg.element.y.baseVal.value-svg.strokeWidthCompensation();return{x:c,y:d}}if(svg.isGroup()){var e=svg.root.createSVGPoint();return e.x=parseInt(svg.element.getAttribute("x"))||0,e.y=parseInt(svg.element.getAttribute("y"))||0,e}if(svg.isForeign())return{x:svg.element.x.baseVal.value||0,y:svg.element.y.baseVal.value||0};var f=svg.element.getBBox();return realX=f.x-svg.strokeWidthCompensation(),realY=f.y-svg.strokeWidthCompensation(),{x:realX,y:realY}},svg.transform=function(a,b,c,d){var e=svg.ROOT_EL||(svg.ROOT_EL=document.getElementById("svgObject"));switch(svg.element.nodeName){case"g":var f=svg.element.transform.baseVal,g,h,i,j,k,l;c!=undefined&&d!=undefined&&(l=svg.getRealBBox(),f.numberOfItems==0?(i=e.createSVGTransform(),i.setMatrix(e.createSVGMatrix()),f.appendItem(i)):i=f.getItem(0),g=svg.element.getScreenCTM(),g&&(j=svg.root.createSVGMatrix(),j.a=g.a,j.d=g.d,k=svg.root.createSVGMatrix(),k.e=l.x*j.a-c,k.f=l.y*j.d-d,j=j.inverse().multiply(k).inverse(),svg.element.setAttribute("transform","matrix("+j.a+" "+j.b+" "+j.c+" "+j.d+" "+j.e+" "+j.f+" )")),svg.element.setAttribute("x",c),svg.element.setAttribute("y",d),svg.element.boundingRect=null);if(a!=undefined&&b!=undefined){var m;f.numberOfItems==0?m=svg.position(0,0):m=svg.position(),i=f.getItem(0),g=svg.element.getCTM(),l=svg.getRealBBox(),j=svg.root.createSVGMatrix(),j.e=l.x,j.f=l.y,g&&(j=g.multiply(j),h=svg.element.ownerSVGElement.getCTM(),k=svg.root.createSVGMatrix(),k.e=(g.e-j.e)/g.a*a+j.e-h.e,k.f=(g.f-j.f)/g.d*b+j.f-h.f,k.a=a,k.d=b,i.setMatrix(k)),svg.element.boundingRect=null}break;case"svg":var n=parseInt(c),o=parseInt(d);isNaN(n)||svg.element.setAttribute("x",n),isNaN(o)||svg.element.setAttribute("y",o);break;case"ellipse":var n=parseInt(c),o=parseInt(d),p=parseFloat(svg.element.getAttribute("rx")),q=parseFloat(svg.element.getAttribute("ry"));isNaN(n)||svg.element.setAttribute("cx",n+p+svg.strokeWidthCompensation()),isNaN(o)||svg.element.setAttribute("cy",o+q+svg.strokeWidthCompensation()),isNaN(parseFloat(a))||(p=Math.abs(Math.max(0,svg.width()*a/2)-svg.strokeWidthCompensation()),svg.element.setAttribute("rx",p)),isNaN(parseFloat(b))||(q=Math.abs(Math.max(0,svg.height()*b/2)-svg.strokeWidthCompensation()),svg.element.setAttribute("ry",q));break;case"circle":var n=parseInt(c),o=parseInt(d),r=parseFloat(svg.element.getAttribute("r"));isNaN(n)||svg.element.setAttribute("cx",n+r+svg.strokeWidthCompensation()),isNaN(o)||svg.element.setAttribute("cy",o+r+svg.strokeWidthCompensation()),isNaN(parseFloat(a))||(p=Math.abs(Math.max(0,svg.width()*a/2)-svg.strokeWidthCompensation()),svg.element.setAttribute("r",r));break;case"rect":var n=parseInt(c)+svg.strokeWidthCompensation(),o=parseInt(d)+svg.strokeWidthCompensation();isNaN(n)||svg.element.setAttribute("x",n),isNaN(o)||svg.element.setAttribute("y",o);break;case"text":var n=parseInt(c),o=parseInt(d);isNaN(n)||svg.element.setAttribute("x",n),isNaN(o)||svg.element.setAttribute("y",o);break;case"foreignObject":var n=parseInt(c),o=parseInt(d),s=svg.element.firstElementChild;isNaN(n)||(svg.element.setAttribute("x",n),s&&(s.style.width=svg.measuredWidth()+"px")),isNaN(o)||(svg.element.setAttribute("y",o),s&&(s.style.height=svg.measuredHeight()+"px"));break;case"path":var l=svg.element.getBBox(),t=svg.scaleGrid(l);if(t&&svg.isRelativePath()){var u=svg.convertPath();svg.pathData(u)}var v=svg.element.pathSegList,w=v.numberOfItems,x=[];a=Math.max(0,a),b=Math.max(0,b),x.right=a*l.width-l.width,x.bottom=b*l.height-l.height,c=c||0,d=d||0;var y=[];y.x=(c||0)+svg.strokeWidthCompensation()-l.x,y.y=(d||0)+svg.strokeWidthCompensation()-l.y;if(!isNaN(a)||!isNaN(b)||!isNaN(c)||!isNaN(d))while(w--){var z=v.getItem(w);a&&b&&(t?(z.x>t.right&&(z.x+=x.right,z.x1+=x.right,z.x2+=x.right),isNaN(t.right)&&(z.x*=a,z.x1*=a,z.x2*=a),z.y>t.bottom&&(z.y+=x.bottom,z.y1+=x.bottom,z.y2+=x.bottom),isNaN(t.bottom)&&(z.y*=b,z.y1*=b,z.y2*=b)):(z.x*=a,z.y*=b,z.x1*=a,z.y1*=b,z.x2*=a,z.y2*=b)),z.pathSegType%2||(c!=undefined&&(z.x+=y.x,z.x2+=y.x,z.x1+=y.x),d!=undefined&&(z.y+=y.y,z.y2+=y.y,z.y1+=y.y))}}e=null},svg.linePosition=function(a,b,c,d){if(svg.isLine()){a!=undefined&&b!=undefined&&(svg.$element[0].setAttribute("x1",a),svg.$element[0].setAttribute("y1",b)),c!=undefined&&d!=undefined&&(svg.$element[0].setAttribute("x2",c),svg.$element[0].setAttribute("y2",d));var e={x1:parseInt(svg.$element[0].getAttribute("x1")),y1:parseInt(svg.$element[0].getAttribute("y1")),x2:parseInt(svg.$element[0].getAttribute("x2")),y2:parseInt(svg.$element[0].getAttribute("y2"))};return e}},svg.gap=function(){return parseInt(svg.element.getAttribute("gap"))||0},svg.padding=function(){return parseInt(svg.element.getAttribute("padding"))||0},svg.isContainer=function(){return svg.element.nodeName=="svg"},svg.isRect=function(){return svg.element.nodeName=="rect"},svg.isImage=function(){return svg.element.nodeName=="image"},svg.isGroup=function(){return svg.element.nodeName=="g"},svg.isText=function(){return svg.element.nodeName=="text"},svg.isForeign=function(){return svg.element.nodeName=="foreignObject"},svg.isLine=function(){return svg.element.nodeName=="line"},svg.isStencil=function(){return svg.hasClass("stencil")||svg.hasClass("stencil-grouped")},svg.hasClass=function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++)if(svg.element.nodeType===1&&(" "+svg.element.className.baseVal+" ").replace($.rclass," ").indexOf(b)>-1)return!0;return!1},svg.isDirty=function(a){return a!=undefined&&(a?svg.element.setAttribute("dirty","true"):svg.element.setAttribute("dirty","false")),svg.element.getAttribute("dirty")=="true"?!0:!1},svg.scaleGrid=function(a){a||(a=svg.element.getBBox());var b=[];b.right=parseInt(svg.element.getAttribute("scale-grid-right"))+a.x,b.bottom=parseInt(svg.element.getAttribute("scale-grid-bottom"))+a.y;if(b.right||b.bottom)return b},svg.minWidth=function(a){var b;if(!svg.element.getAttribute("min-width")){if(a!=undefined)b=a,svg.element.setAttribute("min-width",b);else if(!svg.isContainer()){var c=svg.explicitWidth();if(!utils.getPercentage(c)&&!isNaN(c))b=parseInt(c);else if(svg.isForeign()){var d=svg.element.firstElementChild,e=d.style.width,f=svg.explicitWidth(),g=svg.explicitHeight();f==undefined&&(svg.element.setAttribute("width","100%"),g==undefined&&svg.element.setAttribute("height","100%")),d.style.width="1px",d.style.overflow="hidden",b=d.scrollWidth+(parseInt(d.style.paddingLeft)||0)+(parseInt(d.style.paddingRight)||0)+(parseInt(d.style.marginLeft)||0)+(parseInt(d.style.marginRight)||0),d.style.width=e,f==undefined&&(svg.element.setAttribute("width",b),g==undefined&&svg.element.removeAttribute("height"))}else b=/^icon-/.test(svg.element.getAttribute("id"))?svg.width()/2:svg.width();svg.element.setAttribute("min-width",b)}return b||0}a!=undefined&&(b=a,svg.element.setAttribute("min-width",b));if(a==undefined)return parseInt(svg.element.getAttribute("min-width"))||0},svg.minHeight=function(a){var b;if(!svg.element.getAttribute("min-height")){if(a!=undefined)b=a,svg.element.setAttribute("min-height",b);else if(!svg.isContainer()){var c=svg.explicitHeight();if(!utils.getPercentage(c)&&!isNaN(c))b=parseInt(c);else if(svg.isForeign()){var d=svg.element.firstElementChild;b=Math.round(parseInt(document.defaultView.getComputedStyle(d,null).getPropertyValue("line-height"))*1.3)||0,svg.explicitHeight()==undefined&&svg.element.setAttribute("height",b)}else b=/^icon-/.test(svg.element.getAttribute("id"))?svg.height()/2:svg.height()}return svg.element.setAttribute("min-height",b),b||0}a!=undefined&&(b=a,svg.element.setAttribute("min-height",b));if(a==undefined)return parseInt(svg.element.getAttribute("min-height"))||0},svg.convertPath=function(){var a=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"],b=svg.element.pathSegList,c=b.numberOfItems,d=0,e=0,f="",g=null;for(var h=0;h<c;++h){var i=b.getItem(h),j=i.x||0,k=i.y||0,l=i.x1||0,m=i.y1||0,n=i.x2||0,o=i.y2||0,p=i.pathSegType,q=a[p].toUpperCase(),r=function(a,b,c){var d="",b=b?" "+b.join(" "):"",c=c?" "+c:"";$.each(a,function(b,c){a[b]=c}),f+=q+a.join(" ")+b+c};switch(p){case 1:f+="z";break;case 12:j-=d;case 13:j+=d,d=j,q="L",r([[j,e]]);break;case 14:k-=e;case 15:k+=e,e=k,q="L",r([[d,k]]);break;case 2:case 4:case 18:j-=d,k-=e;case 5:case 3:g&&b.getItem(h-1).pathSegType===1&&!toRel&&(d=g[0],e=g[1]);case 19:j+=d,k+=e,d=j,e=k,p===3&&(g=[d,e]),r([[j,k]]);break;case 6:j-=d,l-=d,n-=d,k-=e,m-=e,o-=e;case 7:j+=d,l+=d,n+=d,k+=e,m+=e,o+=e,d=j,e=k,r([[l,m],[n,o],[j,k]]);break;case 8:j-=d,l-=d,k-=e,m-=e;case 9:j+=d,l+=d,k+=e,m+=e,d=j,e=k,r([[l,m],[j,k]]);break;case 10:j-=d,k-=e;case 11:console.error("Error: Resizing paths with relative elliptical arcs is not implemented!"),j+=d,k+=e,d=j,e=k,r([[i.r1,i.r2]],[i.angle,i.largeArcFlag?1:0,i.sweepFlag?1:0],[j,k]);break;case 16:j-=d,n-=d,k-=e,o-=e;case 17:j+=d,n+=d,k+=e,o+=e,d=j,e=k,r([[n,o],[j,k]])}}return f},svg.pathData=function(a){return a&&svg.element.setAttribute("d",a),a||svg.element.getAttribute("d")},svg.isRelativePath=function(){var a=/[achlmqstv]/,b=svg.pathData().search(a);return b!=-1},svg.shouldWrap=function(){return svg.element.getAttribute("wrap")==="true"},svg.textData=function(a){return a&&svg.element.setAttribute("data-text",a),a||svg.element.getAttribute("data-text")},svg.textAlign=function(a){return a&&svg.element.setAttribute("data-text-align",a),a||svg.element.getAttribute("data-text-align")},svg.isEditable=function(){return svg.element.getAttribute("editable")==="true"},svg.resetSizeOnEdit=function(){return svg.element.getAttribute("reset-size")==="true"},svg.resetSizeOnInspect=function(){return svg.element.getAttribute("reset-size-inspect")==="true"},svg.isMultilineEditable=function(){return svg.element.getAttribute("multiline")==="true"},svg.resizeMode=function(){return svg.element.getAttribute("resize-mode")||svg.RESIZE_ALL},svg.isUIElement=function(){var a=/svg|text|foreignObject|path|circle|rect|ellipse|g|image/,b=svg.element.nodeName.search(a);return b!=-1},svg.data=function(a){console.info("deprecated: svg.data()")},svg.getRealBBox=function(){if(!svg.element.realBBox){var a=svg.$element.find("*").get(),b=svg.element.getBBox(),c,d,e,f,g,h;c=b.x,e=b.y,d=b.x+b.width,f=b.y+b.height,g=b.width,h=b.height;if(a.length)for(var i=0;i<a.length;i++){if(!a[i].getBBox||a[i].nodeName=="clipPath")break;var j=a[i].getBBox(),k=parseFloat(a[i].getAttribute("stroke-width"))||0,l=k/2;c=Math.min(c,j.x-l),e=Math.min(e,j.y-l),d=Math.max(d,j.x+j.width+l),f=Math.max(f,j.y+j.height+l),g=d-c,h=f-e}var m=svg.root.createSVGRect();m.x=c,m.y=e,m.width=g,m.height=h,svg.element.realBBox=m}return svg.element.realBBox},svg.getBoundingRect=function(){if(!svg.element.boundingRect){var a=svg.element.getCTM(),b=svg.element.ownerSVGElement.getCTM(),c=svg.getRealBBox(),d,e,f,g,h,i;h=a.a*c.width,i=a.d*c.height,d=(c.x+a.e/a.a)*a.a-b.e,f=(c.y+a.f/a.d)*a.d-b.f,e=d+h,g=e+i,svg.element.boundingRect={left:d,right:e,top:f,bottom:g,width:h,height:i}}return svg.element.boundingRect};var layout=window.layout=function(a){return typeof a=="string"&&(a=$(a)[0]),layout.init(a)};layout.LAYOUT_VERTICAL="vertical",layout.LAYOUT_HORIZONTAL="horizontal",layout.LAYOUT_NONE="none",layout.ALIGN_VERTICAL_TOP="top",layout.ALIGN_VERTICAL_MIDDLE="middle",layout.ALIGN_VERTICAL_BOTTOM="bottom",layout.ALIGN_HORIZONTAL_LEFT="left",layout.ALIGN_HORIZONTAL_RIGHT="right",layout.ALIGN_HORIZONTAL_CENTER="center",layout.init=function(a){return layout.element=a,layout},layout.measure=function(a){var b=a.getAttribute("layout"),c=svg(a).measuredWidth(),d=svg(a).measuredHeight(),e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=svg(a).padding(),p=o*2,q=0,r=0,s=0,t=0,u=$(a).children();u.length>1&&(m=svg(a).gap(),n=(u.length-1)*m);var v=n+p,w=n+p;isNaN(c)&&(c=svg(a).measuredWidth(a.getAttribute("width"))),isNaN(d)&&(d=svg(a).measuredHeight(a.getAttribute("height")));var x=[];for(var y=0;y<u.length;y++){var z=u[y],A=svg(z).explicitWidth(),B=svg(z).explicitHeight();if(!utils.getPercentage(A)){var C=parseInt(A);isNaN(C)?C=svg(z).width():C=parseInt(A),g+=C}else $.inArray(z,x)==-1&&x.push(z),e+=utils.getPercentage(A);if(!utils.getPercentage(B)){var D=parseInt(B);isNaN(D)?D=svg(z).height():D=parseInt(B),h+=D}else $.inArray(z,x)==-1&&x.push(z),f+=utils.getPercentage(B);svg(z).isContainer()&&C==svg(z).measuredWidth()&&D==svg(z).measuredHeight()?svg(z).isDirty(!1):svg(z).isDirty(!0);var E=svg(z).minWidth(),F=svg(z).minHeight();C<E&&!svg(z).isContainer()&&(C=E),D<F&&!svg(z).isContainer()&&(D=F),svg(z).measuredWidth(C),svg(z).measuredHeight(D),!svg(z).isContainer()&&(!isNaN(parseInt(A))||!isNaN(parseInt(B)))&&svg(z).size(C,D),!isNaN(C)&&!utils.getPercentage(A)&&(v+=C),!isNaN(D)&&!utils.getPercentage(A)&&(w+=D),C=0,D=0}var G=x.length;b==layout.LAYOUT_HORIZONTAL?x.sort(function(a,b){return svg(b).minWidth()-svg(a).minWidth()}):b==layout.LAYOUT_VERTICAL&&x.sort(function(a,b){return svg(b).minHeight()-svg(a).minHeight()}),i=c-(g+n)-p,j=d-(h+n)-p,e<100&&(i*=e/100),f<100&&(j*=f/100),k=i,l=j;for(var y=0;y<x.length;y++){var z=x[y],H=utils.getPercentage(svg(z).explicitWidth()),I=utils.getPercentage(svg(z).explicitHeight()),E=svg(z).minWidth(),F=svg(z).minHeight(),C=0,D=0;if(b==layout.LAYOUT_HORIZONTAL)H&&(C=Math.round(H/e*k),C=Math.max(C,E),k-=C,e-=H,q+=C),I&&(j=d-p,D=j*I/100);else if(b==layout.LAYOUT_VERTICAL)I&&(D=Math.round(I/f*l),D=Math.max(D,F),l-=D,f-=I,r+=D),H&&(i=c-p,C=i*H/100);else{var J;H&&(C=c*H/100-p),I&&(D=d*I/100-p);if(H&&I&&svg(z).resizeMode()==svg.RESIZE_ASPECT)if(c>d){if(E>F){J=E/F;var K=C/J;K>d?(J=F/E,C=D/J,svg(z).measuredWidth(C)):(J=E/F,D=C/J,svg(z).measuredHeight(D))}E<F&&(J=F/E,C=D/J,svg(z).measuredWidth(C)),E==F&&(J=E/F,D=C/J,svg(z).measuredHeight(D))}else if(c<d){if(F>E){J=F/E;var L=D/J;L>c?(J=E/F,D=C/J,svg(z).measuredHeight(D)):(J=F/E,C=D/J,svg(z).measuredWidth(C))}F<E&&(J=E/F,D=C/J,svg(z).measuredHeight(D)),E==F&&(J=F/E,C=D/J,svg(z).measuredWidth(C))}else c==d&&(J=F/E,L=D/J,L>c?(J=E/F,D=C/J,svg(z).measuredHeight(D)):(J=F/E,C=D/J,svg(z).measuredWidth(C)))}G>1&&G===y+1&&(s=q-i,t=r-j),b==layout.LAYOUT_HORIZONTAL&&H?C-=s:b==layout.LAYOUT_VERTICAL&&I&&(D-=t),C<E&&!svg(z).isContainer()&&(C=E),D<F&&!svg(z).isContainer()&&(D=F),svg(z).isContainer()&&C==svg(z).measuredWidth()&&D==svg(z).measuredHeight()?svg(z).isDirty(!1):svg(z).isDirty(!0),svg(z).isContainer()||svg(z).size(C,D),H&&(svg(z).measuredWidth(C),v+=C),I&&(svg(z).measuredHeight(D),w+=D),!!isNaN(C),!!isNaN(D)}svg(a).totalWidth(v),svg(a).totalHeight(w),x=null,u=null,z=null},layout.layout=function(a,b){var c=a;FDBK.executeLayoutHelper(a.templateName,a),b&&layout.measureMinSizes(c),layout.measure(c);var d=c.getAttribute("layout");switch(d){case layout.LAYOUT_HORIZONTAL:layout.horizontalLayout(c);break;case layout.LAYOUT_VERTICAL:layout.verticalLayout(c);break;default:layout.defaultLayout(c)}},layout.horizontalLayout=function(a){var b=a.getAttribute("vertical-align"),c=a.getAttribute("horizontal-align"),d=svg(a).gap(),e=svg(a).padding(),f,g,h=$(a).children(),i=svg(a).totalWidth(),j=svg(a).totalHeight();for(var k=0;k<h.length;k++){var l=h[k];if(!svg(l).isUIElement())continue;if(k==0)f=layout.verticalAlign(l,a,b),g=layout.horizontalAlign(l,a,c),svg(l).position(g,f);else{var m=h[k-1],n=svg(m).position().x,o=svg(m).measuredWidth(),p=n+o+d;f=layout.verticalAlign(l,a,b),svg(l).position(p,f)}svg(l).isContainer()&&svg(l).isDirty()&&layout.layout(l)}},layout.verticalLayout=function(a){var b=a.getAttribute("horizontal-align"),c=a.getAttribute("vertical-align"),d=svg(a).gap(),e=svg(a).padding(),f,g,h=$(a).children();for(var i=0;i<h.length;i++){var j=h[i];if(!svg(j).isUIElement())continue;if(i==0)f=layout.horizontalAlign(j,a,b),g=c?layout.verticalAlign(j,a,c):e,svg(j).position(f,g);else{var k=h[i-1],l=svg(k).position().y,m=svg(k).measuredHeight(),n=l+m+d;f=layout.horizontalAlign(j,a,b),svg(j).position(f,n)}svg(j).isContainer()&&svg(j).isDirty()&&layout.layout(j)}},layout.defaultLayout=function(a){var b=a.getAttribute("vertical-align"),c=a.getAttribute("horizontal-align"),d,e,f=$(a).children();for(var g=0;g<f.length;g++){var h=f[g];if(!svg(h).isUIElement())continue;d=layout.horizontalAlign(h,a,c),e=layout.verticalAlign(h,a,b),svg(h).position(d,e),svg(h).isContainer()&&svg(h).isDirty()&&layout.layout(h)}},layout.verticalAlign=function(a,b,c){var d=svg(b).measuredHeight(),e,f=svg(b).padding();switch(c){case layout.ALIGN_VERTICAL_MIDDLE:e=Math.floor((d-svg(a).measuredHeight())/2);break;case layout.ALIGN_VERTICAL_BOTTOM:e=d-svg(a).measuredHeight()-f;break;default:e=f}return e},layout.horizontalAlign=function(a,b,c){var d=svg(b).measuredWidth(),e=0,f=svg(b).padding();switch(c){case layout.ALIGN_HORIZONTAL_CENTER:var g=b.getAttribute("layout");g==layout.LAYOUT_HORIZONTAL?e=(d-svg(b).totalWidth())/2+f:e=Math.floor((d-svg(a).measuredWidth())/2);break;case layout.ALIGN_HORIZONTAL_RIGHT:e=d-svg(b).totalWidth()+f;break;default:e=f}return e},layout.measureMinSizes=function(a){var b=$(a).find("*").get().reverse();$(b).each(function(){if(svg(this).isText()&&!svg.shouldWrap()){var b=parseInt($(this).css("line-height"));this.setAttribute("dy",b)}this.nodeName!="foreignText";var c=$(this).parent()[0];if(!svg(c).isContainer())return;var d=$(c).children().length,e=svg(c).padding()*2,f,g=0,h=0,i=svg(c).minWidth(),j=svg(c).minHeight(),k=svg(c).explicitWidth(),l=svg(c).explicitHeight();d>1&&(g=svg(c).gap(),h=(d-1)*g),f=c.getAttribute("layout"),svg(c).minWidth()==0&&(i=e,f==layout.LAYOUT_HORIZONTAL&&(i+=h),svg(c).minWidth(i)),svg(c).minHeight()==0&&(j=e,f==layout.LAYOUT_VERTICAL&&(j+=h),svg(c).minHeight(j));switch(f){case layout.LAYOUT_HORIZONTAL:i=svg(c).minWidth()+svg(this).minWidth(),j=Math.max(svg(this).minHeight()+e,svg(c).minHeight());break;case layout.LAYOUT_VERTICAL:i=Math.max(svg(this).minWidth()+e,svg(c).minWidth()),j=svg(this).minHeight()+svg(c).minHeight();break;default:i=Math.max(svg(this).minWidth()+e,svg(c).minWidth()),j=Math.max(svg(this).minHeight()+e,svg(c).minHeight())}c!=a&&(!utils.getPercentage(k)&&!isNaN(parseInt(k))&&(i=parseInt(k)),!utils.getPercentage(l)&&!isNaN(parseInt(l))&&(j=parseInt(l))),svg(c).isContainer()&&(svg(c).minWidth(i),svg(c).minHeight(j),svg(c).isStencil()&&(!svg(c).explicitWidth()&&!svg(c).explicitHeight()&&(c.setAttribute("width",i),c.setAttribute("height",j)),parseInt(svg(c).explicitWidth())<i&&(c.setAttribute("width",i),c.setAttribute("measured-width",i)),parseInt(svg(c).explicitHeight())<j&&(c.setAttribute("height",j),c.setAttribute("measured-height",j))))}),b=null},layout.add=function(a,b,c){var d=$(a).appendTo(b)[0];return c||layout.layout(d,!0),d};var MODULE=function(a,b,c,d){var e,f,g=function(){return g};return g.editingStencil=null,g.enterEditMode=function(){if(a.hasSelection()&&c(a.currentMockup.selection[0]).isStencil()&&!b(a.currentMockup.selection[0]).prop("locked")){var d=a.currentMockup.selection[0];a.editor.startEditing(d)}},g.startEditing=function(d){e=null,f=null;if(c(d).isEditable()){var h=a.currentMockup.stencil(d.id),i=FDBK.stencilTemplate(h.name)&&FDBK.stencilTemplate(h.name).multiline;b("#htmlStage").append(i?'<textarea id="editArea">Some data here</textarea>':'<input id="editArea" type="text" value="Some data here"/>'),FDBK.pub("stencil-edit","start",d),g.editingStencil=d;var j=g.getSelectedRect(d);b(d).prev(".stencil").length>0?e=b(d).prev(".stencil")[0]:b(d).next(".stencil").length>0&&(f=b(d).next(".stencil")[0]),b("#editArea").show().css({left:j.x+"px",top:j.y+"px"}).width(Math.max(j.width,FDBK.config("stencilEditor.minTextareaWidth"))).height(Math.max(j.height,FDBK.config("stencilEditor.minTextareaHeight"))).focus().val(h.text).select(),b("#editArea").on("keydown",null,"esc",function(){g.stopEditing(!1)}).on("keydown",null,i?"meta+return ctrl+return":"return meta+return ctrl+return",function(){g.stopEditing(!0)}).on("keydown",null,"tab",function(a){return a.shiftKey?utils.untab(b(this)[0]):utils.tab(b(this)[0]),!1})}},g.stopEditing=function(h){var i=b("#editArea");if(i.is(":visible")){i.remove();var j=g.editingStencil;if(h){var k=b(j).attr("name"),l=a.currentMockup.stencil(j.id),m=b.extend(!0,{},l),n=i.val();if(n!==l.text){a.currentMockup.undo.startGroup("Edit Stencil"),a.removeStencil(j,{},{forward:!1}),l.text=n;var o={x:c(j).position().x,y:c(j).position().y,width:c(j).measuredWidth(),height:c(j).measuredHeight()},p=o;j=a.addStencilFinal({type:"stencil",templateName:k,data:l},{forward:!1}),a.orderStencil(j,{before:e,after:f},{forward:!1}),b(j).focus();var q=c(j).minWidth(),r=c(j).minHeight();if(o.width<q||c.resetSizeOnEdit())p.width=q;if(o.height<r||c.resetSizeOnEdit())p.height=r;a.resizeStencil(j,{width:p.width,height:p.height,top:p.y,left:p.x},{forward:!1}),l=a.currentMockup.stencil(l.id);var s=a.currentMockup.indexOfStencil(l.id);a.replaceStencilCollab(a.currentMockup.id,l,m,s),a.currentMockup.undo.endGroup(),d.layout(j,!1)}}a.hasSelection()||FDBK.pub("stencil-edit","end",j)}g.editingStencil=null},FDBK.sub("stencil-edit",function(a,b){a==="start"?this.clearSelection():a==="end"&&this.selectElement(b)},a),g.getSelectedRect=function(a){var b={x:c(a).position().x,y:c(a).position().y,width:c(a).width(),height:c(a).height()};return isNaN(c(a).measuredWidth())||(b.width=c(a).measuredWidth(),b.height=c(a).measuredHeight()),b},g.iconLookup=function(){function c(a,b){return a.substring(0,b.selectionStart).match(/.+[\w]+$/)}function d(a,b){if(a.setSelectionRange)a.setSelectionRange(b,b);else if(a.createTextRange){var c=a.createTextRange();c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",b),c.select()}}var a=["icon-glass","icon-music","icon-search","icon-envelope","icon-heart","icon-star","icon-star-empty","icon-user","icon-film","icon-th-large","icon-th","icon-th-list","icon-ok","icon-remove","icon-zoom-in","icon-zoom-out","icon-off","icon-signal","icon-cog","icon-trash","icon-home","icon-file","icon-time","icon-road","icon-download-alt","icon-download","icon-upload","icon-inbox","icon-play-circle","icon-repeat","icon-refresh","icon-list-alt","icon-lock","icon-flag","icon-headphones","icon-volume-off","icon-volume-down","icon-volume-up","icon-qrcode","icon-barcode","icon-tag","icon-tags","icon-book","icon-bookmark","icon-print","icon-camera","icon-font","icon-bold","icon-italic","icon-text-height","icon-text-width","icon-align-left","icon-align-center","icon-align-right","icon-align-justify","icon-list","icon-indent-left","icon-indent-right","icon-facetime-video","icon-picture","icon-pencil","icon-map-marker","icon-adjust","icon-tint","icon-edit","icon-share","icon-check","icon-move","icon-step-backward","icon-fast-backward","icon-backward","icon-play","icon-pause","icon-stop","icon-forward","icon-fast-forward","icon-step-forward","icon-eject","icon-chevron-left","icon-chevron-right","icon-plus-sign","icon-minus-sign","icon-remove-sign","icon-ok-sign","icon-question-sign","icon-info-sign","icon-screenshot","icon-remove-circle","icon-ok-circle","icon-ban-circle","icon-arrow-left","icon-arrow-right","icon-arrow-up","icon-arrow-down","icon-share-alt","icon-resize-full","icon-resize-small","icon-plus","icon-minus","icon-asterisk","icon-exclamation-sign","icon-gift","icon-leaf","icon-fire","icon-eye-open","icon-eye-close","icon-warning-sign","icon-plane","icon-calendar","icon-random","icon-comment","icon-magnet","icon-chevron-up","icon-chevron-down","icon-retweet","icon-shopping-cart","icon-folder-close","icon-folder-open","icon-resize-vertical","icon-resize-horizontal"];b("#editArea").autocomplete({position:{my:"right top",at:"right bottom"},source:function(d,e){var f=c(d.term,b("#editArea")[0]);f=f!==null?f[0]:"",e(b.ui.autocomplete.filter(a,f))},focus:function(){return!1},select:function(a,b){var e=c(this.value,this)[0],f=this.value.substring(0,this.selectionStart-e.length);this.value=f+b.item.value+this.value.substring(this.selectionStart,this.value.length);var g=f.length+b.item.value.length;return d(this,g),!1},search:function(a,b){var d=c(this.value,this);return d!==null}})},a.editor=g,a}(MODULE||{},jQuery,svg,layout),BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(a){for(var b=0;b<a.length;b++){var c=a[b].string,d=a[b].prop;this.versionSearchString=a[b].versionSearch||a[b].identity;if(c){if(c.indexOf(a[b].subString)!=-1)return a[b].identity}else if(d)return a[b].identity}},searchVersion:function(a){var b=a.indexOf(this.versionSearchString);if(b==-1)return;return parseFloat(a.substring(b+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,versionSearch:"OPR",subString:"OPR",identity:"Opera"},{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Linux",identity:"Linux"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone"},{string:navigator.userAgent,subString:"iPad",identity:"iPad"}]};BrowserDetect.init(),BrowserDetect.browser=="Chrome"&&BrowserDetect.version>15||BrowserDetect.browser=="Firefox"&&BrowserDetect.version>9||BrowserDetect.browser=="Safari"&&BrowserDetect.version>5||BrowserDetect.browser=="Opera"&&BrowserDetect.version>15||(BrowserDetect.unsupportedBrowser=!0),BrowserDetect.OS=="iPhone"||BrowserDetect.OS=="iPad"||BrowserDetect.OS=="Mac"?($("html").addClass("mac"),BrowserDetect.isMac=!0):BrowserDetect.OS=="Windows"?$("html").addClass("windows"):BrowserDetect.OS=="Linux"&&$("html").addClass("linux"),BrowserDetect.browser=="Chrome"?$("html").addClass("chrome"):BrowserDetect.browser=="Firefox"?$("html").addClass("firefox"):BrowserDetect.browser=="Safari"?$("html").addClass("safari"):BrowserDetect.browser=="Opera"&&$("html").addClass("opera");var MODULE=function(a,b){b("body").on("click","#group-button",function(){if(b(this).hasClass("disabled")||FDBK.library.$ghost.hasClass("locked"))return;var d={x:a.$ghost.position().left,y:a.$ghost.position().top,width:a.$ghost.width(),height:a.$ghost.height()};a.isSingleSelection()&&a.isGroup(a.currentMockup.selection[0])?c(a.ungroupStencils(a.currentMockup.selection[0].id)):c(a.groupStencils(a.currentMockup.selection,{rect:d}))}),b(document).on("keydown",null,"meta+g ctrl+g",function(){var d;return b("#group-button").hasClass("disabled")||a.$ghost.hasClass("locked")?!1:(b("#group-button").hasClass("active")?(d={x:a.$ghost.position().left,y:a.$ghost.position().top,width:a.$ghost.width(),height:a.$ghost.height()},c(a.ungroupStencils(a.currentMockup.selection[0].id))):(d={x:a.$ghost.position().left,y:a.$ghost.position().top,width:a.$ghost.width(),height:a.$ghost.height()},c(a.groupStencils(a.currentMockup.selection,{rect:d}))),!1)});var c=function(b){a.currentMockup.selection=[].concat(b),a.showSelection()},d=function(a,c){var d=b(a).attr("class").split(" "),g=c?f:e,h=[];for(var i=0;i<d.length;i++)d[i]==e||d[i]==f?h.push(g):h.push(d[i]);b(a).attr("class",h.join(" "))},e="stencil",f="stencil-grouped",g="group";return a.setClassGrouped=d,a.isGroup=function(a){var c=b(a).attr("class").split(" ");return c.indexOf(g)!==-1},a.isGrouped=function(a){var c=b(a).attr("class").split(" ");return c.indexOf(f)!==-1},a}(MODULE||{},jQuery),MODULE=function(a,b,c,d){a.moveStencil=function(b,d,g){var h=utils.stencil(b);if(!h)return;var i=FDBK.library.currentMockup.stencil(utils.stencilId(h));if(d.comesFromUndoManager&&!f(i.id))return;var j=i.left,k=i.top;c(h).position(d.left,d.top),g=e(g),g.forward&&FDBK.pub("collab-move-resize-stencil",FDBK.library.currentMockup.id,h.id,{top:d.top,left:d.left}),g.updateModel&&(a.currentMockup.updateStencil(h.id,{top:d.top,left:d.left}),FDBK.pub("move-stencil",h.id)),d.comesFromUndoManager===!0&&a.showSelection(),g.undoable&&a.currentMockup.undo.undoable("Move element",a.moveStencil,[h.id,{left:j,top:k,comesFromUndoManager:!0}])},a.resizeStencil=function(b,g,h){var i=utils.stencil(b);if(!i)return;var j=a.currentMockup.stencil(i.id);h=e(h);if(g.comesFromUndoManager&&!f(j.id))return;h.undoable&&a.currentMockup.undo.undoable("Resize element",a.resizeStencil,[i.id,{width:j.width,height:j.height,top:j.top,left:j.left,comesFromUndoManager:!0},{forward:h.forward}]),g.width=g.width===undefined?j.width:g.width,g.height=g.height===undefined?j.height:g.height,g.top=g.top===undefined?j.top:g.top,g.left=g.left===undefined?j.left:g.left,c(i).size(g.width,g.height),c(i).position(g.left,g.top),j.type=="stencil"&&d().layout(i,!1),h.updateModel&&(a.currentMockup.updateStencil(i.id,{top:g.top,left:g.left,width:g.width,height:g.height}),FDBK.pub("resize-stencil",i.id)),g.comesFromUndoManager===!0&&a.showSelection(),h.forward&&FDBK.pub("collab-move-resize-stencil",FDBK.library.currentMockup.id,i.id,{top:g.top,left:g.left,width:g.width,height:g.height})},a.addStencilFinal=function(f,g){g=e(g),f.templateName=f.templateName||(f.type==="group"?"tmplsvg-group-stencil":null),f.data=f.data||FDBK.getStencilTemplateDefaultData(f.templateName);var h=FDBK.getStencilDOM(f.templateName,f.data),i=FDBK.stencilTemplate(f.templateName),j=i?i.version||"1.0":"1.0";if(f.data.id&&FDBK.library.currentMockup.stencil(f.data.id)){console.error("Trying to add stencil with existing id");return}f.targetGroup&&(f.target=b("#"+f.targetGroup)),f.target=f.target||a.getActiveMockup();var k=d.add([h],f.target);f.targetGroup?a.setClassGrouped(k,!0):a.setClassGrouped(k,!1);var l=c(k).position();if(g.updateModel){var m=f.data.stencils;delete f.data.stencils;var n=c(k).measuredWidth(),o=a.currentMockup.addStencil(b.extend(!0,{},f.data,{type:f.type,name:f.templateName,version:j,left:l.x,top:l.y,width:c(k).measuredWidth(),height:c(k).measuredHeight()}),f.targetGroup);k.id=o,f.data.left!==undefined&&f.data.top!==undefined&&f.data.width!==undefined&&f.data.height!==undefined&&FDBK.library.resizeStencil(o,{width:f.data.width,height:f.data.height,top:f.data.top,left:f.data.left},{forward:!1,undoable:!1}),f.checkSize===!0&&c(k).resizeMode()==c.RESIZE_NONE&&!isNaN(n)&&setTimeout(function(){var a=c(k).measuredWidth();a>=f.data.width&&FDBK.library.resizeStencil(o,{width:a},{undoable:!1})},0),g.undoable&&a.currentMockup.undo.undoable("Remove Stencil",a.removeStencil,[k.id,{},{forward:g.undoForwardable===undefined?g.forward:g.undoForwardable}]);if(f.type=="group"&&m&&m.length>0){var p,q,r=0;for(var s=m.length-1;s>=0;s--)p=m[s],substencilElem=a.addStencilFinal({type:p.type,templateName:p.name,data:p,targetGroup:o},{forward:!1,undoable:!1}),r=Math.max(r,c(substencilElem).position().x+c(substencilElem).measuredWidth());f.checkSize===!0&&r>f.data.width&&setTimeout(function(){FDBK.library.resizeStencil(o,{width:r,height:f.data.height,top:f.data.top,left:f.data.left},{undoable:!1})},0)}g.forward&&FDBK.pub("collab-add-stencil",a.currentMockup.id,k.id,f.targetGroup),FDBK.pub("add-stencil",k.id)}return k},a.removeStencil=function(c,d,g){var h=FDBK.library.currentMockup;d=d||{},d&&d.mockupId&&(h=FDBK.library.currentProject.mockup(d.mockupId));var i=utils.stencil(c);if(!i||!h)return;var j=h.stencil(i.id);g=e(g);if(!f(j.id,h))return;var k=b(i).prev(".stencil")[0],l=b(i).next(".stencil")[0],m=b.extend(!0,{},j);if(g.undoable){var n;a.isGrouped(i)&&b(i).parent(".stencil").length>0&&(n=b(i).parent(".stencil")[0].id),h.undo.startGroup("Add Stencil"),h.undo.undoable("Stack Stencil",a.orderStencil,[utils.stencilId(i),{before:utils.stencilId(k),after:utils.stencilId(l)},{forward:g.undoForwardable===undefined?g.forward:g.undoForwardable}]),h.undo.undoable("Add stencil",a.addStencilFinal,[{type:m.type,templateName:m.name,data:m,targetGroup:n},{forward:g.undoForwardable===undefined?g.forward:g.undoForwardable}]),h.undo.endGroup()}g.forward&&FDBK.pub("collab-remove-stencil",h.id,i.id),FDBK.library.editor.editingStencil&&FDBK.library.editor.editingStencil.id==i.id&&FDBK.library.editor.stopEditing(!1);if(g.updateModel){var o=h.substencils(i.id);h.removeStencil(i.id),FDBK.pub("remove-stencil",o.map(function(a){return a.id}))}b(i).remove(),d.ignoreSelection=d.ignoreSelection||!1,!d.ignoreSelection&&h.selection.indexOf(i)!==-1&&a.clearSelection()},a.groupStencils=function(b,c,d){d=e(d);var g=[],h=[],i,j,k=c.rect||{},l=b.slice(0);d.undoable&&a.currentMockup.undo.startGroup("Group stencils");for(var m=l.length-1;m>=0;m--){i=utils.stencil(l[m]);if(!i)continue;if(!f(i.id))continue;j=FDBK.library.currentMockup.stencil(i.id),a.removeStencil(i.id,{},d),j.top-=k.y,j.left-=k.x,g.push(j)}var n=a.addStencilFinal({type:"group",templateName:"tmplsvg-group-stencil",data:{top:k.y,left:k.x,width:k.width,height:k.height,stencils:g}},d);return d.undoable&&a.currentMockup.undo.endGroup(),n},a.ungroupStencils=function(b,c,d){d=e(d);var g=utils.stencil(b);if(!g)return;var h=FDBK.library.currentMockup.stencil(g.id),i=[];if(!f(h.id))return;d.undoable&&a.currentMockup.undo.startGroup("Ungroup Stencils"),FDBK.library.removeStencil(g.id,d);if(!h.stencils)return;var j;for(var k=h.stencils.length-1;k>=0;k--)j=h.stencils[k],j.top+=h.top,j.left+=h.left,g=FDBK.library.addStencilFinal({type:j.type,templateName:j.name,data:j},d),i.push(g);return d.undoable&&a.currentMockup.undo.endGroup(),i},a.lockStencil=function(c,d,f){var g=utils.stencil(c);if(!g)return;var h=b(g),i=FDBK.library.currentMockup.stencil(g.id);f=e(f);if(d&&d.comesFromUndoManager&&FDBK.library.currentMockup.groupedStencils[c]!==undefined)return;var j=h.prop("locked")?!1:!0;d&&d.lock!==undefined&&(j=d.lock),j?h.prop("locked","true"):h.removeProp("locked"),f.forward&&FDBK.pub("collab-lock-stencil",FDBK.library.currentMockup.id,g.id,j),f.updateModel&&a.currentMockup.updateStencil(g.id,{locked:j}),f.undoable&&a.currentMockup.undo.undoable("Lock Stencil",a.lockStencil,[g.id,{lock:!j,comesFromUndoManager:!0}])},a.linkStencil=function(b,c,d){var f=utils.stencil(b);if(!f)return;var g=FDBK.library.currentMockup.stencil(utils.stencilId(f));d=e(d),d.undoable&&a.currentMockup.undo.undoable("Link Stencil",a.linkStencil,[f.id,{link:g.link}]),d.forward&&FDBK.pub("collab-link-stencil",FDBK.library.currentMockup.id,f.id,c.link),d.updateModel&&(a.currentMockup.updateStencil(f.id,{link:c.link}),FDBK.pub("link-stencil",f.id,c.link))},a.updateStencil=function(c,d,e){var f=a.currentProject.mockup(c),g=b.extend(!0,{},f.stencil(d));f.updateStencil(d,e);var h=b.extend(!0,{},f.stencil(d)),i=f.indexOfStencil(d);a.replaceStencilCollab(c,h,g,i)},a.updateStencilIndex=function(a,b,c){if(!f(a.id))return;FDBK.library.currentMockup.changeStencilIndex(a.id,b);var d=FDBK.library.currentMockup.stencilList();before=d[b+1]?d[b+1].id:undefined,after=d[b-1]?d[b-1].id:undefined,FDBK.library.orderStencil(a.id,{before:before,after:after},c)},a.orderStencil=function(c,d,g){var h=utils.stencil(c);if(!h)return;model=FDBK.library.currentMockup.stencil(utils.stencilId(h)),currentIndex=FDBK.library.currentMockup.indexOfStencil(h.id);if(!f(model.id))return;g=e(g),before=utils.stencil(d.before),after=utils.stencil(d.after),before?(b(before).after(h),g.updateModel&&a.currentMockup.stackStencil(utils.stencilId(h),"before",utils.stencilId(before))):after&&(b(after).before(h),g.updateModel&&a.currentMockup.stackStencil(utils.stencilId(h),"after",utils.stencilId(after))),!g.undoable,g.forward&&FDBK.pub("collab-order-stencil",FDBK.library.currentMockup.id,h.id,currentIndex)},a.addMockup=function(b,c){c=e(c),b=b||{};var d=a.currentProject,f=b.props||{},g=b.shouldRenameAfterCreating||!1,h=b.switchToMockup===undefined?!0:b.switchToMockup,i=d.mockupList().map(function(a){return a.name}),j=f.isMaster?FDBK.loc("_Untitled Master"):FDBK.loc("_Untitled Page");f.name=f.name||utils.uniqueName(j,i);var k=d.addMockup(f),l=d.mockup(k),m=!h;return a.addMockupUI(l,g,m),h&&(a.changeActiveMockup(k,!0),a.renderCurrentMockup(f.duplicateFrom),a.isMockupRendered(k)||a.setMockupRendered(k,!0)),FDBK.pub("project-changed","add",k),l.isMaster&&FDBK.pub("masters-changed"),c.forward&&FDBK.pub("collab-add-mockup",k),k},a.removeMockup=function(c,d,f){f=e(f);var g=a.currentMockup.id,h=a.currentProject.mockup(c);b("#"+c).remove();var i=a.currentProject.indexOfMockup(c),j=i;i==a.currentProject.mockupList().length-1?j=i-1:i<1&&(j=0),a.removeMasterFromAllPages(c);var k=a.currentProject.childPages(c);for(var l=0;l<k.length;l++)a.setMockupParent(k[l].id,{parentId:h.parent||null},f);(!d||!d.remote)&&a.currentProject.cleanUpLinks(c),f.forward&&FDBK.pub("collab-remove-mockup",c);var m=h.isMaster;a.currentProject.removeMockup(c),a.setMockupRendered(c,!1),d&&d.remote&&g!=c&&(j=a.currentProject.indexOfMockup(a.currentMockup.id));if(a.currentProject.mockupList().length===0)return;a.changeActiveMockup(a.currentProject.mockupList()[j].id),FDBK.pub("project-changed","remove",c),m&&FDBK.pub("masters-changed"),a.refreshProjectStructure()},a.updateMockupName=function(b,c,d){d=e(d);var f=a.currentProject.mockup(b);a.currentProject.updateMockup(b,{name:c.value}),a.pageListItemForMockup(b).find(".mockup-name").text(c.value).prop("title",c.value),FDBK.pub("project-changed","rename",b),FDBK.pub("mockup-renamed",f),FDBK.pub("renamed-mockup",{mockup:b,value:c.value}),f.isMaster&&FDBK.pub("masters-changed"),d.forward&&FDBK.pub("collab-rename-mockup",b)},a.setMockupParent=function(b,c,d){d=e(d);var f=a.currentProject.mockup(b),g=c.updateStructure||!1;d.updateModel&&(f.parent=c.parentId),d.forward&&FDBK.pub("collab-mockup-set-parent",b,c.parentId),g&&a.refreshProjectStructure()},a.changeMockupOrder=function(b,c,d){d=e(d),d.forward&&FDBK.pub("collab-sort-mockup",b,c.index);var f=FDBK.library.currentProject.indexOfMockup(b),g=c.skipRefresh||!1;FDBK.library.currentProject.mockups.splice(c.index,0,FDBK.library.currentProject.mockups.splice(f,1)[0]),g||a.refreshProjectStructure(),FDBK.pub("project-changed","order")},a.convertMasterToNormalPage=function(b,c){c=e(c);var d=a.currentProject.mockup(b);d.isMaster=!1,a.removeMasterFromAllPages(d.id),a.moveMockupSVG(d),FDBK.pub("masters-changed"),d.id==a.currentMockup.id&&FDBK.pub("mockup-changed",d),c.forward&&FDBK.pub("collab-mockup-convert-normal",b)},a.convertNormalToMasterPage=function(b,c){c=e(c);var d=a.currentProject.mockup(b);d.isMaster=!0;var f=d.master;d.parent&&a.setMockupParent(b,{parentId:null},c);var g=a.currentProject.childPages(b);for(var h=0;h<g.length;h++)a.setMockupParent(g[h].id,{parentId:null},c);f&&a.setMasterForMockup(b,{master:null}),a.moveMockupSVG(d),FDBK.pub("masters-changed"),d.id==a.currentMockup.id&&(f?a.changeActiveMockup(a.currentMockup.id):FDBK.pub("mockup-changed",a.currentMockup)),c.forward&&FDBK.pub("collab-mockup-convert-master",b)},a.setMasterForMockup=function(b,c,d){d=e(d);var f=a.currentProject.mockup(b),g=f.master;f.master=c.master,f.id==a.currentMockup.id&&a.changeActiveMockup(f.id),FDBK.pub("masters-changed"),d.forward&&FDBK.pub("collab-mockup-set-master",b,c.master),d.undoable&&f.undo.undoable("Change Page Master",a.setMasterForMockup,[b,{master:g}])},a.updateProjectName=function(c,d){d=e(d),c.value=c.value||FDBK.loc("_Untitled Project"),a.currentProject.name=c.value,a.setProjectTitle(c.value),b("#project-title-input").val(c.value),FDBK.pub("project-renamed",a.currentProject.name),d.forward&&FDBK.pub("collab-rename-project")};var e=function(a){return a=a||{},a.updateModel===undefined&&(a.updateModel=!0),a.undoable===undefined&&(a.undoable=!0),a.forward===undefined&&(a.forward=!0),a},f=function(a,b){return b=b||FDBK.library.currentMockup,b.groupedStencils[a]?!1:b.stencil(a).locked?!1:!0};return a}(MODULE||{},jQuery,svg,layout);(function(a){var b=a.AnimatedIntro=function(a){return this.initialize(a||{})};b.PATH=a.CSS_BASE_URL+"images/animated-intro/",b.prototype.initialize=function(c){this.path=b.PATH,a.bindToInstance(this,["next","previous","close","show","showLandingPage","setIndex","showTutorial"]),this.images=[{caption:"Adding stencils to page",description:"Drag & drop any stencil from the left sidebar",src:"add-stencil.gif"},{caption:"Editing the content of your stencils",description:"Double-click to edit the text of your stencils",src:"edit-stencil.gif"},{caption:"Customizing a stencil's appearance",description:"Click to select the stencil and then click again to inspect its properties",src:"customize-stencil.gif"},{caption:"Aligning stencils",description:"Use the align presets to quickly tidy up your mockup",src:"align-stencils.gif"},{caption:"Arranging stencils",description:"Change the order of your stencils by using the <em>Arrange</em> menu or the keyboard shortcuts",src:"arrange-stencils.gif"},{caption:"Copying & pasting styles",description:"Here's how to quickly apply one stencil's style to another stencil",src:"copy-styles.gif"},{caption:"Adding images",description:"Drag & drop images directly from your desktop!",src:"drag-drop-images.gif"}]},b.prototype.show=function(){this.setIndex(0),this.view=new Ractive({template:"#tmpl-animated-intro",el:"ractive-el",data:{path:this.path,image:this.currentImage,index:this.index,total:this.images.length}}),this.view.on({next:this.next,previous:this.previous,close:this.close})},b.prototype.showLandingPage=function(){this.setIndex(0),this.view=new Ractive({template:"#tmpl-landing-page",el:"ractive-el",data:{path:this.path}}),this.view.on({showTutorial:this.showTutorial,close:this.close})},b.prototype.showTutorial=function(){this.close(),this.show()},b.prototype.next=function(){return this.setIndex(Math.min(this.images.length-1,this.index+1)),this.render(),!1},b.prototype.previous=function(){return this.setIndex(Math.max(0,this.index-1)),this.render(),!1},b.prototype.setIndex=function(a){this.index=a,this.currentImage=this.images[this.index]},b.prototype.render=function(a){this.view.set("image",this.currentImage),this.view.set("index",this.index)},b.prototype.close=function(){this.view&&this.view.teardown()}})(FDBK);var MODULE=function(a,b,c){function l(c){b("#create-link").addClass("disabled"),c&&c.length?(b("#lock-button, #create-selection-hotspot").removeClass("disabled"),d.removeClass("multiple group small-stencil").find(".ghost-guide").remove(),a.isMultiSelection()?(b("#group-button").removeClass("disabled"),b("#group-button").removeClass("active"),d.addClass("multiple").append(a.ghostGuidesForStencils(c))):(a.isGroup(c[0])?(d.addClass("group"),b("#group-button").removeClass("disabled"),b("#group-button").addClass("active")):(d.removeClass("group").find(".stencil-guide-ghost").remove(),b("#group-button").addClass("disabled"),b("#group-button").removeClass("active"),b("#create-link").removeClass("disabled")),a.isLocked(c[0])&&b("#group-button").addClass("disabled")),b("#arrange-button").removeClass("disabled"),b(c[0]).prop("locked")?(b("#align-button").addClass("disabled"),b("#lock-button").addClass("active"),d.addClass("locked").draggable("disable").resizable("disable")):(b("#align-button").removeClass("disabled"),b("#lock-button").removeClass("active"),d.removeClass("locked").draggable("enable").resizable("enable"))):(b("#lock-button, #group-button").removeClass("active"),b("#lock-button, #group-button, #align-button, #arrange-button, #create-selection-hotspot").addClass("disabled"))}function s(b){var c=b.map(function(b){return a.currentMockup.stencil(b.id)}),d={top:null,left:null,width:null,height:null};for(var e=0;e<c.length;e++)for(var f in d)d[f]===null?d[f]=c[e][f]:d[f]!==""&&d[f]!==c[e][f]&&(d[f]="");p.value=d.left,q.value=d.top,n.value=d.width,o.value=d.height}function x(a){var b=e.offset(),c=i[0];j={x:a.clientX-b.left,y:a.clientY-b.top,offsetLeft:b.left+c.scrollLeft,offsetTop:b.top+c.scrollTop,wrapper:c},w.style.top=j.y+"px",w.style.left=j.x+"px",w.style.width=0,w.style.height=0,w.className="active"}function C(){for(var b=0;b<a.currentMockup.selection.length;b++){var c=a.currentMockup.selection[b];a.lockStencil(c)}I()}function D(){a.currentMockup&&(d.removeData("svgElem").hide(),b(".annotation-handle").hide(),a.currentMockup.selection.length=0,FDBK.pub("selection-changed",a.currentMockup.selection),K(),N[0].stencilId=N[0].panelId=null)}function E(){if(a.isSingleSelection())return;a.currentMockup.selection.sort(function(a,c){return b(a).index()-b(c).index()})}function G(a,b){return!(b.left>a.right||b.right<a.left||b.top>a.bottom||b.bottom<a.top)}function H(b){var c=!1;for(var d=0;d<a.currentMockup.selection.length;d++)if(b==a.currentMockup.selection[d]){c=!0;break}return c}function I(){if(!FDBK.allowSelection())return;for(var e=0;e<a.currentMockup.selection.length;e++){var f=a.currentMockup.selection[e];if(!document.getElementById(f.id)){a.currentMockup.selection=[];break}}if(a.isMultiSelection()){var g=[],h=[];for(var i=0;i<a.currentMockup.selection.length;i++)b(a.currentMockup.selection[i]).prop("locked")?g.push(a.currentMockup.selection[i]):h.push(a.currentMockup.selection[i]);h.length&&(a.currentMockup.selection=h)}if(a.hasSelection()){var j={left:Number.MAX_VALUE,top:Number.MAX_VALUE,right:Number.MIN_VALUE,bottom:Number.MIN_VALUE};for(var i=0;i<a.currentMockup.selection.length;i++){var k=L(a.currentMockup.selection[i]);j.left=Math.min(j.left,k.left),j.top=Math.min(j.top,k.top),j.right=Math.max(j.right,k.right),j.bottom=Math.max(j.bottom,k.bottom)}d.data("svgElem",a.currentMockup.selection),d.css({width:j.right-j.left+"px",height:j.bottom-j.top+"px",left:j.left,top:j.top,display:"block"});if(a.isSingleSelection()){var l=a.currentMockup.selection[0],m=c(l).resizeMode();switch(m){case c.RESIZE_HORIZONTAL:d.resizable("option","handles","e, w, e-side, w-side"),d.resizable("option","aspectRatio",!1);break;case c.RESIZE_VERTICAL:d.resizable("option","handles","n, s, n-side, s-side"),d.resizable("option","aspectRatio",!1);break;case c.RESIZE_ASPECT:d.resizable("option","handles","ne, nw, se, sw"),d.resizable("option","aspectRatio",!0);break;case c.RESIZE_ALL:d.resizable("option","handles","ne, nw, se, sw, n-side, s-side, w-side, e-side"),d.resizable("option","aspectRatio",!1);break;case c.RESIZE_NWSE:d.resizable("option","handles","nw, se"),d.resizable("option","aspectRatio",!1);break;case c.RESIZE_NESW:d.resizable("option","handles","ne, sw"),d.resizable("option","aspectRatio",!1);break;case c.RESIZE_NONE:d.resizable("option","handles"," ");break;case c.RESIZE_LINE:d.resizable("option","handles"," "),J()}d.resizable("option","minWidth",c(a.currentMockup.selection[0]).minWidth()),d.resizable("option","minHeight",c(a.currentMockup.selection[0]).minHeight());var n=d.data("resizable").options;d.resizable("destroy"),d.resizable(n);var o=d.attr("class").split(/\s+/),p=/^ghost-for-/;for(i=0;i<o.length;i++){var q=o[i];q.match(p)&&d.removeClass(q)}d.addClass(b(l).attr("class").split(" ").map(function(a){return"ghost-for-"+a}).join(" "))}FDBK.pub("selection-changed",a.currentMockup.selection)}else D()}function J(){var d=a.isSingleSelection()?a.currentMockup.selection[0]:null;if(d&&a.isAnnotation(d)&&!a.isLocked(d)){var e=b(d).find("line")[0];if(e){b(".annotation-handle").show(),b(".annotation-handle").removeClass("hide");var f=c(d).position(),g=c(e).linePosition(),h=b("#annotation-handle-1").outerWidth()/2;b("#annotation-handle-1").css({left:f.x+g.x1-h+"px",top:f.y+g.y1-h+"px"}),b("#annotation-handle-2").css({left:f.x+g.x2-h+"px",top:f.y+g.y2-h+"px"}),b("#annotation-handle-1").data("svgElem",[d]),b("#annotation-handle-2").data("svgElem",[d])}}else K()}function K(){b(".annotation-handle").addClass("hide")}function L(b){var c=a.currentMockup.stencil(b.id),d={left:c.left,top:c.top,right:c.left+c.width,bottom:c.top+c.height};return d}function M(a){var b={};return b.left=parseInt(a.css("left"),10),b.top=parseInt(a.css("top"),10),b.right=b.left+a.outerWidth(),b.bottom=b.top+a.outerHeight(),b}a.animatedIntro=new FDBK.AnimatedIntro,BrowserDetect.unsupportedBrowser&&b("#preloader").append('<h1>Moqups is a stunning HTML5 App for creating high fidelity SVG mockups, wireframes and clickable prototypes!</h1><p>It works great with the latest version of <a href="https://www.google.com/chrome">Chrome</a>, <a href="http://www.mozilla.org/en-US/firefox/new/">Firefox</a> or <a href="http://www.apple.com/safari/download/">Safari</a>.</p><span onclick="$(this).parent().remove();">Unfortunatelly your browser is not supported at the moment. <a href="#">Whatever, I\'ll take my chances!</a></span>'),window.top&&window.self&&window.top!==window.self&&(window.top.location=window.self.location);var d=b("#ghost"),e=a.$htmlStage=b("#htmlStage"),f=b("#svgObject"),g=b("#inspector"),h=b(".stencilInspectButton"),i=b("#project-wrapper"),j,k;a.delayAction=function(){var a=0;return function(b,c){clearTimeout(a),a=setTimeout(b,c)}}(),b(window).focus(function(){FDBK.pub("window-focus")}),b(window).blur(function(){FDBK.pub("window-blur")}),a.chromeBadge={shouldShow:function(){var c=window.chrome&&BrowserDetect.browser!="Opera"&&(!window.chrome.app||!window.chrome.app.isInstalled)&&b.cookie("chromeBadge")!=="0"&&a.getUserSettings("chromeBadge")!=="0";return c},show:function(){if(this.shouldShow()){var a=this;b("#chrome-badge").fadeIn("fast").on("click",".close",function(){return a.hide(),!1}).on("click",".install",function(){return a.install(b(this).data("trigger")),!1})}},install:function(a){var c=this;if(chrome&&chrome.webstore){var d=b("link[rel=chrome-webstore-item]:first").attr("href");d&&chrome.webstore.install(d,function(){c.hide(),b("#footer").find(".add-to-chrome").remove(),b("#welcome-dialog").is(":visible")?b("#welcome-content").html(b("#tmpl-welcome-installed").loc_tmpl()):b("#welcome-content").html(b("#tmpl-welcome-other").loc_tmpl()),FDBK.pub("chrome-install",a)},function(){})}},hide:function(){b("#chrome-badge").fadeOut("fast",function(){b.cookie("chromeBadge","0"),a.setUserSettings("chromeBadge","0")})},reset:function(){b.cookie("chromeBadge",null),a.setUserSettings("chromeBadge",null)},init:function(){var a=this;window.chrome&&BrowserDetect.browser!="Opera"&&(!window.chrome.app||!window.chrome.app.isInstalled)?(b(".add-to-chrome").show(),b(document).on("click",".add-to-chrome",function(){return a.install(b(this).data("trigger")),!1}),b("#welcome-content").html(b("#tmpl-welcome-chrome").loc_tmpl())):(b(".add-to-chrome").hide(),b("#welcome-content").html(b("#tmpl-welcome-other").loc_tmpl())),this.show()}},a.downtimeWarning={show:function(){if(FDBK.DOWNTIME_WARNING&&!b.cookie("ignoreDW")){var a=this;b("#downtime-warning").fadeIn("fast").on("click",".close",function(){return a.hide(),!1})}},hide:function(){b("#downtime-warning").fadeOut("fast",function(){b.cookie("ignoreDW","1")})}},b(document).ajaxStart(function(){a.inProgressRequest=!0,a.delayAction(function(){a.inProgressRequest&&b("html").addClass("ajax")},2e3)}).ajaxStop(function(){a.inProgressRequest=!1,b("html").removeClass("ajax")}),a.hasSelection=function(){return a.currentMockup&&a.currentMockup.selection?a.currentMockup.selection.length>0:!1},a.isSingleSelection=function(){return a.currentMockup&&a.currentMockup.selection?a.currentMockup.selection.length==1:!1},a.isMultiSelection=function(){return a.currentMockup&&a.currentMockup.selection?a.currentMockup.selection.length>1:!1},a.selectElement=function(b,c){if(!FDBK.allowSelection())return;a.currentMockup.selection=[b],I(),c&&a.inspectorState.act("forceShow")},a.toggleElementFromSelection=function(b){var c=a.currentMockup.selection,d=c.map(function(a){return a.id}).indexOf(b.id);d===-1?c.push(b):c.splice(d,1)},a.focusArea="stage",a.isArea=function(b){return b==a.focusArea},a.getAllVisibleStencils=function(){return f.find(a.shouldShowHotspots()?".active-mockup .stencil":'.active-mockup .stencil:not([name="tmplsvg-hotspot"])')},a.ghostGuidesForStencils=function(b){var c="<div class='ghost-guide' style='width:{w}px;height:{h}px;top:{t}px;left:{l}px;'></div>",e=[],f,g,h,i,j,k=d.position();for(var l=0;l<b.length;l++)f=a.currentMockup.stencil(b[l].id),e.push(c.replace("{w}",utils.sanitize(f.width)).replace("{h}",utils.sanitize(f.height)).replace("{t}",utils.sanitize(f.top-k.top)).replace("{l}",utils.sanitize(f.left-k.left)));return e.join("")},a.$stencilTooltip=b(".tooltip-wrapper");var m=b("#stencil-tooltip")[0];a.updateStencilTooltip=function(a,b){switch(a){case"position":m.innerHTML="Left: "+b.left+"&#8193;Top: "+b.top;break;case"size":m.innerHTML="Width: "+b.width+"&#8193;Height: "+b.height;break;default:}},a.showStencilTooltip=function(){a.timeout&&clearTimeout(a.timeout),a.$stencilTooltip.addClass("show")},a.hideStencilTooltip=function(){a.timeout=setTimeout(function(){a.$stencilTooltip.removeClass("show")},500)};var n=b("#insp-width")[0],o=b("#insp-height")[0],p=b("#insp-x")[0],q=b("#insp-y")[0],r=b("#stencil-toolbar");FDBK.sub("selection-changed",function(b){a.hasSelection()?(r.show(),s(b)):r.hide()}),FDBK.sub("selection-transform",function(a,b,c){switch(b){case"start":r.addClass("disabled");break;case"timer-start":break;case"stop":r.removeClass("disabled"),s(c);break;case"timer-stop":s(c)}});var t=function(d){var e=b(d.currentTarget),f=e.data("action"),g=e.data("prop"),h=/^(\+|-)?((\d+(\.\d+)?)|(\.\d+))%$/,i=parseInt(n.value),j=parseInt(o.value),k=h.test(n.value),l=h.test(o.value),m=parseInt(p.value),r=parseInt(q.value),s;switch(f){case"resize":FDBK.library.currentMockup.undo.startGroup("Inspector Resize");for(var t=0;t<a.currentMockup.selection.length;t++){s=a.currentMockup.selection[t];var u=c(s).resizeMode();if(!a.isLocked(s)&&!a.isGroup(s)&&u!=c.RESIZE_NONE){var v=c(s).measuredWidth(),w=c(s).measuredHeight(),x=c(s).position().x,y=c(s).position().y;isNaN(i)&&(i=v),isNaN(j)&&(j=w),k&&(i=Math.round(v*i/100)),l&&(j=Math.round(w*j/100));var z=c(s).minWidth(),A=c(s).minHeight();i=Math.max(i,z),j=Math.max(j,A);switch(u){case c.RESIZE_ASPECT:var B;g=="width"?(B=v/w,j=i/B):(B=w/v,i=j/B);break;case c.RESIZE_VERTICAL:i=v;break;case c.RESIZE_HORIZONTAL:j=w}a.resizeStencil(s,{width:i,height:j,top:y,left:x},{forward:!0,undoable:!0,updateModel:!0})}}FDBK.library.currentMockup.undo.endGroup();break;case"move":FDBK.library.currentMockup.undo.startGroup("Inspector Move");for(var t=0;t<a.currentMockup.selection.length;t++){s=a.currentMockup.selection[t];var x=c(s).position().x,y=c(s).position().y,C=isNaN(m)?x:m,D=isNaN(r)?y:r;a.isLocked(s)||a.moveStencil(s,{top:D,left:C},{forward:!0,undoable:!0,updateModel:!0})}FDBK.library.currentMockup.undo.endGroup()}I()},u=utils.debounce(t,500);b(document).on("change",".stencilToolbarInspectableInput",t).on("keydown",".stencilToolbarInspectableInput",function(a){var c=parseInt(a.target.value,10),d=null;if(!isNaN(c)){switch(a.keyCode){case 38:d=c+1;break;case 40:d=c-1}if(d!==null)return a.target.value=d,u(a),!1}a.keyCode===27&&(b(this).blur(),y(a))}),h.on("click",function(a){if(b(this).hasClass("disabled"))return;FDBK.library.inspectorState.act("showPinned")}),FDBK.sub("inspector-hidden",function(){h.removeClass("pressed")}),a.updateUndoButton=function(){a.currentMockup.undo.undo_available>0?b("#undo-button").removeClass("disabled"):b("#undo-button").addClass("disabled")},a.updateRedoButton=function(){a.currentMockup.undo.redo_available>0?b("#redo-button").removeClass("disabled"):b("#redo-button").addClass("disabled")},b(document).on("click","#undo-button",function(){if(b(this).hasClass("disabled"))return;(a.isArea("stage")||a.isArea("toolbar"))&&a.currentMockup&&a.currentMockup.undo.undo()}),b(document).on("click","#redo-button",function(){if(b(this).hasClass("disabled"))return;(a.isArea("stage")||a.isArea("toolbar"))&&a.currentMockup&&a.currentMockup.undo.redo()}),b(document).on("keydown",null,"meta+z ctrl+z",function(){return(a.isArea("stage")||a.isArea("toolbar"))&&a.currentMockup&&a.currentMockup.undo.undo(),!1}),b(document).on("keydown",null,"meta+shift+z ctrl+shift+z",function(){return(a.isArea("stage")||a.isArea("toolbar"))&&a.currentMockup&&a.currentMockup.undo.redo(),!1});var v={};d.draggable({distance:3,snap:".none",customSnap:a.snapoptions.snap,snapTolerance:a.snapoptions.snap.snapTolerance,snapGrid:a.snapoptions.snapGrid,start:function(d,e){var f=a.currentMockup.selection;if(a.hasSelection()){v.startPos=c(f[0]).position(),v.startUi=e.position||{top:0,left:0},v.newDrag=!0;if(d.altKey&&FDBK.allowNewStencils(!0)){var g=f[0];a.copyStencils(),a.pasteStencils(!0);var h=b(this).data("draggable"),i=b("#htmlStage").offset().left,j=b("#htmlStage").offset().top;h.customSnapElements.push({item:g,width:c(g).measuredWidth(),height:c(g).measuredHeight(),top:c(g).position().y+j,left:c(g).position().x+i})}b(this).addClass("hide")}else b(this).hide();FDBK.pub("selection-transform","move","start",f)},drag:function(b,d){var e=d.position,f;if(b.shiftKey){var g=v.startUi,h=Math.abs(g.left-d.position.left),i=Math.abs(g.top-d.position.top),j=v.newDrag?Math.max(h,i)===h:v.xMax;v.xMax=j,v.newDrag=!1,j?e.top=g.top:e.left=g.left}a.updateStencilTooltip("position",e),k=!0;if(a.hasSelection())if(a.isMultiSelection()){var l=v.startPos.y+e.top-v.startUi.top,m=v.startPos.x+e.left-v.startUi.left,n=c(a.currentMockup.selection[0]).position(),o=m-n.x,p=l-n.y;for(var q=0;q<a.currentMockup.selection.length;q++)f=a.currentMockup.selection[q],selPos=c(f).position(),a.moveStencil(f,{top:selPos.y+p,left:selPos.x+o},{undoable:!1,forward:!1,updateModel:!1})}else f=a.currentMockup.selection[0],a.moveStencil(f,{top:e.top,left:e.left},{undoable:!1,forward:!1,updateModel:!1})},stop:function(b,d){var e=a.currentMockup.selection;a.snapoptions.stop(b,d);if(a.hasSelection()){a.currentMockup.undo.startGroup("Move selection");for(var f=0;f<e.length;f++){var g=c(e[f]).position();a.moveStencil(e[f],{top:g.y,left:g.x})}a.currentMockup.undo.endGroup(),delete v.startPos,delete v.startUi,b.altKey&&FDBK.allowNewStencils()}FDBK.pub("selection-transform","move","stop",e)}}),a.liveResizeFunction=function(b,c){a.snapoptions.update(b,c),k=!0,a.isSingleSelection()&&(a.resizeStencil(a.currentMockup.selection[0],{width:d.width(),height:d.height(),top:parseInt(d.css("top"),10),left:parseInt(d.css("left"),10)},{forward:!1,undoable:!1,updateModel:!1}),a.updateStencilTooltip("size",{height:c.helper.height(),width:c.helper.width()}))},a.helperResizeFunction=function(b,c){a.snapoptions.update(b,c),k=!0,a.isSingleSelection()&&a.updateStencilTooltip("size",{height:c.helper.height(),width:c.helper.width()})},d.resizable({handles:"all",snap:a.snapoptions.snap,snapTolerance:a.snapoptions.snap.snapTolerance,start:function(){var b=a.currentMockup.selection;FDBK.pub("selection-transform","resize","start",b)},resize:a.liveResizeFunction,stop:function(c,f){var g=a.currentMockup.selection,h=0,i=0;a.snapoptions.stop(c,f);if(a.isSingleSelection()){var j=b(this).resizable("option","helper");if(a.snapoptions.snapGrid||j)h=j?e.offset().left:0,i=j?e.offset().top:0,d.css({left:f.position.left-h,top:f.position.top-i,width:f.size.width,height:f.size.height});a.resizeStencil(g[0],{width:f.size.width,height:f.size.height,top:f.position.top-i,left:f.position.left-h})}FDBK.pub("selection-transform","resize","stop",g)}}),b("#clear-selection").on("mousedown",function(a){FDBK.allowSelection()&&(a.target===this||b(a.target).prop("id")==="containment")&&(b(document).disableSelection(),x(a))});var w=document.getElementById("selection-helper");f.on({mousedown:function(c){if(!FDBK.allowSelection())return;var e=b(c.target).closest("#"+a.currentMockup.id+" .stencil");e.length&&!e.prop("locked")?(e=e[0],c.shiftKey||c.ctrlKey||c.metaKey?(a.toggleElementFromSelection(e),I(),k=!0):(a.currentMockup.selection=[e],I(),d.trigger(c)),E()):x(c),b(document).disableSelection()},dblclick:function(c){var d=b(c.target).closest(".active-master-mockup");d.length&&FDBK.allowEditMasters()&&a.changeActiveMockup(d[0].id)}}),d.on({mousedown:function(c){var f=d.hasClass("locked"),g=a.currentMockup.selection[0];b(c.target).hasClass("ui-resizable-handle")?a.updateStencilTooltip("size",{height:d.height(),width:d.width()}):a.updateStencilTooltip("position",d.position()),a.showStencilTooltip();if(b(c.target).hasClass("border")&&!c.shiftKey&&!c.ctrlKey&&!c.metaKey){var h={left:c.clientX-e.offset().left,top:c.clientY-e.offset().top,right:c.clientX-e.offset().left,bottom:c.clientY-e.offset().top};a.isSingleSelection()&&F(h,{multiple:!1,reset:!0},!0),I();if(!a.isSingleSelection())return;if(f&&g===a.currentMockup.selection[0]){D(),x(c);return}f&&!a.isLocked(a.currentMockup.selection[0])&&(d.removeClass("locked").draggable("enable").resizable("enable"),d.trigger(c)),!f&&a.isLocked(a.currentMockup.selection[0])&&d.trigger("mouseup")}},mouseup:function(a){if(!k)if(a.shiftKey||a.ctrlKey||a.metaKey){var b={left:a.clientX-e.offset().left,top:a.clientY-e.offset().top,right:a.clientX-e.offset().left,bottom:a.clientY-e.offset().top};F(b,{multiple:!1,reset:!1},!0),I()}},dblclick:function(){a.editor.enterEditMode()}}),b(document).on("keydown",null,"return",function(c){var d=b(".show-dropdown");d.length&&(d.find(".menu-item.selected").first().click(),FDBK.closeDropdowns());if(!b("#editArea").is(c.target)&&a.focusArea=="stage")return a.editor.enterEditMode(),!1}),b(document).on("mousemove",function(a){if(j){var b=a.clientX-j.offsetLeft+j.wrapper.scrollLeft,c=a.clientY-j.offsetTop+j.wrapper.scrollTop;w.style.width=Math.abs(b-j.x)+"px",w.style.height=Math.abs(c-j.y)+"px",w.style.left=Math.min(b,j.x)+"px",w.style.top=Math.min(c,j.y)+"px",w.style.display="block"}});var y=a.focusStage=function(){a.focusArea!="stage"&&(b(document.activeElement).blur(),a.focusArea="stage",d.removeClass("blur"),b(".annotation-handle").removeClass("blur"))},z=a.blurStage=function(){d.addClass("blur"),a.inspectorState.act("hide")},A,B=a.preventClearSelection=function(a){if(a===undefined)return A;A=a};b(document).on({mousedown:function(c){!b("#editArea").is(c.target)&&a.editor.editingStencil!==null&&(b("#editArea").is(":visible")&&B(!0),a.editor.stopEditing(!0))},mouseup:function(c){var d=b(c.target);!k&&c.button!=2&&!B()&&(w.className==="active"?(c.shiftKey||c.ctrlKey||c.metaKey?F(M(b(w)),{multiple:!0,reset:!1},!1):parseInt(w.style.width,10)<5&&parseInt(w.style.height,10)<5?F(M(b(w)),{multiple:!1,reset:!0},!1):F(M(b(w)),{multiple:!0,reset:!0},!1),I()):!b(c.target).closest(".stencil").length&&b(c.target).closest("#clear-selection").length&&D()),FDBK.pub("selection-event:document:mouse-up"),d.closest("#sidebar-wrapper").length?(a.focusArea="sidebar",z()):d.closest("#toolbar-wrapper").length&&!d.closest(".centered-buttons-wrapper, #undo-redo-buttons").length?(a.focusArea="toolbar",z()):d.closest("#comments-sidebar").length?(a.focusArea="comments",z()):d.closest(".modal").length||d.closest("#overlay").length?(a.focusArea="modal",z()):d.closest("#secondary-toolbar").length&&!d.closest(".stencilInspectButton").length?(a.focusArea="secondary-toolbar",z()):y(c)}}),FDBK.sub("selection-event:document:mouse-up",function(){a.hideStencilTooltip(),b(document).enableSelection(),w.style.display="none",w.className="",j=null,k=null,B(!1)},this),b(document).on("click","#lock-button",function(){if(b(this).hasClass("disabled"))return;C()}),b(document).on("keydown",null,"meta+l ctrl+l",function(){if(b("#lock-button").hasClass("disabled"))return;return C(),!1}),a.isLocked=function(b){if(!b)return!1;var c=a.currentMockup.stencil(b.id);return c&&c.locked},a.isAnnotation=function(b){var c=a.currentMockup.stencil(b.id);return c&&c.type==="annotation"},b(document).on("keydown",null,"del backspace",function(b){if(a.isArea("stage")||a.isArea("toolbar"))if(a.hasSelection()&&!FDBK.isDropdownOpen())return a.deleteSelection(),!1}),a.deleteSelection=function(){var c=a.currentMockup.selection.slice().filter(function(a){return!b(a).prop("locked")});if(c.length){a.currentMockup.undo.startGroup("Remove selection");for(var d=c.length-1;d>=0;d--)a.removeStencil(c[d]);a.currentMockup.undo.endGroup(),D()}},a.addStencil=function(b){return a.addStencilFinal({type:b.data&&b.data.type!==undefined?b.data.type:"stencil",templateName:b.name,data:b.data,target:b.target,targetGroup:b.targetGroup},{undoable:b.undoable,updateModel:!b.skipModel})},a.addStencilInstance=function(c,d,e,f){var g=a.getActiveMockup();f&&(g=b("#"+f),a.setClassGroped(c,!0));var h;return d?h=a.currentMockup.addStencil(d,f):(h=a.currentMockup.copyStencil(c.id),d=a.currentMockup.stencil(h)),c.id=h,g.append(c),FDBK.pub("add-stencil",c.id),e&&a.currentMockup.undo.undoable("Remove Stencil",a.removeStencil,[utils.stencilId(c)]),FDBK.pub("collab-add-stencil",a.currentMockup.id,h,f),c},a.createHotspotsForStencils=function(b){a.shouldShowHotspots()||a.showAllHotspots(),b=b||a.currentMockup.selection||[];var c=[],d;a.currentMockup.undo.startGroup("stencil hotspots");for(var e=0;e<b.length;e++){var f=a.currentMockup.stencil(b[e].id);f&&(d=a.addStencil({name:"tmplsvg-hotspot",undoable:!0}),a.resizeStencil(d,{width:f.width,height:f.height,top:f.top,left:f.left}),c.push(d))}if(!c.length){d=a.addStencil({name:"tmplsvg-hotspot",undoable:!0});var g=a.defaultPosition();a.moveStencil(d,{left:g.left,top:g.top}),c.push(d)}a.currentMockup.selection=c,a.showSelection(),a.inspectorState.act("show"),a.currentMockup.undo.endGroup()},a.shouldShowHotspots=function(){return document.documentElement.className.indexOf("hide-hotspots")===-1},a.toggleHotspotVisibility=function(){var c=b("#toggle-hotspots");c.hasClass("checked")?a.hideAllHotspots():a.showAllHotspots()},a.showAllHotspots=function(a){b("html").removeClass("hide-hotspots"),b("#toggle-hotspots").addClass("checked")},a.hideAllHotspots=function(c){b("html").addClass("hide-hotspots"),b("#toggle-hotspots").removeClass("checked"),a.currentMockup&&a.currentMockup.selection&&(a.currentMockup.selection=a.currentMockup.selection.filter(function(a){return a.getAttribute("name")!=="tmplsvg-hotspot"}),a.showSelection())};var F=function(b,c,d){var e=[],f,g=!1,h=a.getAllVisibleStencils();for(var i=0;i<h.length;i++){var j=L(h[i]);G(b,j)&&(e.push(h[i]),g=!0)}!c.multiple&&e.length>0&&(f=e[e.length-1],e.length=0,e.push(f),g=!0),c.reset&&(a.currentMockup.selection.length=0);for(var k=0;k<e.length;k++)!d&&!H(e[k])?(a.currentMockup.selection.push(e[k]),g=!0):d&&(a.toggleElementFromSelection(e[k]),g=!0);return g&&E(),a.currentMockup.selection};FDBK.sub("remote-stencil-update",function(b){var c=!1;for(var d=a.currentMockup.selection.length-1;d>=0;d--)if(a.currentMockup.selection[d].id==b){c=!0;break}c&&a.showSelection()}),a.adjustSelectionGhost=function(){if(a.currentMockup.selection.length===0)return;var b=a.currentMockup.stencil(a.currentMockup.selection[0].id),c=b.width,e=b.height;Math.min(c,e)<FDBK.config("stencilEditor.stencilTooSmallThreshold")?d.addClass("small-stencil"):d.removeClass("small-stencil")};var N=b("#inspectorContent"),O=null;a.updateInspectorContentForSelection=function(){if(!a.currentMockup||a.currentMockup.selection.length==0||a.currentMockup.selection[0].locked){h.addClass("disabled");return}var b,c,d,e;for(var f=0;f<a.currentMockup.selection.length;f++){b=a.currentMockup.stencil(a.currentMockup.selection[f].id);if(!b.name)continue;var g=FDBK.stencilTemplate(b.name),i=FDBK.normalizedTemplateInspectables(g,b.inspectables);d?(c=c==b.name?c:null,d=utils.intersectionOfObjects(d,i)):(c=b.name,d=i);if(e===undefined||e==1)e=g.justifyAlignSupport||!1}O=c?FDBK.panelNameForStencil(c):null;var j=FDBK.getPanelDOM(d||{},O,{justifyAlignSupport:e});j.childNodes.length>0?(N.html(j),h.removeClass("disabled")):(N.empty(),h.addClass("disabled"))},a.showInspectorForSelection=function(b){if(!a.currentMockup||a.currentMockup.selection.length==0||a.currentMockup.selection[0].locked)return;a.showInspector(O,null,b)},a.showInspector=function(a,b,c){O=a,c=c||{};if(a&&b){var e=FDBK.getPanelDOM(b,a);N.html(e)}if(N.contents().length==0)return;FDBK.pub("inspector-shown",a||"");var f=utils.optimalPopoverPosition(c.anchor||d,g);d.find(".tooltip-wrapper").removeClass("bottom").addClass(f.tooltipWrapperClass),g.find(".popoverTail").removeClass("popoverTailDown popoverTailLeft popoverTailRight popoverTailNone").addClass(f.popoverTailClass),g.css({left:f.left,top:f.top,opacity:1})},a.hideInspector=function(){g.css({opacity:0,left:"-9999px",top:"-9999px"}),a.iconPicker.hide(),a.colorPicker.hide(),FDBK.pub("inspector-hidden",O)};var P=a.inspectorState=AppSeeds.StateManager.create("hidden shown shownPinned latent inert inertPinned").whenIn("hidden",{forceShow:function(){this.goTo("shown")},show:function(){this.goTo("latent")},sleep:function(){this.goTo("inert")},showPinned:function(){this.goTo("shownPinned")}}).whenIn("shownPinned",{enter:function(){h.addClass("pressed"),a.showInspectorForSelection({anchor:h})},exit:function(){a.hideInspector()},sleep:function(){this.goTo("inertPinned")},forceShow:function(){this.goTo("shownPinned")},show:function(){this.goTo("latent")},showPinned:function(){this.goTo("latent")},hide:function(){this.goTo("latent")},remove:function(){this.goTo("hidden")}}).whenIn("shown",{forceShow:function(){this.goTo("shown")},enter:function(b){a.showInspectorForSelection()},exit:function(){a.hideInspector()},sleep:function(){this.goTo("inert")},show:function(){this.goTo("latent")},showPinned:function(){this.goTo("shownPinned")},hide:function(){this.goTo("latent")},remove:function(){this.goTo("hidden")}}).whenIn("latent",{forceShow:function(){this.goTo("shown")},show:function(){this.goTo("shown")},sleep:function(){this.goTo("inert")},remove:function(){this.goTo("hidden")},showPinned:function(){this.goTo("shownPinned")}}).whenIn("inert",{forceShow:function(){this.goTo("shown")},sleep:function(){this.goTo("inert")},wake:function(){this.goTo("hidden")}}).whenIn("inertPinned",{forceShow:function(){this.goTo("shownPinned")},wake:function(){this.goTo("hidden")},sleep:function(){},forceShow:function(){this.goTo("shownPinned")}}).goTo("hidden");return i.scroll(function(){a.inspectorState.act("hide")}),this._selectionCache=null,FDBK.sub("selection-changed",function(a){var b=(a||[]).map(function(a){return a.id}),c=utils.sameArrayContent(b,this._selectionCache||[]);c||(this.inspectorState.act("remove"),this.updateInspectorContentForSelection()),this._selectionCache=b,this._selectionMoveTimer||(l(a),a?(this.inspectorState.act("show"),this.showAnnotationHandles(),this.adjustSelectionGhost()):(this.inspectorState.act("remove"),this.hideAnnotationHandles()))},a),FDBK.sub("selection-transform",function(a,b,c){switch(b){case"timer-start":var e=this;this._selectionMoveTimer?clearTimeout(this._selectionMoveTimer):(this.showStencilTooltip(),this.inspectorState.act("hide")),this._selectionMoveTimer=setTimeout(function(a){e.hideStencilTooltip(),e._selectionMoveTimer=null,FDBK.pub("selection-transform","move","timer-stop",a)},500,c);break;case"start":this.inspectorState.act("hide"),d.addClass("hide"),this.hideAnnotationHandles();break;case"stop":d.removeClass("hide"),this.adjustSelectionGhost()}},a),a.replaceStencilCollab=function(a,c,d,e){if(FDBK.library.currentMockup.groupedStencils[c.id])return;FDBK.library.currentMockup.undo.undoable("Replace Collab Stencil",FDBK.library.replaceStencilCollab,[a,b.extend(!0,{},d),b.extend(!0,{},c),e]),FDBK.pub("collab-replace-stencil",a,c,d,e)},a.inspect=function(d,e,f){var g=a.currentMockup.selection.slice()||[f],h,i=[];a.currentMockup.undo.startGroup("Inspect Stencil");for(var j=0;j<g.length;j++){h=g[j];var k=a.currentMockup.stencil(h.id),l=k.name,m=FDBK.stencilTemplate(l),n=FDBK.normalizedTemplateInspectables(m,k.inspectables),o=b.extend(!0,{},k),p={x:c(h).position().x,y:c(h).position().y,width:c(h).measuredWidth(),height:c(h).measuredHeight()},q=p,r=b(h).prev(".stencil")[0],s=b(h).next(".stencil")[0];a.inspectorState.act("sleep"),a.removeStencil(h,{ignoreSelection:!0},{forward:!1});if(e.hasOwnProperty("corners_rounded"))if(!e.corners_rounded)e.corner_radius=0;else{var t=b(h).data("radius-value")||FDBK.config("stencilTemplates.cornerRadiusValue");e.corner_radius=t}for(var u in e)m.metadata.inspectables.hasOwnProperty(u)?n[u]=e[u]:console.info("not persisting inspectable property",u);k.inspectables=n,h=null;var v=a.addStencilFinal({type:"stencil",templateName:l,data:k},{forward:!1});a.orderStencil(v,{before:r,after:s},{forward:!1});var w=c(v).minWidth(),x=c(v).minHeight();if(p.width<w||c.resetSizeOnInspect())q.width=w;if(p.height<x||c.resetSizeOnInspect())q.height=x;e._width&&(q.width=parseInt(e._width,10)),e._height&&(q.height=parseInt(e._height,10)),a.resizeStencil(v,{width:q.width,height:q.height,top:q.y,left:q.x},{forward:!1}),k=a.currentMockup.stencil(k.id);var y=a.currentMockup.indexOfStencil(k.id);a.replaceStencilCollab(a.currentMockup.id,k,o,y),i.push(v)}a.currentMockup.undo.endGroup(),a.currentMockup.selection=i,a.showSelection(),a.inspectorState.act("forceShow")},FDBK.sub("modal-opened",function(){b(document).trigger("mouseup"),a.focusArea="modal"}),FDBK.sub("modal-closed",function(a){y()}),FDBK.sub("moqups-loaded",function(){BrowserDetect.unsupportedBrowser||b("#preloader").hide(),y()}),a.loadAccountServiceData=function(){FDBK.AUTHORIZED_SERVICES=[],FDBK.API.xhr(FDBK.API.CALL_GET_SERVICES,{success:function(a){if(a.success){FDBK.AUTHORIZED_SERVICES=a.object;for(var b=0;b<FDBK.AUTHORIZED_SERVICES.length;b++)switch(FDBK.AUTHORIZED_SERVICES[b].serviceProvider){case"googledrive":FDBK.AUTHORIZED_SERVICES[b].serviceName="Google Drive";break;case"dropbox":FDBK.AUTHORIZED_SERVICES[b].serviceName="Dropbox";break;default:FDBK.AUTHORIZED_SERVICES[b].serviceName=FDBK.AUTHORIZED_SERVICES[b].serviceProvider}FDBK.pub("account-service-data-loaded")}}})},a.isServiceAuthorized=function(a){for(var b=0;b<FDBK.AUTHORIZED_SERVICES.length;b++)if(FDBK.AUTHORIZED_SERVICES[b].serviceProvider==a)return!0;return!1},a.getUserData=function(){function d(){a.projectIdToLoad=a.projectIdToLoad.split("/")[0],(!a.currentProject||a.currentProject.isClean())&&a.fetchProject(a.projectIdToLoad)}var c=function(){a.applyUserSettings(),a.setLoggedState(!1);if(a.projectIdToLoad){var c=a.projectIdToLoad,d,e=a.projectIdToLoad.split("/").filter(function(a){return a&&a.length>0});e.length>1&&(c=e[0],d=e[1]),d?(a.projectIdToLoad=c,a.validateActivationToken(d,function(){FDBK.pub("moqups-loaded")})):(FDBK.pub("moqups-loaded"),a.showLoginDialog())}else a.openDefaultProject(MQEX.sampleProject),!FDBK.getActiveModalID()&&!b.cookie("hasAccount")&&a.animatedIntro.showLandingPage()};FDBK.API.xhr(FDBK.API.CALL_GET_CURRENT_USER,{success:function(e){if(e.success){FDBK.USER_DATA=b.extend(FDBK.USER_DATA,e.object.user),FDBK.USER_DATA.billingInfo=FDBK.USER_DATA.billingInfo||{},a.setLoggedState(!0),a.loadUserSettings(),a.loadAccountServiceData();if(!FDBK.START_IN_RECOVERY_MODE)if(a.projectIdToLoad){if(a.projectOwnerToLoad&&a.projectOwnerToLoad!=FDBK.USER_DATA.context.userName){var f=FDBK.library.contextController.findContext({userName:a.projectOwnerToLoad});if(f){a.contextController.switchContext(f.uniqueId,"edit/"+a.projectOwnerToLoad+"/"+a.projectIdToLoad);return}d()}else d();a.projectIdToLoad=null,a.projectOwnerToLoad=null}else FDBK.USER_DATA.lastModifiedProject?(!a.currentProject||!!a.currentProject.isClean())&&a.fetchProject(FDBK.USER_DATA.lastModifiedProject):FDBK.pub("at-least-load-google");FDBK.pub("moqups-loaded"),FDBK.START_IN_RECOVERY_MODE=!1}else c()},error:function(){c()}}),window.onbeforeunload=function(){if(FDBK.config("projectManager.warnOnBeforeUnload")&&a.currentProject&&!a.currentProject.isClean())return"You have unsaved changes!";if(FDBK.config("projectManager.warnOnBeforeUnload")&&a.hasUploadsInProgress())return"Some uploads are still in progress!"}},a.checkSession=function(){FDBK.API.xhr(FDBK.API.CALL_GET_CURRENT_USER,{success:function(b){b.success?FDBK.pub("session-check-result",!0):(FDBK.pub("session-check-result",!1),a.setLoggedState(!1),a.showLoginDialog(),FDBK.showServerError({message:FDBK.loc("_Your session has been lost. Please login again to avoid data loss.")}))},error:function(){FDBK.pub("session-check-result",!1),FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_Oops. Something went wrong. Please try again."),buttons:[{text:FDBK.loc("_OK"),classes:"close-modal"}]})}})},a.openDefaultProject=function(c){if(!a.currentProject&&!FDBK.START_IN_RECOVERY_MODE){var d=FDBK.defaultProjects.sampleProjects[c]||FDBK.defaultProjects.emptyProject;a.openProject(d);var e=b(".active-mockup").find(".stencil")[d.selectedStencilIndex];e&&a.selectElement(e,d.showInspector)}FDBK.pub("moqups-loaded")},a.checkHash=function(){var b=decodeURIComponent(window.location.hash);switch(b){case"#!/register":a.isUserLoggedIn()||a.showRegisterDialog();break;case"#!/sign-in":a.isUserLoggedIn()||a.showLoginDialog();break;case"#!/reset":a.isUserLoggedIn()||a.showResetDialog();break;case"#!/recovery":FDBK.START_IN_RECOVERY_MODE=!0,FDBK.showRecoveryDialog();break;case"#!/pricing":FDBK.showPricingPlans("direct-link");break;case"#!/update-card":a.isUserLoggedIn()?FDBK.initUpdateForm():(FDBK.library.askForSession(),FDBK.promptUpdateCard=!0);break;case"#!/newsletter-pricing":FDBK.showPricingPlans("newsletter-link");break;default:var c=null;if(b.indexOf("#!/edit/")!=-1){var d=b.split("#!/edit/");if(d.length==2){var e=d[1].split("/");e.length==3?(a.projectIdToLoad=e[1]+"/"+e[2],a.projectOwnerToLoad=e[0]):e.length>1?(a.projectIdToLoad=e[1],a.projectOwnerToLoad=e[0]):(a.projectIdToLoad=e[0],a.projectOwnerToLoad=null)}}else if(b.indexOf("#reset?rt")!=-1&&!a.isUserLoggedIn())FDBK.resetToken=b.split("#reset?rt=")[1],FDBK.openModal("#password-dialog","reset/"+FDBK.resetToken);else if(b.indexOf("#!/team/")!=-1){var f=b.replace("#!/team/","");c=a.contextController.findContext({userName:f}),c&&(FDBK.USER_DATA.lastModifiedProject=null,a.contextController.switchContext(c.uniqueId))}else if(b.indexOf("#!/account-limit/")!=-1){var g=b.split("#!/account-limit/")[1];g==="projects"&&FDBK.showActiveProjectsAlert()}else if(b.indexOf("#!/payment/")!=-1){var d=b.split("#!/payment/");d[1]&&a.isUserLoggedIn()&&FDBK.setPlanAndPay(d[1])}else a.isUserLoggedIn()&&FDBK.USER_DATA.isFirstLogin&&FDBK.showNewUserPricingPlans(),b&&!c&&!a.projectIdToLoad&&a.contextController.showContextSwitcher()}FDBK.pub("hash-checked")},a.setShortcuts=function(){var a={"short":FDBK.winShortcuts};BrowserDetect.isMac&&(a={"short":FDBK.macShortcuts}),b("#shortcuts-dialog").append(b("#tmpl-shortcuts").loc_tmpl(a)),b("#contextMenu").append(b("#tmpl-context-menu").loc_tmpl(a)),b("#moqups-dropdown").append(b("#tmpl-moqups").loc_tmpl(a)),b("#centered-buttons").append(b("#tmpl-centered-buttons").loc_tmpl(a)).before(b("#tmpl-undo-redo").loc_tmpl(a));var c=function(){b(this).html(a.short[b(this).data("short")].name)};b("[data-short]").each(c),FDBK.sub("inspector-shown",function(){b("#inspectorContent [data-short]").each(c)})},FDBK.sub("dom-ready",function(){uvOptions={},function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"==document.location.protocol?"https://":"http://")+"widget.uservoice.com/zb8lz2gaixOFeGQy59b4Q.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}(),b(".painless-share").share({url:"https://moqups.com/",text:"Check out Moqups! An amazing Mockup/Wireframing tool powered by HTML5:"}),FDBK.sub("user-logged-in",function(){FDBK.hasPremiumPlan()||setTimeout(function(){b(".painless-share").find("label").trigger("click")},2e3)})}),FDBK.sub("dom-ready",function(){function c(){a.getUserData(),a.setShortcuts(),FDBK.generateSVGIcons()}FDBK._stencilsDefsReady?c():FDBK.sub("stencils-and-defs-loaded",function(){c()}),b.cookie("moqups_ref")||b.cookie("moqups_ref",document.referrer,{expires:3650,path:"/"}),a.chromeBadge.init(),a.downtimeWarning.show()}),a.showSelection=I,a.clearSelection=D,a.getSvgPoints=L,a.$svgObject=f,a.$ghost=d,a.$inspector=g,a.$projectWrapper=i,a.reOrderCurrentSelection=E,a.showAnnotationHandles=J,a.hideAnnotationHandles=K,a.projectOwnerToLoad=null,a.projectIdToLoad=null,a}(MODULE||{},jQuery,svg),MODULE=function(a,b,c){a.peopleSuggestionsController={fetchedSugestions:!1,_suggestions:[],fetch:function(b,c){b=b||{},b.force&&(this.fetchedSugestions=[]);if(!this.fetchedSugestions){var d=this;FDBK.API.xhr(FDBK.API.CALL_TEAM_SUGGESTIONS,{success:function(a){a&&a.success?(d._suggestions=a.object.map(function(a){return a.gravatar=utils.getAvatarImageURL({email:a.email,avatar:a.avatar}),a.displayName=a.fullName||a.userName,a}),d.fetchedSugestions=!0,c&&c()):c&&c(a.message)},error:function(){c&&c(a.teamController._genericError)}})}else c&&c()},list:function(){return this._suggestions},usernameForDisplayName:function(a){var b=this.list();for(var c=0;c<b.length;c++)if(b[c].displayName==a)return b[c].userName;return a},autocompleteForInput:function(a){var b=this;this.fetch({},function(c){if(c)return;a.atwho({at:"",search_key:"displayName",data:b.list(),limit:10,tpl:"<li data-value='${atwho-at}${displayName}'><div class='avatar'><img src='${gravatar}'/></div><span>${displayName}</span></li>",callbacks:{matcher:function(a,b){var c=b.replace(/\n\r?/g,",").split(/[ ,]+/);if(c.length===0)return null;var d=c[c.length-1].trim();return d.length>=1&&d.match(/^[a-z0-9@+._-]/i)?d:null},highlighter:function(a,b){var c;return b?(c=new RegExp("span>\\s*(.*)("+b.replace("+","\\+")+")(.*)\\s*</span","ig"),a.replace(c,function(a,b,c,d){return"span> "+b+"<strong>"+c+"</strong>"+d+" </span"})):a},before_insert:function(a,c){return b.usernameForDisplayName(a)+","}}})})}},a.contextController={contexts:[],currentContext:null,init:function(a){this.contexts=a.teams,this.currentContext=a.context},findContext:function(a){for(var b=0;b<this.contexts.length;b++)for(var c in a){if(this.contexts[b][c]!=a[c])break;return this.contexts[b]}return null},switchContext:function(b,c){b&&this.currentContext!==b&&FDBK.API.xhr(FDBK.API.CALL_CONTEXT_SWITCH,{contentType:"application/x-www-form-urlencoded",data:{teamUniqueId:b},success:function(d){if(d&&d.success)a.contextController.refresh(c);else{var e=d.message;e==="collab_restricted"?a.projectNotAvailable(d.object,b):(e.length===0&&(e=FDBK.loc("_Oops. Something went wrong. Please try again.")),FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:e,buttons:[{text:FDBK.loc("_OK"),classes:"right primary-action"}]}))}},error:function(a){FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_Oops. Something went wrong. Please try again."),buttons:[{text:FDBK.loc("_OK"),classes:"right primary-action"}]})}})},showContextSwitcher:function(){if(this.contexts&&this.contexts.length>1){var a=this;b("#account-selection").show();var c=this.contexts.map(function(a){return a=b.extend(!0,{},a),a.avatarImage=utils.getAvatarImageURL({email:a.email,avatar:a.avatar}),a.userName==FDBK.USER_DATA.userName&&(a.displayName=FDBK.USER_DATA.fullName||FDBK.USER_DATA.userName,a.own=!0),a});b("#account-selection").find("ul").html(b("#tmpl-account-selection").loc_tmpl({teams:c})),b(document).on("click","#account-selection li",function(){var c=b(this).data("name");FDBK.USER_DATA.context.userName!==c?a.switchContext(b(this).data("id"),"team/"+b(this).data("name")):b("#account-selection").hide()})}},changeContextName:function(a,c){b.each(this.contexts,function(b,d){b.uniqueId==a&&(b.displayName=c)}),FDBK.USER_DATA.context.uniqueId==a&&(FDBK.USER_DATA.context.displayName=c)},refresh:function(a){a?(window.location="/#!/"+a,window.location.reload(!0)):window.location="/"}},a.teamController={fetched:!1,_team:[],_genericError:FDBK.loc("_Oops. Something went wrong. Please try again."),add:function(b,c){FDBK.API.xhr(FDBK.API.CALL_TEAM_ADD,{data:JSON.stringify({emails:b}),success:function(b){if(b&&b.success&&b.object){var d=[];for(var e=0;e<b.object.length;e++)a.teamController._contains(b.object[e].email)||(a.teamController._team.push(b.object[e]),d.push(b.object[e]));c&&c(d)}else b.message.length===0&&(b.message=a.teamController._genericError),c&&c(null,b.message)},error:function(){c&&c(null,a.teamController._genericError)}})},remove:function(b,c){if(!this._contains(b))return;FDBK.API.xhr(FDBK.API.CALL_TEAM_REMOVE,{contentType:"application/x-www-form-urlencoded",data:{email:b},success:function(d){if(d&&d.success){var e=-1;for(var f=0;f<a.teamController._team.length;f++)if(a.teamController._team[f].email===b){e=f;break}e>=0&&a.teamController._team.splice(e,1),c&&c()}else d.message.length===0&&(d.message=a.teamController._genericError),c&&c(d.message)},error:function(){c(a.teamController._genericError)}})},leave:function(b){FDBK.API.xhr(FDBK.API.CALL_TEAM_LEAVE,{success:function(c){c&&c.success?a.contextController.refresh():(c.message.length===0&&(c.message=a.teamController._genericError),b&&b(c.message))},error:function(){b&&b(a.teamController._genericError)}})},fetch:function(b,c){b=b||{};if(!this.fetched||b.force){var d=this;FDBK.API.xhr(FDBK.API.CALL_TEAM_LIST,{success:function(b){b&&b.success?(a.teamController._team=b.object,a.teamController.fetched=!0,c&&c()):(b.message.length===0&&(b.message=a.teamController._genericError),c&&c(b.message))},error:function(){c&&c(a.teamController._genericError)}})}},list:function(){return this._team},find:function(a){for(var c=0;c<this._team.length;c++)if(this._team[c].email===a)return b.extend(!0,{},this._team[c]);return null},displayName:function(a){var b;return a.fullName?b=a.fullName:b=a.userName,b},_contains:function(a){return this._team.filter(function(b){return b.email==a}).length>0}};var d=null,e=b("#account-settings-dialog"),f=b("#tmpl-team-member"),g=b("#tmpl-team-member-detail"),h=b("#account-list-add-members"),i=b("#team-upgrade-message"),j={team:b("#account-team-pane"),profile:b("#account-profile-pane"),password:b("#account-password-pane"),payments:b("#account-payments-pane"),billing:b("#account-billing-pane"),notifications:b("#account-notifications-pane"),privacy:b("#account-privacy-pane"),"delete":b("#account-delete-pane"),badges:b("#account-badges-pane"),teamList:b("#account-team-list"),teamDetail:b("#account-team-detail"),noMembers:b("#account-team-list-empty"),hasMembers:b("#account-team-list-members")};for(var k in j)j[k].hide();return a.accountSettingsManager=AppSeeds.StateManager.create({onStateChange:function(a){this.act("showMessage","")}}).add(["root -> shown hidden","shown -> team profile password payments billing notifications privacy delete badges","team -> teamList teamDetail","teamList -> noMembers hasMembers"]).whenIn({root:{init:function(){function g(a){a||(a={top:d.find("li.active").position().top+5}),f.css(a)}var c=this;e.on("click","[data-seeds-action]",function(a){var d=b(this).data("seeds-action").split(" ");c.act(d[0],a,d.slice(1))});var d=e.find(".mq-menu"),f=e.find(".mq-menu-marker");e.find(".mq-menu").on("mouseover","li",function(a){g({top:b(this).position().top+5})}).on("mouseout",function(a){g()}),g(),b(document).on("click",function(a){b(a.target).closest("#avatar-picker-actions").length||e.find("#avatar-picker").hide()}),b(document).on("change","[name=avatar]",function(){var a=this.files[0],b=new FormData;b.append("avatar",a,a.name),e.find("#avatar-upload").hide().end().find("#avatar-progress").show();var d=new XMLHttpRequest;d.onload=function(){if(d.readyState==4)if(d.status==200){var a;try{a=JSON.parse(d.responseText)}catch(b){a={object:{errors:[]}}}if(a.object&&a.object.errors&&a.object.errors.length)var f=a.object.errors.slice()[0];else if(a.object&&a.object.images&&a.object.images.length){var g=a.object.images[0].thumb;FDBK.USER_DATA.avatar.file?FDBK.USER_DATA.avatar.file.thumb=g:FDBK.USER_DATA.avatar.file={thumb:g},c.act("setAvatar","custom",g)}}else d.status!=403;e.find("#avatar-progress").hide().end().find("#avatar-upload").show()},d.open(FDBK.API.CALL_UPLOAD_AVATAR.type,FDBK.BASE_URL+FDBK.API.CALL_UPLOAD_AVATAR.url,!0),d.send(b)}),b(document).on("click",".address-prompt",function(){if(window.confirm("Your billing address is incomplete. Do you want to update it now?"))return c.goTo("billing"),!1}),b(document).on("keydown","#team-rename",function(a){a.keyCode===13&&c.act("saveTeamName")}),FDBK.sub("plan-updated",function(){a.teamController.fetch({force:!0},function(a){if(a)return c.act("showMessage",a,!0);var b=c.locate();c.goTo("teamList"),c.act("showMembers"),window.setTimeout(function(){c.goTo(b)},0)})}),FDBK.sub("moqups-loaded",function(){if(!FDBK.library.isUserLoggedIn())return;a.teamController.fetch({force:!0},function(a){if(a)return c.act("showMessage",a,!0);c.goTo("shown")})}),FDBK.sub("account-service-data-loaded",function(){var a={};b.each(FDBK.AUTHORIZED_SERVICES,function(b,c){a[c.serviceProvider]=c}),j.notifications.find(".outlet").html(b("#tmpl-account-notifications-apps").loc_tmpl({services:a,notifications:FDBK.USER_DATA.notifications})),FDBK.library.isServiceAuthorized("googledrive")&&FDBK.isAccountOwner()&&b("#sync-drive").prop("checked",FDBK.SYNC_GOOGLE_DRIVE).parent().css({display:"inline-block"})}),h.hide()},showMessage:function(a,b){error=b||!1,FDBK.showServerError({message:a,style:b?"error":""})}},shown:{enter:function(){var c=this;window.setTimeout(function(){c.goTo("profile")},0),FDBK.config("team.suggestions")&&a.peopleSuggestionsController.autocompleteForInput(b(".suggestions-inputor"))},navigate:function(a,c){b(a.target).closest("li").addClass("active").siblings().removeClass("active"),this.goTo(c[0])}},team:{enter:function(){j.team.show()},exit:function(){j.team.hide()},goToList:function(){this.goTo("teamList")},goToDetail:function(a){this.goTo("teamDetail").act("show",b(a.currentTarget).data("member-email"))}},profile:{enter:function(){var a=this;j.profile.show().find(".outlet").html(b("#tmpl-profile").loc_tmpl({user:FDBK.USER_DATA}))},showAvatarPicker:function(){var a=[];b.each(FDBK.config("systemAvatars"),function(b,c){a.push({avatar:{name:c.name,type:"system",ref:c.ref}})});var c=null;FDBK.USER_DATA.avatar&&FDBK.USER_DATA.avatar.file&&(c={avatar:{type:"custom",ref:FDBK.USER_DATA.avatar.file.thumb}}),e.find("#avatar-picker").html(b("#tmpl-avatar-picker").loc_tmpl({user:FDBK.USER_DATA,avatars:a,customAvatar:c})).toggle()},setGravatar:function(){this.act("setAvatar","gravatar",null)},setSystemAvatar:function(a){this.act("setAvatar","system",b(a.target).data("ref"))},setCustomAvatar:function(a){this.act("setAvatar","custom",b(a.target).data("ref"))},setAvatar:function(a,c){var d=this;e.find("#avatar-picker").hide(),FDBK.API.xhr(FDBK.API.CALL_SET_AVATAR,{data:JSON.stringify({type:a,ref:c}),success:function(d){if(d&&d.success){var e=utils.getAvatarImageURL(FDBK.USER_DATA);FDBK.USER_DATA.avatar.type=a,FDBK.USER_DATA.avatar.ref=c;var f=utils.getAvatarImageURL(FDBK.USER_DATA);b(document).find('img[src="'+e+'"]').prop("src",f)}}})},exit:function(){j.profile.hide()}},payments:{enter:function(){var a=this;j.payments.show(),window.setTimeout(function(){a.act("showPaymentsHistory")},0)},showPaymentsHistory:function(){FDBK.cleanServerError(),j.payments.find(".outlet").html(b("#tmpl-loading").loc_tmpl()),FDBK.isAccountOwner()?FDBK.getPaymentHistory(function(a){j.payments.find(".outlet").html(b("#tmpl-payment-history").loc_tmpl(a))}):j.payments.find(".outlet").html('<h3 class="not-owner">'+FDBK.loc("notOwnerPaymentMessage")+"</h3>")},goToBilling:function(){this.goTo("billing")},setSendInvoice:function(){var a=e.find("[name=send-invoice]").is(":checked");FDBK.API.xhr(FDBK.API.CALL_SET_SEND_INVOICE,{data:{sendInvoice:a},contentType:"application/x-www-form-urlencoded",success:function(){FDBK.SEND_INVOICE=a}})},exit:function(){j.payments.hide(),b(document).off("click",".address-prompt")}},billing:{enter:function(){j.billing.show(),FDBK.isAccountOwner()?j.billing.find(".outlet").html(b("#tmpl-billing-details").loc_tmpl({countries:FDBK.countries,billingInfo:FDBK.USER_DATA.billingInfo,geoIpCode:FDBK.geoIpCode,isPaymentFlow:!1})):j.billing.find(".outlet").html('<h3 class="not-owner">'+FDBK.loc("notOwnerPaymentMessage")+"</h3>"),e.find('[data-seeds-action="navigate billing"]').parents("li").addClass("active").siblings().removeClass("active");var a=e.find(".mq-menu"),c=e.find(".mq-menu-marker"),d={top:a.find("li.active").position().top+5};c.css(d)},exit:function(){j.billing.hide()}},password:{enter:function(){j.password.show()},exit:function(){j.password.hide()}},notifications:{enter:function(){j.notifications.show()},setDriveSync:function(){var a=e.find("#sync-drive").is(":checked");FDBK.API.xhr(FDBK.API.CALL_SET_DRIVE_SYNC,{data:{autoSyncDrive:a},contentType:"application/x-www-form-urlencoded",success:function(){FDBK.SYNC_GOOGLE_DRIVE=a}})},exit:function(){j.notifications.hide()}},privacy:{enter:function(){j.privacy.show()},exit:function(){j.privacy.hide()}},"delete":{enter:function(){j["delete"].show()},exit:function(){j["delete"].hide()}},badges:{enter:function(){j.badges.show()},exit:function(){j.badges.hide()}},teamList:{enter:function(){j.teamList.show();var a=this},stay:function(){this.act("showMembers")},exit:function(){j.teamList.hide()},showMembers:function(){this.act("showTeamSettings"),b("#add-team-members-container").html(b("#tmpl-add-members").loc_tmpl({isPremium:FDBK.hasPremiumPlan()})),a.teamController.list().length>1?this.goTo("hasMembers"):this.goTo("noMembers")},addMembers:function(){var b=this.locate(),c=j[b].find("textarea"),d=utils.usernameEmailArrayFromString(c.val());c.val("");if(d.length==0)return;var e=this;a.teamController.add(d,function(a,c){return c?e.act("showMessage",c,!0):a.length===0?e.act("showMessage","No new members added"):(FDBK.pub("team-updated-members",a.map(function(a){return a.userUniqueId})),b==="noMembers"?e.goTo("hasMembers"):e.act("renderMembers"),e.act("showMessage","Added "+a.length+" member"+(a.length>1?"s":"")+" to your team"))})},showTeamSettings:function(){b("#team-settings").html(b("#tmpl-team-settings").loc_tmpl({ownTeam:FDBK.USER_DATA.context.userName==FDBK.USER_DATA.userName,team:FDBK.USER_DATA.context}))},renameTeam:function(){var a=FDBK.USER_DATA.context,c=b("#team-settings").html(b("#tmpl-team-rename").loc_tmpl()).find("input");c.focus().val(a.displayName).data("uniqueId",a.uniqueId).data("oldName",a.displayName)},saveTeamName:function(){var c=this,d=b("#team-settings").find("input"),e=b.trim(d.val()),f=d.data("uniqueId"),g=d.data("oldName");e?(a.contextController.changeContextName(f,e),c.act("showTeamSettings"),FDBK.API.xhr(FDBK.API.CALL_TEAM_RENAME,{contentType:"application/x-www-form-urlencoded",data:{uniqueId:f,name:e},success:function(b){b.success||(a.contextController.changeContextName(f,g),c.act("showTeamSettings"))},error:function(){a.contextController.changeContextName(f,g),c.act("showTeamSettings")}})):c.act("showTeamSettings")},cancelTeamRename:function(){this.act("showTeamSettings")}},teamDetail:{exit:function(){j.teamDetail.hide()},show:function(c){j.teamDetail.data("member-email",c);var d=a.teamController.find(c);d.avatarImage=utils.getAvatarImageURL({email:d.email,avatar:d.avatar}),d.you=c===FDBK.USER_DATA.email,j.teamDetail.show().find(".outlet").html(b.tmpl(g,d))},removeMember:function(){var b=this;if(confirm(FDBK.loc("_Are you sure you want to remove this member from the team?"))){var c=j.teamDetail.data("member-email"),d=a.teamController.find(c);a.teamController.remove(c,function(){b.goTo("teamList"),FDBK.pub("team-updated-members",[d.userUniqueId]),window.setTimeout(function(){b.act("showMessage",c+" is no longer part of your team.")},0)})}},openProject:function(a){var c=b(a.currentTarget).parent().data("project-id");FDBK.closeModal(),FDBK.library.fetchProject(c)},leaveTeam:function(){var b=this;confirm(FDBK.loc("_Are you sure you want to leave this team?"))&&a.teamController.leave(function(a){a&&b.act("showMessage",a,!0)})}},noMembers:{enter:function(){j.noMembers.show(),e.find(".team-members-count").hide(),FDBK.hasPremiumPlan()?(i.hide(),j.noMembers.find("#account-team-start-add-members-btn").show()):(i.show(),j.noMembers.find("#account-team-start-add-members-btn").hide())},exit:function(){j.noMembers.hide(),this.act("cancelAddMembers")},showAddMembers:function(){h.show(),j.noMembers.find("#account-team-start-add-members-btn").hide()},cancelAddMembers:function(){h.hide(),j.noMembers.find("#account-team-start-add-members-btn").show()}},hasMembers:{enter:function(){j.hasMembers.show();var a=this;window.setTimeout(function(){a.act("renderMembers")},0)},renderMembers:function(){e.find(".team-members-count").text(a.teamController.list().length).show();var c=b("#team-members");c.html(b.tmpl(f,a.teamController.list().map(function(b){return b.avatarImage=utils.getAvatarImageURL({email:b.email,avatar:b.avatar}),b.name=a.teamController.displayName(b),b.you=b.email==FDBK.USER_DATA.email?" - It's you!":"",b}).sort(function(a,b){return a.you&&b.you?a.permission==="owner"&&b.permission==="owner"?a.userName>b.userName?1:a.userName<b.userName?-1:0:a.permission==="owner"?-1:1:a.you?-1:1})))},exit:function(){j.hasMembers.hide()}}}).act("init"),a}(MODULE||{},jQuery,svg);FDBK.mixinModule("recovery",{initModule:function(){if(FDBK.config("projectManagement.recovery.enabled")&&window.localforage){window.localforage.driver()==window.localforage.WEBSQL&&window.localforage.config({name:"moqups_offline",storeName:"localforage",version:"1.0",description:"moqups offline"});var a=this;$("#log-in-with-google").on("click",function(a){!!FDBK.library.currentProject&&!FDBK.library.currentProject.isClean()&&(a.preventDefault(),FDBK.safelyLogInWithGoogle(this.href))}),FDBK.sub("open-project at-least-load-google",function(){this.recoverGoogleProject()},FDBK),this._localProjects=[],window.localforage.getItem(this.LS_PROJECTS_INFO_KEY).then(function(b){a._localProjectsLoaded=!0,a._localProjects=a.deserializeLocalProjects(b).sort(function(a,b){return new Date(b.date)-new Date(a.date)}),FDBK.pub("local-projects-loaded")}),this.$projectsRecoveryDialog=$("#projects-recovery-dialog"),this.$projectsRecoveryTmpl=$("#tmpl-recover-projects"),this.$diagnosticDialog=$("#project-diagnostic-dialog"),FDBK.sub("project-saved-locally",function(a){console.info("Your project was saved to local storage. v:",a)}),FDBK.sub("open-project",function(){var b=FDBK.library.serviceClient._doc?FDBK.library.serviceClient._doc.version:null,c=a._localProjects.filter(function(a){return a.id==FDBK.library.currentProject.uniqueId});a.localProject(FDBK.library.currentProject.uniqueId,function(d){if(d&&b&&c&&c.length==1){var e=c[0],f=(new FDBK.Project(JSON.parse(d))).toServerJSON();e.version!==undefined&&e.version>b?function g(){FDBK.openConfirmDialog({heading:FDBK.loc("_Unsaved changes"),message:FDBK.loc("_NewerVersionLocallyMessage")+"<p><b>"+FDBK.loc("_Local version")+"</b><p>"+'<p><a href="#" id="recover-view-local-button" style="margin-right:5px">'+FDBK.loc("_View")+"</a> "+FDBK.loc("_Last saved")+" "+moment(e.date).format("MMMM Do h:mm a")+" ("+moment(e.date).fromNow()+")</b></p><br/>"+"<p><b>"+FDBK.loc("_Remote version")+"</b><p>"+'<p><a href="#" id="recover-view-remote-button" style="margin-right:5px">'+FDBK.loc("_View")+"</a> "+FDBK.loc("_Last saved")+" "+moment(FDBK.library.currentProject.lastUpdateDate).format("MMMM Do h:mm a")+" ("+moment(FDBK.library.currentProject.lastUpdateDate).fromNow()+")</b></p><br/>",buttons:[{text:FDBK.loc("_Keep local version"),classes:"right",onClick:function(){FDBK.openConfirmDialog({heading:FDBK.loc("_Recover project heading"),message:FDBK.loc("_Recover project in progress")}),FDBK.library.serviceClient.replaceProjectData(f,"recover",function(){FDBK.library.closeCurrentProject(),FDBK.library.fetchProject(e.id),FDBK.closeModal()})}},{text:FDBK.loc("_Keep remote version"),classes:"close-modal right",onClick:function(){a.initAutoSave()}}]}),$("#recover-view-local-button").click(function(){g(),FDBK.library.previewProject(f,!1)}),$("#recover-view-remote-button").click(function(){g(),FDBK.library.previewProject(null,!1)})}():a.initAutoSave()}else a.initAutoSave()})}),this.$projectsRecoveryDialog.on("click",".project-name",function(){var b=$(this).closest(".project").data("project-id");return a.openLocalProject(b),!1}).on("click",".remove-project",function(){var b=$(this).closest(".project").data("project-id");return a.deleteLocalProject(b),$(this).closest(".project").remove(),FDBK.hideTooltip(),!1}).on("click",".remove-all-projects",function(){return confirm(FDBK.loc("_Remove all projects"))&&(a.deleteAllLocalProjects(),FDBK.closeModal()),!1}),$(document).on("keydown",null,"ctrl+shift+y meta+shift+y",function(){return FDBK.diagnostic(),!1}),this.$diagnosticDialog.on("click","#diagnostic-load",function(){a._diagnosticLoad()}).on("click","#diagnostic-check",function(){a._diagnosticCheck()}).on("click","#diagnostic-check-repair",function(){a._diagnosticCheckRepair()}).on("click","#diagnostic-open",function(){a._diagnosticOpen()}).on("click","#diagnostic-minify",function(){a._diagnosticMinify()}).on("click","#diagnostic-beautify",function(){a._diagnosticBeautify()}).on("click","#diagnostic-dump-local-storage",function(){a._diagnosticDumpLocalStorage()}).on("click","#diagnostic-save-file",function(){a._diagnosticSaveFile()}),this.migrateToLocalForage()}},initAutoSave:function(){this.localSaveTimer=AppSeeds.Scheduler.create(FDBK.saveProjectLocally,null,this).repeat(FDBK.config("projectManagement.recovery.saveInterval")).now()},diagnostic:function(){this.$diagnosticDialog.find("textarea").val(""),this._diagnosticResult(null),FDBK.openModal("#project-diagnostic-dialog")},_diagnosticDumpLocalStorage:function(){function d(b){var c;try{c=JSON.stringify(JSON.parse(b),null,2)}catch(d){c=FDBK.localProject(b)}a.push(c)}function e(){var b=new Blob(a),c=URL.createObjectURL(b);window.open(c),window.focus()}function f(){var a=c._localProjects[b];FDBK.localProject(a.id,function(a){d(a),b++;if(b==c._localProjects.length)return e();f()})}var a=[],b=0,c=this;f()},_diagnosticOpen:function(){var a=this.$diagnosticDialog.find("textarea").val(),b;if(a){try{b=JSON.parse(a)}catch(c){console.info("Invalid JSON",c),this._diagnosticResult("JSON is invalid, check console for details.")}b&&(FDBK.library.closeCurrentProject(),b.uniqueId=null,FDBK.library.openProject(b),FDBK.closeModal("#project-diagnostic-dialog"))}else this._diagnosticResult("Diagnostic textarea is empty.")},_diagnosticSaveFile:function(){var a=this.$diagnosticDialog.find("textarea").val(),b;if(a){try{b=JSON.parse(a)}catch(c){console.info("Invalid JSON",c),this._diagnosticResult("JSON is invalid, check console for details.")}if(b){var d=new Blob([a],{type:"text/plain"}),e=URL.createObjectURL(d);window.open(e,"_blank"),window.focus()}}else this._diagnosticResult("Diagnostic textarea is empty.")},_diagnosticLoad:function(){this.$diagnosticDialog.find("textarea").val(JSON.stringify(FDBK.library.currentProject.toServerJSON(),null,2)),this._diagnosticResult(null)},_diagnosticResult:function(a){var b=this.$diagnosticDialog.find("#diagnostic-result");a===null?b.html(""):typeof a=="object"?b.html(Object.keys(a).map(function(b){return"<strong>"+b+"</strong> "+JSON.stringify(a[b])+" / "}).join("")):typeof a=="string"&&b.html(utils.sanitize(a))},_checkForErrors:function(a,b){var c={},d={},e=[],f=[],g=[],h=[],i=[],j=b?{}:null;for(var k=0;k<a.mockups.length;k++){var l=a.mockups[k];if(l.master){var m=a.mockups.some(function(a){return a.id==l.master});m||(i.push(l.master),b&&(l.master=null))}var n=function(a,d){for(var f=0;f<a.length;f++){var h=a[f];h?(b&&d&&h.id.split("-")[0]!==d&&(h.id=utils.guid(d+"-")),c[h.id]?(g.push(h.id),b&&(h.id=utils.guid(l.id+"-"))):c[h.id]=!0,h.type==="group"&&h.stencils&&n(h.stencils,b?d:null)):e.push([l.id,f])}b&&(l.stencils=l.stencils.filter(function(a){return a}))};l?(d[l.id]?(h.push(l.id),b&&(l.id=utils.guid("a"))):d[l.id]=!0,n(l.stencils,b?l.id:null)):f.push(k),b&&(a.mockups=a.mockups.filter(function(a){return a}))}return{duplicateMockups:h,duplicateStencils:g,nullStencils:e,nullMockups:f,missingMasters:i}},_diagnosticBeautify:function(){var a=this.$diagnosticDialog.find("textarea").val(),b;if(a){try{b=JSON.parse(a)}catch(c){console.info("Invalid JSON",c),this._diagnosticResult("JSON is invalid, check console for details.")}b&&(this.$diagnosticDialog.find("textarea").val(JSON.stringify(b,null,2)),this._diagnosticResult("JSON is now beautified"))}else this._diagnosticResult("Diagnostic textarea is empty.")},_diagnosticMinify:function(a){var b=this.$diagnosticDialog.find("textarea").val(),a;if(b){try{a=JSON.parse(b)}catch(c){console.info("Invalid JSON",c),this._diagnosticResult("JSON is invalid, check console for details.")}a&&(this.$diagnosticDialog.find("textarea").val(JSON.stringify(a)),this._diagnosticResult("JSON is now minified"))}else this._diagnosticResult("Diagnostic textarea is empty.")},_diagnosticCheck:function(){var a=this.$diagnosticDialog.find("textarea").val(),b;if(a){try{b=JSON.parse(a)}catch(c){console.info("Invalid JSON",c),this._diagnosticResult("JSON is invalid, check console for details.")}if(b){var d=this._checkForErrors(b,!1);this.$diagnosticDialog.find("textarea").val(JSON.stringify(b,null,2)),this._diagnosticResult(d)}}else this._diagnosticResult("Diagnostic textarea is empty.")},_diagnosticCheckRepair:function(){var a=this.$diagnosticDialog.find("textarea").val(),b;if(a){try{b=JSON.parse(a)}catch(c){console.info("Invalid JSON",c),this._diagnosticResult("JSON is invalid, check console for details.")}if(b){var d=this._checkForErrors(b,!0);this.$diagnosticDialog.find("textarea").val(JSON.stringify(b,null,2)),this._diagnosticResult(d)}}else this._diagnosticResult("Diagnostic textarea is empty.")},LS_PROJECT_KEY:"project:{id}",LS_GOOGLE_KEY:"google_unsaved",LS_PROJECTS_INFO_KEY:"projects",LS_PROJECTS_LIMIT:FDBK.config("projectManagement.recovery.limit"),migrateToLocalForage:function(){if(window.localforage.driver=="localStorageWrapper")return;for(var a in window.localStorage)window.localforage.setItem(a,window.localStorage[a]),window.localStorage.removeItem(a)},saveProjectLocally:function(a){a=a||{};var b=FDBK.library.currentProject;if(b){var c=b.uniqueId||"unsaved"+utils.guid(),d=0;c&&FDBK.library.serviceClient._doc&&(d=FDBK.library.serviceClient._doc.version,d+=FDBK.library.serviceClient._doc.inflightOp||FDBK.library.serviceClient._doc.pendingOp?1:0);var e=this;if(e._deniedLimitIncrease)return;window.localforage.setItem(this.LS_PROJECT_KEY.replace("{id}",c),JSON.stringify(b.toServerJSON())).then(function(f){e.updateProjectsInfo({id:c,name:b.name||FDBK.loc("_Untitled Project"),date:(new Date).toISOString(),version:d}),FDBK.pub("project-saved-locally",d),typeof a.onsuccess=="function"&&a.onsuccess.call(this,c,d)},function(b){b.code&&b.code==b.QUOTA_ERR&&(e._deniedLimitIncrease=!0),console.error("Error writing in offline storage",b),typeof a.onerror=="function"&&a.onerror.call(this)})}},openLocalProject:function(a){this.localProject(a,function(a){try{var b=JSON.parse(a);FDBK.library.closeCurrentProject(),b.uniqueId=null,FDBK.library.openProject(b),FDBK.closeModal()}catch(c){console.error("Error opening local project: JSON is malformed")}})},deleteLocalProject:function(a){var b=this;window.localforage.removeItem("project:"+a).then(function(){b._localProjects=b._localProjects.filter(function(b){return b.id!==a}),b.updateProjectsInfo()},function(a){console.info("Failed deleting offline project",a)})},deleteAllLocalProjects:function(){var a=this._localProjects;for(var b=0;b<a.length;b++)this.deleteLocalProject(a[b].id)},updateProjectsInfo:function(a){if(a){var b=this._localProjects.filter(function(b){return b.id===a.id});if(b&&b.length)b[0].date=a.date,b[0].name=a.name,b[0].version=a.version;else{this._localProjects.splice(0,0,a);while(this._localProjects.length>this.LS_PROJECTS_LIMIT){var c=this._localProjects[this._localProjects.length-1].id;this.deleteLocalProject(c),this._localProjects.splice(this._localProjects.length-1,1)}}}var d=this.serializeLocalProjects(this._localProjects);window.localforage.setItem(this.LS_PROJECTS_INFO_KEY,d).then(function(){},function(a){console.info("Failed saving projects info",a)})},showRecoveryDialog:function(){if(FDBK.config("projectManagement.recovery.enabled")){function a(){var a=this._localProjects;this.$projectsRecoveryDialog.empty().append(this.$projectsRecoveryTmpl.loc_tmpl({projects:a})),FDBK.openModal("#projects-recovery-dialog","recovery"),FDBK.library.animatedIntro.close()}FDBK._localProjectsLoaded?a.call(this):FDBK.sub("local-projects-loaded",a,this)}else FDBK.buildHash()},_deniedLimitIncrease:!1,deserializeLocalProjects:function(a){if(a)try{return JSON.parse(a)}catch(b){}return[]},serializeLocalProjects:function(a){return JSON.stringify(a)},localProject:function(a,b){return window.localforage.getItem("project:"+a,function(a){b(a)})},setGoogleKey:function(a){return window.localforage.setItem(this.LS_GOOGLE_KEY,a)},getGoogleKey:function(a){return window.localforage.getItem(this.LS_GOOGLE_KEY)},deleteGoogleKey:function(){return window.localforage.removeItem(this.LS_GOOGLE_KEY)},recoverGoogleProject:function(){FDBK.getGoogleKey().then(function(a){a&&FDBK.deleteGoogleKey().then(function(){FDBK.localProject(a,function(a){if(a)try{var b=JSON.parse(a);b.uniqueId=null,FDBK.library.closeCurrentProject(),FDBK.library.openProject(b),FDBK.CACHED_PROJECT=""}catch(c){console.error(c)}})},function(a){console.log(a)})},function(a){console.error(a)})},safelyLogInWithGoogle:function(a){this.saveProjectLocally({onsuccess:function(b,c){FDBK.setGoogleKey(b).then(function(){window.onbeforeunload=null,window.location.href=a},function(a){console.error(a)})},onerror:function(){}})}}),FDBK.defaultProjects.emptyProject={name:FDBK.loc("_Untitled Project"),mockups:[{name:FDBK.loc("_Untitled Page"),stageWidth:960,stageHeight:700,stencils:[]}],font:"font-sans"},FDBK.defaultProjects.sampleProjects=[{name:FDBK.loc("_Quick Introduction to Moqups"),stageWidth:960,stageHeight:660,font:"font-sans",mockups:[{id:"a16b2c2a4",name:"Playground",stageWidth:960,stageHeight:660,stencils:[{text:"Press F1 or ? for keyboard shortcuts",inspectables:{color:"#ffffff",font_size:14,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-heading-one",version:"1.0",left:621,top:433,width:246,height:18,id:"a16b2c2a4-107"},{text:"We've tried to make things simple and fairly intuitive so you can unleash your creativity without any obstacles.",inspectables:{color:"#000000",font_size:"14",text_align:"left"},type:"stencil",name:"tmplsvg-text",version:"1.0",left:97,top:105,width:785,height:22,id:"a16b2c2a4-104"},{text:"Stencils are objects that mimic various user interface elements. Some have editable content and other have configurable properties like color, shape, icon, states etc.\n\nEditable stencils can be spiced up with **bold**, *italic*, [links](http://example.com/) and more, using the standard Markdown syntax.\n",inspectables:{line_height:1.3,color:"#232323",font_size:16,text_align:"left"},type:"stencil",name:"tmplsvg-text",version:"1.0",left:97,top:297,width:763,height:103,id:"a16b2c2a4-101"},{text:"",inspectables:{bg:"#ffffff",stroke:"#444444",stroke_width:"2",stroke_style:"solid",checked:"checked",border:"true"},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:80,top:280,width:800,height:120,id:"a16b2c2a4-100"},{text:"Moqups is a nifty HTML5 App used to create wireframes, mockups or UI concepts, prototypes\ndepending on how you like to call them.",inspectables:{color:"#000000",font_size:18,text_align:"left"},type:"stencil",name:"tmplsvg-text",version:"1.0",left:97,top:55,width:783,height:50,id:"a16b2c2a4-97"},{text:"This is a bit tricky to master until you get a hold of it.",inspectables:{font_size:14,stroke_width:2,stroke_style:"solid",text_align:"left",icon:"",icon_size:16,line_height:1,color:"#444444",background_color:"rgba(242, 201, 251, 1)",stroke_color:"#444444",direction:"top-left"},type:"stencil",name:"tmplsvg-tooltip",version:"1.0",left:395,top:209,width:374,height:48,id:"a16b2c2a4-95"},{text:"Select and click again to configure",inspectables:{radius:4,color:"#000000",fill_color:"#f7f6f6",stroke_color:"#000000",icon:"icon-settings",dropdown:"",size:"16"},type:"stencil",name:"tmplsvg-button",version:"1.0",left:395,top:174,width:290,height:32,id:"a16b2c2a4-94"},{text:"Click to select",inspectables:{color:"#000000",fill_color:"#ffd783",stroke_color:"#000000",icon:"",orientation:"back"},type:"stencil",name:"tmplsvg-ios-button",version:"1.0",left:260,top:174,width:120,height:32,id:"a16b2c2a4-93"},{text:"Double click to edit",inspectables:{radius:4,color:"#000000",fill_color:"#f7f6f6",stroke_color:"#000000",icon:"icon-file-edit",dropdown:"",size:"16"},type:"stencil",name:"tmplsvg-button",version:"1.0",left:700,top:174,width:180,height:32,id:"a16b2c2a4-92"},{x:76,y:407,text:"undo/redo any changes",inspectables:{color:"#232323",font_size:18,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-heading-one",version:"1.0",left:135,top:566,width:192,height:23,id:"a16b2c2a4-90"},{text:"Icon",inspectables:{fill_color:"#232323",icon:"icon-undo",size:"24"},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:100,top:565,width:24,height:24,id:"a16b2c2a4-89"},{text:"Icon",inspectables:{foreground_color:"#232323",icon:"icon-share",size:"24"},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:530,top:522,width:24,height:24,id:"a16b2c2a4-87"},{x:76,y:407,text:"and much more to discover...",inspectables:{color:"#232323",font_size:18,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-heading-one",version:"1.0",left:565,top:566,width:237,height:23,id:"a16b2c2a4-77"},{x:135,y:419,text:"export or publish to PDF/PNG",inspectables:{color:"#232323",font_size:18,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-heading-one",version:"1.0",left:565,top:523,width:243,height:23,id:"a16b2c2a4-88"},{text:"Icon",inspectables:{fill_color:"#232323",icon:"icon-check",size:"24"},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:530,top:565,width:24,height:24,id:"a16b2c2a4-74"},{x:76,y:407,text:"type anywhere to search for stencils",inspectables:{color:"#232323",font_size:18,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-heading-one",version:"1.0",left:135,top:480,width:294,height:23,id:"a16b2c2a4-61"},{x:664,y:175,text:"Quick tips:",inspectables:{color:"#ffffff",font_size:20,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-label",version:"1.0",left:97,top:427,width:96,height:26,id:"a16b2c2a4-28"},{x:100,y:475,text:"",inspectables:{background_color:"#606060",stroke_color:"#000000",stroke_width:"0",stroke_style:"solid",corner_radius:"checked",brd:!1},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:80,top:420,width:800,height:38,id:"a16b2c2a4-91"},{x:76,y:407,text:"upload your own images",inspectables:{color:"#232323",font_size:18,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-heading-one",version:"1.0",left:566,top:480,width:198,height:23,id:"a16b2c2a4-47"},{x:135,y:379,text:"connect pages with links and hotspots",inspectables:{color:"#232323",font_size:18,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-heading-one",version:"1.0",left:135,top:524,width:313,height:23,id:"a16b2c2a4-46"},{text:"Icon",inspectables:{fill_color:"#232323",icon:"icon-image",size:"24"},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:530,top:479,width:24,height:24,id:"a16b2c2a4-60"},{text:"Icon",inspectables:{fill_color:"#232323",icon:"icon-link",size:"24"},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:100,top:522,width:24,height:24,id:"a16b2c2a4-59"},{text:"Icon",inspectables:{fill_color:"#232323",icon:"icon-find",size:"24"},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:100,top:477,width:24,height:24,id:"a16b2c2a4-26"},{text:"",inspectables:{bg:"#c9f1fd",stroke:"#000000",stroke_width:"2",stroke_style:"dashed",checked:"checked",border:"true"},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:80,top:40,width:800,height:100,id:"a16b2c2a4-99"},{text:"",inspectables:{background_color:"rgba(255, 255, 255, 1)",stroke_color:"rgba(96, 96, 96, 1)",stroke_width:"2",stroke_style:"solid",corner_radius:"checked",brd:!0},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:80,top:420,width:800,height:200,id:"a16b2c2a4-5dbec6fb"},{text:"Icon",inspectables:{fill_color:"#aedd94",icon:"icon-circle-question",size:"128"},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:100,top:163,width:94,height:94,id:"a16b2c2a4-103"}],master:null,isMaster:!1}],selectedStencilIndex:0,showInspector:!0},{name:FDBK.loc("_Quick Introduction to Moqups"),stageWidth:1e3,stageHeight:1140,font:"font-sans",mockups:[{id:"aa25af2ae",name:"Playground",stageWidth:1e3,stageHeight:1140,stencils:[{text:"Hey there! Welcome to Moqups...",inspectables:{color:"#ebebeb",font_size:26,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-heading-one",version:"1.0",left:38,top:282,width:382,height:34,id:"aa25af2ae-b87ed322"},{text:"",inspectables:{bg:"#444444",stroke:"#000000",stroke_width:"2",stroke_style:"solid",checked:"",border:""},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:20,top:271,width:448,height:47,id:"aa25af2ae-25329bfa"},{text:"Have any questions or issues? Use the Feedback widget in the bottom right corner of the application to contact us at any time!",inspectables:{color:"#7a7a7a",font_size:18,text_align:"center",line_height:"1.3",blokk:"false"},type:"stencil",name:"tmplsvg-text",version:"1.0",left:177,top:818,width:646,height:50,id:"aa25af2ae-8c8e670f"},{inspectables:{stroke:"#929292",stroke_width:"1",stroke_style:"dotted",line_marker_start:"false",line_marker_end:"false",_height:"1"},type:"stencil",name:"tmplsvg-horizontal-line",version:"1.0",left:713,top:541,width:215,height:2,id:"aa25af2ae-3db5cb45"},{inspectables:{stroke:"#929292",stroke_width:"1",stroke_style:"dotted",line_marker_start:"false",line_marker_end:"false",_height:"1"},type:"stencil",name:"tmplsvg-horizontal-line",version:"1.0",left:393,top:541,width:215,height:2,id:"aa25af2ae-c403c215"},{inspectables:{stroke:"#929292",stroke_width:"1",stroke_style:"dotted",line_marker_start:"false",line_marker_end:"false",_height:"1"},type:"stencil",name:"tmplsvg-horizontal-line",version:"1.0",left:715,top:711,width:215,height:2,id:"aa25af2ae-d5b11327"},{inspectables:{stroke:"#929292",stroke_width:"1",stroke_style:"dotted",line_marker_start:"false",line_marker_end:"false",_height:"1"},type:"stencil",name:"tmplsvg-horizontal-line",version:"1.0",left:393,top:711,width:215,height:2,id:"aa25af2ae-ea4b71c9"},{inspectables:{stroke:"#929292",stroke_width:"1",stroke_style:"dotted",line_marker_start:"false",line_marker_end:"false",_height:"1"},type:"stencil",name:"tmplsvg-horizontal-line",version:"1.0",left:73,top:711,width:215,height:2,id:"aa25af2ae-f49ac812"},{inspectables:{stroke:"#929292",stroke_width:"1",stroke_style:"dotted",line_marker_start:"false",line_marker_end:"false",_height:"1"},type:"stencil",name:"tmplsvg-horizontal-line",version:"1.0",left:73,top:541,width:215,height:2,id:"aa25af2ae-c562a8fa"},{text:"So what else can I do with Moqups?",inspectables:{color:"#7a7a7a",font_size:"26",text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-heading-one",version:"1.0",left:296,top:385,width:409,height:34,id:"aa25af2ae-efa22ec2"},{text:"So what else can I do with Moqups?",inspectables:{color:"#ffffff",font_size:"26",text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-heading-one",version:"1.0",left:296,top:386,width:409,height:34,id:"aa25af2ae-ed5ddf1e"},{text:"",inspectables:{bg:"#f7f6f6",stroke:"#000000",stroke_width:"2",stroke_style:"solid",checked:"",border:""},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:20,top:369,width:960,height:60,id:"aa25af2ae-94e929bf",locked:!1},{inspectables:{stroke:"#606060",stroke_width:"8",stroke_style:"solid",line_marker_start:"true",line_marker_end:"false",_height:"8"},type:"stencil",name:"tmplsvg-horizontal-line",version:"1.0",left:487,top:292,width:180,height:16,id:"aa25af2ae-cba9eaaf"},{text:"Some stencils have **editable content** and others have **configurable properties** like color, shape, states, etc.\n\nThere are stencils that don't have configuration options or they can't be edited at all.\n\nFeel free to play around with them to discover who's who.",inspectables:{color:"#000000",font_size:"14",text_align:"center",line_height:"1.3",blokk:"false"},type:"stencil",name:"tmplsvg-text",version:"1.0",left:667,top:135,width:284,height:211,id:"aa25af2ae-c559e598"},{text:"Have any questions or issues? Use the Feedback widget in the bottom right corner of the application to contact us at any time!",inspectables:{color:"#ffffff",font_size:18,text_align:"center",line_height:"1.3",blokk:"false"},type:"stencil",name:"tmplsvg-text",version:"1.0",left:177,top:819,width:646,height:50,id:"aa25af2ae-92ac110b"},{text:"",inspectables:{bg:"#f7f6f6",stroke:"#000000",stroke_width:"2",stroke_style:"solid",checked:"",border:""},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:20,top:798,width:960,height:90,id:"aa25af2ae-c0b2e9b4",locked:!1},{text:"Add team members or collaborators\nto view/edit and discuss on your projects\n",inspectables:{color:"#444444",font_size:"14",text_align:"center",line_height:"1.3",blokk:"false"},type:"stencil",name:"tmplsvg-text",version:"1.0",left:30,top:719,width:300,height:38,id:"aa25af2ae-39a5064e"},{text:"Connect your pages with links & hotspots\nto add interactivity in your project",inspectables:{color:"#444444",font_size:"14",text_align:"center",line_height:"1.3",blokk:"false"},type:"stencil",name:"tmplsvg-text",version:"1.0",left:30,top:549,width:300,height:38,id:"aa25af2ae-17988c8b"},{text:"Decide who can view or edit your projects\nwith granular privacy settings",inspectables:{color:"#444444",font_size:"14",text_align:"center",line_height:"1.3",blokk:"false"},type:"stencil",name:"tmplsvg-text",version:"1.0",left:350,top:719,width:300,height:38,id:"aa25af2ae-a424b198"},{text:"Icon",inspectables:{fill_color:"#606060",icon:"icon-link",size:"64",_width:64,_height:64},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:148,top:467,width:64,height:64,id:"aa25af2ae-694de351"},{text:"Icon",inspectables:{fill_color:"#606060",icon:"icon-lock",size:"64",_width:64,_height:64},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:468,top:636,width:64,height:64,id:"aa25af2ae-31844799"},{text:"Icon",inspectables:{fill_color:"#606060",icon:"icon-user-circle",size:"64",_width:64,_height:64},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:148,top:636,width:64,height:64,id:"aa25af2ae-49ca1e08"},{text:"",inspectables:{bg:"#d4e3fc",stroke:"#000000",stroke_width:"2",stroke_style:"solid",checked:"checked",border:""},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:30,top:450,width:300,height:150,id:"aa25af2ae-2e68a9b9"},{text:"",inspectables:{bg:"#d4e3fc",stroke:"#000000",stroke_width:"2",stroke_style:"solid",checked:"checked",border:""},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:350,top:620,width:300,height:150,id:"aa25af2ae-1367801e"},{text:"",inspectables:{bg:"#dfedd6",stroke:"#000000",stroke_width:"2",stroke_style:"solid",checked:"checked",border:""},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:30,top:620,width:300,height:150,id:"aa25af2ae-1dc18779"},{text:"Press F1 on Win or Cmd+Shift+/ on Mac\nto see a list of available shortcuts",inspectables:{color:"#444444",font_size:"14",text_align:"center",line_height:"1.3",blokk:"false"},type:"stencil",name:"tmplsvg-text",version:"1.0",left:670,top:719,width:300,height:38,id:"aa25af2ae-b33a2327"},{text:"Instantly share your mockups with anyone\nor export them to PDF or PNG\n",inspectables:{color:"#444444",font_size:"14",text_align:"center",line_height:"1.3",blokk:"false"},type:"stencil",name:"tmplsvg-text",version:"1.0",left:670,top:549,width:300,height:38,id:"aa25af2ae-a4209b21"},{text:"Copy & Paste or Drag & Drop\nto upload your own images",inspectables:{color:"#444444",font_size:"14",text_align:"center",line_height:"1.3",blokk:"false"},type:"stencil",name:"tmplsvg-text",version:"1.0",left:350,top:549,width:300,height:38,id:"aa25af2ae-738610cd"},{text:"Menu item",inspectables:{color:"#c0c0c0",font_size:16,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-label",version:"1.0",left:306,top:43,width:72,height:21,id:"aa25af2ae-7eb91c8b"},{text:"",inspectables:{bg:"#444444",stroke:"#000000",stroke_width:"2",stroke_style:"solid",checked:"",border:""},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:272,top:30,width:140,height:46,id:"aa25af2ae-5cab194b"},{text:"Icon",inspectables:{fill_color:"#606060",icon:"icon-share",size:"64",_width:64,_height:64},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:788,top:467,width:64,height:64,id:"aa25af2ae-02fc13ad"},{text:"Icon",inspectables:{fill_color:"#606060",icon:"icon-file-duplicate",size:"64",_width:64,_height:64},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:468,top:466,width:64,height:64,id:"aa25af2ae-c60f6e00"},{text:"Icon",inspectables:{fill_color:"#606060",icon:"icon-circle-question",size:"64",_width:64,_height:64},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:788,top:636,width:64,height:64,id:"aa25af2ae-308f1eca"},{text:"Click an item to select it,\nthen click again to configure.\nDouble click to edit.\n\nIt might be a bit tricky to master until you get a hold of it.",inspectables:{color:"#000000",font_size:"14",text_align:"center",line_height:1.3,blokk:"false"},type:"stencil",name:"tmplsvg-text",version:"1.0",left:61,top:122,width:199,height:117,id:"aa25af2ae-d64e2cdc"},{inspectables:{stroke:"#606060",stroke_width:"8",stroke_style:"solid",line_type:"arc",line_mode:"quadrant-four",line_marker_start:"false",line_marker_end:"true",resize_mode:"nesw"},type:"stencil",name:"tmplsvg-line",version:"1.0",left:254,top:81,width:93,height:91,id:"aa25af2ae-d5c8a58f"},{text:"*Type anywhere to search for stencils...*",inspectables:{color:"#7a7a7a",font_size:14,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-heading-one",version:"1.0",left:697,top:46,width:244,height:18,id:"aa25af2ae-3ecc5d4f"},{text:"Icon",inspectables:{fill_color:"#444444",icon:"icon-find",size:"16",_width:16,_height:16},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:676,top:45,width:16,height:16,id:"aa25af2ae-322db9e1"},{text:"",inspectables:{bg:"#f7f6f6",stroke:"#840705",stroke_width:"1",stroke_style:"solid",checked:"",border:""},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:668,top:37,width:306,height:32,id:"aa25af2ae-b17baa36"},{text:"Menu item",inspectables:{color:"#c0c0c0",font_size:16,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-label",version:"1.0",left:450,top:43,width:72,height:21,id:"aa25af2ae-7f5457e1"},{text:"",inspectables:{bg:"#444444",stroke:"#000000",stroke_width:"2",stroke_style:"solid",checked:"",border:""},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:413,top:30,width:567,height:46,id:"aa25af2ae-a9c18848"},{text:"Menu item",inspectables:{color:"#c0c0c0",font_size:16,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-label",version:"1.0",left:165,top:43,width:72,height:21,id:"aa25af2ae-6fb7b831"},{text:"",inspectables:{bg:"#444444",stroke:"#000000",stroke_width:"2",stroke_style:"solid",checked:"",border:""},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:131,top:30,width:140,height:46,id:"aa25af2ae-48ebaa23"},{text:"Home",inspectables:{color:"#ebebeb",font_size:16,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-label",version:"1.0",left:54,top:43,width:42,height:21,id:"aa25af2ae-76c4a350"},{text:"",inspectables:{bg:"#606060",stroke:"#000000",stroke_width:"2",stroke_style:"solid",checked:"",border:""},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:20,top:30,width:110,height:46,id:"aa25af2ae-7c751b50"},{text:"Privacy Policy  |  Terms & Conditions  |  FAQ  |  Contact",inspectables:{color:"#7a7a7a",font_size:11,text_align:"left",line_height:"1.3",blokk:"false"},type:"stencil",name:"tmplsvg-text",version:"1.0",left:40,top:1088,width:400,height:27,id:"aa25af2ae-44ebe505"},{text:"",inspectables:{bg:"#d4e3fc",stroke:"#000000",stroke_width:"2",stroke_style:"solid",checked:"checked",border:""},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:670,top:450,width:300,height:150,id:"aa25af2ae-7cde4094"},{text:"",inspectables:{bg:"#dfedd6",stroke:"#000000",stroke_width:"2",stroke_style:"solid",checked:"checked",border:""},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:350,top:450,width:300,height:150,id:"aa25af2ae-d8e44d1c"},{text:"",inspectables:{bg:"#dfedd6",stroke:"#000000",stroke_width:"2",stroke_style:"solid",checked:"checked",border:""},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:670,top:620,width:300,height:150,id:"aa25af2ae-a8e2395e"},{text:"Lorem ipsum dolor sitamet, consectetur adipiscingelit. Nulla quam velitvulputate Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla quam velit, vulputate",inspectables:{color:"#aaaaaa",font_size:"14",text_align:"left",line_height:1.8,blokk:"true"},type:"stencil",name:"tmplsvg-text",version:"1.0",left:40,top:919,width:482,height:103,id:"aa25af2ae-a3305f86"},{text:"Find us on Facebook",inspectables:{color:"#929292",font_size:13,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-label",version:"1.0",left:790,top:958,width:134,height:17,id:"aa25af2ae-f93edfcf"},{text:"Icon",inspectables:{fill_color:"#d6d6d6",icon:"icon-facebook",size:"16",_width:16,_height:16},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:930,top:957,width:16,height:16,id:"aa25af2ae-56595096"},{text:"Read our blog",inspectables:{color:"#929292",font_size:13,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-label",version:"1.0",left:831,top:986,width:80,height:17,id:"aa25af2ae-3ebe95b7"},{text:"Icon",inspectables:{fill_color:"#d6d6d6",icon:"icon-wordpress-alt",size:"16",_width:16,_height:16},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:930,top:986,width:16,height:16,id:"aa25af2ae-b66a21ee"},{text:"Find us on Twitter",inspectables:{color:"#929292",font_size:13,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-label",version:"1.0",left:808,top:929,width:116,height:17,id:"aa25af2ae-8b2ebaaa"},{text:"Icon",inspectables:{fill_color:"#d6d6d6",icon:"icon-twitter-alt",size:"24"},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:926,top:925,width:24,height:24,id:"aa25af2ae-b4f2e7f1"},{text:"Copyright  2013 | Awesome Company Inc.",inspectables:{color:"#444444",font_size:12,text_align:"left",line_height:"1.3",blokk:"false"},type:"stencil",name:"tmplsvg-text",version:"1.0",left:40,top:1068,width:256,height:23,id:"aa25af2ae-23a81607"},{text:"",inspectables:{bg:"#d6d6d6",stroke:"#000000",stroke_width:"2",stroke_style:"solid",checked:"",border:""},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:20,top:1050,width:960,height:70,id:"aa25af2ae-986c53a6"},{text:"",inspectables:{bg:"#444444",stroke:"#000000",stroke_width:"2",stroke_style:"solid",checked:"",border:""},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:20,top:889,width:960,height:160,id:"aa25af2ae-3ee71be0"},{text:"the nifty HTML5 wireframing tool.",inspectables:{color:"#606060",font_size:16,text_align:"left",line_height:"1.3",blokk:"false"},type:"stencil",name:"tmplsvg-text",version:"1.0",left:38,top:323,width:316,height:30,id:"aa25af2ae-8a7cf650"},{inspectables:{stroke:"#c0c0c0",stroke_width:"1",stroke_style:"solid",line_marker_start:"false",line_marker_end:"false",_height:"1"},type:"stencil",name:"tmplsvg-horizontal-line",version:"1.0",left:20,top:367,width:960,height:2,id:"aa25af2ae-448a5e68"},{text:"",inspectables:{bg:"#d6d6d6",stroke:"#000000",stroke_width:"2",stroke_style:"solid",checked:"",border:""},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:20,top:20,width:960,height:66,id:"aa25af2ae-a14749c8"},{type:"stencil",name:"tmplsvg-image-placeholder-2",version:"1.0",left:260,top:87,width:420,height:280,id:"aa25af2ae-9bf06572",locked:!1},{text:"",inspectables:{bg:"#E6E6E6",stroke:"#000000",stroke_width:"2",stroke_style:"solid",checked:"",border:""},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:20,top:87,width:960,height:280,id:"aa25af2ae-ca089420"}],master:null,isMaster:!1}],selectedStencilIndex:61,showInspector:!1}];var MODULE=function(a,b){var c=0,d=null,e=0,f=null,g=b("#project-export-status"),h=null,i=null,j={LOCAL:{url:FDBK.API.CALL_EXPORT_LOCAL,needsAuth:!1,id:"localexport",icon:"cloudDownload",display:"My Computer",onSuccess:function(a){a.object.status=="success"&&a.object.url&&w(a.object.url),n(),d=null}},GOOGLE_DRIVE:{url:FDBK.API.CALL_EXPORT_GOOGLE_DRIVE,needsAuth:!0,id:"googledrive",icon:"googledrive",display:"Google Drive",onSuccess:function(){FDBK.openConfirmDialog({heading:FDBK.loc("_Export finished!"),message:FDBK.loc("_The project was exported to your Google Drive account."),buttons:[{text:FDBK.loc("_Close"),classes:"right"}]})}},DROPBOX:{url:FDBK.API.CALL_EXPORT_DROPBOX,needsAuth:!0,id:"dropbox",icon:"dropbox",display:"Dropbox",onSuccess:function(){FDBK.openConfirmDialog({heading:FDBK.loc("_Export finished!"),message:FDBK.loc("_The project was exported to your Dropbox account."),buttons:[{text:FDBK.loc("_Close"),classes:"right"}]})}}};a.showExport=function(){if(a.isUserLoggedIn())if(a.currentProject.isNew())a.saveProject(!0,function(){a.showExport()});else{if(d){FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There is an export in progress. Please try again after it's finished."),buttons:[{text:FDBK.loc("_Close"),classes:"close-modal"}]});return}FDBK.openModal("#export-dialog"),k()}else a.askForSession()};var k=function(){b("#export-pages .export-page").remove();var a=FDBK.library.currentProject.normalPages(),c=a.length;if(c<1)b("#export-no-pages").show(),b("#export-with-pages").hide();else{b("#export-no-pages").hide(),b("#export-with-pages").show(),c>1?b(".page-options").show():b(".page-options").hide(),FDBK.library.currentMockup.isMaster||b("#export-pages").append(b("<option></option>").val(FDBK.library.currentProject.indexOfNormalPage(FDBK.library.currentMockup.id)+1).text("-- Current Page --").addClass("export-page"));var d;for(var e=0;e<c;e++)d=utils.pad(a[e].name,"",FDBK.library.currentProject.pageDepth(a[e])),b("#export-pages").append(b("<option></option>").val(e+1).text(d).addClass("export-page"));b("#export-range-from").attr("max",utils.sanitize(c)),b("#export-range-to").attr("max",utils.sanitize(c)),b("#export-range-to").val(c),b(".export-buttons").empty();for(var f in j){var g=j[f];b(".export-buttons").append('<a href="#" data-service="'+f+'" class="button simple start-export">'+'<span class="mq-svg-icon" data-icon="'+g.icon+'-20" style="margin-right:5px;"></span>'+g.display+"</a>"),FDBK.generateSVGIcons(b("#export-form"))}}};b("#export-type").change(function(){var a=b("#export-type option:selected");b(".export-state").hide();switch(b(a).val()){case"all":break;case"single":b(".export-state-single").show();break;case"range":b(".export-state-range").show()}}),b("#export-form").on("click",".start-export",function(c){if(!FDBK.allowExport()){FDBK.showExportAlert();return}var d=b(c.currentTarget).data("service");i=j[d];var e=b(".export-format:checked").val(),f=b("#export-type option:selected").val(),g,h;f=="all"&&FDBK.library.currentProject.normalPages().length==1&&(f="single"),f=="single"?g=h=b("#export-pages option:selected").val():f=="range"&&(g=b("#export-range-from").val(),h=b("#export-range-to").val());var k;if(f=="all"||f=="range")k=FDBK.library.currentProject.name||"Untitled";else if(f=="single"){var l=FDBK.library.currentProject.normalPages()[Math.max(0,g-1)];k=l.name}else k="Untitled";e&&f&&a.exportProject(d,e,{name:k,range:f,startPage:g,endPage:h})}),a.exportProject=function(b,d,e){h=d;var f=j[b].url;j[b].needsAuth&&s();var i=FDBK.allowExport()?"Paid":"Free";FDBK.trackEvent("Export",i,"Export "+d.toUpperCase()),FDBK.openConfirmDialog({heading:FDBK.loc("_Export Project"),message:FDBK.loc("_Please wait, your export is in progress...")+' (<span id="export-progress-count-1">0</span>%)',buttons:[{text:FDBK.loc("_Export in the background"),classes:"close-modal"}]}),g.html(FDBK.loc("_Export in progress...")+' (<span id="export-progress-count-2">0</span>%)').addClass("shown"),c=0,a.currentProject.isClean()?o(f,e):a.saveProject(!0,function(){o(f,e)})};var l=function(){n(),u();var b=function(a){a&&(g.html(FDBK.loc("_Export failed")).addClass("shown"),setTimeout(function(){g.removeClass("shown")},3e3),FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error exporting your project. Please try again."),buttons:[{text:FDBK.loc("_Close"),classes:"close-modal"}]}),FDBK.unsub("session-check-result",b))};FDBK.sub("session-check-result",b),a.checkSession()},m=function(){n(),f=AppSeeds.Scheduler.create(v,[],this).repeat(FDBK.config("export.checkStatusInterval")).now()},n=function(){e=0,f&&f.stop()},o=function(b,c){b&&c&&FDBK.API.xhr(b,{urlParams:[h],data:{name:c.name,projectUniqueId:a.currentProject.uniqueId,range:c.range,startPage:c.startPage,endPage:c.endPage},contentType:"application/x-www-form-urlencoded",success:function(a){a.success?(a.object.authorizationUrl?(FDBK.openConfirmDialog({heading:FDBK.loc("_Export Project"),message:FDBK.loc("_Please wait, your export is in progress...")+' (<span id="export-progress-count-1">0</span>%)',buttons:[{text:FDBK.loc("_Export in the background"),classes:"close-modal"},{text:FDBK.loc("_Cancel"),classes:"close-modal right cancel-auth-button",onClick:function(){g.removeClass("shown"),u(),n(),d=null}}]}),t(a.object.authorizationUrl)):u(),d=a.object.exportId,m()):l()},error:function(){l()}})},p,q,r=!1,s=function(){p=window.open("about:blank","Authorize","height=600,width=1000"),p.focus(),r=!1,q=AppSeeds.Scheduler.create(function(){if(!p||p.closed)r=!0,q.stop()}).repeat(1e3).now()},t=function(a){if(!p)return;try{p.location.href=a}catch(b){}window.focus&&p.focus()},u=function(a){if(!p)return;p.close(),p=null},v=function(){if(!d){l(),n();return}FDBK.API.xhr(FDBK.API.CALL_GET_EXPORT_STATUS,{data:{exportId:d},success:function(a){e=0;if(a.success&&a.object){if(a.object.status=="inprogress"){b(".cancel-auth-button").hide();var f=a.object.progress||0;if(b("#export-progress-count-1").length)var h=(new countUp("export-progress-count-1",c,f,0,3)).start();if(b("#export-progress-count-2").length)var j=(new countUp("export-progress-count-2",c,f,0,3)).start();c=f}r&&a.object.status=="auth_wait"&&(r=!1,n(),d=null,g.html(FDBK.loc("_Export failed")).addClass("shown"),setTimeout(function(){g.removeClass("shown")},3e3),FDBK.closeModal());if(a.object.status=="success"){n(),d=null;if(b("#export-progress-count-1").length)var h=(new countUp("export-progress-count-1",c,100,0,1.5)).start();if(b("#export-progress-count-2").length)var j=(new countUp("export-progress-count-2",c,100,0,1.5)).start(function(){i.onSuccess&&i.onSuccess(a),g.html(FDBK.loc("_Export finished!")).addClass("shown"),FDBK.closeModal(),u(),setTimeout(function(){g.removeClass("shown")},3e3)})}else if(a.object.status=="fail"||a.object.status=="auth_fail")l(),n(),d=null,u()}else e+=1,e==3&&l()},error:function(){e+=1,e==3&&l()}})},w=function(a){b("[name=exportIframe]").remove();if(!a)return;a=FDBK.BASE_URL+a;var c=b('<iframe src="'+a+'" name="exportIframe"></iframe>');c.appendTo("body")};return a}(MODULE||{},jQuery);FDBK.mixinModule("publish-project",{publishHistory:[],publishToken:null,publishProgress:0,genericError:FDBK.loc("_Oops. Something went wrong. Please try again."),maxRange:0,initModule:function(){var a=this;$(document).on("change","[name=publish-format]",function(){$(".publish-format").hide(),$(this).val()==="pdf"?$(".publish-format.pdf").show():$(".publish-format.png").show()}),$(document).on("change","[name=publish-type]",function(){$(this).siblings(".publish-option").hide(),$(this).siblings("[data-type="+$(this).val()+"]").show()}),$(document).on("click",".publish-button",function(b){a.publishProject($("[name=publish-format]:checked").val()),a.disablePublish()}),$(document).on("click",'[data-seeds-action="deletePublishedItem"]',function(){if($(this).hasClass("disabled"))return;var b=$(this).data("id");confirm(FDBK.loc("Are you sure you want to delete this item?"))&&a.deletePublishedItem(b)}),$(document).on("click",'[data-seeds-action="toggleCopyMode"]',function(){if($(this).hasClass("disabled"))return;var a=$(this).parents(".publish-item");a.toggleClass("copy-mode")}),$(document).on("click",".publish-item input",function(){this.setSelectionRange(0,1e3)}),FDBK.sub("modal-closed",function(b){b==="#publish-dialog"&&a.cancelPublish()})},showPublish:function(){var a=this,b=FDBK.library.currentProject.normalPages(),c=b.length,d=null;a.maxRange=c,a.enablePublish(),$("#publish-history").html('<div class="publish-item">Loading history...</div>'),$("[name=publish-range-from]").attr("max",utils.sanitize(c)),$("[name=publish-range-to]").attr("max",utils.sanitize(c)),$("[name=publish-range-to]").val(c),FDBK.library.currentMockup.isMaster?$("[name=publish-pages]").empty():$("[name=publish-pages]").html($("<option></option>").val(FDBK.library.currentProject.indexOfNormalPage(FDBK.library.currentMockup.id)+1).text("-- Current Page --").addClass("export-page"));for(var e=0;e<c;e++)d=utils.pad(b[e].name,"",FDBK.library.currentProject.pageDepth(b[e])),$("[name=publish-pages]").append($("<option></option>").val(e+1).text(d).addClass("export-page"));FDBK.openModal("#publish-dialog"),a.getPublishHistory()},getPublishHistory:function(){var a=this;FDBK.API.xhr(FDBK.API.CALL_PUBLISH_LIST,{restParams:{projectUniqueId:FDBK.library.currentProject.uniqueId},success:function(b){b&&b.success?(a.publishHistory=b.object.reverse(),a.generatePublishHistory()):FDBK.genericErrorDialog()},error:function(){FDBK.genericErrorDialog()}})},generatePublishHistory:function(){var a=this;$("#publish-history").html($("#tmpl-publish-history").loc_tmpl({items:a.publishHistory,publishProgress:a.publishProgress}))},getPublishedItemIndex:function(a){var b=this,c=null;return $.each(b.publishHistory,function(b,d){d.uniqueId===a&&(c=b)}),c},enablePublish:function(){$(".publish-button").removeClass("disabled"),$("#publish-form").find("input, select").prop("disabled",!1)},disablePublish:function(){$(".publish-button").addClass("disabled"),$("#publish-form").find("input, select").prop("disabled",!0)},publishProject:function(a){if(!FDBK.allowExport()){FDBK.showPublishAlert();return}var b=this,c=FDBK.allowExport()?"Paid":"Free";FDBK.trackEvent("Publish",c,"Publish "+a.toUpperCase());switch(a){case"pdf":var d={range:$("[name=publish-type]").val()};if(d.range==="single")d.startPage=$("#publish-pages-pdf").val(),d.endPage=$("#publish-pages-pdf").val();else if(d.range==="range"){var e=Math.abs(parseInt($("[name=publish-range-from]").val()))||1,f=Math.abs(parseInt($("[name=publish-range-to]").val()))||b.maxRange;d.startPage=e>b.maxRange||e>f?1:e,d.endPage=f>b.maxRange?b.maxRange:f}FDBK.API.xhr(FDBK.API.CALL_PUBLISH_PDF,{restParams:{projectUniqueId:FDBK.library.currentProject.uniqueId},data:d,contentType:"application/x-www-form-urlencoded",success:function(c){c&&c.success&&c.object?b.startPublish(a,c.object.publishUniqueId):FDBK.genericErrorDialog()},error:function(a){a.status==403?FDBK.showUploadLimitAlert():FDBK.genericErrorDialog()}});break;case"png":FDBK.API.xhr(FDBK.API.CALL_PUBLISH_PNG,{restParams:{projectUniqueId:FDBK.library.currentProject.uniqueId},data:{range:"single",startPage:$("#publish-pages-png").val(),endPage:$("#publish-pages-png").val()},contentType:"application/x-www-form-urlencoded",success:function(c){c&&c.success&&c.object?b.startPublish(a,c.object.publishUniqueId):FDBK.genericErrorDialog()},error:function(a){a.status==403?FDBK.showUploadLimitAlert():FDBK.genericErrorDialog()}});break;case"png2x":FDBK.API.xhr(FDBK.API.CALL_PUBLISH_PNG2X,{restParams:{projectUniqueId:FDBK.library.currentProject.uniqueId},data:{range:"single",startPage:$("#publish-pages-png").val(),endPage:$("#publish-pages-png").val()},contentType:"application/x-www-form-urlencoded",success:function(c){c&&c.success&&c.object?b.startPublish(a,c.object.publishUniqueId):FDBK.genericErrorDialog()},error:function(a){a.status==403?FDBK.showUploadLimitAlert():FDBK.genericErrorDialog()}})}},startPublish:function(a,b){var c=this;b?(c.publishToken=b,c.checkPublishStatus(),c.addPublishItem({uniqueId:"progress",mime:a}),FDBK.cleanServerError()):c.cancelPublish()},checkPublishStatus:function(){var a=this;if(!a.publishToken)return;window.setTimeout(function(){FDBK.API.xhr(FDBK.API.CALL_PUBLISH_STATUS,{restParams:{publishUniqueId:a.publishToken},success:function(b){if(b&&b.success)if(b.object.status=="inprogress"){if($("#publish-progress-count").length)var c=(new countUp("publish-progress-count",a.publishProgress,b.object.progress,0,2)).start();a.publishProgress=b.object.progress,a.checkPublishStatus()}else if(b.object.status=="success")if($("#publish-progress-count").length)var c=(new countUp("publish-progress-count",a.publishProgress,100,0,2)).start(function(){a.finishPublish(b.object.publish)});else a.finishPublish();else a.cancelPublish();else a.cancelPublish()},error:function(){a.cancelPublish()}})},2e3)},cancelPublish:function(){var a=this;a.publishToken=null,a.publishProgress=0,FDBK.showServerError({message:FDBK.loc(a.genericError),style:"error"}),a.removePublishItem("progress"),a.enablePublish(),a.generatePublishHistory()},finishPublish:function(a){this.publishToken=null,this.publishProgress=0,this.removePublishItem("progress"),this.addPublishItem(a),this.enablePublish(),this.generatePublishHistory(),$("#publish-item-"+a.uniqueId).toggleClass("copy-mode")},addPublishItem:function(a){FDBK.hideTooltip(),this.publishHistory.unshift(a),this.generatePublishHistory()},removePublishItem:function(a){var b=this.getPublishedItemIndex(a);if(b==null)return;FDBK.hideTooltip(),this.publishHistory.splice(b,1),this.generatePublishHistory()},deletePublishedItem:function(a){var b=this;$("#publish-item-"+a).find(".button").addClass("disabled"),FDBK.API.xhr(FDBK.API.CALL_PUBLISH_DELETE,{restParams:{publishId:a},success:function(c){$("#publish-item-"+a).find(".button").removeClass("disabled"),c&&c.success?b.removePublishItem(a):c&&c.message?FDBK.showServerError({message:FDBK.loc(c.message),style:"error"}):FDBK.showServerError({message:FDBK.loc(b.genericError),style:"error"})},error:function(){FDBK.genericErrorDialog()}})}});var MODULE=function(a,b){function j(a){var d=b(a.currentTarget),f=b(a.currentTarget).css("backgroundColor");if(!(d.closest(".recent-colors").length>0&&d.hasClass("active")||d.closest(".all-colors").length))return;if(!e.is(":focus")){var g=utils.rgbaObjectFromColorString(f),h=b(a.currentTarget).closest(".recent-colors").length>0?parseFloat(g.a)*100:c.getOpacity();c.preview({color:f,opacity:h}),e.val(utils.rgbaObjectToHex(g).toUpperCase())}}function k(){e.is(":focus")||(c.preview(),e.val(c.getHexColor().toUpperCase()))}function l(a){a=a||!1,g.slider("value",c.getOpacity()),h.val(c.getOpacity()+"%"),f.on("mousemove","span",j),f.on("mouseout",".colorPicker",k),e.on("keydown",m),e.on("keyup",n),h.on("keydown",p),h.on("keyup",q),d||s();var l=c.getRecentColors();for(var o=0;o<i.length;o++){if(!(o<l.length))break;b(i[o]).addClass("active"),b(i[o]).css("backgroundColor",l[o])}e.val(c.getHexColor().toUpperCase());if(d[c.getHexColor()])d[c.getHexColor()].addClass("selected");else for(var o=0;o<i.length;o++)if(utils.rgbaObjectToString(utils.rgbaObjectFromColorString(b(i[o]).css("backgroundColor")))==c.getCSSColor()){b(i[o]).addClass("selected");break}a?f.show("fade",100):f.show(),b("body").one("click",function(a){b(a.target).closest("#colorPickerPanel").length===0&&f.is(":visible")&&r()})}function m(a){var c=b(a.currentTarget),d=c.val();if(a.shiftKey&&a.which>=48&&a.which<=57)return a.which==51&&d.indexOf("#")==-1?!0:!1;if(a.ctrlKey||a.metaKey||a.altKey)return!0;if(a.which>70&&a.which<91)return!1}function n(a){var b=e.val();b.length>0&&b[0]!="#"&&(b="#"+b,e.val(b));if(a.which==27){e.val(c.getHexColor().toUpperCase()).blur(),c.preview();return}c.setColor(o(b));if(a.which==13){b=o(b),b.length!=7&&b.length!=4&&(b=c.getHexColor()),c.apply(),r();return}f.find("span").removeClass("selected"),d[c.getHexColor()]&&d[c.getHexColor()].addClass("selected")}function o(a){a=a.replace("#","");if(a.length==0)return"000000";if(a.length==6)return a;if(a.length==3)return a[0]+a[0]+a[1]+a[1]+a[2]+a[2];var b=a+a;do b+=a;while(b.length<6);return b.substring(0,6)}function p(a){var d=b(a.currentTarget);if(a.which>57&&!a.ctrlKey&&!a.metaKey&&!a.altKey||a.shiftKey)return!1;var e;a.which==40&&(e=Math.min(100,Math.max(0,parseInt(d.val().replace("%",""),10)-1))),a.which==38&&(e=Math.min(100,Math.max(0,parseInt(d.val().replace("%",""),10)+1))),e!==undefined&&(isNaN(e)?g.slider("value",0):(g.slider("value",e),h.val(e+"%"),c.setOpacity(e)))}function q(a){var d=b(a.currentTarget),e=Math.min(100,Math.max(0,parseFloat(d.val().replace("%",""),10)));if(a.which==27){e=c.getOpacity(),g.slider("value",e),h.val(e+"%"),c.preview();return}isNaN(e)?g.slider("value",0):(g.slider("value",e),c.setOpacity(e));if(a.which==13){c.setOpacity(e),c.apply();return}}function r(){f.hide("fade",100),f.off("mousemove","span",j),f.off("mouseout",".colorPicker",k),e.off("keydown",m),e.off("keyup",n),h.off("keydown",p),h.off("keyup",q),e.blur()}function s(){d={};var a=b(".colorPicker.all-colors").find("span"),c;for(var e=0;e<a.length;e++)c=utils.rgb2hex(b(a[e]).css("backgroundColor"))+"",d[c]=b(a[e])}function t(a){var b=utils.optimalPopoverPosition(a,f);f.find(".popoverTail").removeClass("popoverTailDown popoverTailLeft popoverTailRight popoverTailNone").addClass(b.popoverTailClass),f.css({left:b.left,top:b.top,opacity:1})}var c={previewArea:null,previewOpaqueBorder:null,_target:null,_colorObject:null,_recentColors:[],init:function(a){this._target=b(a);var c=this._target.find("div").css("backgroundColor");this._colorObject=utils.rgbaObjectFromColorString(c),this.preview()},getOpacity:function(){return Math.round(this._colorObject.a*100)},setOpacity:function(a){this._colorObject.a=a/100,this.preview()},setColor:function(a){var b=utils.rgbaObjectFromColorString(a);this._colorObject.r=b.r,this._colorObject.g=b.g,this._colorObject.b=b.b,this.preview()},getCSSColor:function(){return utils.rgbaObjectToString(this._colorObject)},getHexColor:function(){return utils.rgbaObjectToHex(this._colorObject)},preview:function(a){a=a||{};var b=a.color,c=a.opacity;if(b){var d=utils.rgbaObjectFromColorString(b);c!==undefined?d.a=c/100:d.a=this._colorObject.a,this.previewArea.css("backgroundColor",utils.rgbaObjectToString(d)),this.previewOpaqueBorder.css("box-shadow","0 0 0 1px "+utils.rgbaObjectToString(d)+" inset")}else if(c){var d={r:this._colorObject.r,g:this._colorObject.g,b:this._colorObject.b,a:c/100};this.previewArea.css("backgroundColor",utils.rgbaObjectToString(d)),this.previewOpaqueBorder.css("box-shadow","0 0 0 1px "+utils.rgbaObjectToString(d)+" inset")}else this.previewArea.css("backgroundColor",this.getCSSColor()),this.previewOpaqueBorder.css("box-shadow","0 0 0 1px "+this.getCSSColor()+" inset")},apply:function(){var a=this.getCSSColor();this._target.find("div").css("backgroundColor",a),this._target.removeClass("no-color"),this._target.trigger("change",a);var b=this._recentColors.filter(function(b){return utils.rgbaObjectToString(utils.rgbaObjectFromColorString(b))===utils.rgbaObjectToString(utils.rgbaObjectFromColorString(a))});b.length===0&&this._recentColors.push(a)},getRecentColors:function(){return this._recentColors.slice(-12)}};c.previewArea=b("#colorPickerPanel .colorOutlet"),c.previewOpaqueBorder=b("#colorPickerPanel .colorPreview");var d=null,e=b("#colorCode"),f=b("#colorPickerPanel"),g=b(".opacitySlider"),h=b("#opacityValue"),i=b(".colorPicker.recent-colors").find("span").toArray().reverse();return g.slider({value:g.data("val"),min:0,max:101}),g.on("slidestart",function(b){a.preventClearSelection(!0)}).on("slidestop",function(b){a.preventClearSelection(!1)}).on("slide",function(a){var d=b(a.currentTarget).slider("value");c.setOpacity(d),h.val(d+"%")}).on("slidechange",function(a){if(!a.originalEvent)return;var d=b(a.currentTarget).slider("value");c.setOpacity(d)}),f.on("click","span",function(a){var d=b(a.currentTarget);if(!(d.closest(".recent-colors").length>0&&d.hasClass("active")||d.closest(".all-colors").length))return;f.find("span").removeClass("selected");var e=b(a.currentTarget).css("backgroundColor"),g=utils.rgbaObjectFromColorString(e);c.setColor(e),b(a.currentTarget).closest(".recent-colors").length>0&&c.setOpacity(g.a*100),c.apply()}),f.on("color-picker",function(a,d){c.init(b(d)),f.find("span").removeClass("selected"),f.is(":visible")?r():(t(b(d)),l(!0))}),b("#applyColor").on("click",function(){var a=o(e.val());a.length!=7&&a.length!=4&&(a=c.getHexColor()),c.setColor(a),c.apply(),r()}),b("body").on("click",".color-picker",function(a){f.trigger("color-picker",a.currentTarget),a.stopImmediatePropagation()}),a.colorPicker={hide:r},a}(MODULE||{},jQuery),MODULE=function(a,b){var c=b("#inspector");return b("#iconPickerPanel").on("changeIcon",function(c,d){var e=b(c.currentTarget).data("key")||"icon",f={};f[e]=d,a.inspect(c,f)}),c.on("change","#color-text",function(b,c){a.inspect(b,{color:c})}),c.on("change","#size-text",function(c){a.inspect(c,{font_size:Math.max(6,parseInt(c.target.value,10)||0)}),b(this).blur()}),c.on("change","#line-height-text",function(c){a.inspect(c,{line_height:parseFloat(c.target.value)}),b(this).blur()}),c.on("change","#blokk-text",function(c){a.inspect(c,{blokk:b(c.target).is(":checked")?"true":"false"})}),c.on("change","#color-background",function(b,c){a.inspect(b,{bg:c})}),c.on("change","#color-stroke",function(b,c){a.inspect(b,{stroke:c})}),c.on("click","#inspectable_checked",function(b){a.inspect(b,{checked:b.currentTarget.checked?"checked":""})}),c.on("click","#inspectable_radius",function(b){a.inspect(b,{corners_rounded:b.currentTarget.checked})}),c.on("click","#inspectable_disabled",function(b,c){a.inspect(b,{disabled:b.currentTarget.checked?"checked":""})}),c.on("click",".tooltipTailButton",function(c,d){a.inspect(c,{direction:b(c.currentTarget).data("type")})}),c.on("click",".shapeTypeButton",function(c,d){a.inspect(c,{type:b(c.currentTarget).data("type")})}),c.on("click",".textAlignButton",function(c,d){a.inspect(c,{text_align:b(c.currentTarget).data("align")})}),c.on("change","input[name=inspectable_ios_switch]:radio",function(c){a.inspect(c,{checked:c.target.value=="true"?"checked":""}),b(this).blur()}),c.on("change","input[name=inspectable_avatar]:radio",function(c){a.inspect(c,{type:c.target.value}),b(this).blur()}),c.on("change","input[name=inspectable_ios_keyboard]:radio",function(c){a.inspect(c,{keyboard_type:c.target.value}),b(this).blur()}),c.on("change","input[name=inspectable_window_type]:radio",function(c){a.inspect(c,{type:c.target.value}),b(this).blur()}),c.on("change","input[name=inspectable_ribbon]:radio",function(c){a.inspect(c,{type:c.target.value}),b(this).blur()}),c.on("change","input[name=inspectable_tab_bar]:radio",function(c){a.inspect(c,{mode:c.target.value}),b(this).blur()}),c.on("click",".buttonRadiusButton",function(c){a.inspect(c,{radius:b(c.currentTarget).data("type")})}),c.on("click","#inspectable_button_dropdown",function(b){a.inspect(b,{dropdown:b.currentTarget.checked?"true":""})}),c.on("click",".buttonOrientationButton",function(c){a.inspect(c,{orientation:b(c.currentTarget).data("type")})}),c.on("change","#inspectable_banner_size",function(c){if(c.target.value){var d=c.target.value.match(/(\d+)\*(\d+)/);a.inspect(c,{text:c.target.value,_width:d[1],_height:d[2]})}b(this).blur()}),c.bind("DOMNodeInserted",function(a){var c=b(a.target);c.hasClass("inspectableSlider")&&c.slider({value:c.data("val"),min:0,max:50})}),c.on("slidestart",".inspectableSlider",function(b){a.preventClearSelection(!0)}).on("slidestop",".inspectableSlider",function(b){a.preventClearSelection(!1)}).on("slidechange",".inspectableSlider",function(c){var d={},e=b(c.currentTarget).slider("value"),f=b(c.currentTarget).data("insp");d[f]=e,a.inspect(c,d)}),c.on("change","input[name=inspectable_iphone_orientation]:radio",function(b){var c=b.target.value,d,e;c=="portrait"?(d=250,e=491):(d=491,e=250),a.inspect(b,{orientation:b.target.value,_width:d,_height:e})}),c.on("change","input[name=inspectable_ipad_orientation]:radio",function(b){var c=b.target.value,d,e;c=="portrait"?(d=537,e=687):(d=687,e=537),a.inspect(b,{orientation:b.target.value,_width:d,_height:e})}),c.on("click","#inspectable_ios_menu_background",function(b){b.currentTarget.checked?a.inspect(b,{background:"true"}):a.inspect(b,{background:""})}),c.on("click","#inspectable-grid-header",function(b){b.currentTarget.checked?a.inspect(b,{header:"true"}):a.inspect(b,{header:""})}),c.on("click","#inspectable-grid-zebra",function(b){b.currentTarget.checked?a.inspect(b,{zebra:"true"}):a.inspect(b,{zebra:""})}),c.on("click","#inspectable-grid-sortable",function(b){b.currentTarget.checked?a.inspect(b,{sortable:"true"}):a.inspect(b,{sortable:""})}),c.on("click","#inspectable-grid-border",function(b){b.currentTarget.checked?a.inspect(b,{border:"true"}):a.inspect(b,{border:""})}),c.on("click","#inspectable-grid-vertical-lines",function(b){b.currentTarget.checked?a.inspect(b,{vertical_lines:"true"}):a.inspect(b,{vertical_lines:""})}),c.on("click","#inspectable-grid-horizontal-lines",function(b){b.currentTarget.checked?a.inspect(b,{horizontal_lines:"true"}):a.inspect(b,{horizontal_lines:""})}),c.on("change",".color-picker",function(c,d){var e=b(c.currentTarget).data("type");if(e){var f={};f[e]=d,a.inspect(c,f)}}),c.on("change","#inspectable_icon_size",function(c){a.inspect(c,{icon_size:c.target.value}),b(this).blur()}),c.on("change","#inspectable_size_preset",function(c){a.inspect(c,{size:c.target.value,_width:c.target.value,_height:c.target.value}),b(this).blur()}),c.on("click","#inspectable_border",function(b){b.currentTarget.checked?a.inspect(b,{border:"true"}):a.inspect(b,{border:""})}),c.on("change","#inspectable-stroke-width",function(c){var d,e;b(c.currentTarget).data("type")=="horizontal"&&(d=c.target.value),b(c.currentTarget).data("type")=="vertical"&&(e=c.target.value),a.inspect(c,{stroke_width:c.target.value,_height:d,_width:e,brd:c.target.value>0}),b(this).blur()}),c.on("change","#inspectable-stroke-style",function(c){a.inspect(c,{stroke_style:c.target.value}),b(this).blur()}),c.on("click",".lineTypeButton",function(c){var d=b(c.currentTarget);b(".lineModeButton").removeClass("active"),b("#line-"+d.data("type")+"-default").addClass("active"),b(".lineStencilButtonGroup").hide(),b("#line-inspector-button-"+d.data("type")).show(),a.inspect(c,{line_type:d.data("type"),line_mode:b(c.currentTarget).data("mode"),resize_mode:b(c.currentTarget).data("resize-mode")})}),c.on("click",".lineModeButton",function(c){a.inspect(c,{line_mode:b(c.currentTarget).data("mode"),resize_mode:b(c.currentTarget).data("resize-mode")})}),c.on("click",".lineMarkerButton",function(c){var d=b(c.currentTarget),e=b(c.currentTarget).data("marker-type"),f={};d.hasClass("pressed")?(d.removeClass("pressed"),f[e]="false"):(d.addClass("pressed"),f[e]="true"),a.inspect(c,f)}),c.on("click",".noteTypeButton",function(c){var d=b(c.currentTarget);a.inspect(c,{note_style:d.data("note-style")})}),c.on("change",".mockup-linking-list",function(c){var d=b(this).val(),e=d?{type:FDBK.OBJECT_LINK_TYPE_MOCKUP,ref:d}:null,f;b(this).data("ref",e?e.ref:"");var g=b(this).data("stencil");if(g)a.linkStencil(g,{link:e});else for(var h=0;h<FDBK.library.currentMockup.selection.length;h++)f=FDBK.library.currentMockup.selection[h].id,a.linkStencil(f,{link:e});b(this).blur()}),c.on("click","#inspectable_horizontal_arrow_menu_background",function(b){b.currentTarget.checked?a.inspect(b,{hide_arrow:"true"}):a.inspect(b,{hide_arrow:"false"})}),a}(MODULE||{},jQuery),MODULE=function(a,b){function e(){d=b("#svg-icon-library-webalys path");var a=d.get();for(var e=0;e<a.length-1;e++)c.push(a[e].getAttribute("id"))}function x(a){a=b(a),a.hasClass("allow-clear")?(u.show(),t.css("width","150px")):(u.hide(),t.css("width","200px")),i||F(),j=!0,s.on("mousemove",z),b("body").bind("keydown",D),b(document).on("mousedown",A),b(document).on("mouseup",B),t.on("keyup",C);var c=utils.optimalPopoverPosition(b(a),r);r.find(".popoverTail").removeClass("popoverTailDown popoverTailLeft popoverTailRight popoverTailNone").addClass(c.popoverTailClass),r.css({left:c.left,top:c.top,opacity:1}),r.data("key",b(a).data("key")),r.show("fade",100),t.focus()}function y(){if(!j)return;r.hide("fade",100),s.off("mousemove",z),b("body").unbind("keydown",D),b(document).off("mousedown",A),b(document).off("mouseup",B),t.off("keyup",C),t.blur(),s.find("li").show(),o=null,j=!1,v="",t.val(""),s.animate({scrollTop:0},"fast"),r.removeData("key")}function z(a){a.stopPropagation(),a.preventDefault();var c=b(a.target).closest(".iconListItem");c&&b(c)[0]!=b(l)[0]&&(b(l).removeClass("selected"),b(c).addClass("selected"),l=c,k=b(c).index())}function A(a){b(a.target).closest("#iconSearch").length===0&&(a.stopPropagation(),a.preventDefault())}function B(a){if(b(a.target).closest("#iconSearch").length===0){var c=b(a.target).closest(".iconListItem"),d=b(a.target).closest(r).length===0;c.length>0&&(q=b(c).index(),E(),d=!0),b(a.target).attr("id")=="iconClear"&&(q=-1,E(),d=!0),a.stopPropagation(),a.preventDefault(),d&&y()}}function C(a){if(t.val()==v)return;f.length!=c.length&&G(),v=t.val();var d=s.find("li"),e,g,h,i=v.split(/[\s\W]+/i),j="(?:";for(var m=0;m<i.length;m++)i[m].length>0&&(m>0&&(j+="|"),j+=i[m].toLowerCase());j+=")+";for(var n=0;n<f.length;n++){e=f[n],h=!1;for(var o=0;o<e.length;o++){g=e[o];if(g.toLowerCase().match(j)){b(d[n]).show(),h=!0;break}}h||b(d[n]).hide()}var p=s.find("li:visible");b(l).removeClass("selected"),p?(b(p[0]).addClass("selected"),k=0,l=b(p[0])):k=-1}function D(a){var d=k,e=!1;a.which==37?(d-=1,e=!0):a.which==38?(d-=m,e=!0):a.which==39?(d+=1,e=!0):a.which==40?(d+=m,e=!0):a.which==13?k>=0&&(q=b(s.find("li:visible")[k]).index(),e=!0,E(),y()):a.which==27&&(e=!0,y()),e&&(a.stopPropagation(),a.preventDefault());var f=s.find("li:visible").length;if(d!=k&&d>=0&&d<c.length){b(l).removeClass("selected"),l=s.find("li:visible")[d],b(l).addClass("selected"),k=d;var g=Math.floor(k/m)*h,i=s.scrollTop();(i+s.height()-h<g||g<i)&&s.animate({scrollTop:g},"fast")}}function E(){if(q>=0){var a=H(q);b(w).empty().append(a),r.trigger("changeIcon",c[q])}else b(w).empty().append(p),r.trigger("changeIcon","")}function F(){var a="";for(var b=0;b<c.length;b++){var d=c[b].replace("icon-","").replace(/-/g," ");a+='<li class="'+c[b]+' iconListItem" title="'+d+'">'+H(b)+"</li>"}s.append(a),i=!0,m=Math.floor(s.width()/h),n=Math.ceil(c.length/m)}function G(){f=[];var a,b;for(var d=0;d<c.length;d++){var e=c[d];b=c[d].split("-"),a=[];for(var h in b)b[h]!="icon"&&a.push(b[h]);a=a.concat(g[e]||[]),f[d]=a}}function H(a){return'<svg  xmlns="http://www.w3.org/2000/svg" version="1.1" width="16" height="16">'+b(d.get(a)).clone().outerHTML()+"</svg>"}var c=[],d;FDBK._SVGDefsLoaded?e():FDBK.sub("svg-defs-loaded",e);var f=[],g={"icon-circle-camera":["photo"],"icon-film-movie-camera":["circle"],"icon-circle-share":["arrow"],"icon-circle-exclamation":["attention","alert"],"icon-circle-question":["help"],"icon-circle-heart":["love"],"icon-text-numbered-list":["ordered"],"icon-text-undrline":["underline"],"icon-text-list":["bullet","unordered"],"icon-text-right":["align"],"icon-text-center":["align"],"icon-text-left":["align"],"icon-text-justify":["align"],"icon-music":["note","sound"],"icon-speaker-volume-off":["music","sound"],"icon-speaker-volume-on":["music","sound"],"icon-speaker-volume-up":["music","sound"],"icon-speaker-volume-down":["music","sound"],"icon-speaker-volume":["music","sound"],"icon-wifi-signal":["wireless","radio"],"icon-microphone":["music","sound"],"icon-headphones":["music","sound"],"icon-clock":["time"],"icon-player-next":["music","sound"],"icon-player-forward":["music","sound"],"icon-player-play":["music","sound"],"icon-player-pause":["music","sound"],"icon-player-backward":["music","sound"],"icon-player-previous":["music","sound"],"icon-location":["map"],"icon-pin-add":["map"],"icon-pin":["map"],"icon-wizard":["magic"],"icon-shut-down":["power"],"icon-settings":["cog","wheel"],"icon-tools":["settings"],"icon-user-remove":["minus"],"icon-user-add":["plus"],"icon-emoticon-happy":["smile","face"],"icon-emoticon-sad":["face"],"icon-like":["thumb","up"],"icon-dislike":["thumb","down"],"icon-video":["movie","play"],"icon-image":["picture","photo"],"icon-camera":["photo"],"icon-eye":["view"],"icon-drop":["color"],"icon-pen":["pencil"],"icon-trash-delete":["recycle","bin"],"icon-reload":["refresh","recycle"],"icon-refresh":["reload"],"icon-thumbs":["grid"],"icon-grid":["thumbnails"],"icon-home":["house"],"icon-redo":["arrow"],"icon-undo":["arrow"],"icon-speech-bubble":["message","comment"],"icon-message-bubbles":["speech","chat","comments"],"icon-mail":["email","envelope"],"icon-send":["mail","email","message"],"icon-upload":["arrow"],"icon-download":["arrow"],"icon-inbox-download":["arrow"],"icon-storage":["data","db"],"icon-clipboard-cut":["scissors"],"icon-clipboard-paste":["files"],"icon-file-duplicate":["clipboard","copy"],"icon-file-remove":["minus"],"icon-file-add":["plus"],"icon-shopping-basket":["cart","buy","pay"],"icon-chart":["pie"],"icon-money":["buy","pay"],"icon-credit-card":["buy","pay"],"icon-star":["rating","rate"],"icon-cancel-stop":["disable"],"icon-zoom-in":["plus","magnifier"],"icon-zoom-out":["minus","magnifier"],"icon-find":["zoom","magnifier"],"icon-arrow-down":["dropdown"],"icon-back":["arrow","left"],"icon-forward":["arrow","right"]},h=30,i=!1,j=!1,k=-1,l=null,m=0,n=0,o=null,p='<svg xmlns="http://www.w3.org/2000/svg" fill="#AAA" version="1.1" width="16" height="16"><path d="M15.383 7c0.412 0 0.684 0.331 0.603 0.735l-1.839 6.529c-0.081 0.405-0.485 0.735-0.897 0.735h-10.5c-0.413 0-0.816-0.331-0.897-0.735l-1.839-6.529c-0.081-0.404 0.19-0.735 0.603-0.735h14.766zM14 3.75v2.25h-12v-3.25c0-0.414 0.336-0.75 0.75-0.75h3.25l0.5 1h6.75c0.414 0 0.75 0.336 0.75 0.75z"/></svg>',q=-1,r=b("#iconPickerPanel"),s=b("#iconList"),t=b("#iconSearch"),u=b("#iconClear"),v="",w;return b("body").on("click",".icon-picker",function(a){w=b(a.target).closest(".icon-picker"),x(w)}),a.iconPicker={showFrom:x,hide:y},a}(MODULE||{},jQuery),MODULE=function(a,b){function c(b){a.currentProject&&!a.currentProject.isClean()?FDBK.openConfirmDialog({heading:FDBK.loc("_Open project"),message:FDBK.loc("_You have unsaved changes in current project."),buttons:[{text:FDBK.loc("_Save changes"),classes:"primary-action",onClick:function(){a.saveProject(!0,function(){a.fetchProject(b)}),a.autoSave&&a.autoSave.reset()}},{text:FDBK.loc("_Ignore"),onClick:function(){a.fetchProject(b)}},{text:FDBK.loc("_Cancel"),classes:"right close-modal"}]}):(FDBK.closeModal(),a.fetchProject(b))}return a.ProjectController=function(a){for(var b in a)this[b]=a[b]},utils.mixin(a.ProjectController.prototype,{editLink:function(){return this.version=="1.0"?FDBK.BASE_URL+"/#!/edit/"+this.ownerUserName+"/"+this.uniqueId:FDBK.NEW_URL+this.ownerUserName+"/"+this.uniqueId+"/edit"},viewLink:function(){return FDBK.BASE_URL+this.ownerUserName+"/"+this.uniqueId},createdBy:function(){return this.createdByFullName||this.createdByUserName||this.ownerFullName||this.ownerUserName||"N/A"},updated:function(){return moment(this.lastupdateDate).from(FDBK.SERVER_TIME)},sharedBy:function(){return this.ownerFullName||this.ownerUserName||"N/A"},edit:function(){a.currentProject&&a.currentProject.uniqueId===this.uniqueId?FDBK.closeModal():c(this.uniqueId)},duplicate:function(){var a=b.Deferred(),c=this,d={uniqueId:this.uniqueId,name:utils.copyOf(this.name)},e=FDBK.loc("_There was an error duplicating your project");return FDBK.API.xhr(FDBK.API.CALL_DUPLICATE_PROJECT,{data:d,contentType:"application/x-www-form-urlencoded;"}).done(function(b){if(b.success){var f=b.object;FDBK.API.xhr(FDBK.API.CALL_CLONE_PROJECT_CONTENT_STREAM,{BASE_URL:FDBK.WEB_SOCKET_URL,data:{newId:f.uniqueId,newName:d.name},contentType:"application/x-www-form-urlencoded;",urlParams:[d.uniqueId,"clone"]}).done(function(b){b.success?a.resolveWith(c,[f]):a.rejectWith(c,[e,b])}).fail(function(b){a.rejectWith(c,[e,b])})}else a.rejectWith(c,[e,b])}).fail(function(b){b.status===403?FDBK.showActiveProjectsAlert():a.rejectWith(c,[e,b])}),a},archive:function(){var a=this._call(FDBK.API.CALL_ARCHIVE_PROJECT);return a.done(function(){this.archived=!0}),a},restore:function(){var a=this._call(FDBK.API.CALL_UNARCHIVE_PROJECT);return a.done(function(){this.archived=!1}).fail(function(a){a.status===403&&FDBK.showActiveProjectsAlert()}),a},remove:function(){return this._call(FDBK.API.CALL_DELETE_PROJECT)},leave:function(){return this._call(FDBK.API.CALL_LEAVE_PROJECT,"application/x-www-form-urlencoded;")},_call:function(a,c){var d=b.Deferred(),e=this;return FDBK.API.xhr(a,{contentType:c,data:{uniqueId:this.uniqueId}}).done(function(a){a.success?d.resolveWith(e,[a.object]):d.rejectWith(e)}).fail(function(a){d.rejectWith(e,[a])}),d}}),a.fetchProjectContent=function(c,d){FDBK.API.xhr(FDBK.API.CALL_GET_PROJECT_CONTENT,{urlParams:[c],success:function(c){c.object?(d.jsonData=JSON.parse(c.object.jsonData),a.openProject(d,!0),b("#project-save-status").removeClass("shown")):a.projectNotFound()},error:function(){a.projectNotFound()},crossdomain:!0})},a.fetchProject=function(c,d){a.closeCurrentProject(),FDBK.pub("fetching-project",c),FDBK.API.xhr(FDBK.API.CALL_GET_PROJECT,{data:{uniqueId:c},contentType:"application/json;charset=UTF-8;",success:function(e){if(!e.object||!e.success){e.message==="collab_restricted"&&e.object?a.projectNotAvailable(e.object):a.projectNotFound(e.message),a.closeCurrentProject();return}e.object.jsonData=null,a.serviceClient.getProjectJSON(c,function(c,f){if(c){a.projectNotFound(c);return}for(var g in e.object)f[g]||(f[g]=e.object[g]);d?d():a.openProject(f,!0),b("#project-save-status").removeClass("saved")})},error:function(){a.projectNotFound()}})},a.projectNotFound=function(b){a.openProjects(),!b||b==="not.found"?b=FDBK.loc("_Project not found."):b==="archived"?b=FDBK.loc("_Project is archived."):b=b+". "+FDBK.loc("_Please contact us if the problem persists."),a.projectsView.showError(b)},a.projectNotAvailable=function(a,c){var d="#project-unavailable-dialog";a.owner.ownerName=a.owner.fullName||a.owner.userName,a.owner.teamUniqueId=c,FDBK.USER_DATA.userName===FDBK.USER_DATA.context.userName&&FDBK.USER_DATA.context.userName===a.owner.userName?b(d).html(b("#tmpl-project-unavailable").loc_tmpl({owner:a.owner})):b(d).html(b("#tmpl-project-unavailable-team").loc_tmpl({owner:a.owner})),FDBK.openModal(d),b("#account-selection").hide()},b(document).on("click",'[data-seeds-action="sendUpgradeReminder"]',function(){var a=b(this).data("owner"),c=b(this).data("id");return FDBK.API.xhr(FDBK.API.CALL_UPGRADE_REMINDER,{data:{userUniqueId:c},contentType:"application/x-www-form-urlencoded;",success:function(){FDBK.pub("upgrade-reminder-sent",c)}}),FDBK.openConfirmDialog({heading:FDBK.loc("Message sent"),message:FDBK.loc("An upgrade reminder was sent to "+a),showCloseButton:!0,buttons:[{text:FDBK.loc("Done"),classes:"close-modal right"}]}),!1}),b(document).on("click",'[data-seeds-action="removeUserFromTeam"]',function(){var c=b(this).data("team");return confirm(FDBK.loc("_Are you sure you want to leave this team?"))&&FDBK.API.xhr(FDBK.API.CALL_TEAM_LEAVE,{data:{uniqueId:c},success:function(b){b&&b.success?a.contextController.refresh():FDBK.genericErrorDialog()},error:function(){FDBK.genericErrorDialog()}}),!1}),a}(MODULE||{},jQuery),MODULE=function(a,b){return a.projectsController={projects:null,searchTerm:null,category:"all",categories:{all:{name:"Active Projects",filter:function(a){return a.archived===!1}},team:{name:"Projects in your team",filter:function(a){return a.archived===!1&&a.permission!=="collab_edit"}},"public":{name:"Public Projects",filter:function(a){return a.archived===!1&&a.privacy==="public_"}},"private":{name:"Private Projects",filter:function(a){return a.archived===!1&&a.privacy==="private_"}},archived:{name:"Archived Projects",filter:function(a){return a.archived===!0}},mine:{name:"Projects created by you",filter:function(a){return a.archived===!1&&FDBK.USER_DATA&&(a.createdByUserName?a.createdByUserName:a.ownerUserName)===FDBK.USER_DATA.userName}},shared:{name:"Projects shared with you",filter:function(a){return a.archived===!1&&a.permission==="collab_edit"}},search:function(a){return!this.searchTerm||a.name.toLowerCase().indexOf(this.searchTerm.toLowerCase())>-1}},_filterProjects:function(){var a=this.projects.filter(this.categories[this.category].filter,this).filter(this.categories.search,this).sort(this._sort);return a},_sort:function(a,b){return b.lastupdateDate-a.lastupdateDate},activeCount:function(){return this.projects.filter(this.categories.team.filter).length},list:function(){if(this._listPromise&&this._listPromise.state()==="pending")return this._listPromise;var a=this._listPromise=b.Deferred(),c=this;return this.projects&&!this._invalidated?a.resolveWith(this,[this._filterProjects()]):this.fetch().done(function(){c._invalidated=!1,a.resolveWith(c,[c._filterProjects()])}).fail(function(b){a.rejectWith(c,b)}),a},fetch:function(){var a=b.Deferred(),c=this;return b.when(FDBK.API.xhr(FDBK.API.CALL_GET_ALL_PROJECTS),FDBK.API.xhr(FDBK.API.CALL_GET_ARCHIVED_PROJECTS)).done(function(b,d){var e=b[0],f=d[0],g=e&&e.success&&e.object&&f&&f.success&&f.object;if(g){var h=e.object.concat(f.object);c.projects=c._instantiate(h),a.resolveWith(c)}else a.rejectWith(c,{})}).fail(function(b){a.rejectWith(c,{})}),a},_instantiate:function(b){return b.map(function(b){return new a.ProjectController(b)})},invalidate:function(){this._invalidated=!0},createProject:function(){a.newProject()},project:function(a){return this.projects.filter(function(b){return b.uniqueId===a})[0]},add:function(b){var c=new a.ProjectController(b);this.projects.push(c)},remove:function(a){var b=this.project(a),c=this.projects.indexOf(b);this.projects.splice(c,1)}},a}(MODULE||{},jQuery),MODULE=function(a,b){return a.projectsManager=AppSeeds.StateManager.create().add(["root -> shown hidden","shown -> loading loaded","loaded -> all archived mine shared public private"]).whenIn({root:{navigate:function(a,b){this.view.hideError(),this.goTo(b)},open:function(){this.controller=a.projectsController,this.view=a.projectsView,this.view.hideError(),this.act("close").goTo("all")},close:function(){this.goTo("hidden"),this.controller.invalidate()}},shown:{enter:function(){FDBK.openModal("#new-projects-dialog"),this.view.initUI()},exit:function(){FDBK.closeModal()},createProject:function(a){this.goTo("hidden"),this.controller.createProject()}},hidden:{},loading:{},loaded:{quotaChanged:function(){this.view.updateQuota(this.controller.activeCount(),FDBK.getPlanProjectsLimit())},archiveProject:function(b){var c=this.view.projectForEvent(b),d=c.archive(),e=this;this.view.disableListItem(b),d.done(function(b){e.view.renderProjects(),e.act("quotaChanged"),e.view.hideError(),a.currentProject&&this.uniqueId&&a.currentProject.uniqueId===this.uniqueId&&a.closeCurrentProject()}).fail(function(a,b){e.view.showError(a)}).always(function(){e.view.enableListItem(b),FDBK.hideTooltip()})},editProject:function(a){var b=this.view.projectForEvent(a);b.version=="1.0"?(this.goTo("hidden"),b.edit(),FDBK.hideTooltip()):window.open(FDBK.NEW_URL+b.ownerUserName+"/"+b.uniqueId+"/edit")},duplicateProject:function(a){var b=this.view.projectForEvent(a),c=b.duplicate(),d=this;this.view.disableListItem(a),c.done(function(a){d.controller.add(a),d.view.renderProjects(),d.view.highlightProject(a),d.act("quotaChanged"),d.view.hideError()}).fail(function(a,b){d.view.showError(a)}).always(function(){d.view.enableListItem(a),FDBK.hideTooltip()})},restoreProject:function(a){var b=this.view.projectForEvent(a),c=b.restore(),d=this;this.view.disableListItem(a),c.done(function(a){d.view.renderProjects(),d.act("quotaChanged"),d.view.hideError()}).fail(function(a,b){d.view.showError(a)}).always(function(){d.view.enableListItem(a),FDBK.hideTooltip()})},deleteProject:function(b){if(confirm(FDBK.loc("_Delete Project"))){var c=this.view.projectForEvent(b),d=c.remove(),e=this;this.view.disableListItem(b),d.done(function(b){e.controller.remove(c.uniqueId),e.view.renderProjects(),e.act("quotaChanged"),e.view.hideError(),a.currentProject&&this.uniqueId&&a.currentProject.uniqueId===this.uniqueId&&a.closeCurrentProject()}).fail(function(a,b){e.view.showError(a)}).always(function(){e.view.enableListItem(b),FDBK.hideTooltip()})}},leaveProject:function(a){if(confirm(FDBK.loc("_Leave Project"))){var b=this.view.projectForEvent(a),c=b.leave(),d=this;this.view.disableListItem(a),c.done(function(a){d.controller.remove(b.uniqueId),d.view.renderProjects(),d.view.hideError()}).fail(function(a,b){d.view.showError(a)}).always(function(){d.view.enableListItem(a),FDBK.hideTooltip()})}}},all:{enter:function(){this.controller.category="all",this.controller.searchTerm="",this.view.renderProjects(),this.view.setActive("all")}},archived:{enter:function(){this.controller.category="archived",this.controller.searchTerm="",this.view.renderProjects(),this.view.setActive("archived")},editProject:function(){return!1},duplicateProject:function(){return!1},archiveProject:function(){return!1}},mine:{enter:function(){this.controller.category="mine",this.controller.searchTerm="",this.view.renderProjects(),this.view.setActive("mine")}},shared:{enter:function(){this.controller.category="shared",this.controller.searchTerm="",this.view.renderProjects(),this.view.setActive("shared")}},"public":{enter:function(){this.controller.category="public",this.controller.searchTerm="",this.view.renderProjects(),this.view.setActive("public")}},"private":{enter:function(){this.controller.category="private",this.controller.searchTerm="",this.view.renderProjects(),this.view.setActive("private")}}}),a}(MODULE||{},jQuery),MODULE=function(a,b){return a.projectsView={dialog:b("#new-projects-dialog"),ui:{listTemplate:"#tmpl-new-project-list",listHeading:".project-list-title",listOutlet:".project-list",menuItems:".mq-menu [data-seeds-action]",searchField:"#search-projects",menuMarker:".mq-menu-marker",menu:".mq-menu",quota:".project-quota",newProjectButton:".create-new-project",notificationArea:".mq-notification"},controller:a.projectsController,manager:a.projectsManager,init:function(){var a=this;for(var c in this.ui)this.ui[c]=this.dialog.find(this.ui[c]);this.ui.searchField.on("keyup",function(){a.controller.searchTerm=b(this).val().trim(),a.renderProjects()}),this.dialog.on("click",":not(.disabled) [data-seeds-action]:not(.disabled)",function(c){var d=b(this).data("seeds-action"),e=d.split(" ");return a.manager.act.apply(a.manager,[e[0],c].concat(e.slice(1))),!1}),this.ui.menu.on("mouseover","li",function(){a._moveMarker({top:b(this).position().top+5})}).on("mouseout",function(){a._moveMarker()})},initUI:function(){var a=this,b=this.dialog.find("[data-seeds-premium]");FDBK.hasPremiumPlan()?b.show():b.hide()},_moveMarker:function(a){a||(a={top:this.ui.menu.find("li.active").position().top+5}),this.ui.menuMarker.css(a)},renderProjects:function(){var a=this;this.controller.list().done(function(b){a.ui.listHeading.html(a.controller.categories[a.controller.category].name),a.ui.listOutlet.html(a.ui.listTemplate.loc_tmpl({projects:b,searchTerm:a.controller.searchTerm,category:a.controller.categories[a.controller.category].name,user:{isPremium:FDBK.hasPremiumPlan()}})),a.manager.act("quotaChanged")}).fail(function(){})},highlightProject:function(a){var b=a.uniqueId,c=this.ui.listOutlet.find("[data-project-id="+b+"]");c.addClass("highlight"),window.setTimeout(function(){c.removeClass("highlight")},1500)},setActive:function(a){var b=this.dialog.find("[data-seeds-for="+a+"]");b.addClass("active").siblings().removeClass("active")},projectForEvent:function(a){var c=b(a.target).closest("[data-project-id]").data("project-id");return this.controller.project(c)},disableListItem:function(a){b(a.target).closest("[data-project-id]").addClass("disabled")},enableListItem:function(a){b(a.target).closest("[data-project-id]").removeClass("disabled")},updateQuota:function(a,b){this.ui.quota.find(".mq-progress-bar span").css("width",a/b*100+"%").end().find(".project-quota-used").text(a).end().find(".project-quota-total").text(b).end(),a>=b?(this.ui.quota.find(".project-quota-upgrade").addClass("mq-button-happy"),this.ui.quota.find(".mq-progress-bar").addClass("mq-progress-bar-sad")):(this.ui.quota.find(".project-quota-upgrade").removeClass("mq-button-happy"),this.ui.quota.find(".mq-progress-bar").removeClass("mq-progress-bar-sad"))},showError:function(a){this.ui.notificationArea.show().html(a)},hideError:function(){this.ui.notificationArea.hide()}},a.projectsView.init(),a}(MODULE||{},jQuery),MODULE=function(a,b){function f(c,d,f){var g=a.getMockupListItemView(c,!0,!0);a.currentMockup&&(a.currentMockup.id===c.id&&g.addClass("selected"),a.currentProject.isAncestor(c.id,a.currentMockup.id)&&(c._expanded=!0)),a.currentProject.hasChildren(c.id)&&g.prepend(e.cloneNode(!0)),c._expanded&&g.addClass("expanded");if(f)f.after(g);else if(c.parent){var h=d.find("[data-mockup="+c.parent+"]");if(h.length){var i=h.find("> ul");i.length||(i=b("<ul></ul>").appendTo(h)),i.append(g)}else d.append(g)}else d.append(g)}function i(a){if(!FDBK.library.isUserLoggedIn()){FDBK.library.askForSession();return}var c=b("#new-project-dialog");c.html(b("#tmpl-new-project").loc_tmpl({projectSetup:a})),FDBK.initFontSelection(),FDBK.openModal("#new-project-dialog"),c.find("input[name=name]").focus();var d=b("[name=create-privacy]");FDBK.allowPrivacy()?(d.filter("[value=private]").prop("checked",!0),c.find(".status.private").show()):(d.filter("[value=public]").prop("checked",!0),c.find(".status.public").show())}function j(){if(a.isUserLoggedIn()){if(FDBK.allowSaveProject()){FDBK.openModal("#save-project-as-dialog");var c=b("#save-project-as-dialog").find("input[name=name]").val(utils.copyOf(a.currentProject.name));c.focus()[0].setSelectionRange(0,1e3)}}else a.askForSession()}var c=null;a.$projectStructure=b("#project-structure"),a.$miniProjectStructure=b("#mini-project-structure"),a.$masterProjectStructure=b("#master-project-structure"),a.$allProjectStructures=a.$projectStructure.add(a.$masterProjectStructure).add(a.$miniProjectStructure),a.currentProject=null,a.currentMockup=null,a.renderedMockups=[],a.lastSaveFailed=!1,a.ignoreAutoSaveErrors=!1,a.serviceClient=new FDBK.StreamingClient,a.openProjects=function(){a.projectsManager.act("open")},a.saveFailed=function(c,d){a.lastSaveFailed=!0;var e=c?!1:a.ignoreAutoSaveErrors,f=function(c){c&&d=="session.user.not.matching"?(FDBK.CACHED_PROJECT=JSON.stringify(a.currentProject),FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There is a problem with your session. Please reload the page")})):e||(FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error saving your changes. Please wait while we try again..."),buttons:[{text:FDBK.loc("_Close"),classes:"close-modal"},{text:FDBK.loc("_Ignore"),classes:"right primary-action",onClick:function(){a.ignoreAutoSaveErrors=!0}}]}),FDBK.sub("project-saved",function(){a.lastSaveFailed=!1,b(".modal.active").length>0&&FDBK.closeModal()}),FDBK.unsub("session-check-result",f))};FDBK.sub("session-check-result",f),a.checkSession()},a.setMockupRendered=function(c,d){var e=a.renderedMockups.indexOf(c);d&&e==-1?a.renderedMockups.push(c):!d&&e!=-1&&(b("#"+c).empty(),a.renderedMockups.splice(e,1))},a.isMockupRendered=function(b){return a.renderedMockups.indexOf(b)!=-1},a.setProjectTitle=function(c){a.isUserLoggedIn()&&utils.setDocumentTitle(c),b("#current-project-name").text(c),a.updatePresencePrivacy()},a.appendMockupSVG=function(b){var c=a.getMockupSVG(b.id);b.isMaster?a.$svgObject.find("#grid").after(c):a.$svgObject.append(c)},a.moveMockupSVG=function(c){var d=b("#"+c.id);if(!d.length){console.error("Can't find mockup SVG!");return}c.isMaster?d.detach().insertAfter(a.$svgObject.find("#grid")):d.detach().appendTo(a.$svgObject)},a.convertCurrentPageToMaster=function(b){b=b||{},a.currentMockup.master&&b.merge&&a.mergeMasterIntoCurrentPage(),a.convertNormalToMasterPage(a.currentMockup.id)},a.convertCurrentPageToNormalPage=function(){a.convertMasterToNormalPage(a.currentMockup.id)},a.applyCurrentMasterToAllPages=function(){if(!a.currentMockup.isMaster){console.error("Current mockup is not a master");return}var b=a.currentMockup.id,c=a.currentProject.normalPages();for(var d=0;d<c.length;d++)a.setMasterForMockup(c[d].id,{master:b})},a.removeCurrentMasterFromAllPages=function(){a.removeMasterFromAllPages(a.currentMockup.id)},a.removeMasterFromAllPages=function(b){var c=a.currentProject.pagesForMaster(b);for(var d=0;d<c.length;d++)a.setMasterForMockup(c[d].id,{master:null},{undoable:!1})};var d;FDBK.sub("master-edited",function(b){FDBK.library.currentMockup.master===b&&(d&&window.clearTimeout(d),d=window.setTimeout(function(){a.changeActiveMockup(a.currentMockup.id)},1e3))}),a.setMasterForCurrentPage=function(b){a.setMasterForMockup(a.currentMockup.id,{master:b})},a.mergeMasterIntoCurrentPage=function(){var c=a.currentProject.mockup(a.currentMockup.master),d=b.extend(!0,{},{stencils:c.stencils}).stencils;((function(a){var b=arguments.callee;a.forEach(function(a){a.id=null,a.type==="group"&&b.call(this,a.stencils)},this)})).call(this,d),a.currentMockup.undo.startGroup("Merge master in mockup"),a.setMasterForMockup(a.currentMockup.id,{master:null});var e,f,g=a.currentMockup.stencilList()[a.currentMockup.stencilList().length-1];for(var h=d.length-1;h>=0;h--)e=d[h],f=a.addStencilFinal({type:e.type,templateName:e.name,data:e}),g&&a.orderStencil(f.id,{after:g.id});a.currentMockup.undo.endGroup()},a.newPageWithCurrentMaster=function(){a.addMockup({props:{master:a.currentMockup.id}})},a.addMockupUI=function(b,c,d){a.appendMockupSVG(b),a.addMockupToProjectStructure(b)};var e=document.createElement("span");e.classList.add("expand"),a.addMockupToProjectStructure=function(b,c){b.isMaster?f(b,a.$masterProjectStructure,c):(f(b,a.$projectStructure,c),f(b,a.$miniProjectStructure,c))},a.refreshProjectStructure=function(b){a.$projectStructure[0].innerHTML="",a.$masterProjectStructure[0].innerHTML="",a.$miniProjectStructure[0].innerHTML="",b=b||a.currentProject.mockupList(),b.forEach(function(b){a.addMockupToProjectStructure(b)})},a.copyMockup=function(c){var d=a.currentProject.mockup(c);if(d){var e=b.extend(!0,{},d.propertiesToDuplicate(),{name:utils.uniqueName(d.name,a.currentProject.mockupList().map(function(a){return a.name})),duplicateFrom:d.id});a.addMockup({props:e,shouldRenameAfterCreating:!1})}},a.getActiveMockup=function(){return b("#"+a.currentMockup.id)},a.changeActiveMockup=function(c,d){var e=a.currentProject.mockup(c),f=e.isMaster?a.$masterProjectStructure:a.$projectStructure;a.$allProjectStructures.find("li").removeClass("selected"),a.pageListItemForMockup(c).addClass("selected"),a.$svgObject.find(".mockup").attr("class","mockup").end(),b("#"+c).attr("class","mockup active-mockup"),a.currentProject.uniqueId&&b.cookie("moqups_lastproject",a.currentProject.uniqueId+"-"+c),e.master&&(a.isMockupRendered(e.master)||(a.setMockupRendered(e.master,!0),a.currentMockup=a.currentProject.mockup(e.master),a.renderCurrentMockup()),b("#"+e.master).attr("class","mockup active-master-mockup")),a.currentMockup=e,d!==!0&&!a.isMockupRendered(c)&&(a.setMockupRendered(c,!0),a.renderCurrentMockup()),a.setStageSize(),a.updateUndoButton(),a.updateRedoButton(),a.showSelection(),FDBK.pub("mockup-changed",a.currentMockup)},a.startRenameMockup=function(c){var d=a.currentProject.mockup(c.data("mockup"));b("<input type='text' class='mockup-name-edit-input' maxlength='255'/>").val(d.name).insertBefore(c.addClass("editing").find("> .mockup-name").hide()).focus().select(),a.disablePageSorters()},a.endRenameMockup=function(b,c){if(!b.hasClass("editing"))return!1;var d=b.find(".mockup-name"),e=b.data("mockup");c&&a.updateMockupName(e,{value:c}),b.removeClass("editing").find(".mockup-name-edit-input").remove(),d.show(),a.enablePageSorters(),FDBK.pub("renamed-mockup",{mockup:e,value:c})},a.endRenameAllMockups=function(){a.$allProjectStructures.find(".editing").each(function(c,d){var e=b(d);a.endRenameMockup(e,e.find(".mockup-name-edit-input").val())})},a.closeCurrentProject=function(){a.clearWorkspace(),FDBK.pub("close-project")},a.clearWorkspace=function(){a.currentMockup&&(a.clearSelection(),a.$svgObject.find(".mockup").remove(),a.$allProjectStructures.empty(),a.currentProject=null,a.currentMockup=null,a.renderedMockups.length=0,a.setShareInterface())},a.openProject=function(c,d){a.currentProject=new FDBK.Project(c,d);var e=a.currentProject,f=e.mockupList()[0].id,g=b.cookie("moqups_lastproject"),h=null;g&&g.split("-")[0]===e.uniqueId?h=g.split("-")[1]:b.cookie("moqups_lastproject",null),a.setProjectTitle(e.name);var i=e.mockupList();if(i.length===0)a.addMockup();else for(var j=0;j<i.length;j++)a.addMockupUI(i[j],!1,!0),h&&h===i[j].id&&(f=h);a.changeActiveMockup(f),a.setShareInterface(),FDBK.pub("open-project")},FDBK.sub("empty-project-fetched",function(){a.currentProject.googleFileId&&i(!0)}),FDBK.sub("open-project",function(){b("body").addClass("project-loaded").removeClass("project-loading")}).sub("close-project",function(){b("body").removeClass("project-loaded project-loading")}).sub("fetching-project",function(){b("body").addClass("project-loading")}),a._saveStatusSchedule=AppSeeds.Scheduler.create(function(){b("#project-save-status").removeClass("shown")}).delay(3e3),FDBK.sub("project-sanity-check-passed",function(){b("#project-save-status").addClass("shown"),a._saveStatusSchedule.reset()}),a.initAutoSave=function(){FDBK.config("projectManagement.autoSave")&&a.isUserLoggedIn()&&(a.autoSave&&a.autoSave.stop(),a.autoSave=AppSeeds.Scheduler.create(a.saveProject,[!1],a).repeat(FDBK.config("projectManagement.autoSaveInterval")).now())},FDBK.sub("open-project",function(){FDBK.allowEditPages()?(b(".edit-action").removeClass("disabled"),a.enablePageSorters()):a.disablePageSorters(),a.currentProject.readOnly&&b("#project-read-only-status").addClass("shown")}),FDBK.sub("close-project",function(){b(".edit-action").addClass("disabled"),b("#project-read-only-status").removeClass("shown")}),FDBK.sub("open-project project-saved",function(){FDBK.CACHED_PROJECT=JSON.stringify(a.currentProject)}),FDBK.sub("open-project user-logged-in",function(){a.initAutoSave()}),FDBK.sub("open-project",function(){FDBK.library._touchProject=utils.debounce(function(){if(!FDBK.library.currentProject)return;FDBK.API.xhr(FDBK.API.CALL_TOUCH_PROJECT,{contentType:"application/x-www-form-urlencoded",data:{projectUniqueId:FDBK.library.currentProject.uniqueId}})},3e4,!0)}),FDBK.sub("project-sync-ack",function(){FDBK.library._touchProject()}),FDBK.sub("window-blur close-project",function(){a.autoSave&&a.autoSave.stop()}),FDBK.sub("window-focus",function(){a.autoSave&&a.autoSave.reset()}),a.hasProjectToRecover=function(){return a.hasLocalStorage()?window.localStorage.getItem("project"):!1},a.recoverProject=function(){if(a.hasLocalStorage()){var b=window.localStorage.getItem("project");b?FDBK.openConfirmDialog({heading:FDBK.loc("_Recover project heading"),message:FDBK.loc("_Recover project confirmation"),buttons:[{text:FDBK.loc("_OK"),classes:"primary-action",onClick:function(){try{a.closeCurrentProject(),a.openProject(JSON.parse(b))}catch(c){FDBK.openConfirmDialog({heading:FDBK.loc("_Recover project heading"),message:FDBK.loc("_Recover project failure"),buttons:[{text:FDBK.loc("_OK"),classes:"primary-action close-modal"}]});return}FDBK.config("projectManagement.recovery.deleteAfterRecovery")&&window.localStorage.removeItem("project")}},{text:FDBK.loc("_Cancel"),classes:"close-modal"}]}):FDBK.openConfirmDialog({heading:FDBK.loc("_Recover project heading"),message:FDBK.loc("_Recover project not found"),buttons:[{text:FDBK.loc("_OK"),classes:"primary-action close-modal"}]})}else FDBK.openConfirmDialog({heading:FDBK.loc("_Recover project heading"),message:FDBK.loc("_Recover project not supported"),buttons:[{text:FDBK.loc("_OK"),classes:"primary-action close-modal"}]})},a.saveRetryCount=0,a.saveRetryLimit=3,a.saveProject=function(b,c){if(a.currentProject&&!b&&a.currentProject.isClean()&&!a.lastSaveFailed)return;a.currentProject&&a.currentProject.isNew()?a.serviceClient.createProject(a.currentProject.toServerJSON()):a.serviceClient.saveAction(b);return},a.previewProject=function(c,d){c=c||a.currentProject,d=d===undefined?!0:d;if(c){c=b.extend(!0,{},c);if(d&&window.history&&window.history.pushState)if(a.currentProject&&a.currentProject.uniqueId){var e=a.currentMockup.isMaster?"":"/p:"+a.currentMockup.id;window.history.pushState("preview","","/"+a.currentProject.ownerUserName+"/"+a.currentProject.uniqueId+e)}else window.history.pushState("preview","","/preview");b("body").append('<iframe name="previewProject" id="previewProject" src="/'+FDBK.PREVIEW_URL+'" width="100%" height="100%" frameborder="0"></iframe>'),a.hasActivePreview=!0,b("#previewProject").load(function(){var d=b("#previewProject").contents().find("#project-close-button");if(d.length){d.show().click(function(){return window.parent.FDBK.library.closePreview(),!1}),b(this).contents().find("#moqups").removeAttr("href");var e=this.contentWindow;e.FDBK.sub("mockup-changed",function(b){a.changePreviewURL(b)}),c.ownerIsPremium=FDBK.hasPremiumPlan()||FDBK.library.currentProject.isPremiumProject(),e.FDBK.USER_DATA=b.extend(!0,{},FDBK.USER_DATA),e.FDBK.viewProject(c),a.currentMockup.isMaster||e.FDBK.switchToMockup(e.FDBK.library.currentProject.mockup(a.currentMockup.id)),e.focus()}else b(this).contents().find("body").css("text-align","center");b(this).contents().on("keydown",function(a){a.keyCode==27&&window.parent.FDBK.library.closePreview()})})}},a.changePreviewURL=function(b){if(!window.history||!window.history.replaceState)return;if(a.currentProject&&a.currentProject.uniqueId){var c=b&&b.id?"/p:"+b.id:"";window.history.replaceState("preview","","/"+a.currentProject.ownerUserName+"/"+a.currentProject.uniqueId+c)}else window.history.replaceState("preview","","/preview")},a.closePreview=function(){var c=window.location.href.split("/p:")[1];if(!b("#previewProject").length)return;b("#previewProject").remove(),window.focus(),a.hasActivePreview=!1,window.history&&window.history.replaceState&&window.history.replaceState(null,"","/"),c?a.changeActiveMockup(c):FDBK.buildHash()},window.addEventListener("popstate",function(b){a.hasActivePreview&&a.closePreview(),b.state==="preview"&&a.previewProject(null,!1)},!1),a.openProjectViewer=function(){var a=b("#share-url").val();a&&window.open(a)},a.pageListItemForMockup=function(a,b){return(b||this.$allProjectStructures).find("li[data-mockup="+a+"]")};var g=null,h={dataAttribute:"mockup",start:function(){g=this.serialize(),a.endRenameAllMockups(),document.documentElement.classList.add("unselectable")},stop:function(b){function h(a,b){var c=b.length;for(var d=0;d<c;d++)if(b[d].id===a)return b[d];return null}function j(a,b,c){var d=0;return b?d=FDBK.library.currentProject.indexOfMockup(b)+1:c&&(d=FDBK.library.currentProject.indexOfMockup(c)),d>a&&(d-=1),d}document.documentElement.classList.remove("unselectable");var c=b.dataset.mockup,d=this.serialize();if(JSON.stringify(g)===JSON.stringify(d))return;var e=[],f;for(var i=0;i<d.length;i++){f=d[i].parent;while(f){if(f==c){e.push(d[i].id);break}f=h(f,d),f&&(f=f.parent)}}for(var i=0;i<d.length;i++)if(d[i].id===c||e.indexOf(d[i].id)!=-1){var k=FDBK.library.currentProject.indexOfMockup(d[i].id),l=d.filter(function(a){return a.parent===d[i].parent}),m=l.indexOf(d[i]);if(l.length>1){var n=null,o=null;d[i].parent&&m===0?(n=d[i].parent,o=null):(n=m>0?l[m-1].id:null,o=m===0?l[m+1].id:null),k=j(k,n,o)}else d[i].parent&&(k=j(k,d[i].parent,null));a.changeMockupOrder(d[i].id,{index:k,skipRefresh:!0}),a.setMockupParent(d[i].id,{parentId:d[i].parent||null})}a.refreshProjectStructure()},done:function(){document.documentElement.classList.remove("unselectable")}};return a.normalPageSorter=new Sequoia(a.$projectStructure[0],h),a.miniPageSorter=new Sequoia(a.$miniProjectStructure[0],h),a.masterPageSorter=new Sequoia(a.$masterProjectStructure[0],b.extend({nesting:!1},h)),a.disablePageSorters=function(){a.normalPageSorter.disable(),a.miniPageSorter.disable(),a.masterPageSorter.disable()},a.enablePageSorters=function(){a.normalPageSorter.enable(),a.miniPageSorter.enable(),a.masterPageSorter.enable()},a.$allProjectStructures.on("click",".expand",function(c){var d=b(this).closest("li");d.toggleClass("expanded");var e=d.data("mockup"),f=a.currentProject.mockup(e);return f._expanded=d.hasClass("expanded"),!1}),a.newProject=function(){a.currentProject&&!a.currentProject.isClean()?FDBK.openConfirmDialog({heading:FDBK.loc("_Create new project"),message:FDBK.loc("_You have unsaved changes in current project."),buttons:[{text:FDBK.loc("_Save changes"),classes:"primary-action",onClick:function(){a.saveProject(!0,function(){i()}),a.autoSave&&a.autoSave.reset()}},{text:FDBK.loc("_Ignore"),onClick:function(){i()}},{text:FDBK.loc("_Cancel"),classes:"right close-modal"}]}):i()},b(document).on("submit","#new-project-form",function(){if(b(this).data("setup")){var c=b(this).find("[name=font]:checked").val(),d=b(this).find("[name=name]").val();a.changePrivacy(b("[name=create-privacy]:checked").val()==="private"),a.updateProjectName({value:d}),a.currentProject.font=c,FDBK.applyProjectFont(c),a.serviceClient.replaceProjectData(a.currentProject.toServerJSON(),"drive")}else{var e=b.extend(!0,{},FDBK.defaultProjects.emptyProject),f=b(this).serializeArray();e.name=FDBK.loc("_Untitled Project");for(var g=0;g<f.length;g++)f[g].value&&(e[f[g].name]=b.trim(f[g].value));a.serviceClient.createProject(e,function(){var c=b("[name=create-privacy]:checked").val()==="private";a.changePrivacy(c)})}return FDBK.closeModal(),!1}),a.saveProjectAsCopy=function(){j()},b("#duplicate-project-form").submit(function(){var c=b.trim(b(this).find("input[name=name]").val());c.length===0&&(c=FDBK.loc("_Untitled Project"));var d=a.currentProject.toServerJSON();return d.uniqueId=null,d.name=c,FDBK.CACHED_PROJECT="",a.serviceClient.createProject(d),b(this).find("input[name=name]").val(""),FDBK.closeModal(),!1}),b(document).on("click",".projects-list .project",function(){b(this).siblings().removeClass("selected").end().addClass("selected")}),a.presence={tmplUser:b("#tmpl-presence-avatar"),$container:b("#presence"),$ghostContainer:b("#presence-ghost-wrapper"),currentUsers:[],colors:["#D5161B","#EA6012","#FEC311","#3C2886","#1679C3","#48B8BB","#156D49","#C44888","#332F8A","#B19A5F"],init:function(){FDBK.sub("presence-update-users",this.updateUsers,this),FDBK.sub("presence-user-selection",this.drawUserSelection,this),FDBK.sub("remote-stencil-update",this.updateStencilSelection,this),FDBK.sub("mockup-changed",this.clearAllUsersSelection,this)},updateUsers:function(a){var b=this.currentUsers,c=b.filter(function(b){return!a.filter(function(a){return a.username===b.username}).length}),d=a.filter(function(a){return!b.filter(function(b){return a.username===b.username}).length});c.forEach(this.removeUser,this),d.forEach(this.addUser,this)},addUser:function(a){if(this.user(a)||FDBK.USER_DATA&&FDBK.USER_DATA.userName===a.username)return;a.color=this.colors[this.currentUsers.length%this.colors.length],a.avatarImage=utils.getAvatarImageURL({email:a.email,avatar:a.avatar}),this.currentUsers.push(a);var c=b.loc_tmpl(this.tmplUser,a);this.$container.is(":not(:visible)")&&this.$container.show(),b(c).appendTo(this.$container),setTimeout(function(){b(c).addClass("visible")},0)},userDOM:function(a){return this.$container.find('[data-username="'+a.username+'"]')},user:function(a){return this.currentUsers.filter(function(b){return b.username===a.username})[0]},removeUser:function(a){var b=this.userDOM(a);b.removeClass("visible"),setTimeout(function(){b.remove()},200);var a=this.user(a);a&&this.currentUsers.splice(this.currentUsers.indexOf(a),1),this.currentUsers.length===0&&this.$container.fadeOut(),this.clearUserSelection(a.username)},clearAllUsersSelection:function(){this.$ghostContainer.empty()},clearUserSelection:function(a){this.$ghostContainer.find(".ghost-guide[data-username="+a+"]").remove()},updateStencilSelection:function(c){var d=a.currentMockup.stencil(c),e=b('.ghost-guide[data-stencil="'+c+'"]');d&&e&&e.css({top:d.top,left:d.left,width:d.width,height:d.height})},drawUserSelection:function(c,d,e){var f=this.user({username:d}),g=f?f.color:"transparent";this.clearUserSelection(d);for(var h=0;h<e.length;h++){var i=a.currentMockup.stencil(e[h]);i&&b("<div class='ghost-guide' data-username='"+d+"' data-stencil='"+i.id+"'></div>").css({top:i.top,left:i.left,width:i.width,height:i.height,"border-color":g,"border-style":"dotted"}).appendTo(this.$ghostContainer)}}},a.presence.init(),a.updatePresencePrivacy=function(){var c=b("#presence-wrapper");c.find(".privacy").hide(),a.currentProject.isPublic?c.find(".public").show():c.find(".private").show()},a}(MODULE||{},jQuery),MODULE=function(a,b){function i(){FDBK.showServerError({message:'Collaborative editing is not available for your plan. <a href="#" class="open-dialog" data-dialog="plans-pricing" data-trigger="collaboration">Upgrade Now!</a>',style:"upgrade"})}function j(a){b("#invite-buttons, #default-collab-buttons, #unsaved-collab-buttons").hide(),b("#collaborators").removeClass("share-mode"),b(a).show()}function k(){d.isPrivate=!a.currentProject.isPublic,d.isOwner=FDBK.library.currentProject.canChangeCollaborators(),b("#share-settings-dialog").html(b("#tmpl-share").loc_tmpl({projectRights:d,shareSettings:c})),l(),m(),n(),j("#default-collab-buttons"),FDBK.config("team.suggestions")&&a.peopleSuggestionsController.autocompleteForInput(b("#collaborators").find("[name=emails]")),FDBK.API.xhr(FDBK.API.CALL_GET_COLLABORATORS,{contentType:"application/x-www-form-urlencoded",data:{projectUniqueId:a.currentProject.uniqueId},success:function(a){if(!a.success||!a.object)s();else{e=[];for(var b=0;b<a.object.length;b++){var c=a.object[b],d={email:c.email,name:c.fullName,permission:c.permission,avatarImage:utils.getAvatarImageURL({email:c.email,avatar:c.avatar}),currentUser:c.email===FDBK.USER_DATA.email};e.push(d)}m()}},error:function(){s()},traditional:!0})}function l(){b("#privacy-settings").html(b("#tmpl-privacy-settings").loc_tmpl({projectRights:d,project:FDBK.library.currentProject,user:FDBK.USER_DATA,baseUrl:FDBK.BASE_URL}))}function m(){var a=e.sort(function(a,b){return a.permission=="owner"?-1:b.permission=="owner"?1:a.currentUser?-1:b.currentUser?1:0});b(".collaborators").html(b("#tmpl-collaborators").loc_tmpl({projectRights:d,collaborators:a}))}function n(){b("#email-settings").html(b("#tmpl-email-settings").loc_tmpl({shareSettings:c}))}function o(a){var b=utils.usernameEmailArrayFromString(a),d=[];for(var f=0;f<b.length;f++){var g={email:b[f],name:null,permission:c.permission,currentUser:!1,avatarImage:utils.getAvatarImageURL({email:b[f]})};p(b[f])<0&&e.push(g),d.push(g)}return d}function p(a){var c=-1;return b.each(e,function(b,d){d.email==a&&(c=b)}),c}function q(b,c){e[p(b)].permission=c,c=c.replace("collab_",""),FDBK.API.xhr(FDBK.API.CALL_UPDATE_COLLABORATOR,{contentType:"application/x-www-form-urlencoded",data:{projectUniqueId:a.currentProject.uniqueId,emails:b,level:c},success:function(a){a.success||s(),FDBK.pub("changed-collaborators")},error:function(){s()},traditional:!0})}function r(b){e.splice(p(b),1),m(),FDBK.API.xhr(FDBK.API.CALL_REMOVE_COLLABORATOR,{contentType:"application/x-www-form-urlencoded",data:{projectUniqueId:a.currentProject.uniqueId,emails:b},success:function(a){a.success||s(),FDBK.pub("changed-collaborators")},error:function(){s()},traditional:!0})}function s(a){a=a||FDBK.loc("_Oops. Something went wrong. Please try again."),FDBK.showServerError({message:a,style:"error"})}var c={sendEmail:!0,customMessage:!1,customMessageText:"",sendCopy:!1,permission:"collab_view"},d={isPrivate:!1,isOwner:!1},e=[],f=b("#share-url"),g=b("#open-project-viewer"),h=b("#link-current-page");return a.setShareInterface=function(){var c=b(".share-action");if(FDBK.allowShareProject()){if(a.currentProject.uniqueId&&a.isUserLoggedIn()){var d=h.is(":enabled")&&h.is(":checked")?FDBK.viewURL(a.currentMockup.id):FDBK.viewURL();g.attr("href",d),f.val(d).prop("title",d).parent().show()}else g.attr("href","#"),f.val("").prop("title","").parent().hide();c.removeClass("disabled")}else c.addClass("disabled");FDBK.buildHash()},a.shareProject=function(){a.isUserLoggedIn()?a.currentProject.isNew()?a.saveProject(!0,function(){a.shareProject()}):(FDBK.openModal("#share-settings-dialog"),k()):a.askForSession()},FDBK.sub("loaded-user-settings",function(){var b=a.getUserSettings("linkToCurrentPage");if(typeof b!="boolean")return;b!==h.is(":checked")&&(h.prop("checked",b),a.setShareInterface())}),h.on("change",function(){a.setShareInterface(),f.addClass("highlight"),window.setTimeout(function(){f.removeClass("highlight")},400),a.setUserSettings("linkToCurrentPage",b(this).is(":checked"))}),FDBK.sub("mockup-changed",function(){h.prop("disabled",a.currentMockup.isMaster),a.setShareInterface()}),FDBK.sub("project-changed open-project plan-updated",function(){c.permission=FDBK.allowCollaboration()?"collab_edit":"collab_view",e=[]}),b(document).on("click","[name=project-link]",function(){this.setSelectionRange(0,1e3)}),b(document).on("focus","[name=emails]",function(){j("#invite-buttons"),b("#collab-options").show(),b("#collaborators").addClass("share-mode")}),b(document).on("click","#save-share",function(){var d=b("#collaborators").find("[name=emails]"),f=o(d.val());m(),d.val(""),j("#default-collab-buttons"),b("#collab-options").hide();if(f.length>0){var g="";for(var h=0;h<f.length;h++)g+=f[h].email,h!=f.length-1&&(g+=", ");var i={projectUniqueId:a.currentProject.uniqueId,emails:g,level:c.permission,sendEmail:c.sendEmail};i.level=i.level.replace("collab_",""),c.sendEmail&&(i.sendCopyToMe=c.sendCopy),c.customMessage&&(c.customMessageText=b.trim(b("[name=custom-message]").val()),i.customMessage=c.customMessageText),FDBK.API.xhr(FDBK.API.CALL_ADD_COLLABORATORS,{contentType:"application/x-www-form-urlencoded",data:i,success:function(a){if(a.success&&a.object){for(var c=0;c<a.object.length;c++){var d=p(a.object[c].email);if(d<0)continue;e[d].name=a.object[c].fullName,e[d].avatarImage=utils.getAvatarImageURL({email:a.object[c].email,avatar:a.object[c].avatar}),e[d].permission=a.object[c].permission}m(),FDBK.pub("changed-collaborators"),FDBK.showServerError({message:FDBK.pluralize("_Project was shared with new collaborators",f.length)}),b("#collaborators-list").scrollTop(b("#collaborators-list")[0].scrollHeight)}else s()},error:function(){s()},traditional:!0})}}),b(document).on("click","#cancel-share",function(){j("#default-collab-buttons"),b("#collab-options").hide()}),b(document).on("click","#cancel-changes",function(){j("#default-collab-buttons")}),b(document).on("click","#save-changes",function(){j("#default-collab-buttons")}),b(document).on("click","#collaborators [data-action=delete]",function(){var a=b(this).parents(".collaborator").data("email");FDBK.allowCollaboration()?confirm(FDBK.loc("_Are you sure you want to remove this collaborator?"))&&r(a):r(a),FDBK.hideTooltip()}),FDBK.sub("action-clicked",function(a){var b;a.$action.hasClass("permission")?(b=a.$action.data("permission"),b=="collab_edit"&&!FDBK.allowCollaboration()?i():(a.$dropdown.data("permission",b),b=="collab_view"?a.$dropdown.find(".button span").text("Can View"):a.$dropdown.find(".button span").text("Can Edit"),q(a.$dropdown.parents(".collaborator").data("email"),b))):a.$action.hasClass("bulk-permission")&&(b=a.$action.data("permission"),b=="collab_edit"&&!FDBK.allowCollaboration()?i():(a.$dropdown.data("permission",b),c.permission=b,b=="collab_view"?a.$dropdown.find(".button span").text("Can View"):a.$dropdown.find(".button span").text("Can Edit")))}),b(document).on("change","[name=create-privacy]",function(){var a=b("[name=create-privacy]"),c=b("[name=create-privacy]:checked").val()==="private",d=b("#new-project-dialog");d.find(".status").hide(),c?FDBK.allowPrivacy()?d.find(".status.private").show():(d.find(".status.public").show(),a.filter("[value=public]").prop("checked",!0),FDBK.showServerError({message:'This feature requires a premium subscription.<br/><a href="#" class="open-dialog" data-dialog="plans-pricing" data-trigger="privacy">Upgrade Now!</a>',style:"upgrade"})):d.find(".status.public").show()}),b(document).on("change","[name=privacy]",function(){var c=b("[name=privacy]"),e=b("[name=privacy]:checked").val()==="private";e?FDBK.allowPrivacy()?(d.isPrivate=e,l(),a.changePrivacy(d.isPrivate)):(c.filter("[value=public]").prop("checked",!0),FDBK.showServerError({message:'This feature requires a premium subscription.<br/><a href="#" class="open-dialog" data-dialog="plans-pricing" data-trigger="privacy">Upgrade Now!</a>',style:"upgrade"})):(c.filter("[value=private]").prop("checked",!0),confirm(FDBK.loc("_Are you sure you want to make this project public?"))&&(d.isPrivate=e,l(),a.changePrivacy(d.isPrivate),c.filter("[value=public]").prop("checked",!0)))}),a.changePrivacy=function(b){var c=b?"private_":"public_";if(!FDBK.library.currentProject)return;FDBK.API.xhr(FDBK.API.CALL_SET_PROJECT_PRIVACY,{contentType:"application/x-www-form-urlencoded",data:{projectUniqueId:a.currentProject.uniqueId,privacy:c},traditional:!0,success:function(a){a.success?(FDBK.library.currentProject.isPublic=!b,FDBK.library.updatePresencePrivacy()):s(),FDBK.pub("project-privacy-changed")},error:function(){s()}})},b(document).on("change","[name=send-email]",function(){c.sendEmail=b(this).is(":checked"),n()}),b(document).on("change","[name=send-copy]",function(){c.sendCopy=b(this).is(":checked")}),b(document).on("click",".toggle-custom-message",function(){var a=b("[name=custom-message]");a.length?(c.customMessageText=b.trim(a.val()),c.customMessage=!1):c.customMessage=!0,n()}),b(document).on("mousedown","#collaborators",function(a){b(a.target).closest(".dropdown-wrapper").length||FDBK.closeDropdowns()}),a}(MODULE||{},jQuery),MODULE=function(a,b,c,d){return a.getMockupListItemView=function(a,c,d){var e=d&&a.master?" has-master":"",f=d&&a.master?'<span class="master-indicator" title="'+FDBK.library.currentProject.mockup(a.master).name+'">M</span>':"",g='<li class="mockup-list-item'+e+'" data-mockup="'+utils.sanitize(a.id)+'">'+f+'<span title="'+utils.sanitize(a.name)+'" class="mockup-name ellipsis">'+utils.sanitize(a.name)+"</span>"+"</li>";return c?b(g):g},a.getMockupSVG=function(a){return b.parseXML('<svg xmlns="http://www.w3.org/2000/svg" id="'+utils.sanitize(a)+'" class="mockup"></svg>').childNodes[0]},a.renderStencil=function(a,e,f){if(!a)return;var g,h,i,j,k=f?"stencil-grouped":"stencil";switch(a.type){case"group":h=b.parseXML('<svg xmlns="http://www.w3.org/2000/svg"></svg>').childNodes[0],j=a.stencils,g=null,k+=" group";break;case"stencil":h=FDBK.getStencilDOM(a.name,a),j=null}i=d.add([h],e,!0),i.id=a.id,a.type=="group"&&(i.modelReference=a),i.setAttribute("width",a.width),i.setAttribute("measured-width",a.width),i.setAttribute("height",a.height),i.setAttribute("measured-height",a.height),i.setAttribute("x",a.left),i.setAttribute("y",a.top);if(j)for(var l=j.length-1;l>=0;l--)arguments.callee.call(this,j[l],i,!0);i.className.baseVal=k,a.type!="group"&&d().layout(i,!0);if(a.type!="group"){var m=c(i).measuredWidth();m>a.width&&!FDBK.VIEWER_MODE&&(a.width=m,FDBK.pub("collab-move-resize-stencil",FDBK.library.currentMockup.id,a.id))}k+=" stencil-dom-optimizer";var n=FDBK.stencilTemplate(a.name);return n&&n.excludeFromPrint&&(k+=" exclude-from-print"),i.className.baseVal=k,a.locked&&b(i).prop("locked","true"),h=null,i},a.renderMockup=function(c,d){var e=a.getMockupSVG(c.id);d.append(e),d.find(".mockup").attr("class","mockup"),b("#"+c.id).attr("class","mockup active-mockup"),a.currentMockup=a.currentProject.mockup(c.id),a.renderCurrentMockup()},a.renderFallbackPNGMockup=function(a,b,c){var d;b?d="<img id='"+utils.sanitize(a.id)+"' class='mockup mockup-fallback-png' src='"+b+"'/>":d="<p id='"+utils.sanitize(a.id)+"' class='mockup fallback-not-available'>"+utils.sanitize(a.name)+": "+FDBK.loc("_Fallback image not available")+"</p>",c.append(d)},a.renderCurrentMockup=function(d){var e=a.currentMockup,f=b("#"+e.id);if(d&&FDBK.config("projectManagement.duplicateMockupMethod")==="dom-based"){var g,h=b("#"+d).clone().attr("id",utils.sanitize(e.id)).attr("class","mockup active-mockup").find(".stencil, .stencil-grouped").each(function(b,c){c.id=c.id.replace(d,e.id),g=a.currentMockup.stencil(c.id),g&&(g.locked&&(c.locked="true"),c.templateName=g.name)}).end();f.replaceWith(h)}else{var i=e.stencilList();f.attr("class","mockup active-mockup").append("<style id='reflow-optimization-style'>.stencil-dom-optimizer {display:none !important;}</style>");for(var j=i.length-1;j>=0;j--)var k=a.renderStencil(i[j],f);var l=document.getElementById("reflow-optimization-style");l.parentNode.removeChild(l);var m=b(f).find(".group").get().reverse();b(m).each(function(){var a=this,d=b(a).find(".stencil-grouped").get(),f=0;b(d).each(function(){f=Math.max(f,c(this).position().x+c(this).measuredWidth())}),a.setAttribute("width",f),a.setAttribute("measured-width",f);var g=f>a.modelReference.width;g&&!FDBK.VIEWER_MODE&&(a.modelReference.width=f,FDBK.pub("collab-move-resize-stencil",e.id,a.modelReference.id))})}},a}(MODULE||{},jQuery,svg,layout),MODULE=function(a,b){function k(a,d){var e=!1;for(var g=0;g<a.length;g++)h.indexOf(a[g].type)>-1?(d&&d.addFilesToStage&&(a[g].tempID=utils.guid(),l(a[g],d.position)),c.push(a[g]),e=!0):FDBK.openConfirmDialog({heading:"Invalid file type",message:FDBK.loc("imageExtensionNotValid"),buttons:[{text:FDBK.loc("_Close"),classes:"blue close-modal"}]});if(e)if(!f){m();var j=b("#sidebar-tabs").find("[data-panel=images]");j.hasClass("active")||j.trigger("click")}else i.find("strong").html(c.length+" file"+(c.length>1?"s":"")+" in progress...<span>(click to cancel)</span>")}function l(b,c){var e=new FileReader;e.onload=function(e){var f=new Image;f.src=e.target.result,f.onload=function(){var g=a.addStencilFinal({type:"stencil",templateName:"tmplsvg-image",data:{path:e.target.result,width:f.width,height:f.height}},{undoable:!0,undoForwardable:!0,forward:!1});a.moveStencil(g,{top:c.top,left:c.left},{forward:!1,undoable:!1}),a.currentMockup.updateStencil(g.id,{path:FDBK.CSS_BASE_URL+"images/image-pixel.gif"}),d[b.tempID]={mockup:a.currentMockup.id,stencil:g},FDBK.pub("collab-add-stencil",a.currentMockup.id,g.id),a.selectElement(g),a.focusStage()}},e.readAsDataURL(b)}function m(){if(!c.length||!window.FormData){i.hide(),f=!1;return}f=!0;var b=new FormData;b.append("images[]",c[0],c[0].name),i.html("<strong>"+c.length+" file"+(c.length>1?"s":"")+' in progress...<span>(click to cancel)</span></strong><div class="bar"></div>').show(),e=new XMLHttpRequest,e.upload.onprogress=function(a){if(a.lengthComputable){var b=parseInt(a.loaded/a.total*100,10);i.find(".bar").css("width",b+"%")}},e.onload=function(){if(e.readyState==4)if(e.status==200){var b;try{b=JSON.parse(e.responseText)}catch(f){b={object:{errors:[]}}}if(b.object&&b.object.errors&&b.object.errors.length){var g=b.object.errors.slice()[0];n({filename:g.filename,error:g.error})}else if(b.object&&b.object.images&&b.object.images.length){var h=c[0].tempID;h&&a.updateStencil(d[h].mockup,d[h].stencil.id,{path:b.object.images[0].path}),FDBK.CACHED_IMAGES.unshift(b.object.images[0]),a.initImages(),r()}else n()}else e.status==403?(p(),FDBK.showUploadLimitAlert()):e.status==413?n({filename:c[0].name,error:"Image exceeds the maximum size of 10MB."}):q()},e.open(FDBK.API.CALL_UPLOAD.type,FDBK.BASE_URL+FDBK.API.CALL_UPLOAD.url,!0),e.send(b)}function n(a){if(g){o(0),r();return}var b="<strong>"+c[0].name+"</strong>"+" : Unknown Error<br/>";a&&(b="<strong>"+a.filename+"</strong>"+" : "+FDBK.loc(a.error)+"<br/>"),FDBK.openConfirmDialog({heading:FDBK.loc("imageUploadErrorTitle"),message:b,buttons:[{text:FDBK.loc("_Close"),classes:"right blue",onClick:function(){o(0),r(),FDBK.closeModal()}},{text:FDBK.loc("Skip error messages"),onClick:function(){o(0),r(),g=!0,FDBK.closeModal()}}]})}function o(a){var b=c[a].tempID;b&&d[b]&&FDBK.library.removeStencil(d[b].stencil.id,{mockupId:d[b].mockup})}function p(){e&&e.abort(),b.each(c,function(a){o(a)}),c=[],f=!1,i.hide()}function q(){f=!1,i.html('<strong class="paused">'+c.length+" file"+(c.length>1?"s":"")+' in queue...<span>(click to resume upload)</span></strong><div class="bar paused"></div>').show()}function r(){c.splice(0,1),m()}function s(c,d){var e=c.getData("URL"),f=c.getData("text/html"),g=[];b.each(b(f).find("img"),function(a,b){var c=b.getAttribute("src");c!=e&&g.push(c)}),g.push(e),b.each(g,function(b,c){if(c&&(c.match(".png")||c.match(".jpg")||c.match(".jpeg")||c.match(".gif"))){var e=new Image;e.src=c,e.onload=function(){var b=a.addStencilFinal({type:"stencil",templateName:"tmplsvg-image",data:{path:c,width:e.width,height:e.height}},{undoable:!0,undoForwardable:!0,forward:!1});a.moveStencil(b,{top:d.top,left:d.left},{forward:!1,undoable:!1}),FDBK.pub("collab-add-stencil",a.currentMockup.id,b.id),a.selectElement(b),a.focusStage()}}})}var c=[],d={},e,f=!1,g=!1,h=["image/png","image/gif","image/jpeg"],i=b("#upload-progress"),j=b("#drop-zone");return a.hasUploadsInProgress=function(){return c.length},FDBK.sub("streaming-offline-status-changed",function(){FDBK.STREAMING_OFFLINE||m()}),i.on("click",function(){f?p():m()}),b(document).on("mousedown",function(c){b(c.target).closest("#drop-zone").length||a.uploadInputIsFocused&&a.resetUploadInput()}),b(document).on("dragover",function(c){c.originalEvent.dataTransfer&&(c.originalEvent.dataTransfer.effectAllowed="copy",c.originalEvent.dataTransfer.dropEffect="copy",b(c.target).closest("#htmlStage, #ghost-wrapper").length?a.$htmlStage.addClass("active"):a.$htmlStage.removeClass("active")),c.preventDefault()}),b(document).on("dragend, dragleave",function(b){a.$htmlStage.removeClass("active")}),b(document).on("drop",function(c){if(c.originalEvent.dataTransfer){c.originalEvent.dataTransfer.effectAllowed="copy",c.originalEvent.dataTransfer.dropEffect="copy",a.$htmlStage.removeClass("active");var d=c.originalEvent.dataTransfer.files;if(b(c.target).closest("#htmlStage, #ghost-wrapper").length&&window.FileReader&&FDBK.allowNewStencils()){var e={top:c.originalEvent.clientY-a.$htmlStage.offset().top,left:c.originalEvent.clientX-a.$htmlStage.offset().left};a.processImageFilesData(d,{addFilesToStage:!0,position:e}),!a.isUserLoggedIn()}else a.processImageFilesData(d)}c.preventDefault()}),b(document).on("click","#drop-zone input",function(){a.uploadInputIsFocused=!0}),b(document).on("change","#drop-zone input",function(){a.processImageFilesData(this.files)}),a.processImageFilesData=function(b,c){if(typeof b&&b.length){if(!a.isUserLoggedIn()){FDBK.library.askForSession();return}b.length>50?FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:"You are about to simultaneously upload "+b.length+" images. Depending on the size of the images this might take a lot of time to complete. Are you sure you want to continue?",buttons:[{text:"Cancel",classes:"right blue close-modal",onClick:function(){a.resetUploadInput()}},{text:"Yes, please continue",classes:"close-modal",onClick:function(){k(b,c),a.resetUploadInput()}}]}):(k(b,c),a.resetUploadInput())}else a.resetUploadInput()},a.resetUploadInput=function(){window.setTimeout(function(){j.find("input").remove().end().append('<input name="images" type="file" multiple="multiple">'),a.uploadInputIsFocused=!1},10)},a.initImages=function(){var c=b("#all-images");c.hasClass("isotope")?c.isotope("destroy").empty():c.empty(),b("#tmpl-images").loc_tmpl({images:FDBK.CACHED_IMAGES.slice(0,100),loggedIn:a.isUserLoggedIn()}).appendTo("#all-images"),c.isotope({itemSelector:"li",layoutMode:"fitRows"}),c.data("partialIndex",100)},a.loadMoreImages=function(){var c=b("#all-images"),d=c.data("partialIndex");if(FDBK.CACHED_IMAGES.length<d)return;var e=b("#tmpl-images").loc_tmpl({images:FDBK.CACHED_IMAGES.slice(d,d+10),loggedIn:a.isUserLoggedIn()});c.append(e).isotope("appended",e),c.data("partialIndex",d+10)},b("#image-list").bind("scroll",function(){b(this).scrollTop()+b(this).innerHeight()>=this.scrollHeight&&a.loadMoreImages()}),a.getAllImages=function(){FDBK.library.isUserLoggedIn()?(j.removeClass("disabled").find("input").prop("disabled",!1),FDBK.API.xhr(FDBK.API.CALL_GET_ALL_IMAGES,{success:function(b){var c=b.object.reverse();for(var d=0;d<c.length;d++)FDBK.CACHED_IMAGES.push(c[d]);a.initImages()},error:function(){}})):(j.addClass("disabled").find("input").prop("disabled",!0),a.initImages())},a.deleteImage=function(b){FDBK.library.isUserLoggedIn()&&FDBK.API.xhr(FDBK.API.CALL_DELETE_IMAGE,{data:{imageId:b},success:function(){for(var c=0;c<FDBK.CACHED_IMAGES.length;c++)if(FDBK.CACHED_IMAGES[c].id==b){FDBK.CACHED_IMAGES.splice(c,1),a.initImages();break}}})},a}(MODULE||{},jQuery),MODULE=function(a,b){var c=!1,d=function(){return a.$ghost.hasClass("locked")},e="right left up down shift+right shift+left shift+up shift+down alt+right alt+left alt+up alt+down alt+shift+right alt+shift+left alt+shift+up alt+shift+down",f=function(b){var c,d,e=Number.MAX_VALUE,f=Number.MAX_VALUE;for(var g=0;g<a.currentMockup.selection.length;g++)c=a.currentMockup.selection[g],d=svg(c).position(),a.moveStencil(c,{top:d.y+b.top,left:d.x+b.left},{undoable:!1,forward:!1,updateModel:!1}),d.y<e&&(e=d.y),d.x<f&&(f=d.x);a.updateStencilTooltip("position",{left:f+b.left,top:e+b.top}),FDBK.library.$ghost.css({left:f+b.left,top:e+b.top})};return b(document).bind("keydown",e,function(e){if(a.isArea("stage")&&a.hasSelection()){if(e.altKey&&!c){var f=e.which==37?-10:e.which==39?10:0,g=e.which==38?-10:e.which==40?10:0;a.duplicateStencils(f,g),c=!0}if(!d()){for(var h=0;h<a.currentMockup.selection.length;h++){var i=a.currentMockup.selection[h];b(i).data("startPos")===undefined&&b(i).data("startPos",svg(i).position())}FDBK.library.$ghost.addClass("hide"),FDBK.pub("selection-transform","move","timer-start",a.currentMockup.selection)}return!1}}).bind("keyup",e,function(){if(a.isArea("stage")&&a.hasSelection()&&!d()){var e=a.currentMockup.selection[0];if(b(e).data("startPos")!==undefined){a.currentMockup.undo.startGroup("Move selection");for(var f in a.currentMockup.selection){var g=a.currentMockup.selection[f];a.moveStencil(g,{top:svg(g).position().y,left:svg(g).position().x},{undoable:!1}),a.showSelection(),a.currentMockup.undo.undoable("Move element by",a.moveStencil,[utils.stencilId(g),{left:b(g).data("startPos").x,top:b(g).data("startPos").y,comesFromUndoManager:!0}]),b(g).removeData("startPos")}a.currentMockup.undo.endGroup(),FDBK.library.$ghost.removeClass("hide")}return c=!1,!1}}).bind("keydown","shift+right alt+right alt+shift+right right",function(b){var c=b.shiftKey?10:1;if(a.hasSelection()&&a.isArea("stage")&&!d())return f({left:c,top:0}),!1}).bind("keydown","shift+left alt+left alt+shift+left left",function(b){if(a.hasSelection()&&a.isArea("stage")&&!d()){var c=b.shiftKey?10:1;return f({left:-c,top:0}),!1}}).bind("keydown","shift+up alt+up alt+shift+up up",function(b){if(a.hasSelection()&&a.isArea("stage")&&!d()){var c=b.shiftKey?10:1;return f({left:0,top:-c}),!1}}).bind("keydown","shift+down alt+down alt+shift+down down",function(b){if(a.hasSelection()&&a.isArea("stage")&&!d()){var c=b.shiftKey?10:1;return f({left:0,top:c}),!1}}),a}(MODULE||{},jQuery),MODULE=function(a,b){function i(a){var d=function(a,c){b("."+a).css({left:c.left,top:c.top})};switch(a){case g.HORIZONTAL:d(a,{left:c.position().left+c.outerWidth(),top:c.position().top});break;case g.VERTICAL:d(a,{left:c.position().left,top:c.position().top+c.outerHeight()});break;case g.CENTER:d(a,{left:c.position().left+c.outerWidth()-5,top:c.position().top+c.outerHeight()-5})}}function j(a){var d=b("."+a);switch(a){case g.HORIZONTAL:d.css({height:c.outerHeight()+"px"});break;case g.VERTICAL:d.css({width:c.outerWidth()+"px"});break;case g.CENTER:}}function k(a){b("#resize-tooltip-first").text("Width: "+a.width),b("#resize-tooltip-second").text("Height: "+a.height)}function l(a){var d=Math.max(0+c.position().left+10,a.pageX-c.offset().left-b(".resize-stencil-tooltip").width()),e=Math.max(0+c.position().top+10,a.pageY-c.offset().top-10);b(".resize-tooltip-wrapper").css({left:d,top:e})}var c=b("#htmlStage"),d=b("#grid"),e=b("#gridPattern"),f=b(".stage-resize-handle"),g={HORIZONTAL:"resize-horizontal",VERTICAL:"resize-vertical",CENTER:"resize-center"},h={};return a.enableStageResize=function(){f.show(),b.each(g,function(a,b){i(b),j(b)})},a.disableStageResize=function(){f.hide()},FDBK.sub("selection-transform",function(b,c,d){c==="start"?a.disableStageResize():c==="stop"&&FDBK.allowProjectSettings()&&a.enableStageResize()},a),FDBK.sub("open-project",function(){FDBK.allowProjectSettings()&&a.enableStageResize()}),FDBK.sub("close-project",function(){a.disableStageResize()}),f.draggable({distance:0,containment:[320,169,4e3,4e3],start:function(c,d){h={width:a.currentMockup.stageWidth,height:a.currentMockup.stageHeight},b(this).hasClass(g.HORIZONTAL)&&b("."+g.HORIZONTAL).draggable("option","axis","x"),b(this).hasClass(g.VERTICAL)&&b("."+g.VERTICAL).draggable("option","axis","y"),b(this).hasClass(g.CENTER)?b(this).draggable("option","containment",[310,159,4e3,4e3]):b(this).draggable("option","containment",[320,169,4e3,4e3]),b(".resize-tooltip-wrapper").show(),k({width:a.currentMockup.stageWidth,height:a.currentMockup.stageHeight}),l(c)},drag:function(d,e){var f={width:null,height:null};b(this).hasClass(g.HORIZONTAL)&&(f.width=e.position.left-c.position().left),b(this).hasClass(g.VERTICAL)&&(f.height=e.position.top-c.position().top),b(this).hasClass(g.CENTER)&&(f.width=e.position.left-c.position().left+10,f.height=e.position.top-c.position().top+10),a.setStageSize(f.width,f.height),k({width:f.width||a.currentMockup.stageWidth,height:f.height||a.currentMockup.stageHeight}),l(d)},stop:function(c,d){b(".resize-tooltip-wrapper").hide();var e=parseInt(b("#stage-width").val(),10),f=parseInt(b("#stage-height").val(),10);isNaN(e)||(a.setUserSettings("stageSizeWidth",e),a.currentMockup.stageWidth=e,a.currentProject.stageWidth=e),isNaN(f)||(a.setUserSettings("stageSizeHeight",f),a.currentMockup.stageHeight=f,a.currentProject.stageHeight=f),a.currentMockup.undo.undoable("Change Stage Size",a.setStageSize,[h.width,h.height,!0]),FDBK.pub("collab-update-stagesize",a.currentMockup.id)}}),a.setStageSize=function(e,f,g){g&&a.currentMockup.undo.undoable("Change Stage Size",a.setStageSize,[a.currentMockup.stageWidth,a.currentMockup.stageHeight,!0]),e&&g&&(a.currentMockup.stageWidth=e,a.currentProject.stageWidth=e),f&&g&&(a.currentMockup.stageHeight=f,a.currentProject.stageHeight=f),e=e||a.currentMockup.stageWidth,f=f||a.currentMockup.stageHeight,c.css({width:e,height:f}),b("#clear-selection").css({"min-height":f+40}),d[0].setAttribute("width",e),d[0].setAttribute("height",f),b("#stage-width").val(e),b("#stage-height").val(f),(e||f)&&g&&FDBK.pub("collab-update-stagesize",a.currentMockup.id),a.enableStageResize()},a.updateStageGrid=function(a,b){var c=e.children();for(var d=0;d<c.length;d++)d<=3?(c[d].setAttribute("y1",(d+1)*b),c[d].setAttribute("y2",(d+1)*b),c[d].setAttribute("x2",5*a)):d>3&&d<=7?(c[d].setAttribute("x1",(d-4+1)*a),c[d].setAttribute("x2",(d-4+1)*a),c[d].setAttribute("y2",5*b)):d==8?(c[d].setAttribute("x1",5*a),c[d].setAttribute("x2",5*a),c[d].setAttribute("y2",5*b)):(c[d].setAttribute("y1",5*b),c[d].setAttribute("y2",5*b),c[d].setAttribute("x2",5*a));e[0].setAttribute("width",5*a),e[0].setAttribute("height",5*b)},a}(MODULE||{},jQuery),MODULE=function(a,b){function e(b){var c=a.$ghost.data("resizable").options;b?(c.helper=null,c.resize=a.liveResizeFunction):(c.helper="ui-resizable-helper",c.resize=a.helperResizeFunction),a.$ghost.resizable("destroy"),a.$ghost.resizable(c)}function f(a){var c=b("#grid");a?c.show():c.hide()}function h(){var e=Math.min(Math.max(MIN_STAGE_WIDTH,b("#stage-width").val()),MAX_STAGE_WIDTH),f=Math.min(Math.max(c,b("#stage-height").val()),d),h=b("#grid-width").val(),i=b("#grid-height").val();if(g||e!=a.getUserSettings("stageSizeWidth")||f!=a.getUserSettings("stageSizeHeight")||h!=a.getUserSettings("gridSizeWidth")||i!=a.getUserSettings("gridHeight"))a.setStageSize(e,f,!0),a.snapoptions.setGrid(h,i),a.updateStageGrid(h,i),a.setUserSettings(["stageSizeWidth","stageSizeHeight","gridSizeWidth","gridHeight"],[e,f,h,i]),g=!1}function i(c){c&&b(c.target).hasClass("project-title-input")?a.updateProjectName({value:b("#project-title-input").val()}):h()}function j(a){if(b(a.target).closest(".settings-dropdown").length&&b(a.target).hasClass("text-input")){if((a.which<48||a.which>57)&&a.which!==0&&a.which!=8&&a.which!=9&&a.which!=13&&a.which!=46)return!1;a.which==13&&i()}}var c=MIN_STAGE_WIDTH=100,d=MAX_STAGE_WIDTH=2e4;b(document).on("click","#snap-grid-checkbox",function(){a.snapoptions.gridsystem()!==!1?(a.snapoptions.gridsystemSnapping=b(this).is(":checked"),a.setUserSettings("snapToGrid",b(this).is(":checked"))):a.snapoptions.gridEnabled()?(a.snapoptions.gridEnabled(!1),a.setUserSettings("snapToGrid",!1)):(a.snapoptions.gridEnabled(!0),a.setUserSettings("snapToGrid",!0))}),b(document).on("click","#snap-objects-checkbox",function(){var c=b(this).is(":checked");a.snapoptions.snap.snapToObjects=c,a.setUserSettings("snapToObjects",c)}),b(document).on("click","#smart-guides-checkbox",function(){var c=b(this).is(":checked");a.snapoptions.snap.showGuides=c,a.setUserSettings("showGuides",c)}),b(document).on("click","#live-resize-checkbox",function(){var c=b(this).is(":checked");a.setUserSettings("liveResize",c),e(c)}),b(document).on("click",".gridSettingsButton",function(){var c=b(this).data("type"),d=b("#snap-grid-checkbox").is(":checked");switch(c){case"hide-grid":b(".toggle-gridsystem").hide(),b(".grid-size-inputs").hide(),b("#snap-grid-checkbox").removeAttr("checked").closest("label").hide(),f(!1),a.setUserSettings(["gridVisible","gridsystemEnabled","snapToGrid"],[!1,!1,!1]),a.snapoptions.gridsystem(!1),a.snapoptions.gridEnabled(!1);break;case"show-grid":b(".toggle-gridsystem").hide(),b(".grid-size-inputs").show(),b("#snap-grid-checkbox").closest("label").show(),f(!0),a.setUserSettings(["gridVisible","gridsystemEnabled"],[!0,!1]),a.snapoptions.gridsystem(!1),a.snapoptions.gridEnabled(d);break;case"show-gridsystem":b(".toggle-gridsystem").show(),b(".grid-size-inputs").hide(),b("#snap-grid-checkbox").closest("label").show(),f(!1);var e=b(".gridSystemButton.active").data("type");a.setUserSettings(["gridVisible","gridsystemEnabled","selectedgridSystem"],[!1,!0,e]),a.snapoptions.gridsystem(e),a.snapoptions.gridEnabled(!1),a.snapoptions.gridsystemSnapping=d}}),b(document).on("click",".gridSystemButton",function(){var c=b(this).data("type");a.setUserSettings("selectedgridSystem",c),a.snapoptions.gridsystem(c)}),b("#project-settings").on("keydown","input, textarea","return",function(a){i(a),FDBK.closeDropdowns()}).on("blur","input",i),b(document).on("keypress",j);var g=!0;return FDBK.sub("mockup-changed",function(){g=!0}),FDBK.sub("open-project",function(){FDBK.allowProjectSettings()&&b("#open-settings").removeClass("disabled"),FDBK.allowSaveProject()&&b(".save-action").removeClass("disabled"),b("#project-title-input").val(a.currentProject.name)}),FDBK.sub("project-renamed",function(){b("#project-title-input").val(a.currentProject.name)}),FDBK.sub("close-project",function(){b("#open-settings").addClass("disabled"),b(".save-action").addClass("disabled")}),a.setGridVisible=f,a.setLiveResize=e,a}(MODULE||{},jQuery),MODULE=function(a,b){function h(c){b(c.target).closest("#contextMenu").length||a.hideContextMenu()}function i(){var a,b;for(var c=0;c<FDBK.library.currentMockup.selection.length;c++)b=FDBK.library.currentMockup.stencil(FDBK.library.currentMockup.selection[c].id),a?a=utils.intersectionOfObjects(a,b.inspectables):a=b.inspectables;a&&Object.keys(a).length>0&&(g=a)}function j(){FDBK.library.inspect(null,g)}function k(){a.hasSelection()&&(m(),a.deleteSelection(),f=!0)}function l(){m(),f=!1}function m(){a.hasSelection()&&(c=a.currentMockup.id,d=a.clipboardController.stencilsForClipboardFromSelection())}function n(b,e,g){if(a.currentMockup&&d.length>0&&FDBK.allowNewStencils()){a.currentMockup.id!=c&&b===undefined&&(b=!0),e=e!==undefined?e:d.length==1?0:10,g=g!==undefined?g:d.length==1?d[0].height+10:10,a.currentMockup.undo.startGroup("Paste"),a.currentMockup.selection=[];var h,i=[],j;for(var k=0;k<d.length;k++)h=d[k],b||(h.top+=g,h.left+=e),j=a.addStencilFinal({type:h.type,templateName:h.name,data:h}),i.push(j);a.currentMockup.selection=i,a.showSelection(),m(),a.currentMockup.undo.endGroup();var l=function(b){if(!b)return;if(b.link&&b.link.type=="mockup"){var c=a.currentProject.mockup(b.link.ref);c||(b.link=null)}if(b.type==="group"&&b.stencils)for(var d=0;d<b.stencils;d++)l(b.stencils[d])};for(var n in d){var o=a.currentMockup.stencil(n);l(o)}f=!1}}a.clipboardController={clipboardHelper:null,lastPasted:null,lastPastedImage:null,forcePasteInPlace:!1,init:function(){BrowserDetect.browser!="Chrome"?a.clipboardController.clipboardHelper=b('<div contenteditable="" style="opacity:0;">').appendTo("body")[0]:a.clipboardController.clipboardHelper=b('<div style="opacity:0;">').appendTo("body")[0],b(document).bind("keydown","ctrl meta",a.clipboardController._prepareForClipboardEvent),b(document).on("keydown",function(b){b.keyCode==91&&a.clipboardController._prepareForClipboardEvent()}),window.addEventListener("paste",a.clipboardController._pasteListener),b(document).on("keydown",null,"meta+a ctrl+a",function(){return a.currentMockup&&!a.isArea("modal")&&(a.currentMockup.selection.length=0,a.getAllVisibleStencils().each(function(){a.currentMockup.selection.push(this)}),a.showSelection(),a.clipboardController._prepareForClipboardEvent()),!1})},stencilsForClipboardFromSelection:function(){function c(a){if(a.stencils&&a.stencils.length>0)for(var b=0;b<a.stencils.length;b++)delete a.stencils[b].id,arguments.callee(a.stencils[b])}var d=a.currentMockup.selection.map(function(d){var e=b.extend(!0,{},a.currentMockup.stencil(d.id));return e.id=null,c(e),e});return d},execCopyCommand:function(){return window.chrome&&window.chrome.app&&window.chrome.app.isInstalled?(this._prepareForClipboardEvent(),document.execCommand("copy",!1,this.clipboardHelper.innerHTML),!0):!1},execPasteCommand:function(){return window.chrome&&window.chrome.app&&window.chrome.app.isInstalled?(this._prepareForClipboardEvent(),document.execCommand("paste"),!0):!1},_prepareForClipboardEvent:function(){if(FDBK.hasFocusedInput()||a.isArea("modal"))return;if(a.hasSelection()){var b=a.currentMockup.id,c=a.clipboardController.stencilsForClipboardFromSelection();a.clipboardController.clipboardHelper.textContent=JSON.stringify({sourceMockup:b,stencils:c,guid:utils.guid()});var d=document.createRange();d.selectNodeContents(a.clipboardController.clipboardHelper);var e=window.getSelection();e.removeAllRanges(),e.addRange(d)}a.clipboardController.clipboardHelper.focus()},_pasteListener:function(b){if(FDBK.hasFocusedInput()||a.isArea("modal"))return;if(b.clipboardData&&b.clipboardData.items){var c=b.clipboardData.getData("text/plain"),d=a.clipboardController._getImage(b.clipboardData);d?a.clipboardController._handleImagePasted(d):c&&a.clipboardController._handleTextPasted(c),a.clipboardController.clipboardHelper.innerHTML=""}else setTimeout(a.clipboardController._checkInput,0)},_checkInput:function(){var b=a.clipboardController.clipboardHelper.childNodes[0];a.clipboardController.clipboardHelper.innerHTML="";if(b)if(b.tagName==="IMG"){var c=b.src,d=/^data\:(image\/[a-zA-Z\+]+)\;base64\,(.+)$/.exec(c);if(d){var e=d[1];c=d[2],a.clipboardController._handleImagePasted(utils.b64toBlob(c,e))}}else b.textContent&&a.clipboardController._handleTextPasted(b.textContent)},_getImage:function(a){var b=a.items;for(var c=0;c<b.length;c++)if(b[c].type.indexOf("image")!==-1)return b[c].getAsFile()},_positionOffsetForPaste:function(a){return a.stencils.length>1?{top:10,left:10}:{top:a.stencils[0].height+10,left:0}},_handleTextPasted:function(a){var b;try{b=JSON.parse(a.replace(/\n/g,""))}catch(c){console.log("Failed parsing pasted text, ignoring",c.message)}if(!b||!b.stencils)return;d=[].concat(b.stencils);var e=this._positionOffsetForPaste(b),f=this.forcePasteInPlace||FDBK.library.currentMockup.id!=b.sourceMockup,g=f?0:e.left,h=f?0:e.top,i=this.lastPasted&&b.guid==this.lastPasted.guid&&FDBK.library.currentMockup.id==this.lastPasted.mockupId;if(i&&!this.forcePasteInPlace){f=!1;var e=this._positionOffsetForPaste(b);g=this.lastPasted.left+e.left,h=this.lastPasted.top+e.top}n(f,g,h),this.lastPasted={guid:b.guid,left:g,top:h,mockupId:FDBK.library.currentMockup.id},this.forcePasteInPlace=!1},_handleImagePasted:function(b){var c=FDBK.library.$projectWrapper.scrollLeft()+10,d=FDBK.library.$projectWrapper.scrollTop()+10;this.lastPastedImage&&b.size==this.lastPastedImage.size&&a.currentMockup.id==this.lastPastedImage.mockupId&&(console.log("here"),c+=this.lastPastedImage.left,d+=this.lastPastedImage.top),b.name="Image_Paste "+moment().format("YYYY-DD-MM")+" at "+moment().format("HH.mm.ss")+".png",a.processImageFilesData([b],{addFilesToStage:!0,position:{top:d,left:c}}),this.lastPastedImage={mockupId:FDBK.library.currentMockup.id,size:b.size,top:d,left:c}}},a.clipboardController.init();var c="",d=[],e=[],f=!1,g=null;return b("#contextMenu").on("click",".context-menu",function(){if(!b(this).hasClass("disabled")){var c=b(this).data("type");switch(c){case"cut":a.clipboardController.execCopyCommand()?a.deleteSelection():k();break;case"copy":a.clipboardController.execCopyCommand()||l();break;case"copystyle":i();break;case"paste":a.clipboardController.execPasteCommand()||n(f);break;case"pastestyle":j();break;case"duplicate":a.currentMockup&&(l(),n(f));break;case"delete":a.deleteSelection();break;case"edit":a.editor.enterEditMode();break;case"share":b("#open-share-preview").trigger("mousedown");break;case"hotspot":a.createHotspotsForStencils();break;case"linking":FDBK.showLinkInspectorForSelection()}a.hideContextMenu()}}),a.$projectWrapper.mouseup(function(c){if(c.button==2){if(b("#editArea").is(c.target))return;a.inspectorState.act("hide");var d=b("#contextMenu"),e=d.outerWidth(),f=d.outerHeight();d.find(".disabled").removeClass("disabled"),a.isSingleSelection()?svg(a.currentMockup.selection[0]).isEditable()||d.find(".editable").addClass("disabled"):d.find(".editable").addClass("disabled"),a.hasSelection()||d.find(".selection").addClass("disabled"),a.hasClipboardData()||d.find(".clipboard").addClass("disabled"),g||d.find(".pastestyle").addClass("disabled");var i=c.clientX+e>document.body.clientWidth?c.clientX-e:c.clientX,j=c.clientY>document.body.clientHeight/2?c.clientY-f:c.clientY,k=j+f-document.body.clientHeight;d.css({left:i,top:Math.max(k>0?j-k:j,5)}).fadeIn(50),b(document).on("mousedown",h),FDBK.pub("contextmenu-visible")}}).add("#contextMenu").bind("contextmenu",function(a){return b("#editArea").is(a.target)}),a.hideContextMenu=function(){b("#contextMenu").hide(),a.isSingleSelection()&&a.inspectorState.act("show"),b(document).off("mousedown",h),FDBK.pub("contextmenu-hidden")},b(document).bind("keydown","meta+x ctrl+x",function(){a.isArea("stage")&&(a.clipboardController.execCopyCommand()?a.deleteSelection():(k(),BrowserDetect.browser=="Chrome"&&(e=d)))}),b(document).bind("keydown","meta+c ctrl+c",function(){a.isArea("stage")&&(a.clipboardController.execCopyCommand(),m())}),b(document).bind("keydown","meta+v ctrl+v",function(){if(e.length>0&&a.isArea("stage"))return d=e.slice(),a.clipboardController.forcePasteInPlace=!0,e.length=0,n(),a.clipboardController.forcePasteInPlace=!1,!1}),b(document).bind("keydown","meta+shift+v ctrl+shift+v",function(){a.clipboardController.forcePasteInPlace=!0}),b(document).bind("keydown","meta+d ctrl+d",function(){if(a.isArea("stage"))return a.currentMockup&&!a.$ghost.hasClass("locked")&&(l(),n(f)),!1}),b(document).bind("keydown","alt+c",function(){a.isArea("stage")&&i()}),b(document).bind("keydown","alt+v",function(){a.isArea("stage")&&j()}),a.hasClipboardData=function(){return d.length},a.duplicateStencils=function(b,c){a.currentMockup.undo.startGroup("Duplicate Stencils"),l(),n(!1,b,c),a.currentMockup.undo.endGroup()},a.cutStencils=k,a.copyStencils=l,a.pasteStencils=n,a}(MODULE||{},jQuery),MODULE=function(a,b){function c(c,d){var e;return b.each(d,function(b,d){var f=a.getSvgPoints(d);if(e!==undefined){if(c=="left"||c=="top")e=f[c]<e?f[c]:e;else if(c=="right"||c=="bottom")e=f[c]>e?f[c]:e}else e=f[c]}),e}function d(a,c,d){var e=0;return b.each(c,function(b,c){var d=svg(c).measuredWidth(),f=svg(c).measuredHeight();a=="horizontal"?e+=d:e+=f}),(d-e)/(c.length-1)}function e(a,c){var d;return a=a.charAt(0).toUpperCase()+a.substring(1),b.each(c,function(b,c){d!==undefined?d=svg(c)["measured"+a]()>svg(d)["measured"+a]()?c:d:d=c}),d}function f(b){var c=e("width",b);return a.getSvgPoints(c).left+svg(c).measuredWidth()/2}function g(b){var c=e("height",b);return a.getSvgPoints(c).top+svg(c).measuredHeight()/2}function h(d){if(a.hasSelection()&&d){var e=a.currentMockup.selection[0],h=function(){},i=0,j=0;switch(d){case"left":a.isMultiSelection()&&(i=c("left",a.currentMockup.selection)),h=function(b){j=svg(b).position().y,a.moveStencil(b,{top:j,left:i})};break;case"right":i=a.currentMockup.stageWidth-svg(e).measuredWidth();var k=c("right",a.currentMockup.selection);h=function(b){a.isMultiSelection()&&(i=k-svg(b).measuredWidth()),j=svg(b).position().y,a.moveStencil(b,{top:j,left:i})};break;case"top":a.isMultiSelection()&&(j=c("top",a.currentMockup.selection)),h=function(b){i=svg(b).position().x,a.moveStencil(b,{top:j,left:i})};break;case"bottom":j=a.currentMockup.stageHeight-svg(e).measuredHeight();var l=c("bottom",a.currentMockup.selection);h=function(b){a.isMultiSelection()&&(j=l-svg(b).measuredHeight()),i=svg(b).position().x,a.moveStencil(b,{top:j,left:i})};break;case"center":i=Math.ceil((a.currentMockup.stageWidth-svg(e).measuredWidth())/2);var m=f(a.currentMockup.selection);h=function(b){a.isMultiSelection()&&(i=Math.ceil(m-svg(b).measuredWidth()/2)),j=svg(b).position().y,a.moveStencil(b,{top:j,left:i})};break;case"middle":j=Math.ceil((a.currentMockup.stageHeight-svg(e).measuredHeight())/2);var n=g(a.currentMockup.selection);h=function(b){a.isMultiSelection()&&(j=Math.ceil(n-svg(b).measuredHeight()/2)),i=svg(b).position().x,a.moveStencil(b,{top:j,left:i})}}a.currentMockup.undo.startGroup("Align selection"),b.each(a.currentMockup.selection,function(a,b){h(b)}),a.currentMockup.undo.endGroup(),a.showSelection()}}function i(e){if(a.isMultiSelection()){var f=a.currentMockup.selection.slice();e=="horizontal"?f.sort(function(a,b){return svg(a).position().x-svg(b).position().x}):e=="vertical"&&f.sort(function(a,b){return svg(a).position().y-svg(b).position().y});var g=c("left",a.currentMockup.selection),h=c("top",a.currentMockup.selection),i=c("bottom",a.currentMockup.selection),j=c("right",a.currentMockup.selection),k=e=="horizontal"?j-g:i-h,l=d(e,a.currentMockup.selection,k),m=0;switch(e){case"horizontal":m=g,a.currentMockup.undo.startGroup("Distribute selection horizontally"),b.each(f,function(b,c){var d=m,e=svg(c).position().y;a.moveStencil(c,{top:e,left:d}),m+=svg(c).measuredWidth()+l}),a.currentMockup.undo.endGroup();break;case"vertical":m=h,a.currentMockup.undo.startGroup("Distribute selection vertically"),f.sort(function(a,b){return svg(a).position().y-svg(b).position().y}),b.each(f,function(b,c){var d=svg(c).position().x,e=m;a.moveStencil(c,{top:e,left:d}),m+=svg(c).measuredHeight()+l}),a.currentMockup.undo.endGroup()}a.showSelection()}}function j(d){if(a.isMultiSelection()){var e=a.currentMockup.selection,f=c("left",a.currentMockup.selection),g=c("top",a.currentMockup.selection),h=0;switch(d){case"horizontal":a.currentMockup.undo.startGroup("Layout selection horizontally"),e.sort(function(a,b){return svg(a).position().x-svg(b).position().x}),b.each(e,function(b,c){var d=f+h+b*10,e=svg(c).position().y;a.moveStencil(c,{top:e,left:d}),h+=svg(c).measuredWidth()}),a.currentMockup.undo.endGroup();break;case"vertical":a.currentMockup.undo.startGroup("Layout selection vertically"),e.sort(function(a,b){return svg(a).position().y-svg(b).position().y}),b.each(e,function(b,c){var d=svg(c).position().x,e=g+h+b*10;a.moveStencil(c,{top:e,left:d}),h+=svg(c).measuredHeight()}),a.currentMockup.undo.endGroup();break;default:}a.showSelection()}}return b("body").on("click",".align",function(){h(b(this).data("type"))}),b("body").on("click",".distribute",function(){i(b(this).data("type"))}),b("body").on("click",".layout",function(){j(b(this).data("type"))}),a}(MODULE||{},jQuery),MODULE=function(a,b){function c(c,f){if(a.hasSelection()&&f){c=c.map(function(a){return utils.stencil(a)});var g=c.length,h,i;i=c.map(function(a){return utils.stencilId(a)});switch(f){case"forward":d(c,i);break;case"front":var j=b(c[g-1]).nextAll();if(j.length>0){a.currentMockup.undo.startGroup("send to front");for(h=0;h<j.length;h++)d(c,i);a.currentMockup.undo.endGroup("send to front")}else d(c,i);break;case"backward":e(c,i);break;case"back":var k=b(c[0]).prevAll();if(k.length>0){a.currentMockup.undo.startGroup("send to back");for(h=0;h<k.length;h++)e(c,i);a.currentMockup.undo.endGroup("send to back")}else e(c,i)}}}function d(c,d){var e=c.length,g=b(c[e-1]).next(),h,j=!1;g.length>0&&(a.currentMockup.undo.startGroup("send forward"),f(c[e-1].id,g[0].id,null),j=!0);if(e>1)for(i=e-2;i>=0;i--)h=b(c[i]).next()[0],h&&c[i+1]!=h&&(j||a.currentMockup.undo.startGroup("send forward"),f(c[i].id,null,c[i+1].id),j=!0);j&&a.currentMockup.undo.endGroup()}function e(c,d){var e=c.length,g=b(c[0]).prev(),h,j=!1;g.length>0&&(a.currentMockup.undo.startGroup("send backward"),f(c[0].id,null,g[0].id),j=!0);if(e>1)for(i=1;i<e;i++)h=b(c[i]).prev()[0],h&&(c[i-1]!=h||i===0)&&(j||a.currentMockup.undo.startGroup("send backward"),f(c[i].id,c[i-1].id,null),j=!0);j&&a.currentMockup.undo.endGroup()}function f(c,d,e){var g=b(utils.stencil(c)),h=g.prev(".stencil")[0],i=g.next(".stencil")[0];a.currentMockup.undo.undoable("Stack Stencil",f,[c,utils.stencilId(h),utils.stencilId(i)]),a.stackStencil(c,d,e)}function g(b,c,d){a.orderStencil(b,{before:c,after:d})}return b("body").on("click",".arrange",function(){c(a.currentMockup.selection,b(this).data("type"))}),b(document).on("keydown",null,"meta+up ctrl+up",function(){if(a.isArea("stage"))return c(a.currentMockup.selection,"forward"),!1}),b(document).on("keydown",null,"meta+shift+up ctrl+shift+up",function(){if(a.isArea("stage"))return c(a.currentMockup.selection,"front"),!1}),b(document).on("keydown",null,"meta+down ctrl+down",function(){if(a.isArea("stage"))return c(a.currentMockup.selection,"backward"),!1}),b(document).on("keydown",null,"meta+shift+down ctrl+shift+down",function(){if(a.isArea("stage"))return c(a.currentMockup.selection,"back"),!1}),a.stackStencil=g,a}(MODULE||{},jQuery),MODULE=function(a,b,c){function m(){return d||(e=null,f=null,b("#stencil-preview").remove(),b('<div id="stencil-preview"></div>').appendTo(b("body")),d=!0),b("#stencil-preview")}function n(b,c){var d=FDBK.library.addStencilFinal({type:"stencil",templateName:b.name},{undoable:!0,undoForwardable:!0,forward:!1});return d&&o(d,c),FDBK.pub("collab-add-stencil",a.currentMockup.id,d.id),a.focusStage(),d}function o(b,d){d=d||{};var e=a.defaultPosition();a.moveStencil(b,{top:d.top===undefined?e.top:d.top,left:d.left===undefined?e.left:d.left},{forward:!1,undoable:!1});switch(FDBK.config("stencilSidebar.stencilInitBehavior")){case"edit":c(b).isEditable()?a.editor.startEditing(b):a.selectElement(b,!0);break;case"inspect":a.selectElement(b,!0);break;case"select":a.selectElement(b)}}function p(c,d,e){var f=b(c).clone(),g=a.addStencilFinal({type:"stencil",templateName:"tmplsvg-image",data:{path:f.data("thumb"),width:f.data("width"),height:f.data("height")}},{undoable:!0,undoForwardable:!0,forward:!1});o(g,d),e&&(a.$projectWrapper[0].scrollLeft=d.left||0,a.$projectWrapper[0].scrollTop=d.top||0),a.currentMockup.updateStencil(g.id,{path:f.data("path")}),FDBK.pub("collab-add-stencil",a.currentMockup.id,g.id);var h=FDBK.ASSET_IMAGE_BASE_URL+f.data("path"),i=new Image;i.src=h,i.onload=function(){b(g).find("image").attr("xlink:href",h)},a.focusStage()}function u(c){s="",t=b.trim(j.val()).toLowerCase();if((c.which<37||c.which>40)&&c.which!=27&&c.which!=13){h.find(".found").removeClass("found");var d=t.split(/[\s\W]+/),e="(?:";for(var f=0;f<d.length;f++)d[f].length>0&&(f>0&&(e+="|"),e+=d[f]);e+=")+";var g=RegExp(e,"gi");a.delayAction(function(){switch(a.activeSidebarPanel){case"stencils":case"images":v(g);break;case"pages":w(g)}},300)}}function v(a){if(t!==""&&s!=t||s!==""&&t===""){var c=h.find("li"),d,e,f;for(var g=0;g<c.length;g++){d=b(c[g]),f=FDBK.stencilTemplate(d.find("a").data("id")),e=f&&f.tags?f.tags:"";var i=d.find("span").text().match(a),j=e.toLowerCase().match(a),k=d.find("span").text().split(/[\s\W]+/).length;if(i||j){var m=i?i.length*10:0;m+=j?j.length:0,m+=i&&i.length==k?100:0,d.data("order",m),d.addClass("found")}}h.isotope("updateSortData",h.find("li.found")),h.isotope({filter:".found",sortBy:"order",sortAscending:!1}),s=t,l.show(),b("#search-icon").addClass("has-search")}else t===""&&(l.hide(),b("#search-icon").removeClass("has-search"),h.find("li").each(function(a,c){b(c).data("order",a)}),h.isotope("updateSortData",h.find("li")),h.isotope({filter:"*",sortBy:"order",sortAscending:!0}));x()}function w(c){if(t!==""&&s!=t||s!==""&&t===""){var d=a.currentProject.mockupList().filter(function(a){return a.name.match(c)});a.refreshProjectStructure(d),a.disablePageSorters(),s=t,l.show(),b("#search-icon").addClass("has-search")}else t===""&&(l.hide(),b("#search-icon").removeClass("has-search"),a.refreshProjectStructure(),a.enablePageSorters())}function x(){h.find("li").removeClass("selected");var a=h.find("li");a.filter(".found").length>0&&(a=a.filter(".found"),a.sort(function(a,b){return g.order(a)>g.order(b)?-1:g.order(a)<g.order(b)?1:0})),b(a[0]).addClass("selected"),i.animate({scrollTop:0},"fast")}function y(b){var c=a.currentMockup?a.pageListItemForMockup(a.currentMockup.id):null;c&&(b===37&&c.hasClass("expanded")?(c.removeClass("expanded"),a.currentMockup._expanded=!1):b===39&&!c.hasClass("expanded")&&(c.addClass("expanded"),a.currentMockup._expanded=!0))}function z(a){var c=h.find("li");c.filter(".found").length>0&&(c=c.filter(".found"),c.sort(function(a,b){return g.order(a)>g.order(b)?-1:g.order(a)<g.order(b)?1:0}));var d=0,e=Math.floor(h.width()/b(c[0]).outerWidth()),f=b(c[0]).outerHeight();for(var j=0;j<c.length;j++)if(b(c[j]).hasClass("selected")){d=j;break}var k=d;a==38?k=d-e:a==39?k=d+1:a==40?k=d+e:a==37&&(k=d-1),k=k<0?c.length-1:k>c.length-1?0:k;if(k!=d){b(c[d]).removeClass("selected"),b(c[k]).addClass("selected");var l=Math.floor(k/e)*f,m=i.scrollTop();(m+i.height()-f<l||l<m)&&i.animate({scrollTop:l},"fast")}}var d=!1,e,f;a.defaultPosition=function(a){if(a&&a==="images")return{left:0,top:0};var c=b("#project-wrapper")[0];return{left:20+c.scrollLeft,top:20+c.scrollTop}},FDBK.getAllStencilIconsDOM?b("#stencils").html(FDBK.getAllStencilIconsDOM()):console.error("Wrong order of JS files; module.stencilTemplates not loaded yet.");var g={order:function(a){return b(a).data("order")||0}},h=b("#stencils"),i=b("#stencils-holder"),j=b("#search-input"),k=b("#search-icon"),l=b("#clear-search");k.click(function(){j.focus()}),j.on("blur",function(){q=""}),l.click(function(){b(this).hide(),j.val("").focus(),h.find("li").each(function(a,c){b(c).data("order",a)}),b("#search-icon").removeClass("has-search"),h.isotope("updateSortData",h.find("li")),h.isotope({filter:"*",sortBy:"order",sortAscending:!0}),a.currentProject&&(a.refreshProjectStructure(),a.enablePageSorters())}),b("#stencils, #image-list").on("click","li",function(){b(this).addClass("selected").siblings().removeClass("selected")}),b(document).on("click",".delete-image",function(c){var d=b(this).parents("li").prop("id").split("-")[1];c.shiftKey?a.deleteImage(d):FDBK.openConfirmDialog({heading:FDBK.loc("_Delete image"),message:FDBK.loc("_Selected image will be deleted."),buttons:[{text:FDBK.loc("_Delete"),classes:"primary-action",onClick:function(){a.deleteImage(d)}},{text:FDBK.loc("_Cancel"),classes:"close-modal"}]})}),b(document).on("dblclick",".image-item",function(){if(FDBK.allowNewStencils()){var c=b(this).find("img").first()[0];p(c,a.defaultPosition("images"),!0)}}),b("#image-list").on("mouseenter",".image-item",function(){if(!a.currentProject)return;b(this).draggable({distance:10,helper:m,snap:".none",customSnap:a.snapoptions.snap,snapTolerance:a.snapoptions.snap.snapTolerance,snapGrid:a.snapoptions.snapGrid,containment:"body",cursorAt:{left:0,top:0},scope:"#containment",stop:function(){d=!1,a.snapoptions.stop()},start:function(){b(this).click();var a=b(this).find("img").first().data("width"),c=b(this).find("img").first().data("height"),d=b(this).find("img").first().clone();d.prop("width",a).prop("height",c),f=d[0],b("#stencil-preview").append(d)}})}),b(document).on("dblclick",".stencil-item",function(){FDBK.allowNewStencils()&&n({name:b(this).find("a").data("id"),undoable:!0})}),b(".stencil-item").draggable({distance:10,helper:m,containment:"body",cursorAt:{left:0,top:0},snap:".none",customSnap:a.snapoptions.snap,snapTolerance:a.snapoptions.snap.snapTolerance,snapGrid:a.snapoptions.snapGrid,scope:"#containment",stop:function(){d=!1,a.snapoptions.stop()},start:function(){function f(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg",a);for(var d in b)c.setAttribute(d,b[d]);return c}b(this).click(),a.inspectorState.act("remove");var d={version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",id:"preview-svg"},g=b("#stencil-preview");g.append(f("svg",d));var h=b("#preview-svg"),i=b(this).find("a").data("id");e=a.addStencil({name:i,target:h,skipModel:!0}),g.css({width:c(e).measuredWidth(),height:c(e).measuredHeight()}).offset({top:0}),BrowserDetect.browser.toLowerCase()=="firefox"&&h.css({top:0}),c(e).position(0,0),h.css("width",c(e).measuredWidth()),(c(e).measuredHeight()>2||BrowserDetect.browser.toLowerCase()!="firefox")&&h.css("height",c(e).measuredHeight())}}).draggable("disable"),FDBK.sub("open-project",function(){b(".stencil-item").draggable("enable")}),FDBK.sub("close-project",function(){b(".stencil-item").draggable("disable")}),b("#containment").droppable({tolerance:"pointer",scope:"#containment",drop:function(a,c){if(!FDBK.allowNewStencils())return;var d=b("#htmlStage").offset();c.position.left-=d.left,c.position.top-=d.top;if(e)n({name:b(e).attr("name"),undoable:!0},c.position);else if(f)var g=p(f,c.position)}});var q="";b(document).bind("keydown","meta+f ctrl+f",function(){return a.isArea("stage")&&!j.is(":focus")&&(j.focus(),q=""),!1}),b(document).keydown(function(c){if(a.isArea("sidebar"))if(a.activeSidebarPanel==="pages")c.which===38||c.which===40?(a.navigatePages(c.which===38?"up":"down"),c.preventDefault()):c.which===37||c.which===39?(y(c.which),c.preventDefault()):c.which===27&&(l.trigger("click"),q="");else if(c.which>36&&c.which<41)z(c.which),c.preventDefault();else if(c.which==27)l.trigger("click"),q="";else if(c.which==13&&FDBK.allowNewStencils()&&!a.uploadInputIsFocused){l.trigger("click");if(b("#sidebar-tabs").find(".active").data("panel")=="stencils"){var d=h.find(".selected:not(.isotope-hidden)").find("a");d.length>0&&n({name:d.data("id"),undoable:!0})}else{var d=h.find(".selected:not(.isotope-hidden)").find("img").first();d.length>0&&p(d[0],a.defaultPosition("images"),!0)}}FDBK.hasFocusedInput()||(c.which>=65&&c.which<=90&&!c.ctrlKey&&!c.shiftKey&&!c.altKey&&!c.metaKey?q!==""?(j.mouseup(),j.focus(),q+=String.fromCharCode(c.which).toLowerCase(),j.val(q),u({which:0}),c.preventDefault()):q=String.fromCharCode(c.which).toLowerCase():q="")}),FDBK.sub("user-logged-in",function(){a.activeSidebarPanel=="images"&&a.getAllImages()}),b("#sidebar-tabs").find(".button").click(function(){var a=b(this).data("panel");h.find("li").each(function(a,c){b(c).data("order",a)}),h.isotope("updateSortData",h.find("li")),h.isotope({filter:"*",sortBy:"order",sortAscending:!0}),r(a)}),a.activeSidebarPanel="stencils",b(document).on("keydown",null,"alt+1",function(a){return r("stencils"),!1}).on("keydown",null,"alt+2",function(a){return r("images"),!1}).on("keydown",null,"alt+3",function(a){return r("pages"),!1}).on("keydown",null,"tab",function(b){if(a.isArea("sidebar"))return a.focusStage(),!1}),j.on("keydown",function(a){if(a.altKey)switch(a.which){case 49:r("stencils"),a.preventDefault();break;case 50:r("images"),a.preventDefault();break;case 51:r("pages"),a.preventDefault()}});var r=a.activatePanel=function(c){switch(c){case"stencils":a.activeSidebarPanel!=="stencils"&&(h=b("#stencils"),i=b("#stencils-holder"),j.prop("placeholder",FDBK.loc("_Search stencils")),b("#sidebar-panes-inner").css("left",0),a._previousPanel=a.activeSidebarPanel,a.activeSidebarPanel="stencils",b("#mini-structure-button").removeClass("disabled"));break;case"images":a.activeSidebarPanel!=="images"&&(h=b("#image-list").find("ul"),i=b("#all-images"),j.prop("placeholder",FDBK.loc("_Search images")),FDBK.CACHED_IMAGES.length?a.initImages():a.getAllImages(),b("#sidebar-panes-inner").css("left","-200px"),a._previousPanel=a.activeSidebarPanel,a.activeSidebarPanel="images",b("#mini-structure-button").removeClass("disabled"));break;case"pages":a.activeSidebarPanel!=="pages"&&(j.prop("placeholder",FDBK.loc("_Search pages")),b("#sidebar-panes-inner").css("left","-400px"),a._previousPanel=a.activeSidebarPanel,a.activeSidebarPanel="pages",b("#mini-structure-button").addClass("disabled"))}var d=a.revertPanel=function(){a.activeSidebarPanel==="pages"&&r(a._previousPanel)};b("#sidebar-tabs [data-panel="+c+"]").addClass("active").siblings().removeClass("active"),a.focusArea="sidebar",j.val(""),l.hide(),h.find("li").removeClass("found"),h.isotope({filter:"*",getSortData:g}),x(),b("#search-icon").removeClass("has-search"),a.currentProject&&(a.refreshProjectStructure(),a.enablePageSorters())};j.keyup(u);var s,t;return a.navigatePages=function(b){function c(b){var c=b.parent;while(c){if(!a.currentProject.mockup(c)._expanded)return!1;c=a.currentProject.mockup(c).parent}return!0}var d=a.currentMockup?a.currentMockup.id:null;if(d){var e=a.normalPageSorter.serialize().filter(function(a){return c(a)}).concat(a.masterPageSorter.serialize()),f=0;for(var g=0;g<e.length;g++)if(e[g].id==d){f=g;break}var h=b==="up"?f-1:f+1;h==-1&&(h=e.length-1),h==e.length&&(h=0);var i=e[h].id;a.changeActiveMockup(i)}},r("stencils"),a}(MODULE||{},jQuery,svg,layout);FDBK.mixinModule("ui-components",{initModule:function(){FDBK.$tooltip=$("<div id='button-tooltip'></div>").appendTo("body"),$(window).resize(function(){var a=$(".show-dropdown > .button")[0];a&&FDBK.openDropdown(a)}),$(document).on("mousedown",".button",function(){if($(this).hasClass("disabled"))return;$(this).parent().hasClass("show-dropdown")?FDBK.closeDropdowns():$(this).parent().hasClass("dropdown-wrapper")?FDBK.openDropdown(this):($(this).addClass("active"),$(this).siblings(".dropdown").length||(FDBK.$activeButton=$(this)))}).on("mouseup",function(a){$(a.target).closest(".action").length&&!$(a.target).closest(".disabled").length?FDBK.pub("action-clicked",{$action:$(a.target).closest(".action"),$dropdown:$(".show-dropdown")}):!$(a.target).closest(".dropdown-wrapper").length&&!$(a.target).closest(".dropdown").length&&FDBK.closeDropdowns(),$(a.target).closest(".button")&&!$(a.target).closest(".button").siblings(".dropdown").length&&FDBK.$activeButton&&(FDBK.$activeButton.removeClass("active"),FDBK.$activeButton=null)}).on("hover",".button",function(){if($(this).hasClass("disabled"))return;if($(this).parent().hasClass("detached"))return;$(".show-dropdown").length&&$(this).parent().hasClass("dropdown-wrapper")&&!FDBK.hasFocusedInput()&&FDBK.openDropdown(this)}).on("click",".toggle-buttons .button",function(){$(this).siblings().removeClass("active").end().addClass("active")}).on("click",".action",function(){FDBK.closeDropdowns()}).on("mouseenter",".button, .custom-title",function(){if($(this).hasClass("classic-title"))return;FDBK.showTooltip($(this))}).on("mouseenter",".menu-item",function(){$(this).parents(".dropdown").find(".menu-item").removeClass("selected"),$(this).addClass("selected")}).on("mouseleave",".button, .custom-title",function(){FDBK.hideTooltip()}).on("click","a",function(a){$(this).attr("href")==="#"&&a.preventDefault()}).on("keydown",null,"up",function(){FDBK.navigateByKey({steps:1,direction:"asc"},$(".show-dropdown").find(".menu-item"))}).on("keydown",null,"down",function(){FDBK.navigateByKey({steps:1,direction:"desc"},$(".show-dropdown").find(".menu-item"))})},showTooltip:function(a){var b=a.attr("title"),c=a.hasClass("inverse");if(!b||a.parent().hasClass("show-dropdown"))return;c&&FDBK.$tooltip.addClass("inverse"),FDBK.activeTooltip=a.removeAttr("title").data("title",b),this._tooltipInterval=window.setTimeout(function(){function d(){var b=c?0-FDBK.$tooltip.outerHeight()-5:a.outerHeight()+5;return a.offset().top+b}function e(){return a.offset().left+Math.ceil(a.outerWidth()/2)-Math.ceil(FDBK.$tooltip.outerWidth()/2)}FDBK.$tooltip.html(utils.sanitize(b)+"<span></span>").show(),FDBK.$tooltip.css({top:d(),left:e()}).css({top:d(),left:e()})},400)},hideTooltip:function(){this._tooltipInterval&&window.clearTimeout(this._tooltipInterval),FDBK.activeTooltip&&(FDBK.activeTooltip.attr("title",FDBK.activeTooltip.data("title")),FDBK.activeTooltip=null,FDBK.$tooltip.hide().removeClass("inverse"))},openDropdown:function(a){FDBK.closeDropdowns();var b=$(a).addClass("active").parent();b.addClass("show-dropdown");if(b.hasClass("detached")){var c=b.find(".dropdown").first().clone();c.css({top:b.offset().top+b.outerHeight()+2,left:b.offset().left}),c.appendTo("body")}FDBK.hideTooltip(),FDBK.pub("dropdown-shown",$(a).parent())},closeDropdowns:function(){var a=$(".show-dropdown");a.removeClass("show-dropdown").find(".menu-item").removeClass("selected").end().find(".button").each(function(a,b){$(b).closest(".dropdown-content").length===0&&$(b).removeClass("active")}),FDBK.pub("dropdown-close"),$("body > .dropdown").remove(),$(".sidebar-dropdown").hide(),FDBK.pub("dropdown-close",a)},isDropdownOpen:function(){return $(".show-dropdown").length>0},openModal:function(a,b){if(BrowserDetect.unsupportedBrowser)return;if(!a)return;FDBK.closeModal(),$("#overlay").show().find(a).addClass("active"),FDBK.buildHash(b),FDBK.pub("modal-opened",a)},getActiveModalID:function(){return $("#overlay").find(".modal.active, .mq-modal.active").first().prop("id")},closeModal:function(){var a=FDBK.getActiveModalID();if(!a)return;a="#"+a,$("#overlay").hide().find(a).removeClass("active"),FDBK.cleanAllErrors(a),FDBK.buildHash(),FDBK.pub("modal-closed",a)},openConfirmDialog:function(a){a.width=a.width||"400px",a.heading=a.heading||"Confirm action";var b=$("#confirm-dialog"),c=$('<div class="clearfix" style="padding-top:1em;"></div>');a.buttons&&a.buttons.length&&$.each(a.buttons,function(a,b){var d=$('<a href="#" class="button simple '+b.classes+'">'+b.text+"</a>");d.on("click",function(){typeof b.onBeforeClick=="function"&&b.onBeforeClick(),FDBK.closeModal(),typeof b.onClick=="function"&&b.onClick()}),c.append(d)}),b.html($("#tmpl-confirm-dialog").loc_tmpl(a)),b.find(".mq-modal-content").append(c),FDBK.openModal("#confirm-dialog")},genericErrorDialog:function(){FDBK.openConfirmDialog({heading:FDBK.loc("Request failed"),message:FDBK.loc('There was an error processing your request, please try again later or <a href="#" class="open-feedback"><strong>contact us</strong></a> if the problem persists.'),showCloseButton:!0,buttons:[{text:FDBK.loc("_OK"),classes:"close-modal right"}]})},buildHash:function(a){if(a&&"#!/"+a!=window.location.hash)window.location.hash="#!/"+a;else if(FDBK.library&&FDBK.library.currentProject&&FDBK.library.currentProject.uniqueId){var b=FDBK.library.currentProject;window.location.hash="#!/edit/"+(b.ownerUserName?b.ownerUserName+"/":"")+b.uniqueId}else window.location.hash&&(window.location.hash="#!/")},cleanAllErrors:function(a){$(".reset-input").val(""),$(a).find("p.error").remove().end().find(".error").removeClass("error"),FDBK.showServerError({selector:a})},cleanServerError:function(){var a=$("#overlay").find(".modal.active, .mq-modal.active").first();a.length&&a.find(".server-errors").empty()},showServerError:function(a){var b=$("#overlay").find(".modal.active, .mq-modal.active").first();a&&a.selector&&(b=$(a.selector)),b.find(".server-errors").empty(),a&&a.message&&b.find(".server-errors").append('<div class="message '+(a.style?a.style:"")+'">'+a.message+"</div>")}});var MODULE=function(a,b){function c(){b("#project-structure-dropdown").toggleClass("force-dropdown").toggleClass("show-dropdown")}function d(){var a=b("#"+FDBK.getActiveModalID()).find(".close-modal");a.length&&!a.hasClass("ignore-key")&&!a.hasClass("disabled")&&FDBK.closeModal()}function e(a,b){FDBK.itemIsVisible(b,a)||FDBK.scrollToSelectedItem(b,a)}function j(){f.text(a.currentProject.normalPages().length),g.text(a.currentProject.masterPages().length)}function k(){var b=a.currentMockup;for(var c in i)i[c].enabled(b)?i[c].el.removeClass("disabled"):i[c].el.addClass("disabled")}b(document).bind("keydown","pageup",function(){return a.navigatePages("up"),!1}),b(document).bind("keydown","pagedown",function(){return a.navigatePages("down"),!1}),a.$allProjectStructures.on("click",".mockup-list-item",function(c){return b(this).hasClass("selected")?b(c.target).closest(".mockup-name").length&&a.startRenameMockup(b(this)):(a.endRenameAllMockups(),a.changeActiveMockup(b(this).data("mockup"))),!1}).on("keydown",".mockup-name-edit-input",function(a){a.stopImmediatePropagation()}).on("keyup",".mockup-name-edit-input",function(c){(c.keyCode===13||c.keyCode===27)&&a.endRenameMockup(b(this).parents(".mockup-list-item"),c.keyCode===13?b(this).val().trim():null)}).on("blur",".mockup-name-edit-input",function(){a.endRenameMockup(b(this).parents(".mockup-list-item"),b(this).val().trim())}),b(document).on("click",".edit-action",function(d){if(!b(this).hasClass("disabled")){var e=b(this).data("action"),f=b(this).data("type")==="normal-page"?a.$projectStructure.find(".selected").data("mockup"):a.$masterProjectStructure.find(".selected").data("mockup");if(e&&FDBK.allowEditPages())switch(e){case"new":a.addMockup({props:{},shouldRenameAfterCreating:!1});break;case"new-master":a.addMockup({props:{isMaster:!0},shouldRenameAfterCreating:!1});break;case"delete":case"delete-master":f&&(a.currentProject.size()>1?a.currentMockup.isEmpty()||d.shiftKey?a.removeMockup(f):(c(),FDBK.openConfirmDialog({heading:FDBK.loc("_Delete page"),message:FDBK.loc("_Selected page will be deleted."),buttons:[{text:FDBK.loc("_Delete"),classes:"primary-action",onClick:function(){a.removeMockup(f)}},{text:FDBK.loc("_Cancel"),classes:"close-modal"}]})):(c(),FDBK.openConfirmDialog({heading:FDBK.loc("_Delete page"),message:FDBK.loc("_Last Page"),buttons:[{text:FDBK.loc("_OK"),classes:"close-modal primary-action"}]})));break;case"duplicate":case"duplicate-master":f&&FDBK.allowNewStencils()&&(a.endRenameAllMockups(),a.copyMockup(f));break;case"options":case"master-options":if(f){var g=b(this).data("dropdown"),h=this.getBoundingClientRect(),i=h.top,j=h.left+h.width;b(g).css({top:i,left:j}).toggle();break}}}}),FDBK.sub("modal-closed",function(){b(".force-dropdown").length&&c()}),FDBK.sub("update-available",function(){b("#update-available").addClass("shown")}),b(document).on("click",".open-projects",function(){return a.openProjects(),!1}),b(document).bind("keydown","meta+o ctrl+o",function(){return a.openProjects(),!1}),b(document).on("click",".new-project",function(){return a.newProject(),!1}),b(document).on("click","#save-project",function(){if(b(this).hasClass("disabled"))return;a.saveProject(!0),a.autoSave&&a.autoSave.reset()}),b(document).on("click","#save-project-as",function(){if(b(this).hasClass("disabled"))return;a.saveProjectAsCopy()}),b(document).on("click","#recover-project",function(){a.recoverProject()}),b(document).bind("keydown","meta+s ctrl+s",function(){return a.saveProject(!0),a.autoSave&&a.autoSave.reset(),!1}),b(document).bind("keydown","meta+shift+s ctrl+shift+s",function(){return a.saveProjectAsCopy(),!1}),b(document).on("keydown","input, textarea","meta+s ctrl+s",function(){return a.saveProject(!0),a.autoSave&&a.autoSave.reset(),!1}),b(document).on("click",".share-action",function(){if(!b(this).hasClass("disabled")){var c=b(this).data("action");if(c){switch(c){case"export":a.showExport();break;case"publish":FDBK.showPublish();break;case"email":a.shareProject();break;case"preview":a.previewProject();break;case"history":FDBK.showHistory();break;case"view":a.openProjectViewer()}FDBK.closeDropdowns()}}}),b(document).bind("keydown","alt+meta+x alt+ctrl+x",function(){a.showExport()}),b(document).bind("keydown","alt+meta+e alt+ctrl+e",function(){return a.shareProject(),!1}),b(document).bind("keydown","meta+shift+p alt+ctrl+p",function(){a.previewProject()}),b(document).on("click",".open-project-settings",function(){FDBK.closeModal(),FDBK.allowProjectSettings()&&b("#open-settings").trigger("mousedown")}),b(document).on("click",".open-dialog",function(){if(!b(this).hasClass("disabled")){var c=b(this).data("dialog");switch(c){case"shortcuts":FDBK.openModal("#shortcuts-dialog");break;case"billing":FDBK.openModal("#billing-dialog");break;case"profile":a.accountSettingsManager.goTo("profile"),FDBK.openModal("#account-settings-dialog");break;case"account-settings":a.loadAccountServiceData(),FDBK.openModal("#account-settings-dialog")}}}),b(document).on("click",".give-access",function(){if(b(this).hasClass("disabled"))return;var c=b(this).data("provider");b(this).addClass("disabled");var d=window.open("about:blank","Authorize","height=600,width=1000");d.focus();var e=AppSeeds.Scheduler.create(function(){if(!d||d.closed)a.loadAccountServiceData(),e.stop()}).repeat(1e3).stop();FDBK.API.xhr(FDBK.API.CALL_AUTHORIZE_SERVICE,{restParams:{serviceName:c},success:function(a){a.success&&a.object?(d&&d.location&&(d.location.href=a.object),e.reset().now()):(FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"}),FDBK.pub("account-service-data-loaded"))},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"}),FDBK.pub("account-service-data-loaded")}})}),b(document).on("click",".revoke-access",function(){if(b(this).hasClass("disabled"))return;var c=null,d=b(this).data("provider");d=="googledrive"?c=FDBK.API.CALL_REVOKE_GOOGLE_DRIVE:d=="dropbox"&&(c=FDBK.API.CALL_REVOKE_DROPBOX);if(!c||b(this).hasClass("disabled"))return;confirm(FDBK.loc("Are you sure you want to disconnect this service?"))&&(b(this).addClass("disabled").parents(".app").css({opacity:.5}),FDBK.API.xhr(c,{success:function(b){b.success?a.loadAccountServiceData():(FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"}),FDBK.pub("account-service-data-loaded"))},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"}),FDBK.pub("account-service-data-loaded")}}))}),b(document).bind("keydown","f1 meta+/",function(){return FDBK.openModal("#shortcuts-dialog"),!1}),b(document).on("keydown",null,"esc",function(){a.isArea("modal")?d():(FDBK.closeDropdowns(),a.hideContextMenu(),a.closePreview()),a.isArea("stage")&&a.clearSelection()}),b(document).on("keydown","input, textarea","esc",function(){d()}),b(document).on("keyup",null,"return",function(){if(a.isArea("modal")){var c=b("#overlay").find(".active").find(".primary-action");c.length&&c.trigger("click")}}),b(document).on("click",".open-feedback",function(){UserVoice&&UserVoice.showPopupWidget()}).on("click",".close-modal",function(){if(b(this).hasClass("disabled"))return;FDBK.closeModal()}),FDBK.sub("open-project",function(){b("#mini-structure-button").removeClass("disabled"),b("#project-wrapper").css("overflow","hidden"),window.setTimeout(function(){b("#project-wrapper").css("overflow","auto")},1)}),FDBK.sub("close-project",function(){b("#mini-structure-button").addClass("disabled").find(".ellipsis").text("").prop("title",""),b("#undo-button, #redo-button").addClass("disabled")}),FDBK.sub("mockup-renamed",function(){var c=a.currentMockup.name;b("#mini-structure-button").find(".ellipsis").text(c).prop("title",c)}),FDBK.sub("mockup-changed",function(){var c=a.currentMockup,d=c.name;b("#mini-structure-button").find(".ellipsis").text(d).prop("title",d);var e=a.pageListItemForMockup(c.id);e.parents("li").each(function(){var c=b(this).data("mockup"),d=a.currentProject.mockup(c);d&&(d._expanded=!0,b(this).addClass("expanded"))}),a.scrollToSelectedMockup()}),a.scrollToSelectedMockup=function(){var b=a.currentMockup;b&&(b.isMaster?e(a.$masterProjectStructure[0],a.pageListItemForMockup(a.currentMockup.id,a.$masterProjectStructure)[0]):(e(a.$projectStructure[0],a.pageListItemForMockup(a.currentMockup.id,a.$projectStructure)[0]),e(a.$miniProjectStructure[0],a.pageListItemForMockup(a.currentMockup.id,a.$miniProjectStructure)[0])))},FDBK.sub("dropdown-shown",function(b){b&&b[0].id==="mini-project-structure-wrap"&&a.scrollToSelectedMockup()}),b(document).on("change","[name=comments-notification-global]",function(){var a=b(this).is(":checked");FDBK.API.xhr(FDBK.API.CALL_SET_NOTIFICATION,{data:{value:a},contentType:"application/x-www-form-urlencoded"})});var f=b("#normal-pages-wrapper .count"),g=b("#master-pages-wrapper .count"),h=b("#normal-pages-wrapper .edit-action, #master-pages-wrapper .edit-action"),i={newNormal:{el:h.filter("[data-action=new]"),enabled:function(b){return a.currentProject?!0:!1}},duplicateNormal:{el:h.filter("[data-action=duplicate]"),enabled:function(a){return!a.isMaster}},deleteNormal:{el:h.filter("[data-action=delete]"),enabled:function(a){return!a.isMaster}},optionsNormal:{el:h.filter("[data-action=options]"),enabled:function(a){return!a.isMaster&&FDBK.allowMasters()}},newMaster:{el:h.filter("[data-action=new-master]"),enabled:function(b){return a.currentProject&&FDBK.allowMasters()}},duplicateMaster:{el:h.filter("[data-action=duplicate-master]"),enabled:function(a){return a.isMaster&&FDBK.allowMasters()}},deleteMaster:{el:h.filter("[data-action=delete-master]"),enabled:function(a){return a.isMaster&&FDBK.allowMasters()}},optionsMaster:{el:h.filter("[data-action=master-options]"),enabled:function(a){return a.isMaster&&FDBK.allowMasters()}}};return FDBK.sub("open-project masters-changed mockup-changed",function(){k(),j()}),FDBK.sub("masters-changed",function(){a.refreshProjectStructure()}),FDBK.sub("user-logged-in plan-updated open-project close-project",function(){FDBK.allowMasters()?(b("#master-pages-wrapper .premium-promo").hide(),b("#master-pages").show()):(b("#master-pages-wrapper .premium-promo").show(),b("#master-pages").hide())}),FDBK.sub("masters-changed open-project",function(){var c=a.currentProject.masterPages(),d='<li class="action menu-item" data-page-id="null">No master</li>';for(var e=0;e<c.length;e++)d+='<li class="action menu-item" data-page-id="'+utils.sanitize(c[e].id)+'">'+utils.sanitize(c[e].name)+"</li>";b("#master-page-list").html(d);var f=a.currentMockup;b("#master-page-list [data-page-id="+f.master+"]").addClass("checked").siblings().removeClass("checked");var g=f.master?a.currentProject.mockup(f.master):null;b("#master-for-current-page").text(g?"Master: "+g.name:"No master")}),FDBK.sub("mockup-changed masters-changed",function(){var c=a.currentMockup;c&&(b("#master-page-list [data-page-id="+c.master+"]").addClass("checked").siblings().removeClass("checked"),c.master?b("#merge-master-into-page").removeClass("disabled"):b("#merge-master-into-page").addClass("disabled"))}),FDBK.sub("mockup-changed masters-changed open-project",function(){if(a.currentMockup.isMaster){var c=a.currentProject.pagesForMaster(a.currentMockup.id).length;b("#master-usage").text(FDBK.pluralize("_Master usage",c))}}),FDBK.sub("renamed-mockup",function(c){c.mockup===a.currentMockup.id&&c.value&&b("#current-page-name").text(c.value),FDBK.pub("masters-changed")}),b("#master-page-list").on("click",".menu-item",function(){var c=b(this).data("page-id");return a.setMasterForCurrentPage(c),!1}),b("#convert-to-master-page").on("click",function(){return a.currentMockup.master?FDBK.openConfirmDialog({heading:FDBK.loc("_Convert normal page to master page"),message:FDBK.loc("_Page has master page"),buttons:[{text:FDBK.loc("_Merge master first"),classes:"secondary-action",onClick:function(){a.convertCurrentPageToMaster({merge:!0})}},{text:FDBK.loc("_Remove master"),classes:"primary-action",onClick:function(){a.convertCurrentPageToMaster({merge:!1})}},{text:FDBK.loc("_Cancel"),classes:"close-modal"}]}):a.convertCurrentPageToMaster({merge:!1}),!1}),b("#convert-to-normal-page").on("click",function(){var b=function(){a.convertCurrentPageToNormalPage()};return a.currentProject.pagesForMaster(a.currentMockup.id).length?FDBK.openConfirmDialog({heading:FDBK.loc("_Convert master page to normal page"),message:FDBK.loc("_Master in use"),buttons:[{text:FDBK.loc("_Convert to normal page"),classes:"primary-action",onClick:b},{text:FDBK.loc("_Cancel"),classes:"close-modal"}]}):b(),!1}),b("#apply-master-to-all-pages").on("click",function(){return FDBK.openConfirmDialog({heading:FDBK.loc("_Apply master page to all pages"),message:FDBK.loc("_All normal pages will receive this as master."),buttons:[{text:FDBK.loc("_Apply master"),classes:"primary-action",onClick:function(){a.applyCurrentMasterToAllPages()}},{text:FDBK.loc("_Cancel"),classes:"close-modal"}]}),!1}),b("#remove-master-from-all-pages").on("click",function(){return FDBK.openConfirmDialog({heading:FDBK.loc("_Remove master page from all pages"),message:FDBK.loc("_This master will be removed from any page currently using it."),buttons:[{text:FDBK.loc("_Remove master"),classes:"primary-action",onClick:function(){a.removeCurrentMasterFromAllPages()}},{text:FDBK.loc("_Cancel"),classes:"close-modal"}]}),!1}),b("#merge-master-into-page").on("click",function(){return b(this).hasClass("disabled")?!1:(a.currentMockup.master&&FDBK.openConfirmDialog({heading:FDBK.loc("_Merge master into the current page"),message:FDBK.loc("_The content of the master page will be copied into the current page."),buttons:[{text:FDBK.loc("_Merge master"),classes:"primary-action",onClick:function(){a.mergeMasterIntoCurrentPage()}},{text:FDBK.loc("_Cancel"),classes:"close-modal"}]}),!1)}),b("#new-page-from-master").on("click",function(){return a.newPageWithCurrentMaster(),!1}),b("#show-project-history").on("click",function(){return FDBK.showHistory(),!1}),FDBK.sub("open-project",function(){b("#hotspot-menu-button, #create-hotspot, #create-selection-hotspot").removeClass("disabled")}).sub("close-project",function(){b("#hotspot-menu-button, #create-hotspot, #create-selection-hotspot").addClass("disabled")}),b(document).on("click","#current-project-name",function(){FDBK.closeModal(),FDBK.allowProjectSettings()&&(b("#open-settings").trigger("mousedown"),b("#project-title-input").select().focus())}),a}(MODULE||{},jQuery),MODULE=function(a,b){function d(a){b.each(FDBK.library.contextController.contexts,function(b,c){c.userName==FDBK.USER_DATA.userName&&(c.userName=a)}),FDBK.USER_DATA.context.userName==FDBK.USER_DATA.userName&&(FDBK.USER_DATA.context.userName=a),FDBK.library.currentProject&&FDBK.library.currentProject.ownerUserName==FDBK.USER_DATA.userName&&(FDBK.library.currentProject.ownerUserName=a),FDBK.USER_DATA.userName=a,FDBK.pub("update-profile-dependencies"),FDBK.library.setShareInterface()}function e(a){return/^[a-z0-9._-]+$/i.test(a)}var c=!1;return a.setLoggedState=function(d){d?(c=!0,b.cookie("hasAccount","true",{expires:365,path:"/"}),FDBK.pub("user-logged-in")):(c=!1,FDBK.pub("user-logged-out")),a.setAccountMenu(),a.checkHash(),a.isUserLoggedIn()&&FDBK.USER_DATA.isFirstLogin&&(FDBK.USER_DATA.isFirstLogin=!1,FDBK.pub("account-created"))},a.isUserLoggedIn=function(){return c},a.setAccountMenu=function(){var c=b("#account-menu");if(a.isUserLoggedIn()){var d=b.trim(FDBK.USER_DATA.fullName)?FDBK.USER_DATA.fullName:FDBK.USER_DATA.userName,e={name:d,avatarImage:utils.getAvatarImageURL(FDBK.USER_DATA),isPremium:FDBK.hasPremiumPlan(),teams:[]};a.contextController.init({teams:FDBK.USER_DATA.teams,context:FDBK.USER_DATA.context.uniqueId}),a.contextController.contexts.length>1&&(e.teams=a.contextController.contexts.map(function(a){return a=b.extend(!0,{},a),a.active=a.uniqueId==FDBK.USER_DATA.context.uniqueId,a.avatarImage=utils.getAvatarImageURL({email:a.email,avatar:a.avatar}),a.active&&a.userName!==FDBK.USER_DATA.userName&&(e.name=a.displayName,e.avatarImage="https://moqups.com/home/avatars/team.png"),a.userName==FDBK.USER_DATA.userName&&(a.displayName="Your Account",a.own=!0),a})),c.html(b("#tmpl-logged").loc_tmpl(e)),b("#try-beta").attr("href",FDBK.NEW_URL)}else c.html(b("#tmpl-nosession").loc_tmpl())},FDBK.sub("update-profile-dependencies plan-updated",function(){a.setAccountMenu()}),b(document).on("click",".open-login",function(){a.showLoginDialog()}),b(document).on("click",".open-register",function(){a.showRegisterDialog()}),b(document).on("click",".open-dialog",function(){!b(this).hasClass("disabled")&&b(this).data("dialog")=="reset"&&a.showResetDialog()}),b(document).on("click",".switch-team",function(){if(!b(this).hasClass("disabled")){var c=b(this).data("team");a.contextController.switchContext(c)}}),b(document).on("click","[href=/login/google]",function(){if(FDBK.nextPlan)return window.location=FDBK.BASE_URL+"login/google?redirect="+encodeURIComponent(FDBK.BASE_URL+"#!/payment/"+FDBK.nextPlan.plan.id),!1}),b(document).on("submit","#login-form",function(){if(a.inProgressRequest)return!1;var c={j_username:b("[name=j_username]").val(),j_password:b("[name=j_password]").val(),ajax:"true"};b("#remember").is(":checked")&&(c.rememberme="true"),FDBK.API.xhr(FDBK.API.CALL_LOGIN,{contentType:"application/x-www-form-urlencoded",data:c,success:function(c){if(c.success){FDBK.pub("user-login-success"),b("#login-dialog").is(":visible")&&FDBK.closeModal();try{a.getUserData()}catch(d){}}else FDBK.showServerError({message:FDBK.loc("_Invalid username or password"),style:"error"}),b(".reset-input").val("")},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}})}),a.canViewProject=function(){var b=a.currentProject.canViewProject();return b||a.checkForActivationToken(),b},a.validateActivationToken=function(c,d){FDBK.API.xhr(FDBK.API.CALL_GET_TOKEN_INFO,{data:{token:c},success:function(e){e.success&&e.object.email?(a.showActivateDialog(),b("#tokenInput").val(c),b("#activateEmail").val(e.object.email),FDBK.showServerError({message:"Please choose your username and password"})):a.showLoginDialog(),b("#preloader").hide(),d&&d()},error:function(){a.showLoginDialog(),b("#preloader").hide(),d&&d()},traditional:!0})},a.checkForActivationToken=function(){var c=window.location.hash;if(c.indexOf("activate?at=")!=-1){var d=c.split("="),e=d[1];a.validateActivationToken(e)}else a.showLoginDialog(),FDBK.library.currentProject.permission=="forbidden"&&FDBK.showServerError({message:FDBK.loc("_You don't have access to this project")}),b("#toolbar-options").hide(),b("#preloader").hide()},b(document).on("submit","#register-form",function(){if(a.inProgressRequest)return!1;var c={email:b.trim(b("#signupEmail").val()),userName:b.trim(b("#signupUsername").val()),password:b("#signupPassword").val()};return c.userName&&!e(c.userName)?(b("#signupUsername").blur(),!1):(FDBK.API.xhr(FDBK.API.CALL_SIGN_UP,{data:JSON.stringify(c),success:function(d){if(d.success)FDBK.pub("account-created"),b("[name=j_username]").val(c.userName),b("[name=j_password]").val(c.password),a.inProgressRequest=!1,b("#login-form").submit();else{var e;d.object.emailError?e=d.object.emailError:d.object.usernameError?e=d.object.usernameError:d.object.passwordError?e=d.object.passwordError:d.object.CodeError?e=d.object.CodeError:d.object.inviteCodeError&&(e=d.object.inviteCodeError),FDBK.pub("signup-error",e),FDBK.showServerError({message:FDBK.loc(e),style:"error"})}},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}}),!1)}),b(document).on("submit","#activate-form",function(){if(a.inProgressRequest)return!1;var c={token:b.trim(b("#tokenInput").val()),userName:b.trim(b("#activateUsername").val()),password:b("#activatePassword").val()};return c.userName&&!e(c.userName)?(b("#activateUsername").blur(),!1):(FDBK.API.xhr(FDBK.API.CALL_ACTIVATE_USER,{contentType:"application/x-www-form-urlencoded",data:c,success:function(d){if(d.success)b("[name=j_username]").val(c.userName),b("[name=j_password]").val(c.password),a.inProgressRequest=!1,b("#login-form").submit(),FDBK.closeModal();else{var e;d.object.emailError?e=d.object.emailError:d.object.usernameError?e=d.object.usernameError:d.object.passwordError?e=d.object.passwordError:d.object.CodeError?e=d.object.CodeError:d.object.inviteCodeError&&(e=d.object.inviteCodeError),FDBK.showServerError({message:FDBK.loc(e),style:"error"})}},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}}),!1)}),b("#signupEmail").blur(function(){var a=b(this),c=b.trim(a.val());a.removeClass("error").parent().find("p").remove(),c&&FDBK.API.xhr(FDBK.API.CALL_CHECK_EMAIL,{data:{email:c},dataType:"html",success:function(c){b.parseJSON(c).available||a.addClass("error").after('<p class="error">'+FDBK.loc(b.parseJSON(c).message)+"</p>")},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}})}),b("#signupUsername, #activateUsername").blur(function(){var a=b(this),c=b.trim(a.val());a.removeClass("error").parent().find("p").remove(),c&&e(c)?FDBK.API.xhr(FDBK.API.CALL_CHECK_USER,{data:{name:c},dataType:"html",success:function(c){b.parseJSON(c).available||a.addClass("error").after('<p class="error">'+FDBK.loc(b.parseJSON(c).message)+"</p>")},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}}):c&&!e(c)&&a.addClass("error").after('<p class="error">'+FDBK.loc("usernameNotValid")+"</p>")}),b("#signupPassword, #activatePassword").blur(function(){var a=b(this),c=a.val();a.parent().find("p").remove(),c&&c.length<5?a.addClass("error").after('<p class="error">'+FDBK.loc("passwordLength")+"</p>"):a.removeClass("error")}),a.askForSession=function(){b.cookie("hasAccount")||a.currentProject&&a.currentProject.uniqueId?(a.showLoginDialog(),FDBK.showServerError({message:FDBK.loc("_You need to log in to perform this action.")})):(a.showRegisterDialog(),FDBK.showServerError({message:FDBK.loc("_You need an account to perform this action.")})),FDBK.pub("action-requires-account")},a.showLoginDialog=function(){FDBK.hasCookies()?(FDBK.openModal("#login-dialog","sign-in"),b("[name=j_username]").focus()):FDBK.showCookiesAlert()},a.showRegisterDialog=function(){FDBK.hasCookies()?(FDBK.openModal("#register-dialog","register"),FDBK.pub("opened-signup-dialog")):FDBK.showCookiesAlert()},a.showActivateDialog=function(){FDBK.hasCookies()?FDBK.openModal("#activate-dialog","activate"):FDBK.showCookiesAlert()},a.showResetDialog=function(){FDBK.openModal("#reset-dialog","reset")},b(document).on("submit","#reset-form",function(){if(a.inProgressRequest)return!1;var c=b("#recover-email"),d=b.trim(c.val());return c.removeClass("error").parent().find("p").remove(),d?a.inProgressRequest||FDBK.API.xhr(FDBK.API.CALL_RECOVER_PASSWORD,{data:{email:d},success:function(a){a.success?FDBK.openModal("#reset-success-dialog"):c.addClass("error").after('<p class="error">'+FDBK.loc(a.message)+"</p>")},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}}):c.addClass("error").after('<p class="error">'+FDBK.loc("emailBlank")+"</p>"),!1}),b(document).on("submit","#password-form",function(){if(a.inProgressRequest)return!1;var c=b("#newPassword").val();return c&&c.length<5?FDBK.showServerError({message:FDBK.loc("passwordLength"),style:"error"}):c?c==b("#reNewPassword").val()?a.inProgressRequest||FDBK.API.xhr(FDBK.API.CALL_RESET_PASSWORD,{data:JSON.stringify({token:FDBK.resetToken,newPwd:c}),success:function(a){a.success?FDBK.openConfirmDialog({heading:FDBK.loc("_Password changed"),message:FDBK.loc("_Password successfully changed"),buttons:[{text:FDBK.loc("_Log in"),classes:"right open-login primary-action"},{text:FDBK.loc("_Close"),classes:"close-modal"}]}):FDBK.showServerError({message:FDBK.loc(a.message),style:"error"})},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}}):FDBK.showServerError({message:FDBK.loc("_Passwords do not match."),style:"error"}):FDBK.showServerError({message:FDBK.loc("_Password cannot be empty."),style:"error"}),!1}),b(document).on("click",".change-username",function(){b("#profile-form").find(".warning-username").is(":hidden")?(b("#profile-form").find("[name=userName]").prop("disabled",!1),b("#profile-form").find(".warning-username").show()):(b("#profile-form").find("[name=userName]").prop("disabled",!0).val(FDBK.USER_DATA.userName),b("#profile-form").find(".warning-username").hide())}),b(document).on("submit","#profile-form",function(){var a=b(this),c=b.trim(a.find("[name=userName]").val()),f=FDBK.USER_DATA.userName;FDBK.USER_DATA.fullName=b.trim(a.find("[name=fullName]").val()),FDBK.USER_DATA.email=b.trim(a.find("[name=email]").val()),FDBK.USER_DATA.company=b.trim(a.find("[name=company]").val()),FDBK.USER_DATA.location=b.trim(a.find("[name=location]").val()),FDBK.USER_DATA.url=b.trim(a.find("[name=url]").val());if(!(c&&e(c)||c===f))return FDBK.showServerError({message:FDBK.loc("usernameNotValid"),style:"error"}),!1;f=c,FDBK.API.xhr(FDBK.API.CALL_UPDATE_CURRENT_USER,{data:JSON.stringify({email:FDBK.USER_DATA.email,fullName:FDBK.USER_DATA.fullName,company:FDBK.USER_DATA.company,location:FDBK.USER_DATA.location,url:FDBK.USER_DATA.url,userName:f}),success:function(b){if(b.success)d(f),a.find("[name=userName]").prop("disabled",!0).val(FDBK.USER_DATA.userName),a.find(".warning-username").hide(),FDBK.showServerError({message:FDBK.loc("_Your profile was successfully updated.")});else{var c;b.object.emailError?c=b.object.emailError:b.object.usernameError&&(c=b.object.usernameError),FDBK.showServerError({message:FDBK.loc(c),style:"error"})}},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}})}),b(document).on("submit","#change-form",function(){if(a.inProgressRequest)return!1;var c=b("#changePassword").val(),d=b("#oldPassword").val(),e=b("#changeRePassword").val();return c&&c.length<5?FDBK.showServerError({message:FDBK.loc("passwordLength"),style:"error"}):c?c==e?FDBK.API.xhr(FDBK.API.CALL_CHANGE_PASSWORD,{data:JSON.stringify({name:FDBK.USER_DATA.userName,oldPwd:d,newPwd:c}),success:function(a){a.success?(b("#change-form").find("input[type=password]").blur().val(""),FDBK.showServerError({message:FDBK.loc("_Password successfully changed")})):FDBK.showServerError({message:FDBK.loc(a.message),style:"error"})},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}}):FDBK.showServerError({message:FDBK.loc("_Passwords do not match."),style:"error"}):FDBK.showServerError({message:FDBK.loc("_Password cannot be empty."),style:"error"}),!1}),a}(MODULE||{},jQuery);FDBK.mixinModule("objectLinking",{OBJECT_LINK_TYPE_URL:"url",OBJECT_LINK_TYPE_MOCKUP:"mockup",initModule:function(){function b(){return $.loc_tmpl("<option value={{= id }}>{{= name }}</option>",[{id:null,name:"None"}].concat(FDBK.library.currentProject.normalPages().map(function(a){var b=utils.pad(a.name,"",this.pageDepth(a));return{id:a.id,name:b}},FDBK.library.currentProject)))}function c(){$(".mockup-linking-list").each(function(){var a=$(this),c,d;a.html(b());if(a.data("ref")!==undefined)d=a.data("ref");else{var e;for(var f=0;f<FDBK.library.currentMockup.selection.length;f++)c=FDBK.library.currentMockup.stencil(FDBK.library.currentMockup.selection[f].id),e?e=utils.intersectionOfObjects(c&&c.link?c.link:{},e):e=c&&c.link?c.link:{};d=e&&e.ref?e.ref:""}a.val(d)})}this.$objectLinkStatusRef=$("#object-link-status-ref"),this.$objectLinkStatusUI=$("#object-link-status"),this.$objectLinkSetupUI=$("#object-link-setup"),this.$objectLinkDisabledUI=$("#object-link-disabled"),this.$linkGhostWrapper=$("#link-ghost-wrapper");var a=this;FDBK.sub("project-changed open-project",function(a,b){a==="remove"?FDBK.library.currentProject.cleanUpLinks(b):c()},this),FDBK.sub("masters-changed",function(){var a=FDBK.library.currentProject,b=a.masterPages();for(var d=0;d<b.length;d++)a.cleanUpLinks(b[d].id);c()}),FDBK.sub("renamed-mockup",function(){c()}),FDBK.sub("inspector-shown",function(a){(a==="tmplsvg-hotspot-panel"||a==="tmplsvg-object-linking-panel")&&c()}),FDBK.sub("inspector-hidden",function(a){a==="tmplsvg-object-linking-panel"&&this.showLinkGhosts(FDBK.library.currentMockup.stencilList())});var d=!1;FDBK.sub("selection-transform",function(a,b,c){if(a==="move"||a==="resize")switch(b){case"start":case"timer-start":d||(d=!0,this.hideLinkGhosts(c));break;case"stop":case"timer-stop":d=!1,this.showLinkGhosts(c)}},this),FDBK.sub("link-stencil",function(a,b){this.showLinkGhosts([{id:a,link:b,skipSubstencils:!0}]),c()}),FDBK.sub("remove-stencil",function(a){var b=a.map(function(a){return{id:a,link:null,skipSubstencils:!0}});this.showLinkGhosts(b)}),FDBK.sub("add-stencil move-stencil resize-stencil",function(a){this.showLinkGhosts([{id:a}])}),FDBK.sub("open-project mockup-changed",function(){this.removeAllLinkGhosts(),this.showLinkGhosts(FDBK.library.currentMockup.stencilList())}),FDBK.sub("close-project",function(){this.removeAllLinkGhosts()}),$(document).on("click",".link-ghost-item:not(.temp)",function(){var a=$(this).data("stencil"),b=FDBK.library.currentMockup.stencil(a);return b&&FDBK.showLinkInspector(b,$(this)),!1}).on("keydown",null,"meta+k ctrl+k",function(a){FDBK.library.currentMockup&&FDBK.library.createHotspotsForStencils([]),a.preventDefault()}).on("keydown",null,"meta+shift+k ctrl+shift+k",function(a){FDBK.library.currentMockup&&FDBK.library.hasSelection()&&FDBK.library.createHotspotsForStencils(),a.preventDefault()}).on("keydown",null,"alt+k",function(a){FDBK.showLinkInspectorForSelection(),a.preventDefault()}).on("click","#create-hotspot",function(){return $(this).hasClass("disabled")?!1:(FDBK.library.createHotspotsForStencils([]),!1)}).on("click","#create-selection-hotspot",function(){return $(this).hasClass("disabled")?!1:(FDBK.library.createHotspotsForStencils(),!1)}).on("click","#toggle-hotspots",function(){return FDBK.library.toggleHotspotVisibility(),!1}).on("click","#create-link",function(){return $(this).hasClass("disabled")?!1:(FDBK.showLinkInspectorForSelection(),!1)})},showLinkInspectorForSelection:function(){if(FDBK.library.currentMockup&&FDBK.library.isSingleSelection()){var a=FDBK.library.currentMockup.selection[0],b=FDBK.library.currentMockup.stencil(a.id);FDBK.showLinkInspector(b,FDBK.tempLinkGhost(b))}},showLinkInspector:function(a,b){FDBK.library.clearSelection(),FDBK.library.inspectorState.act("forceShow"),FDBK.library.showInspector("tmplsvg-object-linking-panel",a,{anchor:b||$(utils.stencil(a.id))})},TMPL_LINK_GHOST:function(a){return $.loc_tmpl("<div class='ghost-item link-ghost-item {{= klass }}' data-stencil='{{= id }}'></div>",{id:a.id,klass:a.name==="tmplsvg-hotspot"?"link-for-hotspot":""})},getLinkGhost:function(a){if(a&&a.id)return this.$linkGhostWrapper.find("[data-stencil="+a.id+"]")},tempLinkGhost:function(a){if(a){var b=this.getLinkGhost(a);b.length||(b=this.TMPL_LINK_GHOST(a),this.$linkGhostWrapper.append(b)),b.addClass("temp").css({top:a.top+a.height,left:a.left+a.width})}return b},manageLinkGhost:function(a,b){var c=this.getLinkGhost(a);if(b){var d=FDBK.library.currentMockup.stencilPath(a.id).reduce(function(a,b){return{top:a.top+b.top,left:a.left+b.left}},{top:0,left:0});c.length?c.removeClass("temp"):(c=this.TMPL_LINK_GHOST(a),this.$linkGhostWrapper.append(c)),c.css({top:d.top+a.height,left:d.left+a.width}).show()}else c.remove()},showLinkGhosts:function(a){for(var b=0;b<a.length;b++){var c=a[b].id,d=FDBK.library.currentMockup.stencil(c),e=typeof a[b].link=="undefined"?d.link:a[b].link;if(d){this.manageLinkGhost(d,e);if(!a[b].skipSubstencils){var f=FDBK.library.currentMockup.substencils(c).slice(1);for(var g=0;g<f.length;g++)this.manageLinkGhost(f[g],f[g].link)}}else{var h=this.getLinkGhost(a[b]);h&&h.remove()}}},hideLinkGhosts:function(a){for(var b=0;b<a.length;b++){var c=FDBK.library.currentMockup.substencils(a[b].id);for(var d=0;d<c.length;d++){var e=c[d];if(e&&e.link){var f=this.getLinkGhost(e);f.length&&f.hide()}}}},removeAllLinkGhosts:function(){this.$linkGhostWrapper.empty()}});var MODULE=function(a,b){var c={};return a.loadUserSettings=function(b){FDBK.API.xhr(FDBK.API.CALL_GET_ALL_USER_SETTINGS,{success:function(d){if(d.success&&d.object){var e,f=[];try{f=JSON.parse(d.object.json)}catch(g){console.error("Bad format for user settings")}if(f)for(var h=0;h<f.length;h++)e=f[h],c[e.key]=e.value;FDBK.SYNC_GOOGLE_DRIVE=d.object.autoSyncDrive,FDBK.SEND_INVOICE=d.object.sendInvoice,a.applyUserSettings(),FDBK.pub("loaded-user-settings")}else console.log("Error on loadUserSettings : ",d),a.applyUserSettings();b&&b.call()},error:function(){console.log("Failed loading user settings"),a.applyUserSettings(),b&&b.call()}})},a.saveUserSettings=function(a){var b=[];for(var d in c)if(c.hasOwnProperty(d)&&c[d]!==undefined){var e={key:d,value:c[d]+""};b.push(e)}FDBK.API.xhr(FDBK.API.CALL_SET_ALL_USER_SETTINGS,{data:JSON.stringify(b),success:function(){a&&a.call()},error:function(){a&&a.call()}})},a.getUserSettings=function(a){return c[a]!==undefined?c[a]==="true"?!0:c[a]==="false"?!1:c[a]:null},a.setUserSettings=function(b,d){if(b instanceof Array)for(var e=0;e<b.length;e++)c[b[e]]=d[e];else c[b]=d;a.isUserLoggedIn()&&a.saveUserSettings()},a.applyUserSettings=function(){var d={};d.gridVisible=a.getUserSettings("gridVisible")===null?!0:a.getUserSettings("gridVisible"),d.gridSizeWidth=a.getUserSettings("gridSizeWidth")||20,d.gridSizeHeight=a.getUserSettings("gridSizeWidth")||20,d.stageSizeWidth=a.getUserSettings("stageSizeWidth")||1200,d.stageSizeHeight=a.getUserSettings("stageSizeHeight")||960,d.liveResize=a.getUserSettings("liveResize")===null?!0:a.getUserSettings("liveResize"),d.snapToGrid=a.getUserSettings("snapToGrid")||!1,d.snapToObjects=a.getUserSettings("snapToObjects")===null?!0:a.getUserSettings("snapToObjects"),d.showGuides=a.getUserSettings("showGuides")===null?!0:a.getUserSettings("showGuides"),d.gridsystemEnabled=a.getUserSettings("gridsystemEnabled")===null?!1:a.getUserSettings("gridsystemEnabled"),d.selectedgridSystem=a.getUserSettings("selectedgridSystem")||a.snapoptions.GS_960_12,b("#project-settings").find(".dropdown-content").html(b("#tmpl-project-settings").loc_tmpl({gridWidth:d.gridSizeWidth,gridHeight:d.gridSizeHeight,gridVisible:d.gridVisible,gridsystemEnabled:d.gridsystemEnabled,gridSystemType:d.selectedgridSystem,snapToGrid:d.snapToGrid,liveResize:d.liveResize,snapToObjects:d.snapToObjects,showGuides:d.showGuides})),a.setGridVisible(d.gridVisible),a.snapoptions.setGrid(d.gridSizeWidth,d.gridSizeHeight),a.updateStageGrid(d.gridSizeWidth,d.gridSizeHeight),d.gridsystemEnabled?(a.snapoptions.gridsystem(d.selectedgridSystem),a.snapoptions.gridEnabled(!1),a.snapoptions.gridsystemSnapping=d.snapToGrid):a.snapoptions.gridEnabled(d.snapToGrid),a.setLiveResize(d.liveResize),a.snapoptions.snap.snapToObjects=d.snapToObjects,a.snapoptions.snap.showGuides=d.showGuides;var e=!1;for(var f in d)d.hasOwnProperty(f)&&!c.hasOwnProperty(f)&&(c[f]=d[f],e=!0);a.isUserLoggedIn()&&e&&a.saveUserSettings()},a}(MODULE||{},jQuery);FDBK.mixinModule("payments",{$plans:$("#plans-dialog"),newAccount:!1,promptUpdateCard:!1,cardInfo:null,cardType:null,discountCode:null,downgradeInfo:null,nextPlan:null,hasSeenPricing:!1,ppInProgress:!1,paymentTrigger:null,currencies:{EUR:"",USD:"$"},planStatuses:{active:"Active",canceled:"Canceled",pastdue:"Past-due",expired:"Expired"},geoIpCode:null,countries:[{countryCode:"",countryName:"----------"},{countryCode:"AF",countryName:"Afghanistan"},{countryCode:"AX",countryName:"land"},{countryCode:"AL",countryName:"Albania"},{countryCode:"DZ",countryName:"Algeria"},{countryCode:"AS",countryName:"American Samoa"},{countryCode:"AD",countryName:"Andorra"},{countryCode:"AO",countryName:"Angola"},{countryCode:"AI",countryName:"Anguilla"},{countryCode:"AQ",countryName:"Antarctica"},{countryCode:"AG",countryName:"Antigua and Barbuda"},{countryCode:"AR",countryName:"Argentina"},{countryCode:"AM",countryName:"Armenia"},{countryCode:"AW",countryName:"Aruba"},{countryCode:"AU",countryName:"Australia"},{countryCode:"AT",countryName:"Austria"},{countryCode:"AZ",countryName:"Azerbaijan"},{countryCode:"BS",countryName:"Bahamas"},{countryCode:"BH",countryName:"Bahrain"},{countryCode:"BD",countryName:"Bangladesh"},{countryCode:"BB",countryName:"Barbados"},{countryCode:"BY",countryName:"Belarus"},{countryCode:"BE",countryName:"Belgium"},{countryCode:"BZ",countryName:"Belize"},{countryCode:"BJ",countryName:"Benin"},{countryCode:"BM",countryName:"Bermuda"},{countryCode:"BT",countryName:"Bhutan"},{countryCode:"BO",countryName:"Bolivia"},{countryCode:"BQ",countryName:"Bonaire"},{countryCode:"BA",countryName:"Bosnia and Herzegovina"},{countryCode:"BW",countryName:"Botswana"},{countryCode:"BV",countryName:"Bouvet Island"},{countryCode:"BR",countryName:"Brazil"},{countryCode:"IO",countryName:"British Indian Ocean Territory"},{countryCode:"VG",countryName:"British Virgin Islands"},{countryCode:"BN",countryName:"Brunei"},{countryCode:"BG",countryName:"Bulgaria"},{countryCode:"BF",countryName:"Burkina Faso"},{countryCode:"BI",countryName:"Burundi"},{countryCode:"KH",countryName:"Cambodia"},{countryCode:"CM",countryName:"Cameroon"},{countryCode:"CA",countryName:"Canada"},{countryCode:"CV",countryName:"Cape Verde"},{countryCode:"KY",countryName:"Cayman Islands"},{countryCode:"CF",countryName:"Central African Republic"},{countryCode:"TD",countryName:"Chad"},{countryCode:"CL",countryName:"Chile"},{countryCode:"CN",countryName:"China"},{countryCode:"CX",countryName:"Christmas Island"},{countryCode:"CC",countryName:"Cocos [Keeling] Islands"},{countryCode:"CO",countryName:"Colombia"},{countryCode:"KM",countryName:"Comoros"},{countryCode:"CK",countryName:"Cook Islands"},{countryCode:"CR",countryName:"Costa Rica"},{countryCode:"HR",countryName:"Croatia"},{countryCode:"CU",countryName:"Cuba"},{countryCode:"CW",countryName:"Curacao"},{countryCode:"CY",countryName:"Cyprus"},{countryCode:"CZ",countryName:"Czechia"},{countryCode:"CD",countryName:"Democratic Republic of the Congo"},{countryCode:"DK",countryName:"Denmark"},{countryCode:"DJ",countryName:"Djibouti"},{countryCode:"DM",countryName:"Dominica"},{countryCode:"DO",countryName:"Dominican Republic"},{countryCode:"TL",countryName:"East Timor"},{countryCode:"EC",countryName:"Ecuador"},{countryCode:"EG",countryName:"Egypt"},{countryCode:"SV",countryName:"El Salvador"},{countryCode:"GQ",countryName:"Equatorial Guinea"},{countryCode:"ER",countryName:"Eritrea"},{countryCode:"EE",countryName:"Estonia"},{countryCode:"ET",countryName:"Ethiopia"},{countryCode:"FK",countryName:"Falkland Islands"},{countryCode:"FO",countryName:"Faroe Islands"},{countryCode:"FJ",countryName:"Fiji"},{countryCode:"FI",countryName:"Finland"},{countryCode:"FR",countryName:"France"},{countryCode:"GF",countryName:"French Guiana"},{countryCode:"PF",countryName:"French Polynesia"},{countryCode:"TF",countryName:"French Southern Territories"},{countryCode:"GA",countryName:"Gabon"},{countryCode:"GM",countryName:"Gambia"},{countryCode:"GE",countryName:"Georgia"},{countryCode:"DE",countryName:"Germany"},{countryCode:"GH",countryName:"Ghana"},{countryCode:"GI",countryName:"Gibraltar"},{countryCode:"GR",countryName:"Greece"},{countryCode:"GL",countryName:"Greenland"},{countryCode:"GD",countryName:"Grenada"},{countryCode:"GP",countryName:"Guadeloupe"},{countryCode:"GU",countryName:"Guam"},{countryCode:"GT",countryName:"Guatemala"},{countryCode:"GG",countryName:"Guernsey"},{countryCode:"GN",countryName:"Guinea"},{countryCode:"GW",countryName:"Guinea-Bissau"},{countryCode:"GY",countryName:"Guyana"},{countryCode:"HT",countryName:"Haiti"},{countryCode:"HM",countryName:"Heard Island and McDonald Islands"},{countryCode:"HN",countryName:"Honduras"},{countryCode:"HK",countryName:"Hong Kong"},{countryCode:"HU",countryName:"Hungary"},{countryCode:"IS",countryName:"Iceland"},{countryCode:"IN",countryName:"India"},{countryCode:"ID",countryName:"Indonesia"},{countryCode:"IR",countryName:"Iran"},{countryCode:"IQ",countryName:"Iraq"},{countryCode:"IE",countryName:"Ireland"},{countryCode:"IM",countryName:"Isle of Man"},{countryCode:"IL",countryName:"Israel"},{countryCode:"IT",countryName:"Italy"},{countryCode:"CI",countryName:"Ivory Coast"},{countryCode:"JM",countryName:"Jamaica"},{countryCode:"JP",countryName:"Japan"},{countryCode:"JE",countryName:"Jersey"},{countryCode:"JO",countryName:"Jordan"},{countryCode:"KZ",countryName:"Kazakhstan"},{countryCode:"KE",countryName:"Kenya"},{countryCode:"KI",countryName:"Kiribati"},{countryCode:"XK",countryName:"Kosovo"},{countryCode:"KW",countryName:"Kuwait"},{countryCode:"KG",countryName:"Kyrgyzstan"},{countryCode:"LA",countryName:"Laos"},{countryCode:"LV",countryName:"Latvia"},{countryCode:"LB",countryName:"Lebanon"},{countryCode:"LS",countryName:"Lesotho"},{countryCode:"LR",countryName:"Liberia"},{countryCode:"LY",countryName:"Libya"},{countryCode:"LI",countryName:"Liechtenstein"},{countryCode:"LT",countryName:"Lithuania"},{countryCode:"LU",countryName:"Luxembourg"},{countryCode:"MO",countryName:"Macao"},{countryCode:"MK",countryName:"Macedonia"},{countryCode:"MG",countryName:"Madagascar"},{countryCode:"MW",countryName:"Malawi"},{countryCode:"MY",countryName:"Malaysia"},{countryCode:"MV",countryName:"Maldives"},{countryCode:"ML",countryName:"Mali"},{countryCode:"MT",countryName:"Malta"},{countryCode:"MH",countryName:"Marshall Islands"},{countryCode:"MQ",countryName:"Martinique"},{countryCode:"MR",countryName:"Mauritania"},{countryCode:"MU",countryName:"Mauritius"},{countryCode:"YT",countryName:"Mayotte"},{countryCode:"MX",countryName:"Mexico"},{countryCode:"FM",countryName:"Micronesia"},{countryCode:"MD",countryName:"Moldova"},{countryCode:"MC",countryName:"Monaco"},{countryCode:"MN",countryName:"Mongolia"},{countryCode:"ME",countryName:"Montenegro"},{countryCode:"MS",countryName:"Montserrat"},{countryCode:"MA",countryName:"Morocco"},{countryCode:"MZ",countryName:"Mozambique"},{countryCode:"MM",countryName:"Myanmar [Burma]"},{countryCode:"NA",countryName:"Namibia"},{countryCode:"NR",countryName:"Nauru"},{countryCode:"NP",countryName:"Nepal"},{countryCode:"NL",countryName:"Netherlands"},{countryCode:"NC",countryName:"New Caledonia"},{countryCode:"NZ",countryName:"New Zealand"},{countryCode:"NI",countryName:"Nicaragua"},{countryCode:"NE",countryName:"Niger"},{countryCode:"NG",countryName:"Nigeria"},{countryCode:"NU",countryName:"Niue"},{countryCode:"NF",countryName:"Norfolk Island"},{countryCode:"KP",countryName:"North Korea"},{countryCode:"MP",countryName:"Northern Mariana Islands"},{countryCode:"NO",countryName:"Norway"},{countryCode:"OM",countryName:"Oman"},{countryCode:"PK",countryName:"Pakistan"},{countryCode:"PW",countryName:"Palau"},{countryCode:"PS",countryName:"Palestine"},{countryCode:"PA",countryName:"Panama"},{countryCode:"PG",countryName:"Papua New Guinea"},{countryCode:"PY",countryName:"Paraguay"},{countryCode:"PE",countryName:"Peru"},{countryCode:"PH",countryName:"Philippines"},{countryCode:"PN",countryName:"Pitcairn Islands"},{countryCode:"PL",countryName:"Poland"},{countryCode:"PT",countryName:"Portugal"},{countryCode:"PR",countryName:"Puerto Rico"},{countryCode:"QA",countryName:"Qatar"},{countryCode:"CG",countryName:"Republic of the Congo"},{countryCode:"RE",countryName:"Runion"},{countryCode:"RO",countryName:"Romania"},{countryCode:"RU",countryName:"Russia"},{countryCode:"RW",countryName:"Rwanda"},{countryCode:"ST",countryName:"So Tom and Prncipe"},{countryCode:"BL",countryName:"Saint Barthlemy"},{countryCode:"SH",countryName:"Saint Helena"},{countryCode:"KN",countryName:"Saint Kitts and Nevis"},{countryCode:"LC",countryName:"Saint Lucia"},{countryCode:"MF",countryName:"Saint Martin"},{countryCode:"PM",countryName:"Saint Pierre and Miquelon"},{countryCode:"VC",countryName:"Saint Vincent and the Grenadines"},{countryCode:"WS",countryName:"Samoa"},{countryCode:"SM",countryName:"San Marino"},{countryCode:"SA",countryName:"Saudi Arabia"},{countryCode:"SN",countryName:"Senegal"},{countryCode:"RS",countryName:"Serbia"},{countryCode:"SC",countryName:"Seychelles"},{countryCode:"SL",countryName:"Sierra Leone"},{countryCode:"SG",countryName:"Singapore"},{countryCode:"SX",countryName:"Sint Maarten"},{countryCode:"SK",countryName:"Slovakia"},{countryCode:"SI",countryName:"Slovenia"},{countryCode:"SB",countryName:"Solomon Islands"},{countryCode:"SO",countryName:"Somalia"},{countryCode:"ZA",countryName:"South Africa"},{countryCode:"GS",countryName:"South Georgia and the South Sandwich Islands"},{countryCode:"KR",countryName:"South Korea"},{countryCode:"SS",countryName:"South Sudan"},{countryCode:"ES",countryName:"Spain"},{countryCode:"LK",countryName:"Sri Lanka"},{countryCode:"SD",countryName:"Sudan"},{countryCode:"SR",countryName:"Suriname"},{countryCode:"SJ",countryName:"Svalbard and Jan Mayen"},{countryCode:"SZ",countryName:"Swaziland"},{countryCode:"SE",countryName:"Sweden"},{countryCode:"CH",countryName:"Switzerland"},{countryCode:"SY",countryName:"Syria"},{countryCode:"TW",countryName:"Taiwan"},{countryCode:"TJ",countryName:"Tajikistan"},{countryCode:"TZ",countryName:"Tanzania"},{countryCode:"TH",countryName:"Thailand"},{countryCode:"TG",countryName:"Togo"},{countryCode:"TK",countryName:"Tokelau"},{countryCode:"TO",countryName:"Tonga"},{countryCode:"TT",countryName:"Trinidad and Tobago"},{countryCode:"TN",countryName:"Tunisia"},{countryCode:"TR",countryName:"Turkey"},{countryCode:"TM",countryName:"Turkmenistan"},{countryCode:"TC",countryName:"Turks and Caicos Islands"},{countryCode:"TV",countryName:"Tuvalu"},{countryCode:"UM",countryName:"U.S. Minor Outlying Islands"},{countryCode:"VI",countryName:"U.S. Virgin Islands"},{countryCode:"UG",countryName:"Uganda"},{countryCode:"UA",countryName:"Ukraine"},{countryCode:"US",countryName:"United States"},{countryCode:"GB",countryName:"United Kingdom"},{countryCode:"AE",countryName:"United Arab Emirates"},{countryCode:"UY",countryName:"Uruguay"},{countryCode:"UZ",countryName:"Uzbekistan"},{countryCode:"VU",countryName:"Vanuatu"},{countryCode:"VA",countryName:"Vatican City"},{countryCode:"VE",countryName:"Venezuela"},{countryCode:"VN",countryName:"Vietnam"},{countryCode:"WF",countryName:"Wallis and Futuna"},{countryCode:"EH",countryName:"Western Sahara"},{countryCode:"YE",countryName:"Yemen"},{countryCode:"ZM",countryName:"Zambia"},{countryCode:"ZW",countryName:"Zimbabwe"}],states:[{name:"Alabama",abbreviation:"AL"},{name:"Alaska",abbreviation:"AK"},{name:"American Samoa",abbreviation:"AS"},{name:"Arizona",abbreviation:"AZ"},{name:"Arkansas",abbreviation:"AR"},{name:"California",abbreviation:"CA"},{name:"Colorado",abbreviation:"CO"},{name:"Connecticut",abbreviation:"CT"},{name:"Delaware",abbreviation:"DE"},{name:"District Of Columbia",abbreviation:"DC"},{name:"Federated States Of Micronesia",abbreviation:"FM"},{name:"Florida",abbreviation:"FL"},{name:"Georgia",abbreviation:"GA"},{name:"Guam",abbreviation:"GU"},{name:"Hawaii",abbreviation:"HI"},{name:"Idaho",abbreviation:"ID"},{name:"Illinois",abbreviation:"IL"},{name:"Indiana",abbreviation:"IN"},{name:"Iowa",abbreviation:"IA"},{name:"Kansas",abbreviation:"KS"},{name:"Kentucky",abbreviation:"KY"},{name:"Louisiana",abbreviation:"LA"},{name:"Maine",abbreviation:"ME"},{name:"Marshall Islands",abbreviation:"MH"},{name:"Maryland",abbreviation:"MD"},{name:"Massachusetts",abbreviation:"MA"},{name:"Michigan",abbreviation:"MI"},{name:"Minnesota",abbreviation:"MN"},{name:"Mississippi",abbreviation:"MS"},{name:"Missouri",abbreviation:"MO"},{name:"Montana",abbreviation:"MT"},{name:"Nebraska",abbreviation:"NE"},{name:"Nevada",abbreviation:"NV"},{name:"New Hampshire",abbreviation:"NH"},{name:"New Jersey",abbreviation:"NJ"},{name:"New Mexico",abbreviation:"NM"},{name:"New York",abbreviation:"NY"},{name:"North Carolina",abbreviation:"NC"},{name:"North Dakota",abbreviation:"ND"},{name:"Northern Mariana Islands",abbreviation:"MP"},{name:"Ohio",abbreviation:"OH"},{name:"Oklahoma",abbreviation:"OK"},{name:"Oregon",abbreviation:"OR"},{name:"Palau",abbreviation:"PW"},{name:"Pennsylvania",abbreviation:"PA"},{name:"Puerto Rico",abbreviation:"PR"},{name:"Rhode Island",abbreviation:"RI"},{name:"South Carolina",abbreviation:"SC"},{name:"South Dakota",abbreviation:"SD"},{name:"Tennessee",abbreviation:"TN"},{name:"Texas",abbreviation:"TX"},{name:"Utah",abbreviation:"UT"},{name:"Vermont",abbreviation:"VT"},{name:"Virgin Islands",abbreviation:"VI"},{name:"Virginia",abbreviation:"VA"},{name:"Washington",abbreviation:"WA"},{name:"West Virginia",abbreviation:"WV"},{name:"Wisconsin",abbreviation:"WI"},{name:"Wyoming",abbreviation:"WY"}],pricingPlans:null,pricingDetails:{"moqups-free":{plan:{price:0,descriptionKey:"plan.free",name:"moqups-free",enabled:!1,id:1,currency:"USD"},fullName:"Free",projectsLimit:2,imageStorage:"5MB",billingCycle:"month",yearlyEquivalent:null},"moqups-standard":{plan:{price:9,descriptionKey:"plan.standard",name:"moqups-standard",enabled:!1,id:2,currency:"USD"},fullName:"Standard",projectsLimit:10,imageStorage:"1 GB",billingCycle:"month",yearlyEquivalent:"moqups-standard-yearly"},"moqups-professional":{plan:{price:19,descriptionKey:"plan.professional",name:"moqups-professional",enabled:!1,id:3,currency:"USD"},fullName:"Professional",projectsLimit:50,imageStorage:"5 GB",billingCycle:"month",yearlyEquivalent:"moqups-professional-yearly"},"moqups-ultimate":{plan:{price:39,descriptionKey:"plan.ultimate",name:"moqups-ultimate",enabled:!1,id:4,currency:"USD"},fullName:"Ultimate",projectsLimit:200,imageStorage:"20 GB",billingCycle:"month",yearlyEquivalent:"moqups-ultimate-yearly"},"moqups-standard-yearly":{plan:{price:99,descriptionKey:"plan.standard.yearly",name:"moqups-standard-yearly",enabled:!1,id:5,currency:"USD"},fullName:"Standard",projectsLimit:10,imageStorage:"1 GB",billingCycle:"year",yearlyEquivalent:null},"moqups-professional-yearly":{plan:{price:199,descriptionKey:"plan.professional.yearly",name:"moqups-professional-yearly",enabled:!1,id:6,currency:"USD"},fullName:"Professional",projectsLimit:50,imageStorage:"5 GB",billingCycle:"year",yearlyEquivalent:null},"moqups-ultimate-yearly":{plan:{price:419,descriptionKey:"plan.ultimate.yearly",name:"moqups-ultimate-yearly",enabled:!1,id:7,currency:"USD"},fullName:"Ultimate",projectsLimit:200,imageStorage:"20 GB",billingCycle:"year",yearlyEquivalent:null},"moqups-standard-eur":{plan:{price:9,descriptionKey:"plan.standard",name:"moqups-standard-eur",enabled:!1,id:10,currency:"EUR"},fullName:"Standard",projectsLimit:10,imageStorage:"1 GB",billingCycle:"month",yearlyEquivalent:"moqups-standard-yearly-eur"},"moqups-professional-eur":{plan:{price:19,descriptionKey:"plan.professional",name:"moqups-professional-eur",enabled:!1,id:11,currency:"EUR"},fullName:"Professional",projectsLimit:50,imageStorage:"5 GB",billingCycle:"month",yearlyEquivalent:"moqups-professional-yearly-eur"},"moqups-ultimate-eur":{plan:{price:39,descriptionKey:"plan.ultimate",name:"moqups-ultimate-eur",enabled:!1,id:12,currency:"EUR"},fullName:"Ultimate",projectsLimit:200,imageStorage:"20 GB",billingCycle:"month",yearlyEquivalent:"moqups-ultimate-yearly-eur"},"moqups-standard-yearly-eur":{plan:{price:99,descriptionKey:"plan.standard.yearly",name:"moqups-standard-yearly-eur",enabled:!1,id:13,currency:"EUR"},fullName:"Standard",projectsLimit:10,imageStorage:"1 GB",billingCycle:"year",yearlyEquivalent:null},"moqups-professional-yearly-eur":{plan:{price:199,descriptionKey:"plan.professional.yearly",name:"moqups-professional-yearly-eur",enabled:!1,id:14,currency:"EUR"},fullName:"Professional",projectsLimit:50,imageStorage:"5 GB",billingCycle:"year",yearlyEquivalent:null},"moqups-ultimate-yearly-eur":{plan:{price:419,descriptionKey:"plan.ultimate.yearly",name:"moqups-ultimate-yearly-eur",enabled:!1,id:15,currency:"EUR"},fullName:"Ultimate",projectsLimit:200,imageStorage:"20 GB",billingCycle:"year",yearlyEquivalent:null},"summer-moqups-professional":{plan:{price:15,descriptionKey:"plan.professional",name:"summer-moqups-professional",enabled:!1,id:16,currency:"USD"},fullName:"Professional",projectsLimit:50,imageStorage:"5 GB",billingCycle:"month",yearlyEquivalent:"summer-moqups-professional-yearly"},"summer-moqups-ultimate":{plan:{price:29,descriptionKey:"plan.ultimate",name:"summer-moqups-ultimate",enabled:!1,id:17,currency:"USD"},fullName:"Ultimate",projectsLimit:200,imageStorage:"20 GB",billingCycle:"month",yearlyEquivalent:"summer-moqups-ultimate-yearly"},"summer-moqups-professional-yearly":{plan:{price:159,descriptionKey:"plan.professional.yearly",name:"summer-moqups-professional-yearly",enabled:!1,id:18,currency:"USD"},fullName:"Professional",projectsLimit:50,imageStorage:"5 GB",billingCycle:"year",yearlyEquivalent:null},"summer-moqups-ultimate-yearly":{plan:{price:249,descriptionKey:"plan.ultimate.yearly",name:"summer-moqups-ultimate-yearly",enabled:!1,id:19,currency:"USD"},fullName:"Ultimate",projectsLimit:200,imageStorage:"20 GB",billingCycle:"year",yearlyEquivalent:null},"summer-moqups-professional-eur":{plan:{price:15,descriptionKey:"plan.professional",name:"summer-moqups-professional-eur",enabled:!1,id:20,currency:"EUR"},fullName:"Professional",projectsLimit:50,imageStorage:"5 GB",billingCycle:"month",yearlyEquivalent:"summer-moqups-professional-yearly-eur"},"summer-moqups-ultimate-eur":{plan:{price:29,descriptionKey:"plan.ultimate",name:"summer-moqups-ultimate-eur",enabled:!1,id:21,currency:"EUR"},fullName:"Ultimate",projectsLimit:200,imageStorage:"20 GB",billingCycle:"month",yearlyEquivalent:"summer-moqups-ultimate-yearly-eur"},"summer-moqups-professional-yearly-eur":{plan:{price:159,descriptionKey:"plan.professional.yearly",name:"summer-moqups-professional-yearly-eur",enabled:!1,id:22,currency:"EUR"},fullName:"Professional",projectsLimit:50,imageStorage:"5 GB",billingCycle:"year",yearlyEquivalent:null},"summer-moqups-ultimate-yearly-eur":{plan:{price:249,descriptionKey:"plan.ultimate.yearly",name:"summer-moqups-ultimate-yearly-eur",enabled:!1,id:23,currency:"EUR"},fullName:"Ultimate",projectsLimit:200,imageStorage:"20 GB",billingCycle:"year",yearlyEquivalent:null}},initModule:function(){var a=this;$(document).on("click",".paypal-link",function(){if($(this).hasClass("disabled"))return;FDBK.openModal("#paypal-progress-dialog"),$("#paypal-form").submit();if(!FDBK.library.currentProject||!FDBK.library.currentProject.uniqueId)a.ppInProgress=!0,a.checkPaymentsStatus()}),FDBK.sub("payment-notification-update",function(b){var c=a.getCurrentPlan().plan.name;FDBK.library.saveProject(!0),FDBK.library.autoSave&&FDBK.library.autoSave.reset(),c==="moqups-free"&&b!=="moqups-free"&&FDBK.pub("new-payment-successful",a.paymentTrigger),window.setTimeout(function(){c!==b&&FDBK.openModal("#subscription-changed-dialog")},4e3)}),FDBK.sub("modal-closed",function(b){$("#subscription-content").remove(),b==="#plans-dialog"&&a.newAccount&&!a.nextPlan&&(a.newAccount=!1,FDBK.openModal("#welcome-dialog")),b==="#paypal-progress-dialog"&&(a.ppInProgress=!1)}),FDBK.sub("account-created",function(){a.newAccount=!0}),FDBK.sub("user-logged-in",function(){a.pricingPlans=null,a.updateCurrentPlanPlaceholders(),a.nextPlan?a.changePlan():a.newAccount?FDBK.buildHash("pricing"):a.promptUpdateCard&&(a.promptUpdateCard=!1,a.initUpdateForm())}),FDBK.sub("hash-checked",function(){if(!FDBK.library.isUserLoggedIn())return;FDBK.USER_DATA.planStatus==="pastdue"?FDBK.openModal("#past-due-dialog"):FDBK.USER_DATA.planStatus==="expired"&&FDBK.openModal("#expired-dialog")}),$(document).on("click",".cancel-plan-update",function(){$("#plan-confirmation").remove(),a.$plans.find("#plans").show(),FDBK.cleanServerError()}),$(document).on("click","[data-dialog=plans-pricing]",function(){FDBK.showPricingPlans($(this).data("trigger"))}),$(document).on("click",".plan-picker",function(){if($(this).hasClass("disabled"))return;var b=$(this).data("name");$.each(a.pricingPlans,function(c,d){b===d.plan.name&&a.setNextPlan(d)});if(!a.nextPlan)return;FDBK.library.isUserLoggedIn()?a.changePlan():FDBK.library.showRegisterDialog(),FDBK.pub("plan-selected",a.nextPlan.plan.name)}),$(document).on("click","[name=billing-cycle]",function(){a.generatePricingTable($(this).val())}),$(document).on("click","[name=payment-type]",function(){$(this).parent().addClass("selected").siblings().removeClass("selected"),$("#subscription-content").find(".form-wrapper").hide(),$("#"+$(this).val()).show(),$(this).val()==="paypal-form-wrapper"&&$("#paypal-button").hasClass("disabled")&&a.getPaymentURL()}),$(document).on("click","[name=accountType]",function(){$(this).val()==="company"?$("#company-only").show():$("#company-only").hide()}),$(document).on("click",".toggle-discount",function(){$("#discount-form").toggle()}),$(document).on("submit","#discount-form",function(){return a.applyDiscount(),!1}),$(document).on("click",".update-credit-card",function(){return a.initUpdateForm(),!1}),$(document).on("click",".show-info-popover",function(){var a=$(this).parents(".medium").find(".info-popover");$(this).parents("form").find(".info-popover").not(a).hide(),a.toggle()}),$(document).on("click","#overlay",function(a){$(a.target).closest(".show-info-popover").length||$(this).find(".info-popover").hide()}),$(document).on("change","[name=countryName]",function(){$(this).parents("form").find("[name=countryCode]").val($(this).find("option:selected").data("code"))}),$(document).on("submit",".billing-details-form",function(){var a=$(this).parents("#payment-success-dialog").length,b=FDBK.allowReceipt(),c={};c.accountType=$.trim($(this).find("[name=accountType]:checked").val()),FDBK.USER_DATA.billingInfo.accountType=c.accountType;for(var d=0,e=this.length;d<e;++d){var f=this[d];f.name&&f.name!=="accountType"&&(c[f.name]=$.trim(f.value),FDBK.USER_DATA.billingInfo[f.name]=c[f.name])}c["accountType"]=="personal"&&(c.company=null,c.vatId=null),FDBK.API.xhr(FDBK.API.CALL_UPDATE_BILLING,{data:JSON.stringify(c),success:function(c){c.success?(FDBK.showServerError({message:FDBK.loc("billingAddressSuccess")}),a&&window.setTimeout(function(){FDBK.closeModal()},5e3),b||FDBK.pub("added-billing-address",a)):c.object.error&&FDBK.showServerError({message:FDBK.loc(c.object.error),style:"error"})},error:function(){a&&FDBK.closeModal()}})}),$(document).on("submit","#pay-bank-form",function(){FDBK.cleanServerError();var a=$(this),b={},c={name:!0,email:!0,country:!0,address:!0};for(var d=0,e=this.length;d<e;++d){var f=this[d];f.name&&(b[f.name]=$.trim(f.value));if(c[f.name]&&(!b[f.name]||b[f.name]=="----------"))return FDBK.showServerError({message:FDBK.loc(f.name.charAt(0).toUpperCase()+f.name.slice(1)+" is required."),style:"error"}),!1}a.find("input, button").prop("disabled",!0),$("input[name=payment-type]").prop("disabled",!0),FDBK.showServerError({message:FDBK.loc("_Sending order...")}),FDBK.API.xhr(FDBK.API.CALL_BANK_TRANSFER,{data:JSON.stringify(b),success:function(b){b.success?FDBK.openModal("#bank-order-success-dialog"):(FDBK.showServerError({message:FDBK.loc("_Order could not be processed."),style:"error"}),a.find("input, button").prop("disabled",!1),$("input[name=payment-type]").prop("disabled",!1))},error:function(){FDBK.showServerError({message:FDBK.loc("_Order could not be processed."),style:"error"}),a.find("input, button").prop("disabled",!1),$("input[name=payment-type]").prop("disabled",!1)}})}),$(document).on("submit","#pay-subscription-form",function(){FDBK.cleanServerError(),$("#discount-form").hide();var b=$("<fieldset></fieldset>"),c=$(".cc-number-field").clone();c.val(c.val().replace(/\s/g,""));if(!c.val())return FDBK.showServerError({message:FDBK.loc("_Card number is required."),style:"error"}),!1;a.cardType=$.payment.cardType(c.val());var d=$(".cc-exp-field").clone();d.val(d.val().replace(/\s/g,""));if(!d.val())return FDBK.showServerError({message:FDBK.loc("_Card expiration date is required."),style:"error"}),!1;var e=$(".cc-cvv-field").clone(),f=$(".cc-name-field").clone();f.val($.trim(f.val()));if(!f.val())return FDBK.showServerError({message:FDBK.loc("_Name on card is required."),style:"error"}),!1;b.append(c,d,e,f);var g=$('[name="payment-iframe"]'),h=g[0].contentWindow.submitSubscription;return h?(FDBK.showServerError({message:FDBK.loc("_Processing...")}),a.disableCloseButtons(),$(this).find("input, button").prop("disabled",!0),$("input[name=payment-type]").prop("disabled",!0),$(this).find(".plan-continue").addClass("disabled"),h(b),a.nextPlan&&FDBK.pub("new-payment-initiated")):a.nextPlan?g.prop("src",a.nextPlan.actionUrl):g.prop("src","bt/form/update"),!1}),$(document).on("click",".plan-continue",function(){if($(this).hasClass("disabled"))return;$(this).addClass("disabled");var b=$(this).data("action"),c=$(this).data("url");if(b==="current")a.renewPlan();else if(b==="pastdue")a.retryCharge();else{var d=$.trim($("#downgrade-reason").val());d&&(c+="&reason="+encodeURIComponent(d)),FDBK.API.xhr({url:c,type:"GET",requiresLogin:!0},{success:function(c){c.success?(a.updatePlan(),b==="upgrade"?(FDBK.openModal("#upgrade-success-dialog"),FDBK.pub("user-upgraded-plan",a.getCurrentPlanName())):b==="downgrade"&&(FDBK.openModal("#downgrade-success-dialog"),FDBK.pub("user-downgraded-plan",a.getCurrentPlanName()))):c.message==="creditCardRequired"?(a.initPaymentForm(),$('[name="payment-iframe"]').prop("src","/bt/form/create?plan="+a.nextPlan.plan.name),FDBK.showServerError({message:FDBK.loc(c.message)})):FDBK.showServerError({message:c.message,style:"error"})}})}})},getPaymentURL:function(){var a=this;FDBK.API.xhr(FDBK.API.CALL_GET_PAYMENT_URL,{data:{planId:a.nextPlan.plan.id,provider:"paypal"},contentType:"application/x-www-form-urlencoded",success:function(b){b.success&&b.object&&(a.buildPayPalForm(b.object),$("#paypal-button").removeClass("disabled"))}})},checkPaymentsStatus:function(){var a=this;window.setTimeout(function(){if(!a.ppInProgress)return;FDBK.API.xhr(FDBK.API.CALL_GET_CURRENT_USER,{success:function(b){b.success&&b.object&&b.object.user&&a.nextPlan&&b.object.user.paymentProvider=="paypal"&&b.object.user.plan==a.nextPlan.plan.name?FDBK.pub("payment-notification-update"):a.checkPaymentsStatus()}})},1e4)},applyDiscount:function(){var a=this,b=$.trim($("#customer_discount_code").val());if(b){FDBK.cleanServerError();var c=$("#pay-subscription-form").find("input[type=submit]");c.prop("disabled",!0),FDBK.API.xhr(FDBK.API.CALL_VERIFY_DISCOUNT_CODE,{data:{planName:a.nextPlan.plan.name,code:b},success:function(d){if(d.success)if(d.object.valid){FDBK.showServerError({message:FDBK.loc("_Discount code was successfully applied.")}),$(".toggle-discount").remove(),$("#total-price").text(a.getLocalizedPrice(a.nextPlan.plan.currency,d.object.newPrice)),$("#discount-form").remove();var e=$('[name="payment-iframe"]'),f=e.prop("src");a.discountCode=b,e.prop("src",f+"&voucherCode="+b)}else FDBK.showServerError({message:FDBK.loc("_Invalid discount code."),style:"error"}),c.prop("disabled",!1);else FDBK.showServerError({message:FDBK.loc("_Discount code could not be processed."),style:"error"}),c.prop("disabled",!1)}})}else $(".toggle-discount").trigger("click")},retryCharge:function(){function b(){FDBK.USER_DATA.planStatus="active",a.updatePlan(),FDBK.openModal("#pastdue-success-dialog")}var a=this;FDBK.API.xhr({url:"a/subscr/retrycharge",type:"GET",requiresLogin:!0},{success:function(c){c.success?b():c.message==="subscriptionNotPastDue"?c.object.subscription&&c.object.subscription?c.object.subscription.status==="active"?b():c.object.subscription.status==="expired"?a.renewPlan():FDBK.showServerError({message:FDBK.loc(c.message),style:"error"}):FDBK.showServerError({message:FDBK.loc(c.message),style:"error"}):FDBK.showServerError({message:FDBK.loc(c.message),style:"error"})}})},renewPlan:function(){function b(){FDBK.USER_DATA.planStatus="active",a.updatePlan(),FDBK.openModal("#renew-success-dialog")}var a=this;FDBK.API.xhr({url:"a/subscr/renew?planId="+a.getPlanId(FDBK.USER_DATA.plan),type:"GET",requiresLogin:!0},{success:function(a){a.success?b():a.message==="subscriptionNotExpired"?a.object.subscription&&a.object.subscription?a.object.subscription.status==="active"?b():FDBK.showServerError({message:FDBK.loc(a.message),style:"error"}):FDBK.showServerError({message:FDBK.loc(a.message),style:"error"}):FDBK.showServerError({message:FDBK.loc(a.message),style:"error"})}})},changePlan:function(){var a=this;a.getCurrentPlan().plan.name==="moqups-free"||FDBK.USER_DATA.planStatus=="canceled"?a.initPaymentForm():a.nextPlan.plan.price?a.confirmChangePlan():(a.$plans.find("#plans").append($("#tmpl-loading-downgrade").loc_tmpl()),FDBK.API.xhr(FDBK.API.CALL_GET_DOWNGRADE_INFO,{success:function(b){b.success&&b.hasRight?(a.downgradeInfo=b.object,a.downgradeInfo.collaborators||a.downgradeInfo.archivedProjects||a.downgradeInfo.teamMembers||(a.downgradeInfo=null)):a.downgradeInfo=null,a.confirmChangePlan(),$("#loading-downgrade").remove()},error:function(){a.downgradeInfo=null,a.confirmChangePlan(),$("#loading-downgrade").remove()}}))},confirmChangePlan:function(){var a=this,b=a.$plans.find("#plans").height();a.$plans.find("#plans").hide().before($("#tmpl-plan-confirmation").loc_tmpl({currentPlan:a.getCurrentPlan(),nextPlan:a.nextPlan,leftDays:a.getLeftDays(),downgradeInfo:a.downgradeInfo})),$("#plan-confirmation").css("min-height",b).show()},setNextPlan:function(a){var b=this;a?(b.nextPlan=a,b.nextPlan.ajaxRequestable||b.buildPayPalForm(b.nextPlan.actionUrl)):(b.nextPlan=null,b.buildPayPalForm())},setPlanAndPay:function(a){var b=this;b.getPricingPlans(function(){$.each(b.pricingPlans,function(c,d){a==d.plan.id&&(b.setNextPlan(d),b.initPaymentForm())})})},buildPayPalForm:function(a){if(a){var b=a.split("?")[0],c=a.split("?")[1].split("&"),d=$('<form id="paypal-form" target="_blank" action="'+b+'" method="POST"></form>');$.each(c,function(a,b){var c=(b.split("=")[1]+"").replace(/\+/g,"%20"),e=b.split("=")[0];e&&d.append('<input type="hidden" name="'+e+'" value="'+decodeURIComponent(c)+'"/>')}),$("#paypal-subscription-form").html(d)}else $("#paypal-subscription-form").empty()},getCurrentPlan:function(){var a=this.pricingDetails[FDBK.USER_DATA.plan];return a&&(a.plan.localizedPrice=this.getLocalizedPrice(a.plan.currency,a.plan.price)),a},getLocalizedPrice:function(a,b){var c=this.currencies[a];return c==="$"?c+b:b+" "+c},getYearlyPlanPrice:function(){var a=this,b=0,c=null;if(a.nextPlan&&a.nextPlan.plan.billingCycle==="year")b=a.nextPlan.plan.price,c=a.nextPlan.plan.currency;else if(a.nextPlan){var d=a.pricingDetails[a.nextPlan.plan.name].yearlyEquivalent;b=a.pricingDetails[d].plan.price,c=a.pricingDetails[d].plan.currency}return a.getLocalizedPrice(c,b)},getCurrentPlanName:function(){return FDBK.pricingDetails[FDBK.USER_DATA.plan].fullName},getPlanProjectsLimit:function(){return this.getCurrentPlan().projectsLimit},getPlanId:function(a){return FDBK.pricingDetails[a].plan.id},getCardInfo:function(){var a=$(".show-card");a.html("Loading data..."),FDBK.API.xhr(FDBK.API.CALL_GET_CC_INFO,{success:function(b){var c=b.object;if(c){var d=moment(FDBK.SERVER_TIME),e=d.year()>c.expirationYear||d.year()==c.expirationYear&&d.month()>c.expirationMonth-1;e?a.html($.loc_tmpl('<strong>{{= maskedNumber }}</strong> (<strong style="color:#DC143C;">EXPIRED</strong>: {{= expirationMonth }}/{{= expirationYear }})',c)):a.html($.loc_tmpl("<strong>{{= maskedNumber }}</strong> (exp: {{= expirationMonth }}/{{= expirationYear }})",c))}}})},getLeftDays:function(){var a=moment(FDBK.USER_DATA.nextBillingDate?FDBK.USER_DATA.nextBillingDate:FDBK.SERVER_TIME),b=moment(FDBK.SERVER_TIME),c=a.diff(b,"days");return c>0?c:0},showNewUserPricingPlans:function(){this.newAccount=!0,FDBK.showPricingPlans("direct-link")},showPricingPlans:function(a){var b=this;!FDBK.library.isUserLoggedIn()||FDBK.isAccountOwner()?(FDBK.openModal("#plans-dialog","pricing"),b.pricingPlans?b.generatePricingTable():(b.generatePricingTable(),b.getPricingPlans()),b.hasSeenPricing=!0,b.paymentTrigger=a,FDBK.pub("opened-pricing-plans",a)):FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("notOwnerPaymentMessage"),buttons:[{text:FDBK.loc("_Close"),classes:"simple blue primary-action"}]})},initPaymentForm:function(){var a=this;a.discountCode=null,FDBK.openModal("#new-subscription-dialog"),$("#new-subscription-content").html($("#tmpl-subscription-form").loc_tmpl({currentPlan:a.getCurrentPlan(),nextPlan:a.nextPlan,yearlyPrice:a.getYearlyPlanPrice(),user:FDBK.USER_DATA,countries:a.countries})),$("input.cc-exp-field").payment("formatCardExpiry"),$("input.cc-number-field").payment("formatCardNumber"),$("input.cc-cvv-field").payment("formatCardCVC"),FDBK.cleanServerError()},initUpdateForm:function(a){var b=this,c=a||"#update-subscription-content";b.setNextPlan(),a||FDBK.openModal("#update-subscription-dialog"),$(c).html($("#tmpl-subscription-form").loc_tmpl({currentPlan:b.getCurrentPlan(),nextPlan:b.nextPlan,yearlyPrice:b.getYearlyPlanPrice(),user:FDBK.USER_DATA,countries:b.countries})),$("input.cc-exp-field").payment("formatCardExpiry"),$("input.cc-number-field").payment("formatCardNumber"),$("input.cc-cvv-field").payment("formatCardCVC"),FDBK.cleanServerError(),b.getCardInfo()},getPaymentHistory:function(a){var b=this;FDBK.API.xhr(FDBK.API.CALL_GET_PAYMENT_HISTORY,{success:function(c){var d=c.object.reverse();$.each(d,function(a,c){c.localizedPrice=b.getLocalizedPrice(c.currency,c.paymentG)});var e=d[0];e&&e.nextPayDate&&(FDBK.USER_DATA.nextBillingDate=e.nextPayDate),a&&a({payments:d,nextBillingDate:FDBK.USER_DATA.nextBillingDate,currentPlan:b.getCurrentPlan(),allowReceipt:FDBK.allowReceipt(),paymentProvider:FDBK.USER_DATA.paymentProvider,planStatuses:FDBK.planStatuses,planStatus:FDBK.USER_DATA.planStatus,email:FDBK.USER_DATA.billingInfo.email||FDBK.USER_DATA.email,sendInvoice:FDBK.SEND_INVOICE}),b.getCardInfo()}})},getPricingPlans:function(a){var b=this;FDBK.API.xhr(FDBK.API.CALL_GET_PLANS,{success:function(c){c.success&&(b.pricingPlans=c.object.plans,b.geoIpCode=c.object.country,$.each(b.pricingPlans,function(a,c){c.plan.localizedPrice=b.getLocalizedPrice(c.plan.currency,c.plan.price)}),b.generatePricingTable(),a&&a())}})},generatePricingTable:function(a){var b=this,c=[],d="year";b.getCurrentPlan()&&b.getCurrentPlan().plan&&b.getCurrentPlan().plan.price&&(d=b.getCurrentPlan().billingCycle);var e=a?a:d,f={15:19,29:39,159:199,249:419};b.pricingPlans&&$.each(b.pricingPlans,function(a,d){f[d.plan.price]&&(d.plan.oldLocalizedPrice=b.getLocalizedPrice(d.plan.currency,f[d.plan.price])),e==="month"?b.pricingDetails[d.plan.name]&&($.extend(d.plan,b.pricingDetails[d.plan.name],!0),d.actualStatus=FDBK.USER_DATA.planStatus,d.plan.enabled&&d.plan.price>0&&b.pricingDetails[d.plan.name].billingCycle==e&&c.push(d)):b.pricingDetails[d.plan.name]&&b.pricingDetails[d.plan.name].billingCycle==="year"&&($.extend(d.plan,b.pricingDetails[d.plan.name],!0),d.actualStatus=FDBK.USER_DATA.planStatus,d.plan.enabled&&b.pricingDetails[d.plan.name].billingCycle==e&&c.push(d))}),b.$plans.html($("#tmpl-plans").loc_tmpl({plans:c,hasSession:FDBK.library.isUserLoggedIn(),currentPlan:b.getCurrentPlan(),newAccount:b.newAccount,cycleOption:e,currentPlanStatus:FDBK.USER_DATA.planStatus,oldPrices:f,expireDate:moment().endOf("month").fromNow(),path:FDBK.CSS_BASE_URL}))},disableCloseButtons:function(){$("#"+FDBK.getActiveModalID()).find(".close-modal").addClass("disabled")},enableCloseButtons:function(){$("#"+FDBK.getActiveModalID()).find(".close-modal").removeClass("disabled")},getCreateSubscriptionForm:function(){$("#pay-subscription-form").find("input, button").prop("disabled",!1),$("input[name=payment-type]").prop("disabled",!1),$(".cc-number-field").prop("name","customer[credit_card][number]"),$(".cc-exp-field").prop("name","customer[credit_card][expiration_date]"),$(".cc-name-field").prop("name","customer[credit_card][cardholder_name]"),$(".cc-cvv-field").prop("name","customer[credit_card][cvv]")},getUpdateSubscriptionForm:function(){$("#pay-subscription-form").find("input, button").prop("disabled",!1),$("#subscription-content").find(".plan-continue").removeClass("disabled"),$(".cc-number-field").prop("name","credit_card[number]"),$(".cc-exp-field").prop("name","credit_card[expiration_date]"),$(".cc-name-field").prop("name","credit_card[cardholder_name]"),$(".cc-cvv-field").prop("name","credit_card[cvv]")},updateCurrentPlanPlaceholders:function(){var a=this;$(".current-plan-name").text(a.getCurrentPlanName())},paymentSuccessful:function(){var a=this;a.enableCloseButtons(),a.nextPlan?(a.updatePlan(),FDBK.pub("new-payment-successful",a.paymentTrigger),$("#billing-details").html($("#tmpl-billing-details").loc_tmpl({countries:FDBK.countries,billingInfo:FDBK.USER_DATA.billingInfo,geoIpCode:FDBK.geoIpCode,isPaymentFlow:!0,currentPlan:FDBK.getCurrentPlan()})),FDBK.openModal("#payment-success-dialog")):FDBK.USER_DATA.planStatus==="expired"?a.renewPlan():FDBK.USER_DATA.planStatus==="pastdue"?a.retryCharge():FDBK.openModal("#card-success-dialog"),a.cardType=null},paymentUnsuccessful:function(a){var b=this;b.enableCloseButtons();var c=$('[name="payment-iframe"]'),d=b.discountCode?"&voucherCode="+b.discountCode:"";b.nextPlan?(c.prop("src",b.nextPlan.actionUrl+d),FDBK.pub("new-payment-error",{cardType:b.cardType,errorMessage:a,planName:b.nextPlan.plan.name,userName:FDBK.USER_DATA.userName,email:FDBK.USER_DATA.email})):c.prop("src","bt/form/update"),FDBK.showServerError({message:a,style:"error"}),b.cardType=null},updatePlan:function(){var a=this;a.nextPlan&&(a.nextPlan.plan.name=="moqups-free"?FDBK.USER_DATA.planStatus="canceled":(FDBK.USER_DATA.plan=a.nextPlan.plan.name,FDBK.USER_DATA.planStatus="active"),FDBK.USER_DATA.paymentProvider="braintree"),a.setNextPlan(),a.pricingPlans=null,a.newAccount=!1,a.updateCurrentPlanPlaceholders(),FDBK.pub("plan-updated")}}),FDBK.mixinModule("project-history",{history:null,_revisions:null,$history:!1,initModule:function(){function b(){return FDBK.allowRevisions()?(a.openInputConfirmationDialog({heading:FDBK.loc("_Create new revision"),message:FDBK.loc("_Please describe the changes you have made in this revision:"),primaryActionTitle:FDBK.loc("_Create Revision"),inputPlaceHolder:FDBK.loc("_Revised on ")+moment(new Date).format("dddd, ha"),primaryAction:function(b){a.createRevision(b)}}),$(".confirmation-title").focus(),!1):(FDBK.showRevisionsAlert(),!1)}this.$history=$("#history");var a=this;FDBK.sub("open-project",function(){$("#project-history-button").removeClass("disabled")}),FDBK.sub("close-project",function(){$("#project-history-button").addClass("disabled")}),$("#create-project-revision, #history-dialog-create-revision").on("click",b),$(document).on("keydown",null,"alt+ctrl+r alt+meta+r",function(){return FDBK.quickRevision(),!1}).on("keydown",null,"alt+ctrl+h alt+meta+h",function(){return FDBK.showHistory(),!1}),$("#quick-revision").on("click",function(){FDBK.quickRevision()}),this.$history.on("click",".revision-action",function(b){var c=$(this).data("action"),d=$(b.target).closest(".project")[0].id.replace("_",""),e=a.findRevision(d);if(c=="fork")a.fetchRevisions(d,function(b){if(!b)return;var c=b.data.snapshot;a.openInputConfirmationDialog({heading:FDBK.loc("_Create new project from revision"),message:FDBK.loc("_Enter new project name: "),primaryActionTitle:FDBK.loc("_Create Project"),inputPlaceHolder:FDBK.library.currentProject.name+" "+FDBK.loc("_Copy"),inputValue:FDBK.library.currentProject.name+" "+FDBK.loc("_Copy"),primaryAction:function(a){c.name=a,FDBK.library.closeCurrentProject(),FDBK.library.serviceClient.createProject(c,function(){FDBK.closeModal()})}}),$(".confirmation-title").focus()});else if(c=="view")a.fetchRevisions(d,function(a){if(!a)return;FDBK.library.previewProject(a.data.snapshot,!1)});else if(c=="restore"){var f=function(){a.createRevision("Before Restore "+moment().format("YYYY-DD-MM")+" at "+moment().format("HH.mm.ss"),function(){a.fetchRevisions(d,function(a){function e(a,b){a||(FDBK.library.openProject(b,!0),$("#project-save-status").removeClass("saved"),FDBK.library.currentProject.updateAttributes(c),FDBK.pub("project-saved"),FDBK.pub("refresh-comments")),FDBK.closeModal()}var b=(new FDBK.Project(a.data.snapshot)).toServerJSON(),c=FDBK.library.currentProject.getAttributes(),d=FDBK.library.currentProject.uniqueId;FDBK.library.serviceClient.replaceProjectData(b,"revision",function(){FDBK.library.closeCurrentProject(),FDBK.library.serviceClient.getProjectJSON(d,e)})})})};FDBK.openConfirmDialog({heading:FDBK.loc("_Restore project"),message:FDBK.loc("_Are you sure you want to restore the current project to an older revision ?"),buttons:[{text:FDBK.loc("_Cancel"),classes:"close-modal"},{text:FDBK.loc("_Restore project"),classes:"primary-action right",onClick:f}]})}else c=="delete"?FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_Are you sure you want to delete this revision?"),buttons:[{text:FDBK.loc("_Cancel"),classes:"close-modal",onClick:function(){window.setTimeout(function(){a.history=a._revisions,a.showHistory()},0)}},{text:FDBK.loc("_Delete Revision"),classes:"primary-action right",onClick:function(){a.deleteRevision(d)}}]}):c=="rename"&&(a.openInputConfirmationDialog({heading:FDBK.loc("_Rename revision"),message:FDBK.loc("_Please describe the changes you have made in this revision:"),primaryActionTitle:FDBK.loc("_Rename revision"),inputPlaceHolder:e.title,inputValue:e.title,primaryAction:function(b){a.renameRevision(d,b)},cancelAction:function(){window.setTimeout(function(){a.history=a._revisions,a.showHistory()},0)}}),$(".confirmation-title").val(e.title).focus()[0].setSelectionRange(0,1e3))})},showHistory:function(){var a=this;FDBK.openModal("#history-dialog"),FDBK.allowRevisions()||FDBK.showServerError({message:'Project revisions are not available in your current plan. <br/><a href="#" class="open-dialog" data-dialog="plans-pricing" data-trigger="revisions">Upgrade Now!</a>',style:"upgrade"}),this.$history.empty();if(!this.history){this.$history.append('<p class="no-projects">Loading revisions...</p>'),this.fetchHistory();return}this.history.length===0&&this.$history.append($('<p class="no-projects">No revisions for this project</p>')),this.$history.append($("#tmpl-history").loc_tmpl(this.history)),this._revisions=this.history,this.history=null},showErrorOnFetch:function(){this.$history.empty(),this.$history.append($('<p class="no-projects">There was an error loading revisions.</p>'))},quickRevision:function(){if(!FDBK.allowRevisions())return FDBK.showRevisionsAlert(),!1;var a=FDBK.library.currentProject;if(a&&a.uniqueId){var b=FDBK.loc("_Revised on ")+moment(new Date).format("dddd, ha");this.createRevision(b)}},createRevision:function(a,b){FDBK.API.xhr(FDBK.API.CALL_CREATE_PROJECT_REVISION,{data:{title:a},contentType:"application/x-www-form-urlencoded",urlParams:[FDBK.library.currentProject.uniqueId,"revisions"],success:function(a){a.success?($("#project-revision-saved").addClass("shown"),setTimeout(function(){$("#project-revision-saved").removeClass("shown")},3e3)):FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error saving your revision"),buttons:[{text:FDBK.loc("_OK"),classes:"right primary-action"}]}),b&&b()},error:function(){FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error saving your revision"),buttons:[{text:FDBK.loc("_OK"),classes:"right primary-action"}]}),b&&b()}})},findRevision:function(a){for(var b=0;b<this._revisions.length;b++)if(this._revisions[b]._id==a)return this._revisions[b];return nil},deleteRevision:function(a){var b=this;FDBK.API.xhr(FDBK.API.CALL_CREATE_PROJECT_REVISION,{type:"DELETE",contentType:"application/x-www-form-urlencoded",urlParams:[FDBK.library.currentProject.uniqueId,"revisions",a],success:function(a){a.success?b.showHistory():FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_Oops. Something went wrong. Please try again."),buttons:[{text:FDBK.loc("_OK"),classes:"right primary-action"}]})},error:function(){FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_Oops. Something went wrong. Please try again."),buttons:[{text:FDBK.loc("_OK"),classes:"right primary-action"}]})}})},renameRevision:function(a,b){FDBK.API.xhr(FDBK.API.CALL_CREATE_PROJECT_REVISION,{data:{title:b},type:"PUT",contentType:"application/x-www-form-urlencoded",urlParams:[FDBK.library.currentProject.uniqueId,"revisions",a],success:function(a){a.success?($("#project-revision-saved").addClass("shown"),setTimeout(function(){$("#project-revision-saved").removeClass("shown")},3e3)):FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error saving your revision"),buttons:[{text:FDBK.loc("_OK"),classes:"right primary-action"}]})},error:function(){FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error saving your revision"),buttons:[{text:FDBK.loc("_OK"),classes:"right primary-action"}]})}})},fetchHistory:function(){var a=this;FDBK.API.xhr(FDBK.API.CALL_GET_PROJECT_CONTENT_STREAM,{urlParams:[FDBK.library.currentProject.uniqueId,"revisions","?sort=createDate.desc&fields=_id,_docId,createDate,user,title"],success:function(b){b.success&&b.object?(a.history=b.object.reverse(),a.showHistory()):(a.showErrorOnFetch(),this.history=null)},error:function(){a.showErrorOnFetch(),this.history=null}})},fetchRevisions:function(a,b){var c=this;FDBK.API.xhr(FDBK.API.CALL_GET_PROJECT_CONTENT_STREAM,{urlParams:[FDBK.library.currentProject.uniqueId,"revisions",a],success:function(a){if(a.success&&a.object)return b(a.object);b()},error:function(){b()}})},openInputConfirmationDialog:function(a){var b=function(){$(document).bind("keydown","return",d),$(".confirmation-title").bind("keydown","return",d),FDBK.sub("modal-closed",c)},c=function(){$(document).unbind("keydown",d),$(".confirmation-title").unbind("keydown",d),FDBK.unsub("modal-closed",c)},d=function(){var b=$(".confirmation-title").val()||$(".confirmation-title").attr("placeholder");return a.primaryAction(b),FDBK.closeModal(),!1};FDBK.openConfirmDialog({heading:a.heading,showCloseButton:!0,message:a.message+'<input name="name" class="confirmation-title reset-input" type="text" maxlength="255" placeholder="'+(a.inputPlaceHolder||"")+'" value="'+(a.inputValue||"")+'" style="margin:10px 0 0 0;width:360px">',buttons:[{text:FDBK.loc("_Cancel"),classes:"close-modal",onClick:function(){a.cancelAction&&a.cancelAction()}},{text:a.primaryActionTitle,classes:"right primary-action",onBeforeClick:d}]}),b()}}),FDBK.mixinModule("project-themes",{initModule:function(){var a=this;FDBK.sub("open-project",function(){a.applyProjectFont(FDBK.library.currentProject.font)}),FDBK.sub("loaded-user-settings",this.selectDefaultFont)},initFontSelection:function(){var a=this;for(var b=0,c="",d=FDBK.config("projectManagement.font.list");b<d.length;b++)c+='<label class="preview-font '+d[b].value+'" title="'+d[b].description+'" >\t\t\t\t<input type="radio" name="font" value="'+d[b].value+'"/>'+d[b].name+"</label>";$("#project-fonts").append(c).find("[name=font]").on("change",function(){a.saveProjectFontPreference($(this).val())}).end(),a.selectDefaultFont()},selectDefaultFont:function(){var a=FDBK.library.getUserSettings("defaultFont")||FDBK.config("projectManagement.font.default");$("#project-fonts").find('[value="'+a+'"]').attr("checked","checked")},applyProjectFont:function(a){var b=FDBK.config("projectManagement.font.list").map(function(a){return a.value}).join(" ");$("html").removeClass(b).addClass(a)},saveProjectFontPreference:function(a){FDBK.library.setUserSettings("defaultFont",a)}}),FDBK.mixinModule("projectRevisions",{getProjectSessions:function(a,b){},getProjectRevisionsForSession:function(a,b,c){},getProjectRevisionJSON:function(a,b,c){}}),FDBK.mixinModule("project-comments",{comments:[],commentsSelection:"all",COMMENTS_SELECTION_ALL:"all",COMMENTS_SELECTION_CURRENT:"current",$sidebarComments:null,$commentsWrapper:null,$commentsButton:null,replyToCommentId:!1,initModule:function(){function g(a){var c=null,d=FDBK.library.currentMockup.id,e=$("#new-comment"),g=e.val();if(b.replyToCommentId){c=b.replyToCommentId;var h=b.getComment(c);h&&h.pageId&&(d=h.pageId)}if($.trim(g)){var i={};FDBK.library.currentMockup.selection.length&&(i.stencilIds=FDBK.library.currentMockup.selection.map(function(a){return a.id})),b.postComment({uniqueId:"comment-"+utils.guid(),projectUniqueId:FDBK.library.currentProject.uniqueId,parentUniqueId:c,pageId:d,text:g,attributes:JSON.stringify(i),author:FDBK.USER_DATA}),e.val("").blur(),c&&$(".cancel-comment").click()}f()}this.$sidebarComments=$("#comments"),this.$commentsWrapper=$(".comments-wrapper"),this.$commentsButton=$("#comments-button"),this.$metaGhostWrapper=$("#meta-ghost-wrapper");var a=BrowserDetect.isMac?"&#8984;&#8617;":"Ctrl+Enter";$(".submit-comment-shortcut").html(a);var b=this;FDBK.sub("open-project",function(){this.$commentsButton.removeClass("disabled").find(".comment-count").text("Comments"),FDBK.VIEWER_MODE&&FDBK.library.currentProject.ownerIsPremium&&!FDBK.USER_DATA.userName&&(this.$commentsButton.hide(),$("#notification-settings").hide(),FDBK.API.xhr(FDBK.API.CALL_GET_CURRENT_USER,{success:function(a){a.success&&(FDBK.USER_DATA=$.extend(FDBK.USER_DATA,a.object.user)),b.$commentsButton.show(),FDBK.library.currentProject.canCommentProject()&&$("#notification-settings").show(),FDBK.pub("viewer-user-logged-in")},error:function(){b.$commentsButton.show()}}))}),FDBK.sub("close-project",function(){this.$commentsButton.addClass("disabled")}),FDBK.sub("user-logged-out close-project",function(){this.$commentsButton.find(".comment-count").text("Comments"),this.$commentsButton.removeClass("pressed"),this.comments.length=0,this.$sidebarComments.empty(),$("body").removeClass("has-right-sidebar")}),FDBK.sub("viewer-user-logged-in mockup-changed",function(){FDBK.library.currentProject&&(FDBK.hasPremiumPlan()||FDBK.library.currentProject.isPremiumProject())&&FDBK.library.currentProject.canCommentProject()&&b.showComments()}),FDBK.sub("open-project refresh-comments",function(a){FDBK.library.currentProject&&(FDBK.hasPremiumPlan()||FDBK.library.currentProject.isPremiumProject())&&FDBK.library.currentProject.canCommentProject()&&b.fetchComments()}),FDBK.config("comments.stencilLinks.enabled")&&$(document).on("click",".comment-link",function(){FDBK.goToStencils($(this).data("stencil-ids").split(" "))}),b.$commentsButton.on("click",function(){if($(this).hasClass("disabled"))return;if(FDBK.VIEWER_MODE&&!FDBK.USER_DATA.userName){FDBK.library.askForSession();return}if(FDBK.VIEWER_MODE&&!FDBK.library.currentProject.canCommentProject()){FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_You're not authorized to comment on this project"),buttons:[{text:FDBK.loc("_OK"),classes:"close-modal"}]});return}if(!FDBK.VIEWER_MODE&&!FDBK.hasPremiumPlan()&&!FDBK.library.currentProject.isPremiumProject()){FDBK.showCommentsAlert();return}$(this).toggleClass("pressed"),$("body").toggleClass("has-right-sidebar")}),$("#comments").on("click","a",function(a){var c=$(this).data("type"),d=$(a.target).closest(".comment"),e=d.data("id");if(c==="delete")d.length>0&&(a.shiftKey?b.deleteComment(e):FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_Are you sure you want to delete this comment ?"),buttons:[{text:FDBK.loc("_Delete"),classes:"primary-action",onClick:function(){b.deleteComment(e)}},{text:FDBK.loc("_Cancel"),classes:"close-modal"}]}));else if(c==="reply")b.replyToCommentId=e,$("#add-comment").find(".new").hide().end().find(".reply").show(),$(this).parents(".comment").siblings().addClass("disabled"),$("#new-comment").prop("placeholder","Reply to comment...").focus();else if(c==="unlink")b.unlinkComment(e);else if(c=="page"){var f=$(this).data("page");f&&b.goToMockup(f)}});var c=$("#comments-sidebar"),d=$("#add-comment"),e=function(){c.removeClass("hide-new-comment")},f=function(){c.addClass("hide-new-comment")};FDBK.config("comments.stencilLinks.enabled")&&FDBK.sub("selection-changed",function(a){a.length?d.addClass("link-to-stencil"):d.removeClass("link-to-stencil")}),$("#new-comment").on({focus:e}),$(document).on("click",".cancel-comment",function(){b.replyToCommentId=!1,$("#add-comment").find(".reply").hide().end().find(".new").show(),$(".comment").removeClass("disabled"),$("#new-comment").prop("placeholder","New comment..."),f()}),$(document).on("click",".send-comment",g),$("#new-comment").on("keydown",null,"meta+return ctrl+return",g),jQuery.fn.highlight=function(a,b){$(this).each(function(){var c=$(this);c.before("<div/>"),c.prev().width(c.width()).height(c.height()).css({position:"absolute","background-color":a,opacity:".7"}).fadeOut(b)})},FDBK.sub("open-project",function(){$("[name=comments-notification]").prop("checked",FDBK.library.currentProject.notifications)}),$(document).on("change","[name=comments-notification]",function(){var a=$(this).is(":checked");FDBK.library.currentProject.notifications=a,FDBK.API.xhr(FDBK.API.CALL_SET_NOTIFICATION,{data:{value:a,projectUniqueId:FDBK.library.currentProject.uniqueId},contentType:"application/x-www-form-urlencoded"})}),FDBK.config("comments.allVsCurrent.enabled")?($("#comments-selector").on("click","a",function(){var a=$(this).data("value");switch(a){case"all":FDBK.commentsSelection=FDBK.COMMENTS_SELECTION_ALL;break;case"current":FDBK.commentsSelection=FDBK.COMMENTS_SELECTION_CURRENT}$(this).addClass("selected").siblings("a").removeClass("selected"),b.showComments()}),$("#comments-selector a[data-value="+FDBK.commentsSelection+"]").addClass("selected")):$("#comments-selector").hide()},goToMockup:function(a){a!==FDBK.library.currentMockup.id&&(FDBK.VIEWER_MODE?FDBK.switchToMockup(FDBK.library.currentProject.mockup(a),!0):FDBK.library.changeActiveMockup(a))},goToStencils:function(a){if(!a.length)return;var b=FDBK.library,c=b.currentProject.mockupFromStencilId(a[0]);if(!c){console.info("This stencil is not available; mockup not found.");return}this.goToMockup(c.id);var d=a.filter(function(a){return b.currentMockup.stencil(a)!==null&&document.getElementById(a)});if(d.length){FDBK.VIEWER_MODE?FDBK.highlightStencils(d):(b.currentMockup.selection=d.map(function(a){return document.getElementById(a)}),b.showSelection(),b.focusStage());var e=Math.min.apply(this,d.map(function(a){return b.currentMockup.stencil(a).top})),f=Math.min.apply(this,d.map(function(a){return b.currentMockup.stencil(a).left})),g=FDBK.VIEWER_MODE?document.getElementById("page"):document.getElementById("project-wrapper");g.scrollLeft=f,g.scrollTop=e}else FDBK.VIEWER_MODE||(b.currentMockup.selection.length=0,b.showSelection(),b.focusStage())},showCommentGhosts:function(a){for(var b=0;b<a.length;b++){var c=a[b].id,d=FDBK.library.currentMockup.stencil(c);d&&this.$metaGhostWrapper.find("[data-stencil="+c+"]").css({top:d.top,left:d.left})}this.$metaGhostWrapper.removeClass("hidden")},hideCommentGhosts:function(a){this.$metaGhostWrapper.addClass("hidden")},getCommentsForPage:function(a){return this.comments.filter(function(b){return!a||b.pageId===a})},getComment:function(a){var b=this.getCommentsForPage();for(var c=0;c<b.length;c++){var d=b[c];if(d.uniqueId==a)return d}return null},sortComments:function(){var a=function(a,b){return a.createDate?b.createDate?a.createDate>b.createDate?-1:a.createDate<b.createDate?1:0:1:-1},b=function(a,b){return a.createDate?b.createDate?a.createDate>b.createDate?1:a.createDate<b.createDate?-1:0:-1:1};this.comments=this.comments.filter(function(a){return!a.parentUniqueId}).sort(a).concat(this.comments.filter(function(a){return a.parentUniqueId}).sort(b))},getCommentSummary:function(a){var b="",c=this.getComment(a);return c.text.length<=30?b=c.text:b=c.text.substring(0,30)+"...",b},scrollSidebarToComment:function(a){var b=this.getComment(a),c=a;b.parentUniqueId&&(c=b.parentUniqueId);var d=this.$sidebarComments.find("[data-id="+c+"]");this.$commentsWrapper.scrollTop(this.$commentsWrapper.scrollTop()+d.position().top),this.$sidebarComments.find("[data-id="+a+"]").highlight("#c2e2fd",600)},showComments:function(a){var b=FDBK.commentsSelection===FDBK.COMMENTS_SELECTION_ALL?null:FDBK.library.currentMockup.id,c=this.getCommentsForPage(b);a&&a.highlight&&(this._commentHighlightTimer||(this._commentHighlightTimer=AppSeeds.Scheduler.create(function(){FDBK.$commentsButton.removeClass("button-highlighted")}).delay(1e3)),this.$commentsButton.addClass("button-highlighted"),this._commentHighlightTimer.reset());var d=FDBK.library.currentProject.canDeleteComments(),e=$("#tmpl-comment");this.$sidebarComments.empty(),this.$commentsButton.find(".comment-count").text(FDBK.pluralize("_commentsCount",this.comments.length));if(c.length)for(var f=0;f<c.length;f++){var g=c[f],h=FDBK.library.currentProject.mockup(g.pageId),i=h?h.name:"a deleted page";g=$.extend(!0,g,{canDeleteComment:d,pageTitle:i,sourceExists:h!=null,showSource:b===null,commentMarkdownHtml:utils.markdown(g.text),timestamp:moment(Math.min(g.createDate,FDBK.SERVER_TIME)).from(Math.max(FDBK.SERVER_TIME,g.createDate))+"",author:{avatarImage:utils.getAvatarImageURL({email:g.author.email,avatar:g.author.avatar})}}),!FDBK.config("comments.stencilLinks.enabled")&&g.attributes&&g.attributes.stencilIds&&delete g.attributes.stencilIds;var j=g.parentUniqueId?this.$sidebarComments.find("[data-id="+g.parentUniqueId+"]"):this.$sidebarComments;j.append(e.loc_tmpl(g))}else this.$sidebarComments.append('<p class="no-comments">'+FDBK.loc("_No comments for this page.")+"</p>")},ALL_PAGES:"ALL_PAGES_EVER",fetchComments:function(){var a=this;FDBK.API.xhr(FDBK.API.CALL_GET_COMMENTS,{data:{projectUniqueId:FDBK.library.currentProject.uniqueId},success:function(b){b.success?(a.comments=(b.object||[]).map(a.prepareComments),a.sortComments(),a.showComments({highlight:!0})):a.showErrorOnFetchComments()},error:function(){a.showErrorOnFetchComments()}})},showErrorOnFetchComments:function(){},prepareComments:function(a){if(typeof a.attributes=="string")try{a.attributes=JSON.parse(a.attributes)}catch(b){console.warn("could not parse comment attributes")}return a},addComment:function(a,b){this.prepareComments(b),this.comments.push(b),this.sortComments(),this.showComments(),this.scrollSidebarToComment(b.uniqueId),FDBK.pub("comment-posted",a,b)},postComment:function(a){function g(a,c){var d=b.comments;for(var e=0;e<d.length;e++)d[e].uniqueId===a&&(d[e].uniqueId=c.uniqueId,d[e].createDate=c.createDate);b.showComments()}var b=this,c=FDBK.library.currentMockup.id,d=["projectUniqueId","parentUniqueId","pageId","text","attributes"],e={};for(var f=0;f<d.length;f++)e[d[f]]=a[d[f]];FDBK.API.xhr(FDBK.API.CALL_ADD_COMMENT,{data:JSON.stringify(e),success:function(b){b.success?g(a.uniqueId,b.object):FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error posting your comment. Please try again."),buttons:[{text:FDBK.loc("_Close"),classes:"close-modal"}]})},error:function(){FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error posting your comment. Please try again."),buttons:[{text:FDBK.loc("_Close"),classes:"close-modal"}]})}}),b.addComment(c,a)},unlinkComment:function(a){},deleteComment:function(a){var b=this,c=FDBK.library.currentMockup.id;this.comments=this.comments.filter(function(b){return b.uniqueId!=a&&b.parentUniqueId!=a}),this.showComments(),FDBK.API.xhr(FDBK.API.CALL_DELETE_COMMENTS,{data:{uniqueId:a},success:function(a){a.success?FDBK.pub("comment-posted",c):FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error while deleting the comment. Please try again."),buttons:[{text:FDBK.loc("_Close"),classes:"close-modal"}]})},error:function(){FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error while deleting the comment. Please try again."),buttons:[{text:FDBK.loc("_Close"),classes:"close-modal"}]})}})}})